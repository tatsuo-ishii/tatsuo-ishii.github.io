<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Watchdog</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="Pgpool-II 4.2devel 文書"
HREF="index.html"><LINK
REL="UP"
TITLE="サーバの設定"
HREF="runtime-config.html"><LINK
REL="PREVIOUS"
TITLE="Secure Sockect Layer (SSL)"
HREF="runtime-ssl.html"><LINK
REL="NEXT"
TITLE="その他の設定パラメータ"
HREF="runtime-misc.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2020-08-14T12:08:09"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>Pgpool-II 4.2devel 文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="Secure Sockect Layer (SSL)"
HREF="runtime-ssl.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="runtime-config.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>第 5章サーバの設定</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="その他の設定パラメータ"
HREF="runtime-misc.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="RUNTIME-WATCHDOG-CONFIG"
>5.14. Watchdog</A
></H1
><P
>  
  Watchdogの設定パラメータはpgpool.confに記述されています。
  <TT
CLASS="FILENAME"
>pgpool.conf.sample</TT
>のWATCHDOG節に設定の例があります。
  以下のすべてのオプションがwatchdogプロセスでは指定されている必要があります。
 </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CONFIG-ENABLE-WATCHDOG"
>5.14.1. Watchdogを有効にする</A
></H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-USE-WATCHDOG"
></A
><TT
CLASS="VARNAME"
>use_watchdog</TT
> (<TT
CLASS="TYPE"
>boolean</TT
>)
     </DT
><DD
><P
>      
      onならwatchdogを有効にします。
      デフォルトはoffです。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CONFIG-COMMUNICATION-WATCHDOG"
>5.14.2. Watchdog通信</A
></H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-HOSTNAME"
></A
><TT
CLASS="VARNAME"
>hostnameX</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>サーバのホスト名またはIPアドレスを指定します。
      クエリやパケットの送受信の他、watchdogの識別子としても用います。
      パラメータ名の最後にある数字は「pgpool ノードID」で、0から始まります(たとえばhostname0)。
     </P
><P
>      
     </P
></DD
><DT
><A
NAME="GUC-WD-PORT"
></A
><TT
CLASS="VARNAME"
>wd_portX</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
     </DT
><DD
><P
>      
      watchdogが接続を受け付けるために監視するポート番号です。
      デフォルト値は9000です。
      パラメータ名の最後にある数字は「pgpool ノードID」で、0から始まります(たとえばwd_port0)。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-PGPOOL-PORT"
></A
><TT
CLASS="VARNAME"
>pgpool_portX</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
     </DT
><DD
><P
>      
      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>サーバのポート番号を指定します。
      デフォルト値は9999です。
      パラメータ名の最後にある数字は「pgpool ノードID」で、0から始まります(たとえばpgpool_port0)。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
><DIV
CLASS="EXAMPLE"
><A
NAME="EXAMPLE-WATCHDOG-1"
></A
><P
><B
>例 5-8. Watchdogの設定例</B
></P
><P
>       
       Pgpool ノードが3つあり、それぞれのホストが server1、server2、server3 の場合、
       <A
HREF="runtime-watchdog-config.html#GUC-HOSTNAME"
>hostname</A
>、<A
HREF="runtime-watchdog-config.html#GUC-WD-PORT"
>wd_port</A
>
       及び<A
HREF="runtime-watchdog-config.html#GUC-PGPOOL-PORT"
>pgpool_port</A
>を以下のように設定します。
    </P><PRE
CLASS="PROGRAMLISTING"
>     hostname0 = 'server1'
     wd_port0 = 9000
     pgpool_port0 = 9999

     hostname1 = 'server2'
     wd_port1 = 9000
     pgpool_port1 = 9999

     hostname2 = 'server3'
     wd_port2 = 9000
     pgpool_port2 = 9999
    </PRE
><P>
      </P
></DIV
></DD
><DT
><A
NAME="GUC-WD-AUTHKEY"
></A
><TT
CLASS="VARNAME"
>wd_authkey</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      wachdog間通信で用いられる認証キーを指定します。
      全ての<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>で同じキーを指定する必要があります。
      認証キーが異なるwatchdogからの通信は拒絶されます。
      死活監視を<TT
CLASS="LITERAL"
>heartbeat</TT
>モードで行う場合には、この認証はハートビート信号にも適用されます。
     </P
><P
>      
      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>V3.5</I
></SPAN
>以降では<TT
CLASS="VARNAME"
>wd_authkey</TT
>がwatchdog IPCクライアントの認証にも使われるため、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>と通信するwatchdogプロセスは、<TT
CLASS="LITERAL"
>"IPCAuthKey"</TT
>のコマンドのJSONデータにwd_authkey値を設定しなければなりません。
     </P
><P
>      
      デフォルトは<TT
CLASS="LITERAL"
>''</TT
>（空文字）で、この場合watchdogの認証は行われません。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CONFIG-WATCHDOG-UPSTREAM-CONNECTIONS"
>5.14.3. 上流サーバへの接続</A
></H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-TRUSTED-SERVERS"
></A
><TT
CLASS="VARNAME"
>trusted_servers</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      上位接続を確認するための信頼できるサーバのリストを指定します。
      リスト中の各サーバは、pingの応答に答える必要があります。
      <TT
CLASS="LITERAL"
>"hostA,hostB,hostC"</TT
>のようにカンマで区切って複数のサーバを指定できます。
      全てのサーバに到達できなくなると、watchdogは<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>に障害が発生したと判断します。
      そのため、複数のサーバを指定することを推奨します。
      なお、このパラメータにPostgreSQLサーバを指定することはしないでください。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-PING-PATH"
></A
><TT
CLASS="VARNAME"
>ping_path</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      上位サーバへの接続監視に利用するpingコマンドのパスを指定します。
      <TT
CLASS="LITERAL"
>"/bin"</TT
>のようにパスだけを指定します。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CONFIG-WATCHDOG-VIP-CONTROL"
>5.14.4. 仮想IP制御</A
></H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-DELEGATE-IP"
></A
><TT
CLASS="VARNAME"
>delegate_IP</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      （アプリケーションサーバなど）クライアントサーバから接続される<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の仮想IP（VIP） アドレスを指定します。
      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>がスタンバイからアクティブに切り替わった時、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>はこのVIPを引き継ぎます。
      <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>クォーラムが存在しなければVIPは立ち上がりません</I
></SPAN
>。
      デフォルトは<TT
CLASS="LITERAL"
>''</TT
>（空文字）で、この場合仮想IPは決して立ち上がりません。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-IF-CMD-PATH"
></A
><TT
CLASS="VARNAME"
>if_cmd_path</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>が仮想IPを切り替えるために使用するコマンドへのパスを指定します。
      <TT
CLASS="LITERAL"
>"/sbin"</TT
>のようにパスだけを指定します。
      <TT
CLASS="VARNAME"
>if_up_cmd</TT
>や<TT
CLASS="VARNAME"
>if_down_cmd</TT
>に指定したコマンドが"/"で始まる場合、
      フルパスとみなし<TT
CLASS="VARNAME"
>if_cmd_path</TT
>の設定を無視します。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-IF-UP-CMD"
></A
><TT
CLASS="VARNAME"
>if_up_cmd</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      仮想IPを起動するために実行するコマンドを指定します。
      <TT
CLASS="COMMAND"
>"ip addr add $_IP_$/24 dev eth0 label eth0:0"</TT
>のようにコマンドとパラメータを指定します。
      こをコマンドを実行するには<TT
CLASS="LITERAL"
>root</TT
>権限が必要となりますので、一般ユーザが実行できるように
      <TT
CLASS="COMMAND"
>ip</TT
>コマンドに<TT
CLASS="COMMAND"
>setuid</TT
>を設定するか、
      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>起動ユーザ(デフォルトでは<TT
CLASS="LITERAL"
>postgres</TT
>)がパスワードなしに<TT
CLASS="COMMAND"
>sudo</TT
>を実行できるように設定し、
      <TT
CLASS="COMMAND"
>sudo</TT
>を介したコマンドを<TT
CLASS="LITERAL"
>"/usr/bin/sudo /sbin/ip addr add $_IP_$/24 dev eth0 label eth0:0"</TT
>のように指定します。
      <TT
CLASS="LITERAL"
>$_IP_$</TT
>は<A
HREF="runtime-watchdog-config.html#GUC-DELEGATE-IP"
>delegate_IP</A
>で指定されたIPアドレスに置換されます。
     </P
><P
>      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-IF-DOWN-CMD"
></A
><TT
CLASS="VARNAME"
>if_down_cmd</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      仮想IPを停止するために実行するコマンドを指定します。
      <TT
CLASS="LITERAL"
>"ip addr del $_IP_$/24 dev eth0"</TT
>のようにコマンドとパラメータを指定します。
      こをコマンドを実行するにはroot権限が必要となりますので、一般ユーザが実行できるように
      <TT
CLASS="COMMAND"
>ip</TT
>コマンドに<TT
CLASS="COMMAND"
>setuid</TT
>を設定するか、
      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>起動ユーザ(デフォルトでは<TT
CLASS="LITERAL"
>postgres</TT
>)がパスワードなしに<TT
CLASS="COMMAND"
>sudo</TT
>を実行できるように設定し、
      <TT
CLASS="COMMAND"
>sudo</TT
>を介したコマンドを<TT
CLASS="LITERAL"
>"/usr/bin/sudo /sbin/ip addr del $_IP_$/24 dev eth0"</TT
>のように指定します。
      <TT
CLASS="LITERAL"
>$_IP_$</TT
>は<A
HREF="runtime-watchdog-config.html#GUC-DELEGATE-IP"
>delegate_IP</A
>で指定されたIPアドレスに置換されます。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-ARPING-PATH"
></A
><TT
CLASS="VARNAME"
>arping_path</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      IPアドレス切り替え後に<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>がARPリクエストを送信するコマンドへのパス指定します。
      <TT
CLASS="LITERAL"
>"/usr/sbin"</TT
>のようにパスだけを指定します。
      <TT
CLASS="VARNAME"
>arping_cmd</TT
>に指定したコマンドが"/"で始まる場合、
      フルパスとみなし<TT
CLASS="VARNAME"
>arping_path</TT
>の設定を無視します。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-ARPING-CMD"
></A
><TT
CLASS="VARNAME"
>arping_cmd</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      IPアドレス切り替え後にARPリクエストを送信するコマンドです。
      <TT
CLASS="LITERAL"
>"arping -U $_IP_$ -w 1 -I eth0"</TT
>のようにコマンドとパラメータを指定します。
      こをコマンドを実行するにはroot権限が必要となりますので、一般ユーザが実行できるように
      <TT
CLASS="COMMAND"
>arping</TT
>コマンドに<TT
CLASS="LITERAL"
>setuid</TT
>を設定するか、
      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>起動ユーザ(デフォルトでは<TT
CLASS="LITERAL"
>postgres</TT
>ユーザ)がパスワードなしに<TT
CLASS="COMMAND"
>sudo</TT
>を実行できるように設定し、
      <TT
CLASS="COMMAND"
>sudo</TT
>を介したコマンドを<TT
CLASS="LITERAL"
>"/usr/bin/sudo /usr/sbin/arping -U $_IP_$ -w 1 -I eth0"</TT
>のように設定します。
      <TT
CLASS="LITERAL"
>$_IP_$</TT
>は<A
HREF="runtime-watchdog-config.html#GUC-DELEGATE-IP"
>delegate_IP</A
>で指定されたIPアドレスに置換されます。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CONFIG-WATCHDOG-ESCALATION-DE-ESCALATION"
>5.14.5. 昇格および降格時の振る舞い</A
></H2
><P
>   
   <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>がアクティブ（仮想IPを保持しているステータス）に昇格した時の振る舞いを指定します。
  </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-CLEAR-MEMQCACHE-ON-ESCALATION"
></A
><TT
CLASS="VARNAME"
>clear_memqcache_on_escalation</TT
> (<TT
CLASS="TYPE"
>boolean</TT
>)
     </DT
><DD
><P
>      
      このオプションがonの場合、pgpool-II がアクティブに昇格した時に、共有メモリ上のクエリキャッシュを全て削除します。
      これにより、新しいアクティブの<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>が旧アクティブと非整合な古いクエリキャッシュを使うことを防止します。
     </P
><P
>      
      デフォルトはonです。
     </P
><P
>      
      <A
HREF="runtime-in-memory-query-cache.html#GUC-MEMQCACHE-METHOD"
>memqcache_method</A
>が'shmem'の場合のみ有効です。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-WD-ESCALATION-COMMAND"
></A
><TT
CLASS="VARNAME"
>wd_escalation_command</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      マスターwatchdogに昇格した時に、ここで指定したコマンドがwatchdogによって実行されます。
     </P
><P
>      
      コマンドは、そのノードに仮想IPが設定されていた場合、それが立ち上がる直前のタイミングで実行されます。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-WD-DE-ESCALATION-COMMAND"
></A
><TT
CLASS="VARNAME"
>wd_de_escalation_command</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>のマスターwatchdogが責務を辞退し降格するときに、ここで指定したコマンドが実行されます。
      マスターwatchdogノードは、そのマスターノードの<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>が停止したとき、ネットワーク切断や<I
CLASS="FIRSTTERM"
>クォーラム(quorum)</I
>が失われたことを検出した時に、マスターから辞任します。
     </P
><P
>      
      このコマンドは、watchdogノードに仮想IPアドレスが設定されていた場合、それが停止される直前のタイミングで実行されます。
     </P
><P
>      
      <TT
CLASS="VARNAME"
>wd_de_escalation_command</TT
>は、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>V3.5</I
></SPAN
>より前のバージョンには提供されていません。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CONFIG-WATCHDOG-FAILOVER-BEHAVIOR"
>5.14.6. フェイルオーバの挙動の制御</A
></H2
><P
>   
   これらの設定は、<SPAN
CLASS="APPLICATION"
>watchdog</SPAN
>機能が有効な場合に、バックエンドノードのフェイルオーバの動作を制御するために使用されます。
   これらの設定の影響は、内部的な<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>のフェイルオーバ/縮退要求のみに影響します。
   一方、(PCPコマンドを使った)ユーザが起動したバックエンド切り離し操作では、これらの設定項目は迂回され適用されません。
  </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-FAILOVER-WHEN-QUORUM-EXISTS"
></A
><TT
CLASS="VARNAME"
>failover_when_quorum_exists</TT
> (<TT
CLASS="TYPE"
>boolean</TT
>)
     </DT
><DD
><P
>      このパラメータを有効にすると、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>がバックエンドノードの縮退/フェイルオーバを実行する際にクォーラムが存在するかどうかを考慮するようになります。
     </P
><P
>      「クォーラムが存在する」とは、生きているwatchdogノードの数(<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の数)を全部足して、すべてのwatchdogノードの数に対して多数派を形成できる場合のことを指します。
      たとえば、watchdogノード数が5のとき、生きているノード数が3以上なら多数派を形成できるのでクォーラムは存在しますが、生きているノード数が2以下なら多数派を形成できないのでクォーラムは存在しません。
     </P
><P
>      クォーラムが存在すると、一つのwatchdogノードがバックエンドの障害を誤検知しても他の多数派のノードに否決されるので、障害誤検知に対して堅牢になります。
      これは<A
HREF="runtime-watchdog-config.html#GUC-FAILOVER-REQUIRE-CONSENSUS"
>failover_require_consensus</A
>がオン(デフォルト)の動作ですが、設定によって多数派を形成しなくても直ちにフェイルオーバするようにすることもできます。
       バックエンドの障害を誤って検出した<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードは、障害の発生したバックエンドノードを隔離します。
     </P
><P
>      クォーラムの存在の有無は、<A
HREF="pcp-watchdog-info.html"
>pcp_watchdog_info</A
>コマンドを<TT
CLASS="LITERAL"
>--verbose</TT
>オプション付きで起動することで確認できます。
       <TT
CLASS="LITERAL"
>Quorum state</TT
>が<TT
CLASS="LITERAL"
>QUORUM EXIST</TT
>または<TT
CLASS="LITERAL"
>QUORUM IS ON THE EDGE</TT
>ならクォーラムは存在します。
       <TT
CLASS="LITERAL"
>Quorum state</TT
>が<TT
CLASS="LITERAL"
>QUORUM ABSENT</TT
>ならクォーラムは存在しません。
     </P
><P
>      なお、watchdogノード数が偶数の場合は、生きているノード数がすべてのwatchdogノード数の半数以上ならクォーラムが存在するとみなします。
      たとえば全watchdogノード数が4で、生きているノード数が2以上ならクォーラムが存在するとみなします。
     </P
><P
>      クォーラムが存在しない場合、クォーラムが再び存在するまで、バックエンドの障害を検出した<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードは、障害の発生したバックエンドノードを隔離します。
     </P
><P
>      隔離されたノードを<TT
CLASS="COMMAND"
>pcp_detach_node</TT
>コマンドで強制的にフェイルオーバさせることは可能ですが、<TT
CLASS="COMMAND"
>pcp_attach_node</TT
>コマンドで再びアタッチ状態にすることはできません。
     </P
><P
>      
      隔離されたノードの動作は切り離されたバックエンドノードと似ていますが、フェイルオーバ/縮退と異なり、隔離ステータスはwatchdogクラスタ内の他の<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードに伝播されません。
      したがって、他の<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードは引き続きそのバックエンドを使用し続ける可能性があります。
     </P
><P
>      
      隔離とフェイルオーバ操作には多くの類似点がありますが、どちらも非常に基本的な方法で異なります。
      隔離操作は<A
HREF="runtime-config-failover.html#GUC-FAILOVER-COMMAND"
>failover_command</A
>を実行せず、障害の発生したノードを隔離します。
       この隔離されたノードがマスタの場合、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>はスタンバイをマスタに昇格させないので、マスタノードが隔離されている間は、使用可能なマスタバックエンドノードはありません。
     </P
><P
>      更に、障害ノードとは違い、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>は隔離されたノードに対してはヘルスチェックを実行し続けます。
      隔離されたノードが到達可能になり次第、そのノードは自動的に再度アタッチされます。
      これは<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II </SPAN
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>V4.1</I
></SPAN
>以降にのみ適用されることに注意してください。
      それ以前のバージョンをお使いの場合は、隔離されたノードに対する接続性の問題が解決されたら、<A
HREF="pcp-attach-node.html"
>pcp_attach_node</A
>を使ってそのノードを復帰させさなければなりません。
     </P
><P
>      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II </SPAN
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>V4.1</I
></SPAN
>以後では、プライマリノードのフェイルオーバに関してwatchdogのマスタノードが合意形成に失敗し、その結果プライマリバックエンドが隔離状態になった場合、そのマスタノードはマスタ/コーディネータの枠割を辞退し、次のリーダの選挙の際にwd_priorityを引き下げることにより、クラスタが新しいリーダを選ぶように仕向けます。
      </P><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
>	スタンバイバックエンドの障害時にマスタノードが合意形成に失敗した場合は、特にアクションは起こしません。
	watchdogマスタが管理する隔離されたスタンバイバックエンドは新しいリーダの選挙を引き起こしません。
       </P
></BLOCKQUOTE
></DIV
><P>
     </P
><P
>      このパラメータがoffなら、クォーラムが存在しなくても障害が発生するとフェイルオーバします。
     </P
><P
>      
      デフォルト値はonです。
     </P
><P
>      
      failover_when_quorum_existsは<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II </SPAN
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>V3.7</I
></SPAN
>より前では利用できません。
     </P
><P
>      
      このパラメータは、サーバーの起動時にのみ設定できます。
     </P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
>       
       ネイティブレプリケーションモードでは<TT
CLASS="VARNAME"
>failover_when_quorum_exists</TT
>機能は利用できません。
      </P
></BLOCKQUOTE
></DIV
></DD
><DT
><A
NAME="GUC-FAILOVER-REQUIRE-CONSENSUS"
></A
><TT
CLASS="VARNAME"
>failover_require_consensus</TT
> (<TT
CLASS="TYPE"
>boolean</TT
>)
     </DT
><DD
><P
>      
      このパラメータを有効にすると、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>は、<SPAN
CLASS="APPLICATION"
>watchdog</SPAN
>クォーラムが存在し、少なくともクォーラム投票に必要なノードの最小数があれば、バックエンドノードで縮退/フェイルオーバを実行します。
     </P
><P
>      
      たとえば、3ノードの<SPAN
CLASS="APPLICATION"
>watchdog</SPAN
>のクラスタでは、フェイルオーバは、少なくとも2つのノードが特定のバックエンドノードに対してフェイルオーバの実行要求をするときのみ実行されます。
     </P
><P
>      このパラメータがoffなら、投票で合意が取れなくてもフェイルオーバします。
     </P
><P
>      
      デフォルト値はonです。
     </P
><P
>&#13;      
      <DIV
CLASS="CAUTION"
><P
></P
><TABLE
CLASS="CAUTION"
BORDER="1"
WIDTH="90%"
><TR
><TD
ALIGN="CENTER"
><B
>注意</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
>	<TT
CLASS="VARNAME"
>failover_require_consensus</TT
>が有効な場合、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>は他            の<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードから充分な投票を得るまでフェイルオーバしません。
	ですから、正しくバックエンドの障害を検出するために、すべての<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードでヘルスチェックを有効にすることを強く推奨します。
	ヘルスチェックに関する詳細については、<A
HREF="runtime-config-health-check.html"
>項5.8</A
>をご覧ください。
       </P
></TD
></TR
></TABLE
></DIV
>

      </P><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
>        
        ネイティブレプリケーションモードでは<TT
CLASS="VARNAME"
>failover_require_consensus</TT
>機能は利用できません。
       </P
></BLOCKQUOTE
></DIV
><P>

      
      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>V3.7</I
></SPAN
>より前では<TT
CLASS="VARNAME"
>failover_require_consensus</TT
>は利用できません。
      <A
HREF="runtime-watchdog-config.html#GUC-FAILOVER-WHEN-QUORUM-EXISTS"
>failover_when_quorum_exists</A
>が有効な場合にのみ有効です。
     </P
><P
>      
      このパラメータは、サーバの起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-ALLOW-MULTIPLE-FAILOVER-REQUESTS-FROM-NODE"
></A
><TT
CLASS="VARNAME"
>allow_multiple_failover_requests_from_node</TT
> (<TT
CLASS="TYPE"
>boolean</TT
>)
     </DT
><DD
><P
>      
      このパラメータは、<A
HREF="runtime-watchdog-config.html#GUC-FAILOVER-REQUIRE-CONSENSUS"
>failover_require_consensus</A
>と連携して動作します。
       有効にすると、単一の<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードが複数のフェイルオーバ投票をできます。
     </P
><P
>      
      たとえば、3ノードの<SPAN
CLASS="APPLICATION"
>watchdog</SPAN
>クラスタでは、1つの<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードが特定のバックエンドノードのフェイルオーバに対して2つのフェイルオーバ要求を送信すると、両方の要求が別の投票としてカウントされ、たとえ他の<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードからの投票を得なくても、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>がフェイルオーバを実行します。 
     </P
><P
>      たとえば、ヘルスチェックでエラーが検出されても有効投票数に達しない場合、障害が引き続き発生していて次のヘルスチェックで再度エラーが検出されれば、都合2票が投票されることになります。ほかのwatchdogが検出しない恒久的な障害が発生した際にフェイルオーバを引き起こしたい時に有用です。
     </P
><P
>      
      デフォルト値はoffです。
     </P
><P
>      
      <TT
CLASS="VARNAME"
>allow_multiple_failover_requests_from_node</TT
>は、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II </SPAN
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>V3.7</I
></SPAN
>以前では利用できません。
      <A
HREF="runtime-watchdog-config.html#GUC-FAILOVER-WHEN-QUORUM-EXISTS"
>failover_when_quorum_exists</A
>と<A
HREF="runtime-watchdog-config.html#GUC-FAILOVER-REQUIRE-CONSENSUS"
>failover_require_consensus</A
>の両方が有効な場合にのみ有効です。
     </P
><P
>      
      このパラメータは、サーバの起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-ENABLE-CONSENSUS-WITH-HALF-VOTES"
></A
><TT
CLASS="VARNAME"
>enable_consensus_with_half_votes</TT
> (<TT
CLASS="TYPE"
>boolean</TT
>)
     </DT
><DD
><P
>      このパラメータは<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>が、クォーラムとフェイルオーバにおける合意を解決する際に、どのように多数決ルールにおける計算を行うかを設定します。
     </P
><P
>      このパラメータがオンなら、クォーラムとフェイルオーバの合意のために、全体のうち半数の投票だけでよくなります。
      そうでなければ、全体のうち少なくとも半数に加えて1票の投票が必要になります。
      フェイルオーバにおいては、これは<A
HREF="runtime-watchdog-config.html#GUC-FAILOVER-REQUIRE-CONSENSUS"
>failover_require_consensus</A
>と同期して動作します。
      クォーラムの存在決定、フェイルオーバにおける合意形成の両方において、watchdogクラスタが偶数の<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードから構成されている場合にのみこのパラメータは効果があります。
      参加者が奇数のwatchdogクラスタにおける多数決決定の際には、このパラメータの設定値は影響しません。
     </P
><P
>      たとえば、このパラメータがオンのときは、2ノードのwatchdogクラスタではクォーラムが存在するためには一つの<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードが生きている必要があります。
      このパラメータがオフのときは、2ノードのwatchdogクラスタではクォーラムが存在するためには2つの<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードが生きている必要があります。
     </P
><P
>      このパラメータがオンのときは、4ノードのwatchdogクラスタではクォーラムが存在するためには2つの<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードが生きている必要があります。
      このパラメータがオフのときは、3ノードのwatchdogクラスタではクォーラムが存在するためには2つの<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>ノードが生きている必要があります。
     </P
><P
>      このパラメータがオンのときは、split-brainが発生するリスクがあることに注意してください。
      たとえば、ノードA, B, C, Dからなる4ノードのクラスタでは、(A, B)と(C, D)の分断された2つのネットワークになる可能性があります。
      (A, B)と(C, D)にとっては、それぞれ生きた2つのノードが存在するので、クォーラムは依然として存在します。
      各々のグループはそれぞれのマスタwatchdogを選び、これはすなわちsplit-brainです。
     </P
><P
>      デフォルト値はオフです。
     </P
><P
>      <TT
CLASS="VARNAME"
>enable_consensus_with_half_votes</TT
>は<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
><SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>V4.1</I
></SPAN
>よりも前には存在しません。
      以前のバージョンは、あたかもこのパラメータがオンであるかのように動作します。
     </P
><P
>      このパラメータは、サーバの起動時にのみ設定できます。
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CONFIG-WATCHDOG-LIFECHECK"
>5.14.7. <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の死活監視</A
></H2
><P
>   
   Watchdogは、定期的にpgpool-IIの状態を監視します。

  </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-WD-LIFECHECK-METHOD"
></A
><TT
CLASS="VARNAME"
>wd_lifecheck_method</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      死活監視の方法を指定します。
      指定できる値は <TT
CLASS="LITERAL"
>'heartbeat'</TT
> (デフォルト)、<TT
CLASS="LITERAL"
>'query'</TT
>、または<TT
CLASS="LITERAL"
>'external'</TT
> です。
     </P
><P
>      
      <TT
CLASS="LITERAL"
>'heartbeat'</TT
>を指定した場合には、監視は「ハートビートモード」で行われます。
      watchdog は一定間隔でハートビート信号（UDP パケット）を他の<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>へ送信します。
      またwatchdogは他の<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>から送られてくる信号を受信します。
      これが一定時間以上途絶えた場合にはその<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>に障害が発生したと判断します。
     </P
><P
>      
      <TT
CLASS="LITERAL"
>query</TT
>: このモードではwatchdogは監視用のクエリを<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>に発行し、それが成功するかどうかで pgpool-II が生きているかどうかを判断します。
      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>サーバ間の設置場所が離れている場合、<TT
CLASS="LITERAL"
>query</TT
>モードが有効かもしれません。
      <DIV
CLASS="CAUTION"
><P
></P
><TABLE
CLASS="CAUTION"
BORDER="1"
WIDTH="90%"
><TR
><TD
ALIGN="CENTER"
><B
>注意</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
>	
	クエリモードでは、<A
HREF="runtime-config-connection.html#GUC-NUM-INIT-CHILDREN"
>num_init_children</A
>を十分大きな値にしてください。
	 watchdogプロセスも<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>にクライアントとして接続するからです。
       </P
></TD
></TR
></TABLE
></DIV
>
     </P
><P
>      
      <TT
CLASS="LITERAL"
>external</TT
>: このモードでは、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>に組み込みの死活監視は無効になり、watchdogはローカルとリモートのノード死活監視を行うために外部システムを使います。
     </P
><P
>      
      <TT
CLASS="LITERAL"
>external</TT
>モードは<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>V3.5</I
></SPAN
>よりも前のバージョンでは提供されていません。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-WD-MONITORING-INTERFACES-LIST"
></A
><TT
CLASS="VARNAME"
>wd_monitoring_interfaces_list</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      watchdogプロセスがネットワークリンクの状態を監視するネットワークデバイス名をカンマ区切りのリストで指定します。
      リスト中の全てのネットワークインタフェースが（無効化あるいはケーブルを抜かれることで）非アクティブになると、watchdog はネットワークが完全に故障したと見なし自らを停止させませす。
      <TT
CLASS="LITERAL"
>''</TT
>（空文字）を指定するとネットワークインタフェースの監視が無効になります。
      <TT
CLASS="LITERAL"
>'any'</TT
>を指定すると、ループバック以外の存在する全てのネットワークインタフェースを監視します。
      デフォルトの値は<TT
CLASS="LITERAL"
>''</TT
>空リスト '' （監視は無効）です。
     </P
><P
>      
      <TT
CLASS="VARNAME"
>wd_monitoring_interfaces_list</TT
>は、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>V3.5</I
></SPAN
>よりも前のバージョンでは提供されていません。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-WD-INTERVAL"
></A
><TT
CLASS="VARNAME"
>wd_interval</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
     </DT
><DD
><P
>      
      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>が死活監視を行う間隔を秒単位で指定します（１以上の数字）。
      デフォルトは10です。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-WD-PRIORITY"
></A
><TT
CLASS="VARNAME"
>wd_priority</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
     </DT
><DD
><P
>      
      このパラメータによってローカルのwatchdogノードがマスターに選ばれる優先度を上げることができます。
      古いマスターノードが故障した状況でクラスタがマスターノードの選択を行う際に、<TT
CLASS="VARNAME"
>wd_priority</TT
>が高いノードがマスターwatchdogノードに選ばれます。
      <TT
CLASS="VARNAME"
>wd_priority</TT
>はクラスタの初期起動時にも有効なので、
      複数のwatchdogノードを同時に起動した場合、<TT
CLASS="VARNAME"
>wd_priority</TT
>が高いノードがマスターwatchdogノードに選ばれます。
      このため、watchdogノードは意図しないノードがマスターに選ばれることが無いように<TT
CLASS="VARNAME"
>wd_priority</TT
>の優先順位が高い順に起動するべきです。
     </P
><P
>      
      <TT
CLASS="VARNAME"
>wd_priority</TT
>は、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>V3.5</I
></SPAN
>よりも前のバージョンでは提供されていません。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-WD-IPC-SOCKET-DIR"
></A
><TT
CLASS="VARNAME"
>wd_ipc_socket_dir</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> watchdog の<ACRONYM
CLASS="ACRONYM"
>IPC</ACRONYM
>通信で受け付ける UNIX ドメインソケットが作成されるディレクトリを指定します。
      デフォルトは<TT
CLASS="LITERAL"
>'/tmp'</TT
>です。
      このソケットが cron ジョブで削除されることのないよう気をつけてください。
      この値は <TT
CLASS="LITERAL"
>'/var/run'</TT
>などのディレクトリに設定することを推奨します。
     </P
><P
>      
      <TT
CLASS="VARNAME"
>wd_ipc_socket_dir</TT
>は、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>V3.5</I
></SPAN
>よりも前のバージョンでは提供されていません。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CONFIG-WATCHDOG-LIFECHECK-HEARTBEAT"
>5.14.8. 死活監視：ハートビートモードの設定</A
></H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-HEARTBEAT-HOSTNAME"
></A
><TT
CLASS="VARNAME"
>heartbeat_hostnameX</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      ハートビート信号を送受信するための<ACRONYM
CLASS="ACRONYM"
>IP</ACRONYM
>アドレスまたは <ACRONYM
CLASS="ACRONYM"
>ホスト名</ACRONYM
>を指定します。
      パラメータ名の最後にある数字は「pgpool ノードID」で、0から始まります(たとえばheartbeat_hostname0)。
      複数のハートビート信号の送り先をセミコロン(;)で区切って指定することができます。
     </P
><P
>      
      <TT
CLASS="VARNAME"
>heartbeat_hostnameX</TT
>は、<A
HREF="runtime-watchdog-config.html#GUC-WD-LIFECHECK-METHOD"
>wd_lifecheck_method</A
>が<TT
CLASS="LITERAL"
>'heartbeat'</TT
>に設定されている場合のみ有効です。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-HEARTBEAT-PORT"
></A
><TT
CLASS="VARNAME"
>heartbeat_portX</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
     </DT
><DD
><P
>      
      ハートビート信号を受信するためのポート番号を指定します。
      1つのみを指定してください。
      パラメータ名の最後にある数字は「pgpool ノードID」で、0から始まります(たとえばheartbeat_port0)。
     </P
><P
>      
      <TT
CLASS="VARNAME"
>heartbeat_portX</TT
>は、<A
HREF="runtime-watchdog-config.html#GUC-WD-LIFECHECK-METHOD"
>wd_lifecheck_method</A
> が <TT
CLASS="LITERAL"
>'heartbeat'</TT
>に設定されている場合のみ有効です。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-HEARTBEAT-DEVICE"
></A
><TT
CLASS="VARNAME"
>heartbeat_deviceX</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      ハートビートの送受信に用いるネットワークデバイス名を指定します。
      パラメータ名の最後にある数字は「pgpool ノードID」で、0から始まります(たとえばheartbeat_device0)。
      複数のネットワークデバイス名をセミコロン(;)で区切って指定することができます。
     </P
><P
>      
      <TT
CLASS="VARNAME"
>heartbeat_deviceX</TT
>は、<A
HREF="runtime-watchdog-config.html#GUC-WD-LIFECHECK-METHOD"
>wd_lifecheck_method</A
>が<TT
CLASS="LITERAL"
>'heartbeat'</TT
>に設定されている場合のみ有効です。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
><DIV
CLASS="EXAMPLE"
><A
NAME="EXAMPLE-HEARTBEAT-1"
></A
><P
><B
>例 5-9. Heartbeat 信号を用いた死活監視の設定例</B
></P
><P
>       
       Pgpool ノードが3つあり、それぞれのホストが server1、server2、server3 の場合、
       <A
HREF="runtime-watchdog-config.html#GUC-HEARTBEAT-HOSTNAME"
>heartbeat_hostname</A
>、<A
HREF="runtime-watchdog-config.html#GUC-HEARTBEAT-PORT"
>heartbeat_port</A
>
       及び<A
HREF="runtime-watchdog-config.html#GUC-HEARTBEAT-DEVICE"
>heartbeat_device</A
>を以下のように設定します。
	</P><PRE
CLASS="PROGRAMLISTING"
>     heartbeat_hostname0 = 'server1'
     heartbeat_port0 = 9694
     heartbeat_device0 = ''

     heartbeat_hostname1 = 'server2'
     heartbeat_port1 = 9694
     heartbeat_device1 = ''

     heartbeat_hostname2 = 'server3'
     heartbeat_port2 = 9694
     heartbeat_device2 = ''
	</PRE
><P>
      </P
></DIV
></DD
><DT
><A
NAME="GUC-WD-HEARTBEAT-KEEPALIVE"
></A
><TT
CLASS="VARNAME"
>wd_heartbeat_keepalive</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
     </DT
><DD
><P
>      
      ハートビート信号を送信する間隔（秒）を指定します。
      デフォルトは2です。
      <TT
CLASS="VARNAME"
>wd_heartbeat_keepalive</TT
>は、<A
HREF="runtime-watchdog-config.html#GUC-WD-LIFECHECK-METHOD"
>wd_lifecheck_method</A
>が<TT
CLASS="LITERAL"
>'heartbeat'</TT
>に設定されている場合のみ有効です。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-WD-HEARTBEAT-DEADTIME"
></A
><TT
CLASS="VARNAME"
>wd_heartbeat_deadtime</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
     </DT
><DD
><P
>      
      このオプションで指定された間隔（秒）の間ハートビート信号が途絶えた場合、リモートのwatchdogに障害が発生したとみなされます。
      デフォルトは<TT
CLASS="LITERAL"
>30</TT
>です。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="CONFIG-WATCHDOG-LIFECHECK-QUERY"
>5.14.9. 死活監視：クエリモードの設定</A
></H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="GUC-WD-LIFE-POINT"
></A
><TT
CLASS="VARNAME"
>wd_life_point</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
     </DT
><DD
><P
>      
      監視クエリの応答が得られなかった場合のリトライ回数を指定します。
      有効な値は1以上の整数です。
     </P
><P
>      
      <A
HREF="runtime-watchdog-config.html#GUC-WD-LIFECHECK-METHOD"
>wd_lifecheck_method</A
>が<TT
CLASS="LITERAL"
>'query'</TT
>の場合のみ、<TT
CLASS="VARNAME"
>wd_life_point</TT
>は有効です。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-WD-LIFECHECK-QUERY"
></A
><TT
CLASS="VARNAME"
>wd_lifecheck_query</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      リモートの<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の死活監視に使うクエリを指定します。
      デフォルトは<TT
CLASS="LITERAL"
>"SELECT 1"</TT
>です。
     </P
><P
>      
      <A
HREF="runtime-watchdog-config.html#GUC-WD-LIFECHECK-METHOD"
>wd_lifecheck_method</A
>が<TT
CLASS="LITERAL"
>'query'</TT
>の場合のみ、<TT
CLASS="VARNAME"
>wd_life_check_query</TT
>は有効です。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-WD-LIFECHECK-DBNAME"
></A
><TT
CLASS="VARNAME"
>wd_lifecheck_dbname</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      リモートの<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の死活監視用の接続先のデータベース名です。
      デフォルトは<TT
CLASS="LITERAL"
>'template1'</TT
>です。
     </P
><P
>      
      <A
HREF="runtime-watchdog-config.html#GUC-WD-LIFECHECK-METHOD"
>wd_lifecheck_method</A
>が<TT
CLASS="LITERAL"
>'query'</TT
>の場合のみ、<TT
CLASS="VARNAME"
>wd_life_check_dbname</TT
>は有効です。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-WD-LIFECHECK-USER"
></A
><TT
CLASS="VARNAME"
>wd_lifecheck_user</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      リモートの<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の死活監視用の接続先のユーザ名です。
      デフォルトは<TT
CLASS="LITERAL"
>'nobody'</TT
>です。
     </P
><P
>      
      <A
HREF="runtime-watchdog-config.html#GUC-WD-LIFECHECK-METHOD"
>wd_lifecheck_method</A
>が<TT
CLASS="LITERAL"
>'query'</TT
>の場合のみ、<TT
CLASS="VARNAME"
>wd_life_check_user</TT
>は有効です。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
></DD
><DT
><A
NAME="GUC-WD-LIFECHECK-PASSWORD"
></A
><TT
CLASS="VARNAME"
>wd_lifecheck_password</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
     </DT
><DD
><P
>      
      リモートの<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>の死活監視用の接続先のパスワードです。
      デフォルトは<TT
CLASS="LITERAL"
>''</TT
>（空文字）です。
     </P
><P
>      
      <TT
CLASS="VARNAME"
>wd_lifecheck_password</TT
>が空白のままであった場合、<SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>は空のパスワードを使用する前に<A
HREF="runtime-config-connection.html#GUC-POOL-PASSWD"
>pool_passwd</A
>ファイルから<A
HREF="runtime-watchdog-config.html#GUC-WD-LIFECHECK-USER"
>wd_lifecheck_user</A
>のパスワードの取得を試みます。
     </P
><P
>      
      <TT
CLASS="VARNAME"
>wd_lifecheck_password</TT
>にAES256-CBCで暗号化されたパスワードも指定することができます。
      AESで暗号化されたパスワードを指定するためには、パスワード文字列は暗号化（<TT
CLASS="LITERAL"
>aes-256-cbc</TT
>アルゴリズムを使用）および<TT
CLASS="LITERAL"
>base64</TT
>でエンコードした後、<TT
CLASS="LITERAL"
>AES</TT
>を接頭辞として付けなければいけません。
     </P
><P
>      
      暗号化されていないクリアテキストパスワードを指定するためには、<TT
CLASS="LITERAL"
>TEXT</TT
>をパスワード文字列の前に付けます。
      例えば、パスワードとして<TT
CLASS="LITERAL"
>mypass</TT
>を設定したい場合、パスワードフィールドに<TT
CLASS="LITERAL"
>TEXTmypass</TT
>と指定すべきです。
     </P
><P
>      
      正しくフォーマットされたAESで暗号化されたパスワード文字列を<A
HREF="pg-enc.html"
>pg_enc</A
>コマンドを使用して作成することもできます。
       </P><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
>	 
	 <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>は暗号化されたパスワードを使うために起動時に有効な復号鍵を要求します。
	 <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>に復号鍵を提供する方法の詳細は<A
HREF="auth-aes-encrypted-password.html#AUTH-AES-DECRYPTION-KEY"
>項6.4.2</A
>を参照してください。
	</P
></BLOCKQUOTE
></DIV
><P>
     </P
><P
>&#13;      
      <A
HREF="runtime-watchdog-config.html#GUC-WD-LIFECHECK-METHOD"
>wd_lifecheck_method</A
>が<TT
CLASS="LITERAL"
>'query'</TT
>の場合のみ、<TT
CLASS="VARNAME"
>wd_life_check_password</TT
>は有効です。
     </P
><P
>      
      このパラメータは、サーバ起動時にのみ設定できます。
     </P
><P
>      
      デフォルトは<TT
CLASS="LITERAL"
>''</TT
>（空文字）です.
     </P
></DD
></DL
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="runtime-ssl.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="runtime-misc.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Secure Sockect Layer (SSL)</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="runtime-config.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>その他の設定パラメータ</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>