<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>5.7. Load Balancing</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="pgpool-II 3.6beta2 Documentation" /><link rel="up" href="runtime-config.html" title="Chapter 5. Server Configuration" /><link rel="prev" href="runtime-config-logging.html" title="5.6. Error Reporting and Logging" /><link rel="next" href="runtime-config-health-check.html" title="5.8. Health Check" /><link rel="copyright" href="legalnotice.html" title="Legal Notice" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.7. Load Balancing</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="runtime-config-logging.html">Prev</a> </td><th width="60%" align="center">Chapter 5. Server Configuration</th><td width="20%" align="right"> <a accesskey="n" href="runtime-config-health-check.html">Next</a></td></tr></table><hr /></div><div class="sect1" id="runtime-config-load-balancing"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.7. Load Balancing</h2></div></div></div><p>    <span class="productname">Pgpool-II</span> load balancing of SELECT queries
    works with Master Slave mode (<a class="xref" href="runtime-config-runnung-mode.html#runtime-config-master-slave-mode" title="5.3.1. Master slave mode">Section 5.3.1, “Master slave mode”</a>)
    and Replication mode (<a class="xref" href="runtime-config-runnung-mode.html#runtime-config-replication-mode" title="5.3.2. Replication mode">Section 5.3.2, “Replication mode”</a>). When enabled
    <span class="productname">Pgpool-II</span> sends the writing queries to the
    <acronym class="acronym">primay node</acronym> in Master Slave mode, all of the backend nodes
    in Replication mode, and other queries get load balanced among all backend nodes.
    To which node
    the load balancing mechanism sends read queries is decided at the
    session start time and will not be changed until the session
    ends. The only exception is by writing special SQL comments. See
    below for more details.
  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>      Queries which are sent to primary node or replicated because they cannot be balanced are
      also accounted for in the load balancing algorithm.
    </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>      If you don't want a query that qualifies for the load balancing to be
      load balanced by <span class="productname">Pgpool-II</span>, you can put
      <span class="emphasis"><em>/*NO LOAD BALANCE*/</em></span> comment before the <acronym class="acronym">SELECT
      </acronym> statement. This will disable the load balance of the particular query
      and <span class="productname">Pgpool-II</span> will send it to the master node (the primary node in Master Slave mode).
    </p></div><div class="variablelist"><dl class="variablelist"><dt id="guc-load-balance-mode"><span class="term"><code class="varname">load_balance_mode</code> (<code class="type">boolean</code>)
        <a id="idp57082896" class="indexterm"></a>
      </span></dt><dd><p>          When set to on, <span class="productname">Pgpool-II</span> enables the
          load balancing on incoming <acronym class="acronym">SELECT</acronym> queries.
          i.e. <acronym class="acronym">SELECT</acronym> queries from the clients gets distributed to
          the configured <span class="productname">PostgreSQL</span> backends.
          Default is off.
        </p><p>          This parameter can only be set at server start.
        </p></dd><dt id="guc-ignore-leading-white-space"><span class="term"><code class="varname">ignore_leading_white_space</code> (<code class="type">boolean</code>)
        <a id="idp57089184" class="indexterm"></a>
      </span></dt><dd><p>          When set to on, <span class="productname">Pgpool-II</span> ignores the
          white spaces at the beginning of SQL queries in load balancing.
          It is useful if used with APIs like DBI/DBD:Pg which adds
          white spaces against the user's intention.
        </p><p>          This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.
        </p></dd><dt id="guc-white-function-list"><span class="term"><code class="varname">white_function_list</code> (<code class="type">string</code>)
        <a id="idp57094512" class="indexterm"></a>
      </span></dt><dd><p>          Specifies a comma separated list of function names that
          <span class="emphasis"><em>DO NOT</em></span> update the database. SELECTs including
          functions <span class="emphasis"><em>not specified </em></span> in this list are not load balanced.
          These are replicated among all the DB nodes in Replication mode,
          sent to the primary node only in Maste Slave mode.
        </p><p>          You can use regular expression to match function names,
		  to which <code class="literal">^</code> and <code class="literal">$</code> are automatically added.
        </p><div class="example" id="example-white-function-list-1"><p class="title"><strong>Example 5.2. Using regular expression</strong></p><div class="example-contents"><p>            If you have prefixed all your read only function
            with 'get_' or 'select_', You can
            set the <a class="xref" href="runtime-config-load-balancing.html#guc-white-function-list">white_function_list</a> like below:
          </p><pre class="programlisting">white_function_list = 'get_.*,select_.*'
          </pre><p>
          </p></div></div><br class="example-break" /><p>          This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.
        </p></dd><dt id="guc-black-function-list"><span class="term"><code class="varname">black_function_list</code> (<code class="type">string</code>)
        <a id="idp57104592" class="indexterm"></a>
      </span></dt><dd><p>          Specifies a comma separated list of function names that
          <span class="emphasis"><em>DO</em></span> update the database.
          SELECTs including functions <span class="emphasis"><em>specified</em></span> in this list are
		  not load balanced.
          These are replicated among all the DB nodes in Replication mode,
          sent to the primary node only in Maste Slave mode.
        </p><p>          You can use regular expression to match function names,
		  to which <code class="literal">^</code> and <code class="literal">$</code> are automatically added.
        </p><div class="example" id="example-black-function-list-1"><p class="title"><strong>Example 5.3. Using regular expression</strong></p><div class="example-contents"><p>            If you have prefixed all your updating functions
            with 'set_', 'update_', 'delete_' or 'insert_', You can
            set the <a class="xref" href="runtime-config-load-balancing.html#guc-black-function-list">black_function_list</a> like below:
          </p><pre class="programlisting">black_function_list = 'nextval,setval,set_.*,update_.*,delete_.*,insert_.*'
          </pre><p>
          </p></div></div><br class="example-break" /><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>            <a class="xref" href="runtime-config-load-balancing.html#guc-black-function-list">black_function_list</a> and <a class="xref" href="runtime-config-load-balancing.html#guc-white-function-list">white_function_list</a>
            are mutually exclusive and only one of the two lists can be set in the configuration.
          </p></div><div class="example" id="example-black-function-list-2"><p class="title"><strong>Example 5.4. Configuring using <code class="literal">nextval()</code> and <code class="literal">setval()</code> to land on proper backend</strong></p><div class="example-contents"><p>            Prior to <span class="productname">Pgpool-II</span><span class="emphasis"><em>V3.0</em></span>,
            <code class="literal">nextval()</code> and <code class="literal">setval()</code> were known as functions writing to the database.
            You can configure this by setting <a class="xref" href="runtime-config-load-balancing.html#guc-black-function-list">black_function_list</a>
            and <a class="xref" href="runtime-config-load-balancing.html#guc-white-function-list">white_function_list</a> as follows
              </p><pre class="programlisting">white_function_list = ''
black_function_list = 'nextval,setval,lastval,currval'
              </pre><p>
          </p></div></div><br class="example-break" /><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>            <span class="productname">PostgreSQL</span> also contains <code class="literal">lastval()</code> and
            <code class="literal">currval()</code> in addition to
            <code class="literal">nextval()</code> and <code class="literal">setval()</code>.
            Though <code class="literal">lastval()</code> and <code class="literal">currval()</code>
            are not writing function type, but it is advised to treat
            <code class="literal">lastval()</code> and <code class="literal">currval()</code>
            as writing functions to avoid errors which occur when
            these functions are accidentally load balanced.
          </p></div><p>          This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.
        </p></dd><dt id="guc-database-redirect-preference-list"><span class="term"><code class="varname">database_redirect_preference_list</code> (<code class="type">string</code>)
        <a id="idp57131040" class="indexterm"></a>
      </span></dt><dd><p>         Specifies the list of <em class="replaceable"><code>"database-name:node id"</code></em> pairs
         to send <acronym class="acronym">SELECT</acronym> queries to a particular backend
         node for a particular database connection.
         For example, by specifying "test:1", <span class="productname">Pgpool-II</span>
         will redirect all <acronym class="acronym">SELECT</acronym> queries to the backend node of ID 1 for
         the connection to "test" database.
         You can specify multiple <em class="replaceable"><code>"database name:node id"</code></em> pair by separating them
         using comma (,).
        </p><p>         Regular expressions are also accepted for database name.
         You can use special keywords as <em class="replaceable"><code>node id</code></em>.
		 If <span class="emphasis"><em>"primary"</em></span> is specified, queries are sent to the primary node, and
         if <span class="emphasis"><em>"standby"</em></span> is specified, one of the standby nodes are selected randomly
		 based on weights.
        </p><div class="example" id="example-database-redirect-list"><p class="title"><strong>Example 5.5. Using database_redirect_preference_list</strong></p><div class="example-contents"><p>            If you want to configure the following <acronym class="acronym">SELECT</acronym> query routing rules:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>                Route all <acronym class="acronym">SELECT</acronym> queries on <code class="literal">postgres</code>
                database to the primary backend node.
              </p></li><li class="listitem"><p>                Route all <acronym class="acronym">SELECT</acronym> queries on <code class="literal">mydb0</code> or on
                <code class="literal">mydb1</code> databases to backend node of ID 1.
              </p></li><li class="listitem"><p>                Route all <acronym class="acronym">SELECT</acronym> queries on <code class="literal">mydb2</code>
                database to standby backend nodes.
              </p></li></ul></div><p>            then the <a class="xref" href="runtime-config-load-balancing.html#guc-database-redirect-preference-list">database_redirect_preference_list</a> will be configured as follows:
              </p><pre class="programlisting">database_redirect_preference_list = 'postgres:primary,mydb[01]:1,mydb2:standby'
              </pre><p>
          </p></div></div><br class="example-break" /><p>          This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.
        </p></dd><dt id="guc-app-name-redirect-preference-list"><span class="term"><code class="varname">app_name_redirect_preference_list</code> (<code class="type">string</code>)
        <a id="idp57149520" class="indexterm"></a>
      </span></dt><dd><p>          Specifies the list of <em class="replaceable"><code>"application-name:node id"</code></em> pairs
          to send <acronym class="acronym">SELECT</acronym> queries to a particular backend
          node for a particular client application connection.
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>            In <span class="productname">PostgreSQL</span> <span class="emphasis"><em>V9.0</em></span> or later the "Application name" is a name specified
            by a client when it connects to database.
          </p></div><p>          For example, application name of <code class="command">psql</code> command is
          <code class="literal">"psql"</code>
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>            <span class="productname">Pgpool-II</span> recognizes the application name
            only specified in the start-up packet.
            Although a client can provide the application name
            later in the session, but that does not get considered by the
            <span class="productname">Pgpool-II</span> for query routing.
          </p></div><p>          The notion of <a class="xref" href="runtime-config-load-balancing.html#guc-app-name-redirect-preference-list">app_name_redirect_preference_list</a>
          is same as the <a class="xref" href="runtime-config-load-balancing.html#guc-database-redirect-preference-list">database_redirect_preference_list</a>
          thus you can also use the regular expressions for application names.
          Similarly special keyword <span class="emphasis"><em>"primary"</em></span> indicates the primary node and
         <span class="emphasis"><em>"standby"</em></span> indicates one of standby nodes.
        </p><div class="example" id="example-app-name-redirect-list"><p class="title"><strong>Example 5.6. Using app-name_redirect_preference_list</strong></p><div class="example-contents"><p>            If you want to configure the following <acronym class="acronym">SELECT</acronym> query routing rules:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>                Route all <acronym class="acronym">SELECT</acronym> from <code class="literal">psql</code>
                client to the primary backend node.
              </p></li><li class="listitem"><p>                Route all <acronym class="acronym">SELECT</acronym> queries from <code class="literal">myapp1</code>
                client to backend node of ID 1.
              </p></li><li class="listitem"><p>                Route all <acronym class="acronym">SELECT</acronym> queries from <code class="literal">myapp2</code>
                client to standby backend nodes.
              </p></li></ul></div><p>            then the <a class="xref" href="runtime-config-load-balancing.html#guc-app-name-redirect-preference-list">app_name_redirect_preference_list</a> will be configured as follows:
              </p><pre class="programlisting">app_name_redirect_preference_list = 'psql:primary,myapp1:1,myapp2:standby'
              </pre><p>
          </p></div></div><br class="example-break" /><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>            <a class="xref" href="runtime-config-load-balancing.html#guc-app-name-redirect-preference-list">app_name_redirect_preference_list</a> takes precedence
            over the <a class="xref" href="runtime-config-load-balancing.html#guc-database-redirect-preference-list">database_redirect_preference_list</a>.
          </p></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>            <acronym class="acronym">JDBC</acronym> driver postgreSQL-9.3 and earlier versions
            does not send the application name in the startup packet even if
            the application name is specified using the <acronym class="acronym">JDBC</acronym>
            driver option <code class="literal">"ApplicationName"</code> and
            <code class="literal">"assumeMinServerVersion=9.0"</code>.
            So if you want to use the <a class="xref" href="runtime-config-load-balancing.html#guc-app-name-redirect-preference-list">app_name_redirect_preference_list</a>
            feature through <acronym class="acronym">JDBC</acronym>, Use postgreSQL-9.4 or later version of the driver.
          </p></div><p>          This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.
        </p></dd><dt id="guc-allow-sql-comments"><span class="term"><code class="varname">allow_sql_comments</code> (<code class="type">boolean</code>)
        <a id="idp57177840" class="indexterm"></a>
      </span></dt><dd><p>        When set to on, <span class="productname">Pgpool-II</span> ignore the
        <acronym class="acronym">SQL</acronym> comments when identifying if the load balance
        or query cache is possible on the query.
        When this parameter is set to off, the <acronym class="acronym">SQL</acronym> comments
        on the query could effectively prevent the query from being
        load balanced or cached (pre <span class="productname">Pgpool-II</span>
        <span class="emphasis"><em>V3.4</em></span> behavior).
        </p><p>          This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.
					You can also use <a class="xref" href="sql-pgpool-set.html" title="PGPOOL SET"><span class="refentrytitle">PGPOOL SET</span></a> command to alter the value of
					this parameter for a current session.
        </p></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config-logging.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-health-check.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">5.6. Error Reporting and Logging </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 5.8. Health Check</td></tr></table></div></body></html>