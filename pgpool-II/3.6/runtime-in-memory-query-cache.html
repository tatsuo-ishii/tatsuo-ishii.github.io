<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>5.12. In Memory Query Cache</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="pgpool-II 3.7devel Documentation" /><link rel="up" href="runtime-config.html" title="Chapter 5. Server Configuration" /><link rel="prev" href="runtime-streaming-replication-check.html" title="5.11. Streaming Replication Check" /><link rel="next" href="runtime-ssl.html" title="5.13. Secure Sockect Layer (SSL)" /><link rel="copyright" href="legalnotice.html" title="Legal Notice" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.12. In Memory Query Cache</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="runtime-streaming-replication-check.html">Prev</a> </td><th width="60%" align="center">Chapter 5. Server Configuration</th><td width="20%" align="right"> <a accesskey="n" href="runtime-ssl.html">Next</a></td></tr></table><hr /></div><div class="sect1" id="runtime-in-memory-query-cache"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.12. In Memory Query Cache</h2></div></div></div><p>    In memory query cache can be used with all modes of
    <span class="productname">Pgpool-II</span>.
    <span class="productname">Pgpool-II</span> does not
    need a restart when the cache gets outdated because of
    the underlying table updates.
  </p><p>    In memory cache saves the pair of SELECT statement
    and its result
    (along with the Bind parameters, if the SELECT is an
    extended query). If the same SELECTs comes in,
    <span class="productname">Pgpool-II</span> returns the value
    from cache. Since no <acronym class="acronym">SQL</acronym> parsing nor
    access to <span class="productname">PostgreSQL</span> are involved, the serving of results
from the in memory cache is extremely fast.</p><p>  On the other hand, it might be slower than the normal path
  in some cases, because it adds some overhead to store cache.
  Moreover when a table is updated, <span class="productname">Pgpool-II
  </span> automatically deletes all the caches related to the
  table. Therefore, the performance will be degraded by a system with
  a lot of updates.  If the query cache hit ratio (it can be checked
  by using <a class="xref" href="sql-show-pool-cache.html" title="SHOW POOL_CACHE"><span class="refentrytitle">SHOW POOL_CACHE</span></a>) is lower than 70%,
  you might want to disable in memory cache.</p><div class="sect2" id="runtime-in-memory-query-cache-enabling"><div class="titlepage"><div><div><h3 class="title">5.12.1. Enabling in memory query cache</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="guc-memory-cache-enabled"><span class="term"><code class="varname">memory_cache_enabled</code> (<code class="type">boolean</code>)
	<a id="idm45737774022656" class="indexterm"></a>
      </span></dt><dd><p>	  Setting to on enables the memory cache.
	  Default is off.
	</p><p>          This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.</p></dd></dl></div></div><div class="sect2" id="runtime-in-memory-query-cache-choose-storage"><div class="titlepage"><div><div><h3 class="title">5.12.2. Choosing cache storage</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="guc-memqcache-method"><span class="term"><code class="varname">memqcache_method</code> (<code class="type">string</code>)
	<a id="idm45737774017088" class="indexterm"></a>
      </span></dt><dd><p>          Specifies the storage type to be used for the cache.
	  Below table contains the list of all valid values for the parameter.
	</p><div class="table" id="memqcache-method-table"><p class="title"><strong>Table 5.10. Memcache method options</strong></p><div class="table-contents"><table class="table" summary="Memcache method options" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code class="literal">'shmem'</code></td><td>Use shared memory</td></tr><tr><td><code class="literal">'memcached'</code></td><td>Use <a class="ulink" href="http://memcached.org/" target="_top">memcached</a></td></tr></tbody></table></div></div><br class="table-break" /><p>          Default is <code class="literal">'shmem'</code>.
	</p><p>          This parameter can only be set at server start.
	</p></dd></dl></div></div><div class="sect2" id="runtime-in-memory-query-cache-config"><div class="titlepage"><div><div><h3 class="title">5.12.3. Common configurations</h3></div></div></div><p>    These below parameter are valid for both <code class="literal">shmem</code>
    and <code class="literal">memcached</code> type query cache.
  </p><div class="variablelist"><dl class="variablelist"><dt id="guc-memqcacheexpire"><span class="term"><code class="varname">memqcache_expire</code> (<code class="type">integer</code>)
	<a id="idm45737774004464" class="indexterm"></a>
      </span></dt><dd><p>          Specifies the life time of query cache in seconds.
          Default is 0. which means no cache expiration and cache remains
          valid until the table is updated.
        </p><p>          This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>    <code class="varname">memqcache_expire</code> and
    <a class="xref" href="runtime-in-memory-query-cache.html#guc-memqcache-auto-cache-invalidation">memqcache_auto_cache_invalidation</a> are orthogonal to each other.
  </p></div></dd><dt id="guc-memqcache-auto-cache-invalidation"><span class="term"><code class="varname">memqcache_auto_cache_invalidation</code> (<code class="type">boolean</code>)
    <a id="idm45737773998128" class="indexterm"></a>
  </span></dt><dd><p>      Setting to on, automatically deletes the cache related to the updated tables.
      When off, cache is not deleted.
    </p><p>      Default is on.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>        This parameters <a class="xref" href="runtime-in-memory-query-cache.html#guc-memqcache-auto-cache-invalidation">memqcache_auto_cache_invalidation</a>
          and <a class="xref" href="runtime-in-memory-query-cache.html#guc-memqcacheexpire">memqcache_expire</a> are orthogonal to each other.
      </p></div><p>      This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.</p></dd><dt id="guc-memqcache-maxcache"><span class="term"><code class="varname">memqcache_maxcache</code> (<code class="type">integer</code>)
    <a id="idm45737773991360" class="indexterm"></a>
  </span></dt><dd><p>      Specifies the maximum size in bytes of the SELECT query result to be cached.
      The result with data size larger than this value will not be cached by
      <span class="productname">Pgpool-II</span>.
      When the caching of data is rejected because of the size constraint the following
      message is shown.
      </p><pre class="programlisting">	LOG:   pid 13756: pool_add_temp_query_cache: data size exceeds memqcache_maxcache. current:4095 requested:111 memq_maxcache:4096
      </pre><p>
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>        For the shared memory query(<code class="literal">'shmem'</code>) cache the
        <code class="varname">memqcache_maxcache</code> must be set lower than
        <a class="xref" href="runtime-in-memory-query-cache.html#guc-memqcache-cache-block-size">memqcache_cache_block_size</a> and for <code class="literal">'memcached'</code>
          it must be lower than the size of slab (default is 1 MB).
      </p></div><p>      This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.</p></dd><dt id="guc-white-memqcache-table-list"><span class="term"><code class="varname">white_memqcache_table_list</code> (<code class="type">string</code>)
    <a id="idm45737773981936" class="indexterm"></a>
  </span></dt><dd><p>      Specifies a comma separated list of table names whose SELECT
      results should be cached by the <span class="productname">Pgpool-II</span>.
    </p><p>      You can use regular expression into the list to match table name
      (to which ^ and $ are automatically added).
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>        If the queries can refer the table with and without the schema
        qualification then you must add both entries(with and without
        schema name) in the list.
        </p><pre class="programlisting">	  #For example:
	  #If the queries sometime use "table1" and other times "public.table1"
	  #to refer the table1 then the white_memqcache_table_list
	  #would be configured as follows.

	  white_memqcache_table_list = "table1,public.table1"

        </pre><p>

      </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>        <code class="varname">white_memqcache_table_list</code>
        precedence over <a class="xref" href="runtime-in-memory-query-cache.html#guc-black-memqcache-table-list">black_memqcache_table_list</a>
      </p></div><p>      This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.</p></dd><dt id="guc-black-memqcache-table-list"><span class="term"><code class="varname">black_memqcache_table_list</code> (<code class="type">string</code>)
    <a id="idm45737773973136" class="indexterm"></a>
  </span></dt><dd><p>      Specifies a comma separated list of table names whose SELECT
      results should <span class="emphasis"><em>NOT</em></span> be cached by the <span class="productname">        Pgpool-II</span>.
    </p><p>      You can use regular expression into the list to match table name
      (to which ^ and $ are automatically added),
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>        If the queries can refer the table with and without the schema
        qualification then you must add both entries(with and without
        schema name) in the list.
        </p><pre class="programlisting">	  #For example:
	  #If the queries sometime use "table1" and other times "public.table1"
	  #to refer the table1 then the black_memqcache_table_list
	  #would be configured as follows.

	  black_function_list = "table1,public.table1"

        </pre><p>

      </p></div><p>      This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.</p></dd><dt id="guc-memqcache-oiddir"><span class="term"><code class="varname">memqcache_oiddir</code> (<code class="type">string</code>)
    <a id="idm45737773965584" class="indexterm"></a>
  </span></dt><dd><p>      Specifies the full path to the directory for storing the
      <code class="literal">oids</code> of tables used by SELECT queries.
    </p><p>      <code class="varname">memqcache_oiddir</code> directory contains the sub directories
      for the databases. The directory name is the OID of the database. In addition, each
      database directory contains the files for each table used by SELECT statement.
      Again the name of the file is the OID of the table.
      These files contains the pointers to query cache which are used as key for
      deleting the caches.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>        Normal restart of <span class="productname">Pgpool-II</span> does not clear the
        contents of <code class="varname">memqcache_oiddir</code>.
      </p></div><p>      This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.</p></dd></dl></div></div><div class="sect2" id="runtime-in-memory-query-cache-shmem-config"><div class="titlepage"><div><div><h3 class="title">5.12.4. Configurations to use shared memory</h3></div></div></div><p>    These are the parameters used with shared memory as the cache storage.
  </p><div class="variablelist"><dl class="variablelist"><dt id="guc-memqcache-total-size"><span class="term"><code class="varname">memqcache_total_size</code> (<code class="type">integer</code>)
	<a id="idm45737773956192" class="indexterm"></a>
      </span></dt><dd><p>	  Specifies the shared memory cache size in bytes.
	</p><p>          This parameter can only be set at server start.
	</p></dd><dt id="guc-memqcache-max-num-cache"><span class="term"><code class="varname">memqcache_max_num_cache</code> (<code class="type">integer</code>)
	<a id="idm45737773952416" class="indexterm"></a>
      </span></dt><dd><p>          Specifies the number of cache entries. This is used to define the size of cache management space.
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>            The management space size can be calculated by:
            <code class="varname">memqcache_max_num_cache</code> * 48 bytes.
            Too small number will cause an error while registering cache.
            On the other hand too large number will just waste space.
          </p></div><p>          This parameter can only be set at server start.
	</p></dd><dt id="guc-memqcache-cache-block-size"><span class="term"><code class="varname">memqcache_cache_block_size</code> (<code class="type">integer</code>)
	<a id="idm45737773947632" class="indexterm"></a>
      </span></dt><dd><p>          Specifies the cache block size. <span class="productname">Pgpool-II</span> uses the
          cache memory arranged in <code class="varname">memqcache_cache_block_size</code> blocks.
          SELECT result is packed into the block and must fit in a single block.
          And the results larger than <code class="varname">memqcache_cache_block_size</code> are
          not cached.
	</p><p>          <code class="varname">memqcache_cache_block_size</code> must be set to atleast 512.
        </p><p>          This parameter can only be set at server start.
	</p></dd></dl></div></div><div class="sect2" id="runtime-in-memory-query-cache-memcached-config"><div class="titlepage"><div><div><h3 class="title">5.12.5. Configurations to use memcached</h3></div></div></div><p>    These are the parameters used with memcached as the cache storage.
  </p><div class="variablelist"><dl class="variablelist"><dt id="guc-memqcache-memcached-host"><span class="term"><code class="varname">memqcache_memcached_host</code> (<code class="type">string</code>)
	<a id="idm45737773939856" class="indexterm"></a>
      </span></dt><dd><p>          Specifies the host name or the IP address on which <code class="literal">memcached</code>
          works. You can use <code class="literal">'localhost'</code> if <code class="literal">memcached</code>
          and <span class="productname">Pgpool-II</span> resides on same server.
	</p><p>          This parameter can only be set at server start.
	</p></dd><dt id="guc-memqcache-memcached-port"><span class="term"><code class="varname">memqcache_memcached_port</code> (<code class="type">integer</code>)
	<a id="idm45737773933104" class="indexterm"></a>
      </span></dt><dd><p>          Specifies the port number of <acronym class="acronym">memcached</acronym>.
          Default is 11211.
	</p><p>          This parameter can only be set at server start.
	</p></dd></dl></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-streaming-replication-check.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-ssl.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">5.11. Streaming Replication Check </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 5.13. Secure Sockect Layer (SSL)</td></tr></table></div></body></html>