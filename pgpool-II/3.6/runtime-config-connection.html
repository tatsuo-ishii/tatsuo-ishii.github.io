<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>5.2. Connections and Authentication</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="pgpool-II 3.6.0 Documentation" /><link rel="up" href="runtime-config.html" title="Chapter 5. Server Configuration" /><link rel="prev" href="config-setting.html" title="5.1. Setting Parameters" /><link rel="next" href="runtime-config-runnung-mode.html" title="5.3. Running mode" /><link rel="copyright" href="legalnotice.html" title="Legal Notice" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.2. Connections and Authentication</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="config-setting.html">Prev</a> </td><th width="60%" align="center">Chapter 5. Server Configuration</th><td width="20%" align="right"> <a accesskey="n" href="runtime-config-runnung-mode.html">Next</a></td></tr></table><hr /></div><div class="sect1" id="runtime-config-connection"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.2. Connections and Authentication</h2></div></div></div><div class="sect2" id="runtime-config-connection-settings"><div class="titlepage"><div><div><h3 class="title">5.2.1. Connection Settings</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="guc-listen-addresses"><span class="term"><code class="varname">listen_addresses</code> (<code class="type">string</code>)
		<a id="idp56753632" class="indexterm"></a>
	</span></dt><dd><p>			Specifies the hostname or IP address, on which <span class="productname">Pgpool-II</span>
			will accept TCP/IP connections. <code class="literal">'*'</code>
			accepts all incoming connections. <code class="literal">''</code>
			disables TCP/IP connections. Default
			is <code class="literal">'localhost'</code>. Connections via UNIX
			domain socket are always accepted.
		</p><p>			This parameter can only be set at server start.
		</p></dd><dt id="guc-port"><span class="term"><code class="varname">port</code> (<code class="type">integer</code>)
		<a id="idp56759360" class="indexterm"></a>
	</span></dt><dd><p>			The port number used
			by <span class="productname">Pgpool-II</span> to listen for
			connections. Default is 9999.
		</p><p>			This parameter can only be set at server start.
		</p></dd><dt id="guc-socket-dir"><span class="term"><code class="varname">socket_dir</code> (<code class="type">string</code>)
		<a id="idp56763136" class="indexterm"></a>
	</span></dt><dd><p>			The directory where the UNIX domain socket accepting connections for
			<span class="productname">Pgpool-II</span> will be
			created. Default is <code class="literal">/tmp</code>. Be aware that this
			socket might be deleted by a cron job. We recommend to set this
			value to <code class="literal">/var/run</code> or such directory.
		</p><p>			This parameter can only be set at server start.
		</p></dd><dt id="guc-pcp-listen-addresses"><span class="term"><code class="varname">pcp_listen_addresses</code> (<code class="type">string</code>)
		<a id="idp56768368" class="indexterm"></a>
	</span></dt><dd><p>			Specifies the hostname or IP address, on which pcp process
			will accept TCP/IP connections. <code class="literal">*</code>
			accepts all incoming connections. <code class="literal">"" </code>
			disables TCP/IP connections. Default
			is <code class="literal">*</code>. Connections via UNIX domain
			socket are always accepted.
		</p><p>			This parameter can only be set at server start.
		</p></dd><dt id="guc-pcp-port"><span class="term"><code class="varname">pcp_port</code> (<code class="type">integer</code>)
		<a id="idp56773584" class="indexterm"></a>
	</span></dt><dd><p>			The port number used by PCP
			process to listen for connections. Default is 9898.
		</p><p>			This parameter can only be set at server start.
		</p></dd><dt id="guc-pcp-socket-dir"><span class="term"><code class="varname">pcp_socket_dir</code> (<code class="type">string</code>)
		<a id="idp56776848" class="indexterm"></a>
	</span></dt><dd><p>			The directory where the UNIX domain socket accepting connections for
			PCP process will be
			created. Default is <code class="literal">/tmp</code>. Be aware that
			this socket might be deleted by a cron job. We recommend
			to set this value to <code class="literal">/var/run</code> or such
			directory.
		</p><p>			This parameter can only be set at server start.
		</p></dd><dt id="guc-num-init-children"><span class="term"><code class="varname">num_init_children</code> (<code class="type">integer</code>)
		<a id="idp56781488" class="indexterm"></a>
	</span></dt><dd><p>			The number of
			preforked <span class="productname">Pgpool-II</span> server
			processes. Default is 32.  num_init_children is also the
			concurrent connections limit
			to <span class="productname">Pgpool-II</span> from clients.  If
			more than num_init_children clients try to connect to
			<span class="productname">Pgpool-II</span>, <span class="emphasis"><em>they are
			blocked (not rejected with an error, like <span class="productname">PostgreSQL</span>)
			until a connection to any <span class="productname">Pgpool-II</span>
			process is closed</em></span>.  Up to
			<a class="xref" href="runtime-config-connection-pooling.html#guc-listen-backlog-multiplier">listen_backlog_multiplier</a>*
			num_init_children can be queued.
		</p><p>			The queue is inside the kernel called "listen queue". The
			length of the listen queue is called "backlog".  There is
			an upper limit of the backlog in some systems, and if
			num_init_children*<a class="xref" href="runtime-config-connection-pooling.html#guc-listen-backlog-multiplier">listen_backlog_multiplier</a>
			exceeds the number, you need to set the backlog higher.
			Otherwise, following problems may occur in heavy loaded systems:
			1) connecting to <span class="productname">Pgpool-II</span> fails
			2) connecting to <span class="productname">Pgpool-II</span> is
			getting slow because of retries in the kernel.  You can
			check if the listen queue is actually overflowed by using
			"netstat -s" command.  If you find something like:
			</p><pre class="programlisting">535 times the listen queue of a socket overflowed
			</pre><p>
			then the listen queue is definitely overflowed.
			You should increase the backlog in this case (you will be required a super user privilege).
			</p><pre class="programlisting"># sysctl net.core.somaxconn
net.core.somaxconn = 128
# sysctl -w net.core.somaxconn = 256
			</pre><p>
You could add following to /etc/sysctl.conf instead.
			</p><pre class="programlisting">net.core.somaxconn = 256
			</pre><p>
		</p><p>			Number of connections to each <span class="productname">PostgreSQL</span> is roughly max_pool*num_init_children.
		</p><p>						However, canceling a query creates another
						connection to the backend; thus, a query cannot be canceled if
						all the connections are in use. If you want to ensure that queries can
						be canceled, set this value to twice the expected connections.
		</p><p>						In addition, <span class="productname">PostgreSQL</span> allows concurrent
						connections for non superusers up to max_connections -
						superuser_reserved_connections.
		</p><p>			In summary, max_pool, num_init_children, max_connections,
			superuser_reserved_connections must satisfy the following formula:
			</p><pre class="programlisting">max_pool*num_init_children &lt;= (max_connections - superuser_reserved_connections) (no query canceling needed)
max_pool*num_init_children*2 &lt;= (max_connections - superuser_reserved_connections) (query canceling needed)
			</pre><p>
		</p><p>			This parameter can only be set at server start.
		</p></dd></dl></div></div><div class="sect2" id="runtime-config-authentication-settings"><div class="titlepage"><div><div><h3 class="title">5.2.2. Authentication Settings</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="guc-enable-pool-hba"><span class="term"><code class="varname">enable_pool_hba</code> (<code class="type">boolean</code>)
					<a id="idp56798240" class="indexterm"></a>
				</span></dt><dd><p>						If <code class="literal">true</code>, <span class="productname">Pgpool-II</span> will use the
						<code class="filename">pool_hba.conf</code> for the client authentication.
						See <a class="xref" href="auth-pool-hba-conf.html" title="6.1. The pool_hba.conf File">Section 6.1, “The <code class="filename">pool_hba.conf</code> File”</a> for details on how to configure
						<code class="filename">pool_hba.conf</code> for client authentication.
						Default is <code class="literal">false</code>
					</p><p>						This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.
					</p></dd><dt id="guc-pool-passwd"><span class="term"><code class="varname">pool_passwd</code> (<code class="type">string</code>)
					<a id="idp56805632" class="indexterm"></a>
				</span></dt><dd><p>						Specify the password file name for md5 authentication.
						Default value is <code class="literal">"pool_passwd"</code>.
						Specifying <code class="literal">''</code> (empty) disables the use of password file.
						See <a class="xref" href="auth-methods.html#auth-md5" title="6.2.2. MD5 Password Authentication">Section 6.2.2, “MD5 Password Authentication”</a> for more details.
					</p><p>						This parameter can only be set at server start.
					</p></dd><dt id="guc-authentication-timeout"><span class="term"><code class="varname">authentication_timeout</code> (<code class="type">integer</code>)
					<a id="idp56810704" class="indexterm"></a>
				</span></dt><dd><p>						Specify the timeout in seconds for <span class="productname">Pgpool-II</span>
						authentication. Specifying 0 disables the time out.
						Default value is 60
					</p><p>						This parameter can be changed by reloading the <span class="productname">Pgpool-II</span> configurations.
					</p></dd></dl></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="config-setting.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-runnung-mode.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">5.1. Setting Parameters </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 5.3. Running mode</td></tr></table></div></body></html>