<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>2.1. Introduction</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="pgpool-II 3.6beta2 Documentation" /><link rel="up" href="tutorial-watchdog.html" title="Chapter 2. Watchdog" /><link rel="prev" href="tutorial-watchdog.html" title="Chapter 2. Watchdog" /><link rel="next" href="tutorial-watchdog-integrating-external-lifecheck.html" title="2.2. Integrating external lifecheck with watchdog" /><link rel="copyright" href="legalnotice.html" title="Legal Notice" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2.1. Introduction</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="tutorial-watchdog.html">Prev</a> </td><th width="60%" align="center">Chapter 2. Watchdog</th><td width="20%" align="right"> <a accesskey="n" href="tutorial-watchdog-integrating-external-lifecheck.html">Next</a></td></tr></table><hr /></div><div class="sect1" id="tutorial-watchdog-intro"><div class="titlepage"><div><div><h2 class="title" style="clear: both">2.1. Introduction</h2></div></div></div><p>    Watchdog is a sub process of <span class="productname">Pgpool-II</span>
    to add high availability. Watchdog is used to resolve the single
    point of failure by coordinating multiple <span class="productname">pgpool-II</span>
    nodes. The watchdog was first introduced in <span class="productname">pgpool-II</span>
    <span class="emphasis"><em>V3.2</em></span> and is significantly enhanced in
    <span class="productname">pgpool-II</span> <span class="emphasis"><em>V3.5</em></span>, to ensure the presence of a
    quorum at all time. This new addition to watchdog makes it more fault tolerant
    and robust in handling and guarding against the split-brain syndrome
    and network partitioning. However to ensure the quorum mechanism properly
    works, the number of pgpool-II nodes must be odd in number and greater than or
    equal to 3.
  </p><div class="sect2" id="tutorial-watchdog-coordinating-nodes"><div class="titlepage"><div><div><h3 class="title">2.1.1. Coordinating multiple <span class="productname">Pgpool-II</span> nodes</h3></div></div></div><a id="idp56331088" class="indexterm"></a><p>      Watchdog coordinates multiple <span class="productname">Pgpool-II</span> nodes
      by exchanging information with each other.
    </p><p>      At the startup, if the watchdog is enabled, <span class="productname">Pgpool-II</span> node
      sync the status of all configured backend nodes from the master watchdog node.
      And if the node goes on to become a master node itself it initializes the backend
      status locally. When a backend node status changes by failover etc..,
      watchdog notifies the information to other <span class="productname">Pgpool-II</span>
      nodes and synchronizes them. When online recovery occurs, watchdog restricts
      client connections to other <span class="productname">Pgpool-II</span>
      nodes for avoiding inconsistency between backends.
    </p><p>      Watchdog also coordinates with all connected <span class="productname">Pgpool-II</span> nodes to ensure
      that failback, failover and follow_master commands must be executed only on one <span class="productname">pgpool-II</span> node.
    </p></div><div class="sect2" id="tutorial-watchdog-lifechecking"><div class="titlepage"><div><div><h3 class="title">2.1.2. Life checking of other <span class="productname">Pgpool-II</span> nodes</h3></div></div></div><a id="idp56338432" class="indexterm"></a><p>      Watchdog lifecheck is the sub-component of watchdog to monitor
      the health of <span class="productname">Pgpool-II</span> nodes participating
      in the watchdog cluster to provide the high availability.
      Traditionally <span class="productname">Pgpool-II</span> watchdog provides
      two methods of remote node health checking. <code class="literal">"heartbeat"</code>
      and <code class="literal">"query"</code> mode.
      The watchdog in <span class="productname">Pgpool-II</span> <span class="emphasis"><em>V3.5</em></span>
      adds a new <code class="literal">"external"</code> to <a class="xref" href="runtime-watchdog-config.html#guc-wd-lifecheck-method">wd_lifecheck_method</a>,
      which enables to hook an external third party health checking
      system with <span class="productname">Pgpool-II</span> watchdog.
    </p><p>      Apart from remote node health checking watchdog lifecheck can also check
      the health of node it is installed on by monitoring the connection to upstream servers.
      If the monitoring fails, watchdog treats it as the local <span class="productname">Pgpool-II</span>
      node failure.
    </p><p>      In <code class="literal">heartbeat</code> mode, watchdog monitors other <span class="productname">Pgpool-II</span>
      processes by using <code class="literal">heartbeat</code> signal.
      Watchdog receives heartbeat signals sent by other <span class="productname">Pgpool-II</span>
      periodically. If there is no signal for a certain period,
      watchdog regards this as the failure of the <span class="productname">Pgpool-II</span>.
      For redundancy you can use multiple network connections for heartbeat
      exchange between <span class="productname">Pgpool-II</span> nodes.
      This is the default and recommended mode to be used for health checking.
    </p><p>      In <code class="literal">query</code> mode, watchdog monitors <span class="productname">Pgpool-II</span>
      service rather than process. In this mode watchdog sends queries to other
      <span class="productname">Pgpool-II</span> and checks the response.
       </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>         Note that this method requires connections from other <span class="productname">Pgpool-II</span>,
         so it would fail monitoring if the <a class="xref" href="runtime-config-connection.html#guc-num-init-children">num_init_children</a> parameter isn't large enough.
         This mode is deprecated and left for backward compatibility.
       </p></div><p>
      </p><p>       <code class="literal">external</code> mode is introduced by <span class="productname">Pgpool-II</span>
       <span class="emphasis"><em>V3.5</em></span>. This mode basically disables the built in lifecheck
       of <span class="productname">Pgpool-II</span> watchdog and expects that the external system
       will inform the watchdog about health of local and all remote nodes participating in the watchdog cluster.
      </p></div><div class="sect2" id="tutorial-watchdog-consistency-of-config"><div class="titlepage"><div><div><h3 class="title">2.1.3. Consistency of configuration parameters on all <span class="productname">Pgpool-II</span> nodes</h3></div></div></div><a id="idp56358880" class="indexterm"></a><p>      At startup watchdog verifies the <span class="productname">Pgpool-II</span>
      configuration of the local node for	the consistency with the configurations
      on the master watchdog node and warns the user of any differences.
      This eliminates the likelihood of undesired behavior that can happen
      because of different configuration on different <span class="productname">Pgpool-II</span> nodes.
    </p></div><div class="sect2" id="tutorial-watchdog-changing-active"><div class="titlepage"><div><div><h3 class="title">2.1.4. Changing active/standby state when certain fault is detected</h3></div></div></div><a id="idp56362256" class="indexterm"></a><p>      When a fault of <span class="productname">Pgpool-II</span> is detected,
      watchdog notifies the other watchdogs of it.
      If this is the active <span class="productname">Pgpool-II</span>,
      watchdogs decide the new active <span class="productname">Pgpool-II</span>
      by voting and change active/standby state.
    </p></div><div class="sect2" id="tutorial-watchdog-automatic-vip"><div class="titlepage"><div><div><h3 class="title">2.1.5. Automatic virtual IP switching</h3></div></div></div><a id="idp56365984" class="indexterm"></a><p>      When a standby <span class="productname">Pgpool-II</span> server promotes to active,
      the new active server brings up virtual IP interface. Meanwhile, the previous
      active server brings down the virtual IP interface. This enables the active
      <span class="productname">Pgpool-II</span> to work using the same
      IP address even when servers are switched.
    </p></div><div class="sect2" id="tutorial-watchdog-changing-automatic-register-in-recovery"><div class="titlepage"><div><div><h3 class="title">2.1.6. Automatic registration of a server as a standby in recovery</h3></div></div></div><a id="idp56369536" class="indexterm"></a><p>      When the broken server recovers or new server is attached, the watchdog process
      notifies this to the other watchdogs in the cluster along with the information of the new server,
      and the watchdog process receives information on the active server and
      other servers. Then, the attached server is registered as a standby.
    </p></div><div class="sect2" id="tutorial-watchdog-start-stop"><div class="titlepage"><div><div><h3 class="title">2.1.7. Starting/stopping watchdog</h3></div></div></div><a id="idp56371888" class="indexterm"></a><p>      The watchdog process starts and stops automatically as sub-processes
      of the <span class="productname">Pgpool-II</span>, therefore there is no
      dedicated command to start and stop watchdog.
    </p><p>      Watchdog controls the virtual IP interface, the commands executed by
      the watchdog for bringing up and bringing down the VIP require the
      root privileges. <span class="productname">Pgpool-II</span> requires the
      user running <span class="productname">Pgpool-II</span> to have root
      privileges when the watchdog is enabled along with delegate IP.
      This is however not good security practice to run the
      <span class="productname">Pgpool-II</span> as root user, the alternative
      and preferred way is to run the <span class="productname">Pgpool-II</span>
      as normal user and use either the custom commands for
      <a class="xref" href="runtime-watchdog-config.html#guc-if-up-cmd">if_up_cmd</a>, <a class="xref" href="runtime-watchdog-config.html#guc-if-down-cmd">if_down_cmd</a>,
      and <a class="xref" href="runtime-watchdog-config.html#guc-arping-cmd">arping_cmd</a> using <code class="command">sudo</code>
      or use <code class="command">setuid</code> ("set user ID upon execution")
      on <code class="literal">if_*</code> commands
    </p><p>      Lifecheck process is a sub-component of watchdog, its job is to monitor the
      health of <span class="productname">Pgpool-II</span> nodes participating in
      the watchdog cluster. The Lifecheck process is started automatically
      when the watchdog is configured to use the built-in life-checking,
      it starts after the watchdog main process initialization is complete.
      However lifecheck process only kicks in when all configured watchdog
      nodes join the cluster and becomes active. If some remote node fails
      before the Lifecheck become active that failure will not get caught by the lifecheck.
    </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="tutorial-watchdog.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="tutorial-watchdog.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="tutorial-watchdog-integrating-external-lifecheck.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 2. Watchdog </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 2.2. Integrating external lifecheck with watchdog</td></tr></table></div></body></html>