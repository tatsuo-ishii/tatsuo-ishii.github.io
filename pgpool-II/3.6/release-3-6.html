<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Release 3.6</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="pgpool-II 3.6-alpha1 Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="Release Notes"
HREF="release.html"><LINK
REL="PREVIOUS"
TITLE="Release Notes"
HREF="release.html"><LINK
REL="NEXT"
TITLE="Index"
HREF="bookindex.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=ISO-8859-1"><META
NAME="creation"
CONTENT="2016-10-18T00:47:17"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>pgpool-II 3.6-alpha1 Documentation</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="Release Notes"
HREF="release.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="release.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>Appendix A. Release Notes</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="Index"
HREF="bookindex.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="RELEASE-3-6"
>A.1. Release 3.6</A
></H1
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>Release Date: </B
>2016-11-xx</P
></BLOCKQUOTE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN5436"
>A.1.1. Overview</A
></H2
><P
>      Major enhancements in <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> 3.6 include:
    </P
><P
></P
><UL
><LI
><P
>	  Improve the behavior of fail-over. In the steaming
	  replication mode, client sessions will not be disconnected
	  when a fail-over occurs any more if the session does not use
	  the failed standby server. If the primary server goes down,
	  still all sessions will be disconnected. Also it is possible
	  to connect to <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> even if
	  it is doing health checking retries. Before all attempt of
	  connecting to <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> failed
	  while doing health checking retries.
	</P
></LI
><LI
><P
>	  New PGPOOL SET command has been introduced. Certain
	  configuration parameters now can be changed on the fly in a
	  session.
	</P
></LI
><LI
><P
>	  Watchdog is significantly enhanced. It becomes more reliable
	  than previous releases.
	</P
></LI
><LI
><P
>	  Handling of extended query protocol (e.g. used by Java
	  applications) in streaming replication mode speeds up if
	  many rows are returned in a result set.
	</P
></LI
><LI
><P
>	  Import parser of PostgreSQL 9.6.
	</P
></LI
><LI
><P
>	  In some cases pg_terminate_backend() now does not trigger a
	  fail-over.
	</P
></LI
><LI
><P
>	  Change documentation format from raw HTML to SGML.
	</P
></LI
></UL
><P
>      The above items are explained in more detail in the sections below.
    </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN5458"
>A.1.2. Major Enhancements</A
></H2
><P
></P
><UL
><LI
><P
>	  Improve the behavior of fail-over (Tatsuo Ishii)
	</P
><P
>	  In the steaming replication mode, client sessions will not
	  be disconnected when a fail-over occurs any more if the
	  session does not use the failed standby server. If the
	  primary server goes down, still all sessions will be
	  disconnected. Health check timeout case will also cause the
	  full session disconnection. Other health check error,
	  including retry over case does not trigger full session
	  disconnection.
	</P
><P
>	  For user's convenience, "show pool_nodes" command shows the
	  session local load balance node info since this is important
	  for users in case of fail-over. If the load balance node is
	  not the failed node, the session will not be affected by
	  fail-over.
	</P
><P
>	  Also now it is possible to connect
	  to <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> even if it is doing
	  health checking retries. Before all attempt of connecting
	  to <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> failed while doing
	  health checking retries.  Before any attempt to connect to
	  <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> fails if it is doing a
	  health check against failed node even if
	  <A
HREF="runtime-config-failover.html#GUC-FAIL-OVER-ON-BACKEND-ERROR"
>fail_over_on_backend_error</A
> is off
	  because <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> child first
	  tries to connect to all backend including the failed one and
	  exits if it fails to connect to a backend (of course it
	  fails). This is a temporary situation and will be resolved
	  before pgpool executes fail-over. However if the health check
	  is retrying, the temporary situation keeps longer depending
	  on the setting
	  of <A
HREF="runtime-config-health-check.html#GUC-HEALTH-CHECK-MAX-RETRIES"
>health_check_max_retries</A
> and
	  <A
HREF="runtime-config-health-check.html#GUC-HEALTH-CHECK-RETRY-DELAY"
>health_check_retry_delay</A
>. This is not
	  good. Attached patch tries to mitigate the problem:
	</P
><P
>	  When an attempt to connect to backend fails, give up
	  connecting to the failed node and skip to other node, rather
	  than exiting the process if operating in streaming
	  replication mode and the node is not primary node.
	</P
><P
>	  Mark the local status of the failed node to "down".  This
	  will let the primary node be selected as a load balance node
	  and every queries will be sent to the primary node. If
	  there's other healthy standby nodes, one of them will be
	  chosen as the load balance node.
	</P
><P
>	  After the session is over, the child process will suicide to
	  not retain the local status.
	</P
></LI
><LI
><P
>	  Add <A
HREF="sql-pgpool-show.html"
>PGPOOL
	  SHOW</A
>, <A
HREF="sql-pgpool-set.html"
>PGPOOL
	  SET</A
> and
	  <A
HREF="sql-pgpool-reset.html"
>PGPOOL RESET</A
>
	  commands (Muhammad Usama).
	</P
><P
>	  These are similar to the PostgreSQL's SET and SHOW commands
	  for GUC variables, adding the functionality
	  in <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> to set and reset the
	  value of config parameters for the current session, and for
	  that it adds a new syntax
	  in <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> which is similar to
	  PostgreSQL's SET and RESET variable syntax with an addition
	  of <TT
CLASS="LITERAL"
>PGPOOL</TT
> keyword at the start.
	</P
><P
>	  Currently supported configuration parameters by PGPOOL
	  SHOW/SET/RESET are: <A
HREF="runtime-config-logging.html#GUC-LOG-STATEMENT"
>log_statement</A
>,
	  <A
HREF="runtime-config-logging.html#GUC-LOG-PER-NODE-STATEMENT"
>log_per_node_statement</A
>, <A
HREF="runtime-misc.html#GUC-CHECK-TEMP-TABLE"
>check_temp_table</A
>,
	  <A
HREF="runtime-misc.html#GUC-CHECK-UNLOGGED-TABLE"
>check_unlogged_table</A
>, <A
HREF="runtime-config-load-balancing.html#GUC-ALLOW-SQL-COMMENTS"
>allow_sql_comments</A
>,
	  <A
HREF="runtime-config-connection-pooling.html#GUC-CLIENT-IDLE-LIMIT"
>client_idle_limit</A
>, <A
HREF="runtime-config-logging.html#GUC-LOG-ERROR-VERBOSITY"
>log_error_verbosity</A
>,
	  <A
HREF="runtime-config-logging.html#GUC-CLIENT-MIN-MESSAGES"
>client_min_messages</A
>, <A
HREF="runtime-config-logging.html#GUC-LOG-MIN-MESSAGES"
>log_min_messages</A
>,
	  <A
HREF="runtime-online-recovery.html#GUC-CLIENT-IDLE-LIMIT-IN-RECOVERY"
>client_idle_limit_in_recovery</A
>.
	</P
></LI
><LI
><P
>	  Sync inconsitent status
	  of <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> nodes
	  in <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> instances after
	  restart (Muhammad Usama).
	</P
><P
>	  At the <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> startup, The
	  status of each configured backend node is loaded from the
	  backend status file or otherwise initialized by querying the
	  backend nodes. This technique works fine in stand alone mode
	  and also with the watchdog enabled as long as the status of
	  backend nodes remains consistent until
	  all <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> nodes got up and
	  running.  But since <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>
	  does not sync the backend node status from the watchdog
	  cluster at startup time, so in some cases
	  the <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> nodes participating
	  in the watchdog cluster may get a different status for the
	  same backend, especially if
	  the <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> nodes part of the
	  watchdog cluster starts at different times and between that
	  time an unavailable backend PostgreSQL node had become
	  available again.
	</P
><P
>    	  So to solve this, the commit implements the new startup
	  procedure for the
	  standby <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>, And now the
	  standby
	  <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> will load the backend
	  status of all
	  configured <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> nodes from
	  the watchdog master/coordinator node at the time of startup.
	</P
></LI
><LI
><P
>	  Enhance performance of SELECT when lots of rows involved
	  (Tatsuo Ishii).
	</P
><P
>	  <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> flushes data to network
	  (calling write(2)) every time it sends a row data ("Data
	  Row" message) to frontend. For example, if 10,000 rows
	  needed to be transfer, 10,000 times write()s are
	  issued. This is pretty expensive. Since after repeating to
	  send row data, "Command Complete" message is sent, it's
	  enough to issue a write() with the command complete
	  message. Also there are unnecessary flushing are in handling
	  the command complete message.
	</P
><P
>	  <A
HREF="http://www.pgpool.net/pipermail/pgpool-hackers/2016-September/001784.html"
TARGET="_top"
>Quick
	  testing</A
> showed that from 47% to 62% performance
	  enhancements were achieved in some cases.
	</P
><P
>	  Unfortunately, performance in workloads where transferring
	  few rows, will not be enhanced since such rows are needed to
	  flush to network anyway.
	</P
></LI
><LI
><P
>	  Import <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> 9.6's SQL
	  parser (Peng Bo).
	</P
><P
>	  This allows <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> to fully
	  understand the newly added SQL syntax such as <TT
CLASS="LITERAL"
>COPY
	  INSERT RETURNING</TT
>.
	</P
></LI
><LI
><P
>	  In some cases pg_terminate_backend() now does not trigger a
	  fail-over (Muhammad Usama).
	</P
><P
>	  Since the pg_terminate_backend function
	  in <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> is used to
	  terminate the backend connection, So what happens is, when
	  this function kills a <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>
	  backend that is connected to
	  the <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>, This disconnection
	  of backend by pg_terminate_backend function is appeared as a
	  backend node failure to
	  the <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>.  But the problem
	  here is, PostgreSQL does not give any information to the
	  client program that the connection is going to be killed
	  because of the pg_terminate_backend call and on the client
	  side, it looks similar to the backend node failure.
	</P
><P
>          Now to solve this in <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> we
	  need two things.  First is to identify the
	  pg_terminate_backend function in the query and the
	  <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> child process that
	  hosts the particular backend connection which will be killed
	  by that pg_terminate_backend function call, so that we get a
	  heads up in advance about the backend termination, and
	  secondly the routing of the query containing
	  pg_terminate_backend also needs a new logic so that the
	  query should be sent to the correct PostgreSQL node that
	  hosts the backend with the PID referred by the
	  pg_terminate_bakend()
	</P
><P
>	  So how does this commit handles pg_terminate_backend()??  In
	  the SimpleQuery() function which is the work horse of simple
	  query processing in the <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>
	  we start with the search of the pg_terminate_backend()
	  function call in the query parse tree and if the search
	  comes out to be successful, the next step is to locate
	  the <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> child process and a
	  backend node of that connection whose PID is specified in
	  pg_terminate_backend function's argument. Once the
	  connection and the <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>
	  child process is identified, we just set the
	  swallow_termination flag(added by this commit in
	  ConnectionInfo structure) for that connection in the shared
	  memory, and also set the query destination node to the
	  backend node that hosts that particular connection and does
	  not call pool_where_to_send() for this query so that the
	  query should be sent to the correct backend node.
	</P
><P
>          Now when the query is routed to the correct node and
	  consequently the backend gets killed, that results in the
	  communication error on <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
>
	  side, the <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> already knows
	  that this disconnection is due the pg_terminate_backend and
	  not because of node failure as the swallow_termination flag
	  is already set for the connection.
	</P
><P
>	  Some works are still remaining.
	</P
><P
>	  pg_terminate_backend is not handled with extended query
	  protocol.
	</P
><P
>	  Currently we only support
	  pg_terminate_backend(constant number) function calls. If the
	  expression or sub query is used in the argument of
	  pg_terminate_backend then it would not be handled e.g
	  </P><PRE
CLASS="PROGRAMLISTING"
>pgpool=# select pg_terminate_backend(1025); -- Supported
pgpool=# select pg_terminate_backend( 2 +1); -- NOT SUPPORTED
pgpool=# select pg_terminate_backend((select 1)); -- NOT SUPPORTED
	  </PRE
><P>
	</P
><P
>	  Currently only one pg_terminate_backend call in a query is
	  handled.
	</P
></LI
><LI
><P
>          HTML documents are now generated from SGML documents
          (Muhammad Usama, Tatsuo Ishii, Peng Bo).
	</P
><P
>	  It is intended to have better construction, contents and
          maintainability. However, still there's tremendous room to
          enhance the SGML documents. Please help us!
	</P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN5548"
>A.1.3. Other Enhancements</A
></H2
><P
></P
><UL
><LI
><P
>	  Make authentication error message more user friendly (Tatsuo Ishii)
	</P
><P
>	  When attempt to connect to backend (including health
	  checking), emit error messages from backend something like
	  "sorry, too many clients already" instead of "invalid
	  authentication message response type, Expecting 'R' and
	  received '%c'"
	</P
></LI
><LI
><P
>	  Tighten up health check timer expired condition in pool_check_fd() (Muhammad Usama)
	</P
><P
>	  Check if the signal was actually the health check timer
	  expire to make sure that we do not declare the timer expire
	  due to some other signal arrived while waiting for data for
	  health check in pool_check_fd().
	</P
></LI
><LI
><P
>	  Add new script called "watchdog_setup" (Tatstuo Ishii)
	</P
><P
>	  <A
HREF="watchdog-setup.html"
>watchdog_setup</A
> is a command to create a
	  temporary installation
	  of <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> clusters with
	  watchdog for mainly testings.
	</P
></LI
><LI
><P
>	  Add "-pg" option to pgpool_setup (Tatsuo Ishii)
	</P
><P
>	  This is useful when you want to assign specific port numbers to
	  <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> while
	  using <A
HREF="pgpool-setup.html"
>pgpool_setup</A
>. Also
	  now <TT
CLASS="COMMAND"
>pgpool_setup</TT
> is installed in the
	  standard bin directory which is same
	  as <TT
CLASS="COMMAND"
>pgpool</TT
>.
	</P
></LI
><LI
><P
>	  Add "replication delay" column to "show pool_nodes" (Tatsuo Ishii)
	</P
><P
>	  This column
	  shows the <A
HREF="runtime-streaming-replication-check.html"
>	  replication delay</A
> value in bytes if operated in
	  streaming replication mode.
	</P
></LI
><LI
><P
>	  Do not update status file if all backend nodes are in down status (Chris Pacejo, Tatsuo Ishii)
	</P
><P
>	  This commit tries to remove the data inconsitency in
	  replication mode found
	  in <A
HREF="http://www.pgpool.net/pipermail/pgpool-general/2015-August/003974.html"
TARGET="_top"
>[pgpool-general:
	  3918]</A
> by not recording the status file when all
	  backend nodes are in down status.  This surprisingly simple
	  but smart solution was provided by Chris Pacejo.
	</P
></LI
><LI
><P
>	  Allow to use multiple SSL cipher protocols (Multiple Usama)
	</P
><P
>	  By replacing TLSv1_method() with SSLv23_method() while
	  initializing the SSL session, we can use more protocols than
	  TLSv1 protocol.
	</P
></LI
><LI
><P
>	  Allow to use arbitrary number of items in the
	  black_function_list/white_function_list (Muhammad Usama)
	</P
><P
>	  Previously there were fixed limits for those.
	</P
></LI
><LI
><P
>	  Properly process empty queries (all comments) (Tatsuo Ishii)
	</P
><P
>	  <SPAN
CLASS="PRODUCTNAME"
>Pgpool-II</SPAN
> now recognizes an empty
	  query consisted of all comments (for example "/* DBD::Pg
	  ping test v3.5.3 */") (note that no ';') as an empty query.
	  </P
><P
>	  Before such that query was recognized an error.
	</P
></LI
><LI
><P
>	  Add some warning messages for wd_authkey hash calculation failure (Yugo Nagata)
	</P
><P
>	  Sometimes wd_authkey calculation fails for some reason other
	  than authkey mismatch. The additional messages make these
	  distinguishable for each other.
	</P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN5591"
>A.1.4. Changes</A
></H2
><P
></P
><UL
><LI
><P
>	  
	</P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN5596"
>A.1.5. Bug fixes</A
></H2
><P
></P
><UL
><LI
><P
>	
	</P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="release.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="bookindex.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Release Notes</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="release.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Index</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>