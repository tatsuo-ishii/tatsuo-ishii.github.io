<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>A.1. Release 3.6</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="pgpool-II 3.6.0 Documentation" /><link rel="up" href="release.html" title="Appendix A. Release Notes" /><link rel="prev" href="release.html" title="Appendix A. Release Notes" /><link rel="next" href="bookindex.html" title="Index" /><link rel="copyright" href="legalnotice.html" title="Legal Notice" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">A.1. Release 3.6</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="release.html">Prev</a> </td><th width="60%" align="center">Appendix A. Release Notes</th><td width="20%" align="right"> <a accesskey="n" href="bookindex.html">Next</a></td></tr></table><hr /></div><div class="sect1" id="release-3-6"><div class="titlepage"><div><div><h2 class="title" style="clear: both">A.1. Release 3.6</h2></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Release Date</h3><p>2016-11-21</p></div><div class="sect2" id="idp58975104"><div class="titlepage"><div><div><h3 class="title">A.1.1. Overview</h3></div></div></div><p>      Major enhancements in <span class="productname">Pgpool-II</span> 3.6 include:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>	  Improve the behavior of fail-over. In the steaming
	  replication mode, client sessions will not be disconnected
	  when a fail-over occurs any more if the session does not use
	  the failed standby server. If the primary server goes down,
	  still all sessions will be disconnected. Also it is possible
	  to connect to <span class="productname">Pgpool-II</span> even if
	  it is doing health checking retries. Before all attempt of
	  connecting to <span class="productname">Pgpool-II</span> failed
	  while doing health checking retries.
	</p></li><li class="listitem"><p>	  New PGPOOL SET command has been introduced. Certain
	  configuration parameters now can be changed on the fly in a
	  session.
	</p></li><li class="listitem"><p>	  Watchdog is significantly enhanced. It becomes more reliable
	  than previous releases.
	</p></li><li class="listitem"><p>	  Handling of extended query protocol (e.g. used by Java
	  applications) in streaming replication mode speeds up if
	  many rows are returned in a result set.
	</p></li><li class="listitem"><p>	  Import parser of PostgreSQL 9.6.
	</p></li><li class="listitem"><p>	  In some cases pg_terminate_backend() now does not trigger a
	  fail-over.
	</p></li><li class="listitem"><p>	  Change documentation format from raw HTML to SGML.
	</p></li></ul></div><p>      The above items are explained in more detail in the sections below.
    </p></div><div class="sect2" id="idp58982240"><div class="titlepage"><div><div><h3 class="title">A.1.2. Major Enhancements</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>	  Improve the behavior of fail-over. (Tatsuo Ishii)
	</p><p>	  In the steaming replication mode, client sessions will not
	  be disconnected when a fail-over occurs any more if the
	  session does not use the failed standby server. If the
	  primary server goes down, still all sessions will be
	  disconnected. Health check timeout case will also cause the
	  full session disconnection. Other health check error,
	  including retry over case does not trigger full session
	  disconnection.
	</p><p>	  For user's convenience, "show pool_nodes" command shows the
	  session local load balance node info since this is important
	  for users in case of fail-over. If the load balance node is
	  not the failed node, the session will not be affected by
	  fail-over.
	</p><p>	  Also now it is possible to connect
	  to <span class="productname">Pgpool-II</span> even if it is doing
	  health checking retries. Before all attempt of connecting
	  to <span class="productname">Pgpool-II</span> failed while doing
	  health checking retries.  Before any attempt to connect to
	  <span class="productname">Pgpool-II</span> fails if it is doing a
	  health check against failed node even if
	  <a class="xref" href="runtime-config-failover.html#guc-fail-over-on-backend-error">fail_over_on_backend_error</a> is off
	  because <span class="productname">Pgpool-II</span> child first
	  tries to connect to all backend including the failed one and
	  exits if it fails to connect to a backend (of course it
	  fails). This is a temporary situation and will be resolved
	  once pgpool executes fail-over. However if the health check
	  is retrying, the temporary situation keeps longer depending
	  on the setting
	  of <a class="xref" href="runtime-config-health-check.html#guc-health-check-max-retries">health_check_max_retries</a> and
	  <a class="xref" href="runtime-config-health-check.html#guc-health-check-retry-delay">health_check_retry_delay</a>. This is not
	  good. Attached patch tries to mitigate the problem:
	</p><p>	  When an attempt to connect to backend fails, give up
	  connecting to the failed node and skip to other node, rather
	  than exiting the process if operating in streaming
	  replication mode and the node is not primary node.
	</p><p>	  Mark the local status of the failed node to "down".  This
	  will let the primary node be selected as a load balance node
	  and every queries will be sent to the primary node. If
	  there's other healthy standby nodes, one of them will be
	  chosen as the load balance node.
	</p><p>	  After the session is over, the child process will suicide to
	  not retain the local status.
	</p></li><li class="listitem"><p>	  Add <a class="link" href="sql-pgpool-show.html" title="PGPOOL SHOW">PGPOOL
	  SHOW</a>, <a class="link" href="sql-pgpool-set.html" title="PGPOOL SET">PGPOOL
	  SET</a> and
	  <a class="link" href="sql-pgpool-reset.html" title="PGPOOL RESET">PGPOOL RESET</a>
	  commands. (Muhammad Usama)
	</p><p>	  These are similar to the PostgreSQL's SET and SHOW commands
	  for GUC variables, adding the functionality
	  in <span class="productname">Pgpool-II</span> to set and reset the
	  value of config parameters for the current session, and for
	  that it adds a new syntax
	  in <span class="productname">Pgpool-II</span> which is similar to
	  PostgreSQL's SET and RESET variable syntax with an addition
	  of <code class="literal">PGPOOL</code> keyword at the start.
	</p><p>	  Currently supported configuration parameters by PGPOOL
	  SHOW/SET/RESET are: <a class="xref" href="runtime-config-logging.html#guc-log-statement">log_statement</a>,
	  <a class="xref" href="runtime-config-logging.html#guc-log-per-node-statement">log_per_node_statement</a>, <a class="xref" href="runtime-misc.html#guc-check-temp-table">check_temp_table</a>,
	  <a class="xref" href="runtime-misc.html#guc-check-unlogged-table">check_unlogged_table</a>, <a class="xref" href="runtime-config-load-balancing.html#guc-allow-sql-comments">allow_sql_comments</a>,
	  <a class="xref" href="runtime-config-connection-pooling.html#guc-client-idle-limit">client_idle_limit</a>, <a class="xref" href="runtime-config-logging.html#guc-log-error-verbosity">log_error_verbosity</a>,
	  <a class="xref" href="runtime-config-logging.html#guc-client-min-messages">client_min_messages</a>, <a class="xref" href="runtime-config-logging.html#guc-log-min-messages">log_min_messages</a>,
	  <a class="xref" href="runtime-online-recovery.html#guc-client-idle-limit-in-recovery">client_idle_limit_in_recovery</a>.
	</p></li><li class="listitem"><p>	  Sync inconsitent status
	  of <span class="productname">PostgreSQL</span> nodes
	  in <span class="productname">Pgpool-II</span> instances after
	  restart. (bug 218) (Muhammad Usama)
	</p><p>    Watchdog does not synchronize status.
	</p></li><li class="listitem"><p>	  Enhance performance of SELECT when lots of rows involved.
	  (Tatsuo Ishii)
	</p><p>	  <span class="productname">Pgpool-II</span> flushes data to network
	  (calling write(2)) every time it sends a row data ("Data
	  Row" message) to frontend. For example, if 10,000 rows
	  needed to be transfer, 10,000 times write()s are
	  issued. This is pretty expensive. Since after repeating to
	  send row data, "Command Complete" message is sent, it's
	  enough to issue a write() with the command complete
	  message. Also there are unnecessary flushing are in handling
	  the command complete message.
	</p><p>	  <a class="ulink" href="http://www.pgpool.net/pipermail/pgpool-hackers/2016-September/001784.html" target="_top">Quick
	  testing</a> showed that from 47% to 62% performance
	  enhancements were achieved in some cases.
	</p><p>	  Unfortunately, performance in workloads where transferring
	  few rows, will not be enhanced since such rows are needed to
	  flush to network anyway.
	</p></li><li class="listitem"><p>	  Import <span class="productname">PostgreSQL</span> 9.6's SQL
	  parser. (Bo Peng)
	</p><p>	  This allows <span class="productname">Pgpool-II</span> to fully
	  understand the newly added SQL syntax such as <code class="literal">COPY
	  INSERT RETURNING</code>.
	</p></li><li class="listitem"><p>	  In some cases <code class="function">pg_terminate_backend()</code> now does not trigger a fail-over. (Muhammad Usama)
	</p><p>    Because PostgreSQL returns exactly the same error code as postmaster
    down case and <code class="function">pg_terminate_backend()</code> case, using
    <code class="function">pg_terminate_backend()</code> raises a failover which user might not want. To
    fix this, now <span class="productname">Pgpool-II</span> finds a pid of backend which is the target of
    <code class="function">pg_terminate_backend()</code> and does not trigger failover if so.
    </p><p>    This functions is limited to the case of simple protocol and the pid
    is given to <code class="function">pg_terminate_backend()</code> as a constant. So if you call
    <code class="function">pg_terminate_backend()</code> via extended protocol (e.g. Java) still
    <code class="function">pg_terminate_backend()</code> triggers a failover.
    </p></li><li class="listitem"><p>          HTML documents are now generated from SGML documents.
          (Muhammad Usama, Tatsuo Ishii, Bo Peng)
	</p><p>	  It is intended to have better construction, contents and
          maintainability. Also man pages are now generated from SGML.
	  However, still there's tremendous room to
          enhance the SGML documents. Please help us!
	</p></li></ul></div></div><div class="sect2" id="idp59021744"><div class="titlepage"><div><div><h3 class="title">A.1.3. Other Enhancements</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>	  Make authentication error message more user friendly. (Tatsuo Ishii)
	</p><p>	  When attempt to connect to backend (including health
	  checking), emit error messages from backend something like
	  "sorry, too many clients already" instead of "invalid
	  authentication message response type, Expecting 'R' and
	  received '%c'"
	</p></li><li class="listitem"><p>	  Tighten up health check timer expired condition in pool_check_fd(). (Muhammad Usama)
	</p></li><li class="listitem"><p>	  Add new script called "watchdog_setup". (Tatstuo Ishii)
	</p><p>	  <a class="xref" href="watchdog-setup.html" title="watchdog_setup"><span class="refentrytitle">watchdog_setup</span></a> is a command to create a
	  temporary installation
	  of <span class="productname">Pgpool-II</span> clusters with
	  watchdog for mainly testings.
	</p></li><li class="listitem"><p>	  Add "-pg" option to pgpool_setup. (Tatsuo Ishii)
	</p><p>	  This is useful when you want to assign specific port numbers to
	  <span class="productname">PostgreSQL</span> while
	  using <a class="xref" href="pgpool-setup.html" title="pgpool_setup"><span class="refentrytitle">pgpool_setup</span></a>. Also
	  now <code class="command">pgpool_setup</code> is installed in the
	  standard bin directory which is same
	  as <code class="command">pgpool</code>.
	</p></li><li class="listitem"><p>	  Add "replication delay" column to "show pool_nodes". (Tatsuo Ishii)
	</p><p>	  This column
	  shows the <a class="link" href="runtime-streaming-replication-check.html" title="5.11. Streaming Replication Check">	  replication delay</a> value in bytes if operated in
	  streaming replication mode.
	</p></li><li class="listitem"><p>	  Do not update status file if all backend nodes are in down status. (Chris Pacejo, Tatsuo Ishii)
	</p><p>	  This commit tries to remove the data inconsitency in
	  replication mode found
	  in <a class="ulink" href="http://www.pgpool.net/pipermail/pgpool-general/2015-August/003974.html" target="_top">[pgpool-general:
	  3918]</a> by not recording the status file when all
	  backend nodes are in down status.  This surprisingly simple
	  but smart solution was provided by Chris Pacejo.
	</p></li><li class="listitem"><p>	  Allow to use multiple SSL cipher protocols. (Muhammad Usama)
	</p><p>	  By replacing TLSv1_method() with SSLv23_method() while
	  initializing the SSL session, we can use more protocols than
	  TLSv1 protocol.
	</p></li><li class="listitem"><p>	  Allow to use arbitrary number of items in the
	  black_function_list/white_function_list. (Muhammad Usama)
	</p><p>	  Previously there were fixed limits for those.
	</p></li><li class="listitem"><p>	  Properly process empty queries (all comments). (Tatsuo Ishii)
	</p><p>	  <span class="productname">Pgpool-II</span> now recognizes an empty
	  query consisted of all comments (for example "/* DBD::Pg
	  ping test v3.5.3 */") (note that no ';') as an empty query.
	  </p><p>	  Before such that query was recognized an error.
	</p></li><li class="listitem"><p>	  Add some warning messages for wd_authkey hash calculation failure. (Yugo Nagata)
	</p><p>	  Sometimes wd_authkey calculation fails for some reason other
	  than authkey mismatch. The additional messages make these
	  distinguishable for each other.
	</p></li></ul></div></div><div class="sect2" id="idp59037616"><div class="titlepage"><div><div><h3 class="title">A.1.4. Changes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>        Fix the broken log_destination = syslog functionality. (Muhammad Usama)
        </p><p>        Fixing the logging to the syslog destination, which got broken by the
        PGPOOL SET/SHOW command commit, and also enhancing the log_destination
        configuration parameter to be assigned with the comma separated list of multiple
        destinations for the <span class="productname">Pgpool-II</span> log. Now, after this commit log_destination can
        be set to any combination of 'syslog' and 'stderr' log destinations.
        </p></li><li class="listitem"><p>            Change the default value of
            <a class="xref" href="runtime-config-failover.html#guc-search-primary-node-timeout">search_primary_node_timeout</a> from 10 to 300. (Tatstuo Ishii)
			</p><p>            Prior default value 10 seconds is sometimes too short for a standby to
            be promoted.
			</p></li><li class="listitem"><p>			Change the <code class="filename">Makefile</code> under directory
            <code class="filename">src/sql/</code>, that is proposed by
            <a class="ulink" href="http://www.pgpool.net/pipermail/pgpool-hackers/2016-June/001611.html" target="_top">            [pgpool-hackers: 1611]</a>. (Bo Peng)
			</p></li><li class="listitem"><p>				Change the PID length of <a class="link" href="pcp-proc-count.html" title="pcp_proc_count">pcp_proc_count</a> command output to 6 characters long. (Bo Peng)
			</p><p>                If the <span class="productname">Pgpool-II</span> process ID are over 5 characters, the 6th character of each process ID
                will be removed. This commit changes the process ID length of <a class="link" href="pcp-proc-count.html" title="pcp_proc_count">pcp_proc_count</a> command
                output to 6 characters long.
            </p></li><li class="listitem"><p>			    Redirect all user queries to primary server. (Tatsuo Ishii)
            </p><p>               Up to now some user queries are sent to other than the primary server
               even if <a class="xref" href="runtime-config-load-balancing.html#guc-load-balance-mode">load_balance_mode</a> = off. This commit changes the behavior: if
               load_balance_mode = off in streaming replication mode, now all the
               user queries are sent to the primary server only.
            </p></li></ul></div></div><div class="sect2" id="idp59049392"><div class="titlepage"><div><div><h3 class="title">A.1.5. Bug fixes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>      Fixing a potential crash in pool_stream functions. (Muhammad Usama)
      </p><p>      POOL_CONNECTION-&gt;con_info should be checked for null value before de-referencing
      when read or write fails on backend socket.
      </p></li><li class="listitem"><p>      Fixing the design of failover command propagation on watchdog cluster. (Muhammad Usama)
      </p><p>      Overhauling the design of how failover, failback and promote node commands are
      propagated to the watchdog nodes. Previously the watchdog on pgpool-II node that
      needs to perform the node command (failover, failback or promote node) used to
      broadcast the failover command to all attached pgpool-II nodes. And this
      sometimes makes the synchronization issues, especially when the watchdog cluster
      contains a large number of nodes and consequently the failover command sometimes
      gets executed by more than one <span class="productname">Pgpool-II</span>.
      </p><p>      Now with this commit all the node commands are forwarded to the
      master/coordinator watchdog, which in turn propagates to all standby nodes.
      Apart from above the commit also changes the failover command interlocking
      mechanism and now only the master/coordinator node can become the lock holder
      so the failover commands will only get executed on the master/coordinator node.
      </p></li><li class="listitem"><p>        Fix the case when all backends are down then 1 node attached. (Tatsuo Ishii)
        </p><p>        When all backends are down, no connection is accepted. Then 1
        <span class="productname">PostgreSQL</span> becomes up, and attach the node using pcp_attach_node. It
        successfully finishes. However, when a new connection arrives, still
        the connection is refused because<span class="productname">Pgpool-II</span> child process looks into the
        cached status, in which the recovered node is still in down status if
        mode is streaming replication mode (native replication and other modes
        are fine). Solution is, if all nodes are down, force to restart all
        pgpool child.
        </p></li><li class="listitem"><p>	    Fix for avoiding downtime when <span class="productname">Pgpool-II</span> changes require a restart. (Muhammad Usama)
        </p><p>        To fix this, the verification mechanism of configuration parameter values is
        reversed, previously the standby nodes used to verify their parameter values
        against the respective values on the master <span class="productname">Pgpool-II</span> node and when the
        inconsistency was found the FATAL error was thrown, now with this commit the
        verification responsibility is delegated to the master <span class="productname">Pgpool-II</span> node.
        Now the master node will verify the configuration parameter values of each
        joining standby node against its local values and will produce
        a WARNING message instead of an error in case of a difference.
        This way the nodes having the different configurations will also be allowed to
        join the watchdog cluster and the user has to manually look out for the
        configuration inconsistency warnings in the master <span class="productname">Pgpool-II</span> log to avoid the
        surprises at the time of <span class="productname">Pgpool-II</span> master switch over.
        </p></li><li class="listitem"><p>	    Fix a problem with the watchdog <a class="xref" href="runtime-config-failover.html#guc-failover-command">failover_command</a> locking mechanism. (Muhammad Usama)
        </p></li><li class="listitem"><p>        Add compiler flag "-fno-strict-aliasing" in <code class="filename">configure.ac</code> to fix compiler error. (Tatsuo Ishii)
        </p></li><li class="listitem"><p>	    Do not use <code class="function">random()</code> while generating MD5 salt. (Tatsuo Ishii)
        </p><p>        <code class="function">random()</code> should not be used in security related applications.  To
        replace <code class="function">random()</code>, import <code class="function">PostmasterRandom()</code> from PostgreSQL.  Also
        store current time at the start up of <span class="productname">Pgpool-II</span> main process for later
        use.
        </p></li><li class="listitem"><p>	    Don't ignore sync message from frontend when query cache is enabled. (Tatsuo Ishii)
        </p></li><li class="listitem"><p>	    Fix bug that <span class="productname">Pgpool-II</span> fails to start if <a class="xref" href="runtime-config-connection.html#guc-listen-addresses">listen_addresses</a> is empty string. (bug 237) (Muhammad Usama)
        </p><p>        The socket descriptor array (fds[]) was not getting the array end marker
        when TCP listen addresses are not used.
        </p></li><li class="listitem"><p>	    Create regression log directory if it does not exist yet. (Tatsuo Ishii)
        </p></li><li class="listitem"><p>	    Fixing the error messages when the socket operation fails. (Muhammad Usama)
        </p></li><li class="listitem"><p>	    Update regression test 003.failover to reflect the changes made to
        <a class="link" href="sql-show-pool-nodes.html" title="SHOW POOL NODES">show pool_nodes</a>. (Tatsuo Ishii)
        </p></li><li class="listitem"><p>	    Fix hang when portal suspend received. (bug 230) (Tatsuo Ishii)
        </p></li><li class="listitem"><p>	    Fix pgpool doesn't de-escalate IP in case network restored. (bug 228) (Muhammad Usama)
        </p><p>        set_state function is made to de-escalate, when it is changing the local node's
        state from the coordinator state to some other state.
        </p></li><li class="listitem"><p>	    SIGUSR1 signal handler should be installed before watchdog initialization. (Muhammad Usama)
        </p><p>        Since there can be a case where a failover request from other watchdog nodes
        arrive at the same time when the watchdog has just been initialized,
        and if we wait any longer to install a SIGUSR1 signal handler, it can
        result in a potential crash
        </p></li><li class="listitem"><p>        Fix <span class="productname">Pgpool-II</span> doesn't escalate ip in case of another node inavailability. (bug 215) (Muhammad Usama)
        </p><p>        The heartbeat receiver fails to identify the heartbeat sender watchdog node when
        the heartbeat destination is specified in terms of an IP address while
        wd_hostname is configured as a hostname string or vice versa.
        </p></li><li class="listitem"><p>        Fixing a coding mistake in watchdog code. (Muhammad Usama)
        </p><p>        <code class="function">wd_issue_failover_lock_command()</code> function is supposed to forward command type
        passed in as an argument to the <code class="function">wd_send_failover_sync_command()</code> function instead
        it was passing the NODE_FAILBACK_CMD command type.
        </p><p>        The commit also contains some log message enhancements.
        </p></li><li class="listitem"><p>	    Display human readable output for backend node status. (Muhammad Usama)
        </p><p>        Changed the output of <a class="link" href="pcp-proc-info.html" title="pcp_proc_info">pcp_node_info</a> utility and show commands display human
        readable backend status string instead of internal status code.
        </p></li><li class="listitem"><p>          Replace "MAJOR" macro to prevent occasional failure. (Tatsuo Ishii)
        </p><p>          The macro calls <code class="function">pool_virtual_master_db_node_id()</code> and then access
          backend-&gt;slots[id]-&gt;con using the node id returned. In rare cases, it
          could point to 0 (in case when the DB node is not connected), which
          gives access to con-&gt;major, then it causes a segfault.
        </p></li><li class="listitem"><p>        Fix "kind mismatch" error message in <span class="productname">Pgpool-II</span>. (Muhammad Usama)
        </p><p>        Many of "kind mismatch..." errors are caused by notice/warning
        messages produced by one or more of the DB nodes. In this case now
        <span class="productname">Pgpool-II</span> forwards the messages to frontend, rather than throwing the
        "kind mismatch..." error. This would reduce the chance of "kind
        mismatch..."  errors.
        </p></li><li class="listitem"><p>	    Fix handling of <a class="xref" href="runtime-config-connection.html#guc-pcp-listen-addresses">pcp_listen_addresses</a> config parameter. (Muhammad Usama)
        </p></li><li class="listitem"><p>	    Save and restore errno in each signal handler. (Tatsuo Ishii)
        </p></li><li class="listitem"><p>	    Fix usage of <code class="function">wait(2)</code> in pgpool main process. (Tatsuo Ishii)
        </p><p>        The usage of <code class="function">wait(2)</code> in <span class="productname">Pgpool-II</span>
        main could cause infinite wait in the system call. Solution is,
        to use <code class="function">waitpid(2)</code> instead of <code class="function">wait(2)</code>.
        </p></li><li class="listitem"><p>        Fix that <code class="function">pool_read()</code> does not emit error messages when <code class="function">read(2)</code> returns -1 if
        <a class="xref" href="runtime-config-failover.html#guc-fail-over-on-backend-error">fail_over_on_backend_error</a> is off. (Tatsuo Ishii)
        </p></li><li class="listitem"><p>        Fix buffer over run problem in "show pool_nodes". (Tatsuo Ishii)
        </p><p>        While processing "show pool_nodes", the buffer for hostname was too
        short. It should be same size as the buffer used for <code class="filename">pgpool.conf</code>.
        Problem reported by a twitter user who is using pgpool on AWS (which
        could have very long hostname).
        </p></li><li class="listitem"><p>        Fix <a class="ulink" href="http://www.pgpool.net/pipermail/pgpool-hackers/2016-June/001638.html" target="_top">        [pgpool-hackers: 1638]</a> pgpool-II does not use default configuration. (Muhammad Usama)
        </p><p>         Configuration file not found should just throw a WARNING message
         instead of ERROR or FATAL.
        </p></li><li class="listitem"><p>	    Fix bug with load balance node id info on shmem. (Tatsuo Ishii)
        </p><p>        There are few places where the load balance node was mistakenly put on
        wrong place. It should be placed on:
        </p><pre class="programlisting">ConnectionInfo *con_info[child id, connection pool_id, backend id].load_balancing_node].
        </pre><p>
        In fact it was placed on:
        </p><pre class="programlisting">*con_info[child id, connection pool_id, 0].load_balancing_node].
        </pre><p>
        </p><p>        As long as the backend id in question is 0, it is ok. However while
        testing <span class="productname">Pgpool-II</span> 3.6's enhancement regarding failover, if primary
        node is 1 (which is the load balance node) and standby is 0, a client
        connecting to node 1 is disconnected when failover happens on node
        0. This is unexpected and the bug was revealed.
        </p><p>        It seems the bug was there since long time ago but it had not found
        until today by the reason above.
        </p></li><li class="listitem"><p>	    Fix for bug that pgpool hangs connections to database. (bug 197) (Muhammad Usama)
        </p><p>        The client connection was getting stuck when backend node and remote <span class="productname">Pgpool-II</span>
        node becomes unavailable at the same time. The reason was a missing command
        timeout handling in the function that sends the IPC commands to watchdog.
        </p></li><li class="listitem"><p>	    Fix a posible hang during health checking. (bug 204) (Yugo Nagata)
        </p><p>        Helath checking was hang when any data wasn't sent
        from backend after <code class="function">connect(2)</code> succeeded. To fix this,
        <code class="function">pool_check_fd()</code> returns 1 when <code class="function">select(2)</code> exits with
        EINTR due to SIGALRM while health checkking is performed.
        </p></li><li class="listitem"><p>         Deal with the case when the primary is not node 0 in streaming replication mode. (Tatsuo Ishii)
        </p><p>
         <a class="ulink" href="http://www.pgpool.net/mantisbt/view.php?id=194#c837" target="_top">         http://www.pgpool.net/mantisbt/view.php?id=194#c837</a> reported that if
         primary is not node 0, then statement timeout could occur even after
         bug194-3.3.diff was applied. After some investigation, it appeared
         that MASTER macro could return other than primary or load balance
         node, which was not supposed to happen, thus <code class="function">do_query()</code> sends queries
         to wrong node (this is not clear from the report but I confirmed it in
         my investigation).
        </p><p>         <code class="function">pool_virtual_master_db_node_id()</code>, which is called in MASTER macro
         returns query_context-&gt;virtual_master_node_id if query context
         exists. This could return wrong node if the variable has not been set
         yet. To fix this, the function is modified: if the variable is not
         either load balance node or primary node, the primary node id is
         returned.
        </p></li><li class="listitem"><p>	    If statement timeout is enabled on backend and <code class="function">do_query()</code> sends a query to primary node, and all of following user queries are sent to
	    standby, it is possible that the next command, for example END, could
	    cause a statement timeout error on the primary, and a kind mismatch
	    error on pgpool-II is raised. (bug 194) (Tatsuo Ishii)
        </p><p>        This fix tries to mitigate the problem by sending sync message instead
        of flush message in <code class="function">do_query()</code>, expecting that the sync message reset
        the statement timeout timer if we are in an explicit transaction. We
        cannot use this technique for implicit transaction case, because the
        sync message removes the unnamed portal if there's any.
        </p><p>        Plus, pg_stat_statement will no longer show the query issued by
        do_query() as "running".
        </p><p>        Plus, pg_stat_statement will no longer show the query issued by
        <code class="function">do_query()</code> as "running".
        </p></li><li class="listitem"><p>	    Fix extended protocol handling in raw mode. (Tatsuo Ishii)
        </p><p>        Bug152 reveals that extended protocol handling in raw mode (actually
        other than in stream mode) was wrong in <code class="function">Describe(</code>) and <code class="function">Close()</code>.
        Unlike stream mode, they should wait for backend response.
        </p></li><li class="listitem"><p>	    Fix confusing comments in <code class="filename">pgpool.conf</code>. (Tatsuo Ishii)
        </p></li><li class="listitem"><p>	    Fix  Japanese and Chinese documetation bug about raw mode. (Yugo Nagata, Bo Peng)
        </p><p>        Connection pool is avalilable in raw mode.
        </p></li><li class="listitem"><p>	    Fix is_<code class="function">set_transaction_serializable()</code> when
        SET default_transaction_isolation TO 'serializable'. (bug 191) (Bo Peng)
        </p><p>        SET default_transaction_isolation TO 'serializable' is sent to
        not only primary but also to standby server in streaming replication mode,
        and this causes an error. Fix is, in streaming replication mode,
        SET default_transaction_isolation TO 'serializable' is sent only to the
        primary server.
        </p></li><li class="listitem"><p>        Fix extended protocol hang with empty query. (bug 190) (Tatsuo Ishii)
        </p><p>        The fixes related to extended protocol cases in 3.5.1 broke the case
        of empty query.  In this case backend replies with "empty query
        response" which is same meaning as a command complete message. Problem
        is, when empty query response is received, pgpool does not reset the
        query in progress flag thus keeps on waiting for backend. However,
        backend will not send the ready for query message until it receives a
        sync message. Fix is, resetting the in progress flag after receiving
        the empty query response and reads from frontend expecting it sends a
        sync message.
        </p></li><li class="listitem"><p>	    Fix for <a class="ulink" href="http://www.pgpool.net/pipermail/pgpool-general/2016-March/004627.html" target="_top">        [pgpool-general: 4569]</a> segfault during trusted_servers check. (Muhammad Usama)
        </p><p>        PostgreSQL's memory and exception manager APIs adopted by the <span class="productname">Pgpool-II</span> 3.4 are not
        thread safe and are causing the segmentation fault in the watchdog lifecheck
        process, as it uses the threads to ping configured trusted hosts for checking
        the upstream connections.
        Fix is to remove threads and use the child process approach instead.
        </p></li><li class="listitem"><p>        Validating the PCP packet length. (Muhammad Usama)
        </p><p>        Without the validation check, a malformed PCP packet can crash the PCP child
        and/or can run the server out of memory by sending the packet with a
        very large data size.
        </p></li><li class="listitem"><p>         Fix <a class="link" href="pgpool-setup.html" title="pgpool_setup">pgpool_setup </a> to not confuse log output. (Tatsuo Ishii)
        </p><p>         Before it simply redirects the stdout and stderr of pgpool process to
         a log file. This could cause log contents being garbled or even
         missed because of race condition caused by multiple process being
         writing concurrently. I and Usama found this while investigating the
         regression failure of 004.watchdog.

         To fix this, <a class="link" href="pgpool-setup.html" title="pgpool_setup">pgpool_setup </a> now generates startall script so that pgpool
         now sends stdout/stderr to cat command and cat writes to the log file
         (It seems the race condition does not occur when writing to a pipe).
        </p></li><li class="listitem"><p>	    Fix for <a class="ulink" href="http://www.pgpool.net/pipermail/pgpool-general/2016-March/004577.html" target="_top">	    [pgpool-general: 4519]</a> Worker Processes Exit and Are Not Re-spawned. (Muhammad Usama)
        </p><p>        The problem was due to a logical mistake in the code for checking the exiting
        child process type when the watchdog is enabled.
        I have also changed the severity of the message from FATAL to LOG, emitted
        for child exits due to max connection reached.
        </p></li><li class="listitem"><p>	    Fix pgpool hung after receiving error state from backend. (bug #169) (Tatsuo Ishii)
        </p><p>        This could happend if we execute an extended protocol query and it
        fails.
        </p></li><li class="listitem"><p>	    Fix query stack problems in extended protocol case. (bug 167, 168) (Tatstuo Ishii)
        </p><p>        </p></li><li class="listitem"><p>	    Fix <a class="ulink" href="http://www.pgpool.net/pipermail/pgpool-hackers/2016-March/001440.html" target="_top">        [pgpool-hackers: 1440]</a> yet another reset query stuck problem. (Tatsuo Ishii)
        </p><p>        After receiving X message from frontend, if <span class="productname">Pgpool-II</span> detects EOF on
        the connection before sending reset query, <span class="productname">Pgpool-II</span> could wait for
        backend which had not received the reset query. To fix this, if EOF
        received, treat this as FRONTEND_ERROR, rather than ERROR.
        </p></li><li class="listitem"><p>	    Fix for <a class="ulink" href="http://www.pgpool.net/pipermail/pgpool-general/2015-December/004323.html" target="_top">	    [pgpool-general: 4265]</a> another reset query stuck problem. (Muhammad Usama)
        </p><p>        The solution is to report FRONTEND_ERROR instead of simple ERROR when
        pool_flush on front-end socket fails.
        </p></li><li class="listitem"><p>	    Fixing pgpool-recovery module compilation issue with <span class="productname">PostgreSQL</span> 9.6. (Muhammad Usama)
        </p><p>        Incorporating the change of function signature for
        <code class="function">GetConfigOption()</code> functions in <span class="productname">PostgreSQL</span> 9.6
        </p></li><li class="listitem"><p>	    Fix compile issue on freebsd. (Muhammad Usama)
        </p><p>        Add missing include files. The patch is contributed by
        the bug reporter and enhanced a little by me.
        </p></li><li class="listitem"><p>	    Fix regression test to check timeout of each test. (Yugo Nagata)
        </p></li><li class="listitem"><p>	    Add some warning messages for <a class="xref" href="runtime-watchdog-config.html#guc-wd-authkey">wd_authkey</a> hash calculation failure. (Yugo Nagata)
        </p><p>        Sometimes <a class="xref" href="runtime-watchdog-config.html#guc-wd-authkey">wd_authkey</a> calculation fails for some reason other than
        authkey mismatch. The additional messages make these distingushable
        for each other.
        </p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="release.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="release.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="bookindex.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Appendix A. Release Notes </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Index</td></tr></table></div></body></html>