<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>5.8. ヘルスチェック</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Pgpool-II 3.7devel 文書" /><link rel="up" href="runtime-config.html" title="第5章 サーバの設定" /><link rel="prev" href="runtime-config-load-balancing.html" title="5.7. 負荷分散" /><link rel="next" href="runtime-config-failover.html" title="5.9. フェイルオーバとフェイルバック" /><link rel="copyright" href="legalnotice.html" title="Legal Notice" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left" colspan="2"></td><th width="60%" align="center"><a accesskey="h" href="index.html">Pgpool-II 3.7devel 文書</a></th><td width="20%" align="right"></td></tr><tr><td width="10%" align="left" valign="top"><a accesskey="p" href="runtime-config-load-balancing.html">前へ</a> </td><td width="10%" align="left" valign="top"><a accesskey="u" href="runtime-config.html">上へ</a></td><td width="60%" align="center">5.8. ヘルスチェック</td><td width="20%" align="right" valign="top"> <a accesskey="n" href="runtime-config-failover.html">次へ</a></td></tr></table><hr /></div><div class="sect1" id="runtime-config-health-check"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.8. ヘルスチェック</h2></div></div></div><p><span class="productname">Pgpool-II</span>はサーバネットワークの障害を検知するために、設定されたバックエンドに定期的に接続を試みます。
この障害チェックの手続きを「ヘルスチェック」と言います。
障害が検知されると、<span class="productname">Pgpool-II</span>は設定に基づいてフェイルオーバや縮退運転を試みます。 
    </p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注意</h3><p>ヘルスチェックは各バックエンドノードへの余分の接続を1つ必要としますので、<code class="filename">postgresql.conf</code>の<code class="literal">max_connections</code>もそれに応じて調整する必要があります。
      </p></div><p>
  </p><div class="variablelist"><dl class="variablelist"><dt id="guc-health-check-timeout"><span class="term"><code class="varname">health_check_timeout</code> (<code class="type">integer</code>)
      <a id="idm45645430417952" class="indexterm"></a>
    </span></dt><dd><p>TCP接続が時間内に成功せずにバックエンドの<span class="productname">PostgreSQL</span>への接続を諦めるまでのタイムアウト値を秒単位で指定します。 
    </p><p>このパラメータは、ネットワークケーブルが抜けた際などにヘルスチェックが長時間待たされるのを防止します。
デフォルトは20秒です。0を指定するとタイムアウト処理をしません (TCP/IP のタイムアウトまで待ちます)。 
    </p><p>このパラメータは<span class="productname">Pgpool-II</span>の設定を再読み込みすることで変更可能です。
    </p></dd><dt id="guc-health-check-period"><span class="term"><code class="varname">health_check_period</code> (<code class="type">integer</code>)
      <a id="idm45645430411776" class="indexterm"></a>
    </span></dt><dd><p>ヘルスチェックの間隔を秒単位で指定します。
デフォルトは0で、これはヘルスチェックが無効であることを意味します。
    </p><p>このパラメータは<span class="productname">Pgpool-II</span>の設定を再読み込みすることで変更可能です。
    </p></dd><dt id="guc-health-check-user"><span class="term"><code class="varname">health_check_user</code> (<code class="type">string</code>)
      <a id="idm45645430407184" class="indexterm"></a>
    </span></dt><dd><p>ヘルスチェックを行う<span class="productname">PostgreSQL</span>ユーザ名を指定します。
同じユーザ名が全ての<span class="productname">PostgreSQL</span>バックエンドに存在していなければなりません。
さもないと、ヘルスチェックがエラーとなります。
      </p><p>このパラメータは<span class="productname">Pgpool-II</span>の設定を再読み込みすることで変更可能です。
      </p></dd><dt id="guc-health-check-password"><span class="term"><code class="varname">health_check_password</code> (<code class="type">string</code>)
      <a id="idm45645430401040" class="indexterm"></a>
    </span></dt><dd><p><a class="xref" href="runtime-config-health-check.html#guc-health-check-user">health_check_user</a>で設定したヘルスチェックを行う<span class="productname">PostgreSQL</span>ユーザ名のパスワードを指定します。
ユーザとパスワードは全ての<span class="productname">PostgreSQL</span>バックエンドで同じである必要があります。
さもないと、ヘルスチェックがエラーとなります。
      </p><p>このパラメータは<span class="productname">Pgpool-II</span>の設定を再読み込みすることで変更可能です。
      </p></dd><dt id="guc-health-check-database"><span class="term"><code class="varname">health_check_database</code> (<code class="type">string</code>)
      <a id="idm45645430394240" class="indexterm"></a>
    </span></dt><dd><p>ヘルスチェックを行う対象の<span class="productname">PostgreSQL</span>データベース名を指定します。
デフォルトは<code class="literal">''</code>で、この場合は最初に<code class="literal">postgres</code>データベースが試され、その後で<code class="literal">template1</code>データベースが試されます。
これは<span class="productname">Pgpool-II</span> <span class="emphasis"><em>V3.4</em></span>以前の挙動と同じです。 
      </p><p>このパラメータは<span class="productname">Pgpool-II</span>の設定を再読み込みすることで変更可能です。
      </p></dd><dt id="guc-health-check-max-retries"><span class="term"><code class="varname">health_check_max_retries</code> (<code class="type">integer</code>)
      <a id="idm45645430385680" class="indexterm"></a>
    </span></dt><dd><p>ヘルスチェックに失敗したときに、諦めてフェイルオーバを始める前にリトライする最大回数を指定します。
        </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">ヒント</h3><p>この設定は動作にむらのあるネットワーク環境において、マスターノードが正常であるにも関わらず、たまにヘルスチェックが失敗することが予想される場合に有用です。
          </p></div><p>
        </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">ヒント</h3><p><code class="varname">health_check_max_retreis</code>を有効にする場合は、<a class="xref" href="runtime-config-failover.html#guc-fail-over-on-backend-error">fail_over_on_backend_error</a>を無効にするのが望ましいです。 
          </p></div><p>
デフォルト値は0で、この場合はリトライをしません。 
      </p><p>このパラメータは<span class="productname">Pgpool-II</span>の設定を再読み込みすることで変更可能です。
      </p></dd><dt id="guc-health-check-retry-delay"><span class="term"><code class="varname">health_check_retry_delay</code> (<code class="type">integer</code>)
      <a id="idm45645430378400" class="indexterm"></a>
    </span></dt><dd><p>ヘルスチェックのリトライ間の時間間隔を秒単位で指定します(<a class="xref" href="runtime-config-health-check.html#guc-health-check-max-retries">health_check_max_retries</a> &gt; 0でなければ有効になりません)。
0を指定すると、待ち時間はなくリトライは直ちに行われます。
      </p><p>このパラメータは<span class="productname">Pgpool-II</span>の設定を再読み込みすることで変更可能です。
      </p></dd><dt id="guc-connect-timeout"><span class="term"><code class="varname">connect_timeout</code> (<code class="type">integer</code>)
      <a id="idm45645430372848" class="indexterm"></a>
    </span></dt><dd><p><code class="function">connect()</code>システムコールを使ったバックエンドへの接続を諦めるまでの時間をミリ秒単位で指定します。
デフォルトは10000ミリ秒(10秒)です。
不安定なネットワークを使う場合、この値を大きくすると良いでしょう。
0を指定すると、タイムアウトしません。 
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p><code class="varname">connect_timeout</code>の値はヘルスチェックだけではなく通常の接続プールを生成するときにも使われます。
          </p></div><p>
      </p><p>このパラメータは<span class="productname">Pgpool-II</span>の設定を再読み込みすることで変更可能です。
      </p></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config-load-balancing.html">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-failover.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">5.7. 負荷分散 </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> 5.9. フェイルオーバとフェイルバック</td></tr></table></div></body></html>