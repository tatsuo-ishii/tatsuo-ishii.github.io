<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>5.9. フェイルオーバとフェイルバック</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Pgpool-II 3.7devel 文書" /><link rel="up" href="runtime-config.html" title="第5章 サーバの設定" /><link rel="prev" href="runtime-config-health-check.html" title="5.8. ヘルスチェック" /><link rel="next" href="runtime-online-recovery.html" title="5.10. オンラインリカバリ" /><link rel="copyright" href="legalnotice.html" title="Legal Notice" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left" colspan="2"></td><th width="60%" align="center"><a accesskey="h" href="index.html">Pgpool-II 3.7devel 文書</a></th><td width="20%" align="right"></td></tr><tr><td width="10%" align="left" valign="top"><a accesskey="p" href="runtime-config-health-check.html">前へ</a> </td><td width="10%" align="left" valign="top"><a accesskey="u" href="runtime-config.html">上へ</a></td><td width="60%" align="center">5.9. フェイルオーバとフェイルバック</td><td width="20%" align="right" valign="top"> <a accesskey="n" href="runtime-online-recovery.html">次へ</a></td></tr></table><hr /></div><div class="sect1" id="runtime-config-failover"><div class="titlepage"><div><div><h2 class="title" style="clear: both">5.9. フェイルオーバとフェイルバック</h2></div></div></div><div class="sect2" id="runtime-config-failover-settings"><div class="titlepage"><div><div><h3 class="title">5.9.1. フェイルオーバとフェイルバックの設定</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="guc-failover-command"><span class="term"><code class="varname">failover_command</code> (<code class="type">string</code>)
        <a id="idm45645430364320" class="indexterm"></a>
      </span></dt><dd><p><span class="productname">PostgreSQL</span>バックエンドノードが切り離される時に実行するユーザコマンドを指定します。
<span class="productname">Pgpool-II</span>はコマンド実行の前に、以下の特殊文字をバックエンドの具体的な情報に置き換えます。
        </p><div class="table" id="failover-command-table"><p class="title"><strong>表5.6 フェイルオーバコマンドオプション</strong></p><div class="table-contents"><table class="table" summary="フェイルオーバコマンドオプション" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>特殊文字</th><th>説明</th></tr></thead><tbody><tr><td>%d</td><td>切り離されたノードのDBノードID</td></tr><tr><td>%h</td><td>切り離されたノードのホスト名</td></tr><tr><td>%p</td><td>切り離されたノードのポート番号</td></tr><tr><td>%D</td><td>切り離されたノードのデータベースクラスタパス</td></tr><tr><td>%M</td><td>古いマスターノードのID</td></tr><tr><td>%m</td><td>新しいマスターノードのID</td></tr><tr><td>%H</td><td>新しいマスターノードのホスト名</td></tr><tr><td>%P</td><td>古いプライマリノードのID</td></tr><tr><td>%r</td><td>新しいマスターノードのポート番号</td></tr><tr><td>%R</td><td>新しいマスターノードのデータベースクラスタパス</td></tr><tr><td>%%</td><td>	'%'文字</td></tr></tbody></table></div></div><br class="table-break" /><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p>フェイルオーバーが実行されると、<span class="productname">Pgpool-II</span>は子プロセスを切断します。
これにより、<span class="productname">Pgpool-II</span>への全てのアクティブセッションが終了されます。
その後、<span class="productname">Pgpool-II</span>は<code class="command">failover_command</code>を実行し、コマンドが完了した後に<span class="productname">Pgpool-II</span>はクライアントからの接続を再び受け付ける準備のため新しい子プロセスを起動します。
          </p></div><p>このパラメータは<span class="productname">Pgpool-II</span>の設定を再読み込みすることで変更可能です。
        </p></dd><dt id="guc-failback-command"><span class="term"><code class="varname">failback_command</code> (<code class="type">string</code>)
        <a id="idm45645430344096" class="indexterm"></a>
      </span></dt><dd><p><span class="productname">PostgreSQL</span>バックエンドノードが<span class="productname">Pgpool-II</span>に復帰された時に実行するユーザコマンドを指定します。
<span class="productname">Pgpool-II</span>はコマンド実行の前に、以下の特殊文字をバックエンドの具体的な情報に置き換えます。
        </p><div class="table" id="ffailback-command-table"><p class="title"><strong>表5.7 フェイルバックコマンドオプション</strong></p><div class="table-contents"><table class="table" summary="フェイルバックコマンドオプション" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>特殊文字</th><th>説明</th></tr></thead><tbody><tr><td>%d</td><td>復帰したノードのDBノードID</td></tr><tr><td>%h</td><td>復帰したノードのホスト名</td></tr><tr><td>%p</td><td>復帰したノードのポート番号</td></tr><tr><td>%D</td><td>復帰したノードのデータベースクラスタパス</td></tr><tr><td>%M</td><td>古いマスターノードのID</td></tr><tr><td>%m</td><td>新しいマスターノードのID</td></tr><tr><td>%H</td><td>新しいマスターノードのホスト名</td></tr><tr><td>%P</td><td>古いプライマリノードのID</td></tr><tr><td>%r</td><td>新しいマスターノードのポート番号</td></tr><tr><td>%R</td><td>新しいマスターノードのデータベースクラスタパス</td></tr><tr><td>%%</td><td>	'%'文字</td></tr></tbody></table></div></div><br class="table-break" /><p>このパラメータは<span class="productname">Pgpool-II</span>の設定を再読み込みすることで変更可能です。
        </p></dd><dt id="guc-follow-master-command"><span class="term"><code class="varname">follow_master_command</code> (<code class="type">string</code>)
        <a id="idm45645430327520" class="indexterm"></a>
      </span></dt><dd><p>プライマリノードのフェイルオーバー後に実行するユーザコマンドを指定します。
この機能は、マスタースレーブモードでストリーミングレプリケーション構成の場合のみ有効です。
<span class="productname">Pgpool-II</span>はコマンド実行の前に、以下の特殊文字をバックエンドの具体的な情報に置き換えます。

        </p><div class="table" id="follow-master-command-table"><p class="title"><strong>表5.8 フォローマスターコマンドオプション</strong></p><div class="table-contents"><table class="table" summary="フォローマスターコマンドオプション" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>特殊文字</th><th>説明</th></tr></thead><tbody><tr><td>%d</td><td>切り離されたノードのDBノードID</td></tr><tr><td>%h</td><td>切り離されたノードのホスト名</td></tr><tr><td>%p</td><td>切り離されたノードのポート番号</td></tr><tr><td>%D</td><td>切り離されたノードのデータベースクラスタパス</td></tr><tr><td>%M</td><td>古いマスターノードのID</td></tr><tr><td>%m</td><td>新しいマスターノードのID</td></tr><tr><td>%H</td><td>新しいマスターノードのホスト名</td></tr><tr><td>%P</td><td>古いプライマリノードのID</td></tr><tr><td>%r</td><td>新しいマスターノードのポート番号</td></tr><tr><td>%R</td><td>新しいマスターノードのデータベースクラスタパス</td></tr><tr><td>%%</td><td>	'%'文字</td></tr></tbody></table></div></div><br class="table-break" /><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p><code class="varname">follow_master_command</code>が空文字列でない場合、ストリーミングレプリケーションによるマスタースレーブでプライマリノードのフェイルオーバーが完了した後に、<span class="productname">Pgpool-II</span>は新しいプライマリ以外のすべてのノードを切り離し、クライアントから再び接続を受け付ける準備のため再度新しい子プロセスを起動します。
その後、<span class="productname">Pgpool-II</span>は切り離されたそれぞれのノードに対して<code class="varname">follow_master_command</code>に設定したコマンドを実行します。
        </p></div><p>通常は、<code class="varname">follow_master_command</code>コマンドは<a class="xref" href="pcp-recovery-node.html" title="pcp_recovery_node"><span class="refentrytitle">pcp_recovery_node</span></a>コマンドを呼んで新しいプライマリからスレーブをリカバリするために使用します。
        </p><p>このパラメータは<span class="productname">Pgpool-II</span>の設定を再読み込みすることで変更可能です。
        </p></dd><dt id="guc-fail-over-on-backend-error"><span class="term"><code class="varname">fail_over_on_backend_error</code> (<code class="type">boolean</code>)
        <a id="idm45645430307456" class="indexterm"></a>
      </span></dt><dd><p>onに設定した場合、<span class="productname">Pgpool-II</span>は<span class="productname">PostgreSQL</span>バックエンド接続からの読み出し、書き込みのエラーをバックエンドノードの故障と見なし、現在のセッションを切断した後にそのノードをフェイルオーバします。
offに設定した場合、そのようなエラーの場合でも<span class="productname">Pgpool-II</span>は単にエラーをレポートしセッションが切断するのみです。
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p><code class="varname">fail_over_on_backend_error</code>をoffにする場合は、バックエンドのヘルスチェックを有効にすることをお勧めします（<a class="xref" href="runtime-config-health-check.html" title="5.8. ヘルスチェック">5.8. ヘルスチェック</a>をご覧ください）。
なお、<span class="productname">PostgreSQL</span>バックエンドサーバが管理コマンドでシャットダウンされたことを<span class="productname">Pgpool-II</span>が検知した場合には依然としてフェイルオーバが起こることに注意してください。
          </p></div><p>このパラメータは<span class="productname">Pgpool-II</span>の設定を再読み込みすることで変更可能です。
        </p></dd><dt id="guc-search-primary-node-timeout"><span class="term"><code class="varname">search_primary_node_timeout</code> (<code class="type">integer</code>)
        <a id="idm45645430297136" class="indexterm"></a>
      </span></dt><dd><p>フェイルオーバが起きた時にプライマリノードを検索するための最大時間を秒単位で指定します。
<span class="productname">Pgpool-II</span>は、ここで設定したした時間の間にプライマリノードを見つけられなかった場合、探すのを諦めます。
デフォルト値は300です。
0を指定すると、永久に検索し続けます。
        </p><p>このパラメータはストリーミングレプリケーションによるマスタースレーブモードの場合のみ有効です。
        </p><p>このパラメータは<span class="productname">Pgpool-II</span>の設定を再読み込みすることで変更可能です。
        </p></dd></dl></div></div><div class="sect2" id="runtime-config-failover-in-the-raw-mode"><div class="titlepage"><div><div><h3 class="title">5.9.2. rawモードにおけるフェイルオーバ</h3></div></div></div><p>rawモードにおいて、複数のバックエンドサーバが定義されている場合、フェイルオーバが可能です。
通常の動作では<span class="productname">Pgpool-II</span>は<code class="literal">backend_hostname0</code>で指定したバックエンドにアクセスします。
何らかのリユで<code class="literal">backend_hostname0</code>のサーバに障害が発生すると、<span class="productname">Pgpool-II</span>は<code class="literal">backend_hostname1</code>へのアクセスを試みます。
これが失敗した場合には<span class="productname">Pgpool-II</span>は<code class="literal">backend_hostname2, 3</code>と以下同様に試みます。
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config-health-check.html">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-online-recovery.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">5.8. ヘルスチェック </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> 5.10. オンラインリカバリ</td></tr></table></div></body></html>