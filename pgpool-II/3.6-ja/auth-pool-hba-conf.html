<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>6.1. pool_hba.confファイル</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="index.html" title="Pgpool-II 3.7devel 文書" /><link rel="up" href="client-authentication.html" title="第6章 クライアント認証" /><link rel="prev" href="client-authentication.html" title="第6章 クライアント認証" /><link rel="next" href="auth-methods.html" title="6.2. 認証方式" /><link rel="copyright" href="legalnotice.html" title="Legal Notice" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left" colspan="2"></td><th width="60%" align="center"><a accesskey="h" href="index.html">Pgpool-II 3.7devel 文書</a></th><td width="20%" align="right"></td></tr><tr><td width="10%" align="left" valign="top"><a accesskey="p" href="client-authentication.html">前へ</a> </td><td width="10%" align="left" valign="top"><a accesskey="u" href="client-authentication.html">上へ</a></td><td width="60%" align="center">6.1. <code class="filename">pool_hba.conf</code>ファイル</td><td width="20%" align="right" valign="top"> <a accesskey="n" href="auth-methods.html">次へ</a></td></tr></table><hr /></div><div class="sect1" id="auth-pool-hba-conf"><div class="titlepage"><div><div><h2 class="title" style="clear: both">6.1. <code class="filename">pool_hba.conf</code>ファイル</h2></div></div></div><a id="idm45863245860208" class="indexterm"></a><p><span class="productname">PostgreSQL</span>の<code class="filename">pg_hba.conf</code>と同じよう<span class="productname">Pgpool-II</span>でも<code class="filename">pool_hba.conf</code>とよばれる設定ファイルを使った同様のクライアント認証機能をサポートしています。
<span class="productname">Pgpool-II</span>インストールするとデフォルトインストール先の設定ファイルディレクトリ（<code class="literal">"/usr/local/etc"</code>）にサンプルの<code class="filename">pool_hba.conf.sample</code>が含まれています。
デフォルトではpool_hbaによる認証は無効になっており、<code class="varname">enable_pool_hba</code>を<code class="literal">on</code>に設定することで有効になります。
<a class="xref" href="runtime-config-connection.html#guc-enable-pool-hba">enable_pool_hba</a>設定パラメータをご覧ください。
  </p><p><code class="filename">pool_hba.conf</code>のフォーマットは<span class="productname">PostgreSQL</span>の<code class="filename">pg_hba.conf</code>のものとほとんど同じです。
<code class="filename">pool_hba.conf</code>ファイルの一般的な書式は、1行につき1つのレコードというレコードの集合です。
空行はコメント用の<code class="literal">#</code>文字以降の文字と同じく無視されます。
レコードは行をまたいで続けることはできません。
レコードはスペースもしくはタブ、もしくはその両方で区切られた、複数のフィールドで構成されています。
フィールドには、フィールド値が二重引用符付きの場合空白文字を含むことができます。
データベース、ユーザもしくはアドレスフィールド内のキーワード(例：<code class="literal">all</code>または<code class="literal">replication</code>)の一つを引用するとその特別な意味が失われ、その名称のデータベース、ユーザもしくはホストと一致するようになります。
  </p><p>それぞれのレコードは接続形式、（接続形式に対して意味を持つのであれば）クライアントのIPアドレス範囲、データベースの名前、ユーザ名およびこれらのパラメータに一致する接続で使用される認証方法を指定します。
接続形式、クライアントアドレス、要求されたデータベース、およびユーザ名に一致する最初のレコードが認証処理に使用されます。
「失敗時の継続」や、 あるいは「バックアップ」はありません。
これは、もしあるレコードが選択されて認証に失敗した場合、後続のレコードは考慮されないということです。
どのレコードも一致しない時はアクセスが拒否されます。
  </p><p>レコードは以下の書式のうちの1つの形式を取ります。
</p><pre class="synopsis">local      <em class="replaceable"><code>database</code></em>  <em class="replaceable"><code>user</code></em>  <em class="replaceable"><code>auth-method</code></em>  [<span class="optional"><em class="replaceable"><code>auth-options</code></em></span>]
host       <em class="replaceable"><code>database</code></em>  <em class="replaceable"><code>user</code></em>  <em class="replaceable"><code>CIDR-address</code></em>  <em class="replaceable"><code>auth-method</code></em>  [<span class="optional"><em class="replaceable"><code>auth-options</code></em></span>]</pre><p>
フィールドの意味は以下のようになっています。

   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">local</code></span></dt><dd><p>このレコードはUnixドメインソケットを使用する接続に対応します。
この種類のレコードを使用しないと、Unixドメインソケット経由の接続は拒否されます
      </p></dd><dt><span class="term"><code class="literal">host</code></span></dt><dd><p>このレコードは、TCP/IPを使用した接続に対応します。
<code class="literal">host</code>レコードは、<acronym class="acronym">SSL</acronym>もしくは非<acronym class="acronym">SSL</acronym>接続のいずれかに対応します。
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p>サーバのデフォルトの動作は、ローカルループバックアドレスである<code class="literal">localhost</code>のみTCP/IP接続を監視しています。
よってサーバにおいて<a class="xref" href="runtime-config-connection.html#guc-listen-addresses">listen_addresses</a>パラメータが適切な値に設定された状態で起動されていない限り、リモートのTCP/IP接続はできません。
      </p></div></dd><dt><span class="term"><em class="replaceable"><code>database</code></em></span></dt><dd><p>このレコードで対応するデータベース名を指定します。
<code class="literal">all</code>という値は、全てのデータベースと対応することを指定します。
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p>databaseフィールド値として<code class="literal">"samegroup"</code>はサポートされません
       </p><p><span class="productname">Pgpool-II</span>は<span class="productname">PostgreSQL</span>バックエンドサーバにあるユーザ情報を事前に知る事ができないため、データベース名は<code class="filename">pool_hba.conf</code>にあるdatabaseフィールドの項目のみと比較されます。
       </p></div><p>
      </p></dd><dt><span class="term"><em class="replaceable"><code>user</code></em></span></dt><dd><p>このレコードで対応するデータベースユーザ名を指定します。
<code class="literal">all</code>という値は、全てのユーザが対応することを指定します。
それ以外の場合には特定のデータベースユーザの名前となります。
       </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p>userフィールド値として"+"を使ったグループ指定はサポートされません

       </p><p>上記の<code class="literal">"samegroup"</code>と同じ理由で、ユーザ名は単純に<code class="filename">pool_hba.conf</code>にあるuserフィールドの項目のみ対してチェックされます。
       </p></div><p>
      </p></dd><dt><span class="term"><em class="replaceable"><code>address</code></em></span></dt><dd><p>このレコードに対応しているクライアントマシンのアドレスを指定します。
IPアドレスの範囲は、範囲の開始アドレス、続いてスラッシュ(<code class="literal">/</code>)と<acronym class="acronym">CIDR</acronym>マスクの長さという標準の数値表記で指定されます。
CIDRマスク長とは、クライアントIPアドレスが一致しなければならない、高位のビット数を表すものです。
指定するIPアドレスのこれより右側のビットには、0を指定しなければなりません。
IPアドレスと<code class="literal">/</code>、およびCIDRマスク長の間には空白を入れてはいけません。
       </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p>現在、IPv6アドレス/マスク表記法はサポートされません
       </p></div><p>
      </p><p>このフィールドは<code class="literal">host</code>レコードにのみ適用されます。
      </p></dd><dt><span class="term"><em class="replaceable"><code>auth-method</code></em></span></dt><dd><p>接続がこのレコードに一致する場合に使用する認証方式を指定します。
使用できる選択肢は以下にまとめていますが、詳しく<a class="xref" href="auth-methods.html" title="6.2. 認証方式">6.2. 認証方式</a>を参照してください。

       </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">trust</code></span></dt><dd><p>接続を無条件で許可します。
この方式は、<span class="productname">Pgpool-II</span>に接続できる全てのユーザを許可します。
         </p></dd><dt><span class="term"><code class="literal">reject</code></span></dt><dd><p>接続を無条件に拒否します。
特定のホストをあるグループから「除外」するために便利です。
例えば、1行の<code class="literal">reject</code>は特定のホストが接続することを拒否します。
         </p></dd><dt><span class="term"><code class="literal">md5</code></span></dt><dd><p>クライアントに対して認証時に二重MD5ハッシュ化パスワードを要求します。

        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p><code class="literal">md5</code>認証を使うには、ユーザ名とパスワードを<code class="filename">pool_passwd</code>というパスワードファイルに登録する必要があります。
詳細は<a class="xref" href="auth-methods.html#auth-md5" title="6.2.2. MD5パスワード認証">6.2.2. MD5パスワード認証</a>を参照してください。
         </p></div><p>
         </p></dd><dt><span class="term"><code class="literal">pam</code></span></dt><dd><p>オペレーティングシステムによって提供されるPAM（Pluggable Authentication Modules）サービスを使用した認証です。
詳細は<a class="xref" href="auth-methods.html#auth-pam" title="6.2.3. PAM認証">6.2.3. PAM認証</a>を参照してください
         </p><p><span class="productname">Pgpool-II</span>が稼働するホスト上のユーザ情報を使ったPAM認証を利用することができます。
PAMサポートを有効にするには、<span class="productname">Pgpool-II</span>が<code class="command">"--with-pam"</code>をつけてconfigureされていなければなりません。
         </p><p>PAM認証を有効にするには、<span class="productname">Pgpool-II</span>のサービス設定ファイルをシステムのPAM設定ディレクトリ（通常は<code class="literal">"/etc/pam.d"</code>にあります）に作成しなければなりません。
サービス設定ファイルのサンプルはインストールディレクトリ下に<code class="literal">"share/pgpool.pam"</code>としてインストールされています。
         </p></dd></dl></div><p>

      </p></dd><dt><span class="term"><em class="replaceable"><code>auth-options</code></em></span></dt><dd><p><em class="replaceable"><code>auth-method</code></em>フィールドの後ろに、認証方式のオプションを指定する、<em class="replaceable"><code>name</code></em>=<em class="replaceable"><code>value</code></em>の形式のフィールドが存在する可能性があります。
      </p></dd></dl></div><p>
  </p><p><code class="filename">pool_hba.conf</code>レコードは接続が試みられる度に順番に検査されますので、レコードの順序はとても大切です。
典型的には、始めの方のレコードには厳しい接続照合パラメータと緩い認証方式があるのに対し、終わりの方のレコードにはより緩い照合パラメータとより厳しい認証方式があります。
例えば、ローカルTCP接続では<code class="literal">trust</code>認証方式、リモートTCP接続に対してはパスワードを要求したいとします。
この場合、広範囲にわたって許可されるクライアントのIPアドレスに対するパスワード認証を指定するレコードの前に127.0.0.1からの接続に対する<code class="literal">trust</code>認証指定のレコードが置かれなければなりません。
  </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">ヒント</h3><p>ここで説明された全てのpool_hba認証のオプションはクライアントと<span class="productname">Pgpool-II</span>の間についてだということに注意してください。
クラインアントは依然として、<span class="productname">PostgreSQL</span>による認証を通過しなければなりませんし、バックエンド<span class="productname">PostgreSQL</span>サーバ上のデータベースに対して<code class="literal">CONNECT</code>権限を持っていなければなりません。
    </p><p>pool_hbaにとってはクライアントに指定されたユーザ名やデータベース名(例. psql -U testuser testdb)が実際にバックエンド上に存在するかどうかは問題ではありません。
pool_hbaは<code class="filename">pool_hba.conf</code>の値とマッチするかどうかのみを気にします。
    </p></div><p>   Some examples of <code class="filename">pool_hba.conf</code> entries are below.
   See the next section for details on the different authentication methods.
<code class="filename">pool_hba.conf</code>ファイルの例をいくつか以下に示します。
各種認証方式の詳細については次の節をご覧ください。
  </p><div class="example" id="example-pg-hba.conf"><p class="title"><strong>例6.1 <code class="filename">pool_hba.conf</code>の項目の例</strong></p><div class="example-contents"><pre class="programlisting"># Allow any user on the local system to connect to any database with
# any database user name using Unix-domain sockets (the default for local
# connections).
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
local   all             all                                     trust

# The same using local loopback TCP/IP connections.
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             all             127.0.0.1/32            trust

# Allow any user from host 192.168.12.10 to connect to database
# "postgres" if the user's password is correctly supplied.
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    postgres        all             192.168.12.10/32        md5</pre></div></div><br class="example-break" /></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="client-authentication.html">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="client-authentication.html">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="auth-methods.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">第6章 クライアント認証 </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> 6.2. 認証方式</td></tr></table></div></body></html>