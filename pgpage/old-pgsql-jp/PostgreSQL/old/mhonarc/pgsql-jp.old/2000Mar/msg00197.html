<!-- MHonArc v2.1.0 -->
<!--X-Subject: [pgsql&#45;jp 13503] Re: 自己紹介＆Debianパッケージの6.5について -->
<!--X-From: Naohito Kikuchi <kick@sisd.dnp.co.jp> -->
<!--X-Date: Tue, 14 Mar 2000 20:08:45 +0900 -->
<!--X-Message-Id: 200003141107.AA02732@vivid.sisd.dnp.co.jp -->
<!--X-ContentType: text/plain -->
<!--X-Reference-Id: NCBBKEPFCJBJDLLOGBDHCEENCAAA.kataoka@interwiz.koganei.tokyo.jp -->
<!--X-Head-End-->
<HTML>
<HEAD>
<TITLE>[pgsql-jp 13503] Re: 自己紹介＆Debianパッケージの6.5について </TITLE>
<LINK REV="made" HREF="mailto:kick@sisd.dnp.co.jp">
</HEAD>
<BODY BGCOLOR="#ffffff">
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
[<A HREF="msg00196.html">Date Prev</A>][<A HREF="msg00198.html">Date Next</A>][<A HREF="msg00198.html">Thread Prev</A>][<A HREF="msg00191.html">Thread Next</A>][<A HREF="index.html#00197">Date Index</A>][<A HREF="threads.html#00197">Thread Index</A>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>[pgsql-jp 13503] Re: 自己紹介＆Debianパッケージの6.5について</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><em>From</em>: Naohito Kikuchi &lt;<A HREF="mailto:kick@sisd.dnp.co.jp">kick@sisd.dnp.co.jp</A>&gt;</LI>
<LI><em>Date</em>: Tue, 14 Mar 2000 20:08:45 +0900</LI>
<LI><em>References</em>: &lt;NCBBKEPFCJBJDLLOGBDHCEENCAAA.kataoka@interwiz.koganei.tokyo.jp&gt;</LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
こんにちは。
菊地です。

"Hiroki Kataoka" &lt;kataoka@interwiz.koganei.tokyo.jp&gt; wrote:

&gt; 片岡＠インターウィズです。
&gt; &gt; 少し気になることですが、vacuum中に
&gt; &gt; NOTICE:  Index creature_mapnumber2: NUMBER OF INDEX' TUPLES
&gt; &gt; (4393) IS NOT THE SAME AS HEAP' (4402)
&gt; &gt; といった警告(？)が数か所出ています。
&gt; &gt; (要するにデータがボロボロ？)
&gt; 
&gt;   私の場合上記のメッセージは、VACUUM中にエラーになったり、VACUUMに時間がかか
&gt; りすぎるのでバックエンドをKILLしたり（こんなひどいことをついやっちゃうんです
&gt; ね…）、いずれにしてもテーブルの更新中に重大なエラーになった場合に起きるよう
&gt; です（といっても普通はないと思いますが）。
&gt; 
&gt;   テーブル本体とインデックス内容とに食い違いがあるということなので、インデッ
&gt; クスを作り直したり、ダンプ→リストアですっきりきれいにすれば問題なくなりま
&gt; す。

最近、使用しているDBでvacuumをしたときに上記に報告されているような
メッセージが出てしまいました。そこで過去のメールを探していたのです
が、その原因や対策について良く分からなかったので質問させてください。

エラーメッセージは以下のように出ていました。
&gt; NOTICE:  Index aaaaatblclassidx: NUMBER OF INDEX' TUPLES 
&gt; (104) IS NOT THE SAME AS HEAP' (102)
&gt; NOTICE:  Index bbbbbtblpididx: NUMBER OF INDEX' TUPLES 
&gt; (104) IS NOT THE SAME AS HEAP' (102)
&gt; (同様なので以下略)

実行中にバックエンドをKILLするなどのような危険なことはしていません
でした。また、このエラーを発見したときもDB自体は動作しているのを確
認しています。ただ、インデックスが壊れてしまっているようで、select
文によるクエリー結果に変なものを取得してきました。変なものを取得し
てきたというのは、ID=100のものを検索しているのに、クエリー結果とし
てID=101のものが表示されるというようなものです。テーブルのデータを
流してみると、ID=100のものとID=101の両方のデータが存在しました。
そこで、インデックスの再作成を行うと、エラーは出なくなったのですが、
IDが重複しているデータの中のID=101のものが消えているなど、他にもい
くつかデータが消えていました。

このエラーを見たことがある方で、原因をご存知の方がいらっしゃいまし
たら、考えられることを教えてもらえませんか？また、その時の対策で良
い方法がございましたら、ご教授ください。よろしくお願いします。

# もしかしたら、PostgreSQLのバグなどということは無いのでしょうか？

使用環境は以下です。
Redhat Linux 5.1
PostgreSQL 6.5.2
Perl 5.004_05

--
大日本札幌ISD 菊地直人 &lt;kick@sisd.dnp.co.jp&gt;
</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<LI>Prev by Date:
<STRONG><A HREF="msg00196.html">[pgsql-jp 13502] Re: １文字違いを検索する方法</A></STRONG>
</LI>
<LI>Next by Date:
<STRONG><A HREF="msg00198.html">[pgsql-jp 13504] 【お礼】曜日の表示　解決報告</A></STRONG>
</LI>
<LI>Prev by thread:
<STRONG><A HREF="msg00198.html">[pgsql-jp 13504] 【お礼】曜日の表示　解決報告</A></STRONG>
</LI>
<LI>Next by thread:
<STRONG><A HREF="msg00191.html">[pgsql-jp 13497] Re: backend terminated abnormally</A></STRONG>
</LI>
<LI>Index(es):
<UL>
<LI><A HREF="index.html#00197"><STRONG>Date</STRONG></A></LI>
<LI><A HREF="threads.html#00197"><STRONG>Thread</STRONG></A></LI>
</UL>
</LI>
</UL>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
