<!-- MHonArc v2.1.0 -->
<!--X-Subject: [pgsql&#45;jp 2462] Re: freeze on running regression test -->
<!--X-From: HIROSE&#45;31&#45;Masaaki <hirose31@t3.rim.or.jp> -->
<!--X-Date: Wed, 10 Sep 1997 03:37:50 +0900 -->
<!--X-Message-Id: 199709091835.DAA10772@mail.t3.rim.or.jp -->
<!--X-ContentType: text/plain -->
<!--X-Reference-Id: 199709091416.XAA04004@meshsv26.tk.mesh.ad.jp -->
<!--X-Head-End-->
<HTML>
<HEAD>
<TITLE>[pgsql-jp 2462] Re: freeze on running regression test </TITLE>
<LINK REV="made" HREF="mailto:hirose31@t3.rim.or.jp">
</HEAD>
<BODY BGCOLOR="#ffffff">
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
[<A HREF="msg00034.html">Date Prev</A>][<A HREF="msg00036.html">Date Next</A>][<A HREF="msg00034.html">Thread Prev</A>][<A HREF="msg00036.html">Thread Next</A>][<A HREF="index.html#00035">Date Index</A>][<A HREF="threads.html#00035">Thread Index</A>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>[pgsql-jp 2462] Re: freeze on running regression test</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><em>From</em>: HIROSE-31-Masaaki &lt;<A HREF="mailto:hirose31@t3.rim.or.jp">hirose31@t3.rim.or.jp</A>&gt;</LI>
<LI><em>Date</em>: Wed, 10 Sep 1997 03:37:50 +0900</LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>

こんにちは。ひろせです。

石井＠SRAさん、坂内＠マイコン計測さん、リプライ感謝します。m(_ _)m
# LDP はこれからあたってみます。

Tatsuo Ishii さんが 97.9.9ごろに書いた
「[pgsql-jp 2460] Re: freeze on running regression test」のメールを引用します

&gt; postmaster 経由で SELECT するとバックエンドが死んでしまうようですね。

状況は

●psql DBNAME 経由で SELECT うんぬんすると３回に１回の割合で psql が固まる
●postgres DBNAME で起動してそのプロンプトから SELECT うんぬんを
  入力した場合は、いくらやっても固まらない
  # この場合どうやって postgres を終了するのでしょう？

んな感じです。

psql が postmaster(?) とお話しするときに何らかのトラブルが起こると
考えていいのでしょうか。

&gt; Linux/x86 では、デフォルトで shared memory が入っているはずなので、
&gt; 直接関係ないと思います。ひろせさんがお使いのカーネルはオリジナルの
&gt; ままですよね？

再構築してます。(^^;
大きなところでは
・Netatalk
・IP Masquerade
・NIC (DECchip 21140A)
・PS/2
関連の設定と、不要な項目の削除をしています。

&gt; strings で見てもしょうがないです:-)

この辺のことはよくわからないので御教授ください。m(_ _)m

やってみたことを記します。

postgres@[~]$ psql test1			＃ psql 起動
	:	:	:	:
test1=&gt; select * from shimei where sei='hirose';
						＃ 固まる
						＃ C-\ する
Quit (core dumped)

						＃ gdb で psql を起動
postgres@[~]$ gdb /usr/local/app/pgsql-6.1.1/bin/psql core

GDB is free software and you are welcome to distribute copies of it
 under certain conditions; type "show copying" to see the conditions.
There is absolutely no warranty for GDB; type "show warranty" for details.
GDB 4.16 (i486-slackware-linux),
Copyright 1996 Free Software Foundation, Inc...

Core was generated by `psql test1'.
Program terminated with signal 3, Quit.
Reading symbols from /usr/local/app/pgsql-6.1.1/lib/libpq.so...done.
Reading symbols from /lib/libdl.so.1...done.
Reading symbols from /lib/libm.so.5...done.
Reading symbols from /lib/libtermcap.so.2...done.
Reading symbols from /lib/libcurses.so.1...done.
Reading symbols from /lib/libc.so.5...done.
Reading symbols from /lib/ld-linux.so.1...done.
#0  0x40061520 in __read ()

(gdb) where
#0  0x40061520 in __read ()
#1  0x4006fd07 in _IO_file_read ()
#2  0x6b6e in ?? ()
Cannot access memory at address 0x616c6250.

(gdb) run test1
Starting program: /usr/local/app/pgsql/bin/psql test1
	:	:	:	:	:
test1=&gt; select * from shimei where sei='hirose';
						＃何回か実行すると固まる
						＃ C-c
Program received signal SIGINT, Interrupt.
0x40061520 in __read ()

(gdb) display __read				＃関数表示
1: {&lt;text variable, no debug info&gt;} 0x4006150c &lt;__read&gt; = {
    &lt;text variable, no debug info&gt;} 0x4006150c &lt;__read&gt;

(gdb) display _IO_file_read
2: {&lt;text variable, no debug info&gt;} 0x4006fce0 &lt;_IO_file_read&gt; = {
    &lt;text variable, no debug info&gt;} 0x4006fce0 &lt;_IO_file_read&gt;

(gdb) up
#1  0x4006fd07 in _IO_file_read ()
(gdb) up
#2  0x54006b6e in ?? ()
(gdb) up
Cannot access memory at address 0x616c6250.

関数の中の変数は表示されませんでした。

postgres@[~]$ file /usr/local/app/pgsql-6.1.1/bin/psql
/usr/local/app/pgsql-6.1.1/bin/psql: ELF 32-bit LSB executable,
	Intel 80386, version 1, dynamically linked, not stripped
と表示されているので strip はされていないと思います。

&gt; 後、ASSERTION をオンにしてコンパイルしてみるのも有益な情報が
&gt; 得られる可能性があります。

具体的にどうすればいいのでしょうか？
Makefile.custom に CFLAGS=-Aassertion と書いたら
$ make all
	:	:	:	:	:
gcc -Aassertion -Wall -Wmissing-prototypes -Dlinux -I../include   -c
version.c -
o version.o
*Initialization*:1: missing token-sequence in `#assert'
make[1]: *** [version.o] Error 1
make[1]: Leaving directory
`/usr/local/src/00making/jpostgresql-v6.1.1/src/utils
'
make: *** [all] Error 2

と怒られました。

&gt; &gt;環境は、
&gt; &gt;Linux 2.0.30 / Slackware 3.2 （だったと思います）
&gt; &gt;CPU: Cyrix 6x86 P133+
&gt; &gt;RAM: 32MB
&gt; &gt;
&gt; &gt;postgresql-v6.1.1 + jp.patch (1997/7/22版)
&gt; &gt;flex version 2.5.4
&gt; &gt;GNU Make version 3.75
&gt; &gt;gcc version 2.7.2.1
&gt; &gt;
&gt; &gt;です。
&gt;
&gt; うーむ、全く模範的な環境ですね。悪いところが見あたりません。
&gt; まさかとは思いますが、ハードトラブル？たとえば、CPU やメモリ
&gt; を差し替えると直ったりして。

Cyrix というのが怪しいといえば怪しいのですが…。
CPU 、メモリのストックがないので差し替えはできませんが、メモリ
の差す順番を変えて試してみます。

# スタートレックが始まってしまった…。

ではでは





---
ひろせまさあき
 E-mail: hirose31@t3.rim.or.jp
 WWW   : <A HREF="http://www.t3.rim.or.jp/~hirose31/">http://www.t3.rim.or.jp/~hirose31/</A>
</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<UL><LI><STRONG>Follow-Ups</STRONG>:
<UL>
<LI><STRONG><A NAME="00036" HREF="msg00036.html">[pgsql-jp 2463] Re: freeze on running regression test</A></STRONG>
<UL><LI><EM>From:</EM> Tatsuo Ishii &lt;t-ishii&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-Follow-Ups-End-->
<!--X-References-->
<UL><LI><STRONG>References</STRONG>:
<UL>
<LI><STRONG><A NAME="00033" HREF="msg00033.html">[pgsql-jp 2460] Re: freeze on running regression test</A></STRONG>
<UL><LI><EM>From:</EM> t-ishii@sra.co.jp (Tatsuo Ishii)</LI></UL></LI>
</UL></LI></UL>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<LI>Prev by Date:
<STRONG><A HREF="msg00034.html">[pgsql-jp 2461] Re: freeze on running regression test</A></STRONG>
</LI>
<LI>Next by Date:
<STRONG><A HREF="msg00036.html">[pgsql-jp 2463] Re: freeze on running regression test</A></STRONG>
</LI>
<LI>Prev by thread:
<STRONG><A HREF="msg00034.html">[pgsql-jp 2461] Re: freeze on running regression test</A></STRONG>
</LI>
<LI>Next by thread:
<STRONG><A HREF="msg00036.html">[pgsql-jp 2463] Re: freeze on running regression test</A></STRONG>
</LI>
<LI>Index(es):
<UL>
<LI><A HREF="index.html#00035"><STRONG>Date</STRONG></A></LI>
<LI><A HREF="threads.html#00035"><STRONG>Thread</STRONG></A></LI>
</UL>
</LI>
</UL>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
