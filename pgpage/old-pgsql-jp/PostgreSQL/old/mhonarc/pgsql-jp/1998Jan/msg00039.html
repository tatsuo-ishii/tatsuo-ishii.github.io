<!-- MHonArc v2.1.0 -->
<!--X-Subject: [pgsql&#45;jp 3252] Re: Too Large Allocation Request -->
<!--X-From: t&#45;ishii@sra.co.jp (Tatsuo Ishii) -->
<!--X-Date: Fri, 9 Jan 1998 20:51:13 +0900 -->
<!--X-Message-Id: 199801091149.UAA04957@meshsv26.tk.mesh.ad.jp -->
<!--X-ContentType: text/plain -->
<!--X-Head-End-->
<HTML>
<HEAD>
<TITLE>[pgsql-jp 3252] Re: Too Large Allocation Request </TITLE>
<LINK REV="made" HREF="mailto:t-ishii@sra.co.jp">
</HEAD>
<BODY BGCOLOR="#ffffff">
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
[<A HREF="msg00038.html">Date Prev</A>][<A HREF="msg00040.html">Date Next</A>][<A HREF="msg00057.html">Thread Prev</A>][<A HREF="msg00038.html">Thread Next</A>][<A HREF="index.html#00039">Date Index</A>][<A HREF="threads.html#00039">Thread Index</A>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>[pgsql-jp 3252] Re: Too Large Allocation Request</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><em>From</em>: <A HREF="mailto:t-ishii@sra.co.jp">t-ishii@sra.co.jp</A> (Tatsuo Ishii)</LI>
<LI><em>Date</em>: Fri, 9 Jan 1998 20:51:13 +0900</LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
石井です。全然解決になってないですが...

At  7:27 PM 98.1.8 +0900, SHIOZAKI Takehiko wrote:
&gt;塩崎です。
&gt;本家の方まで調べていただいて恐縮です。

いえ、最近はサーチエンジンが本家のページに装備されたので、
さらっと調べるくらいならほとんど手間がかかりません。

&gt;[On Jan  7, t-ishii@sra.co.jp (Tatsuo Ishii) writes:]
&gt;&gt;
&gt;&gt;どんなSQL文を使っているのか分かりませんが、いつも同じテーブルで
&gt;
&gt;すみません。それは重々分かっているんですが、いろいろ事情があるもので。

こちらこそ済みません。業務上の秘密をばらすことを強要したつもりは
無かったのですが...

&gt;&gt;エラーが出るのでしょうか？であれば、そのテーブルが壊れているのかも
&gt;&gt;しれません。可能ならばinitdbからやり直してみてはどうでしょう？
&gt;
&gt;やってみましたが、駄目(同じ)でした。

うーん、そうでしたか。

&gt;試行錯誤の結果、postmasterの起動時に「-o '-S 1024'」オプションをつけて
&gt;sortmemを増やしてやればよいことが分かりました。
&gt;しかし、sortmemは高速化のためにディスク使用を減らすのに使われるのではな
&gt;いのでしょうか? これが少なくても遅くなるだけで、エラーになるのは変な気が
&gt;します。
&gt;
&gt;では、実際のSQL文で状況を説明します。

[中略]

&gt;ということで、(3)はちょっと謎ですが、基本的にtext型でsortするとメモリを
&gt;食いすぎて駄目なようです。

group by もソートが発生するので、order by と group by を同時に指定すると
メモリを消費すると思います。
#だからといって、エラーになっていいわけではありませんが。

&gt;intやchar*で「group by」したものを一時表にでも
&gt;しまってから、別の(マスタ)表と結合した方がよいのでしょうか。
&gt;それでも「order by」の問題は残るので、sort用にint型の列でも増やすべきな
&gt;んでしょうか。
&gt;# どうもtext型はうさん臭い気がする。「[pgsql-jp 3088]」の問題も、
&gt;# text型に対するindexをつけないようにしたらなくなったし。

再現可能なデータを添えて本家にレポートするのが良いのですが、
開発者は次の 6.3 に取り組んでいる最中なので、調べてもらえる可能性薄い
でしょうね。また、6.3 では text 型の実装が少し変わったようなので、
もしかしたら今回の問題は解消されているかもしれません。

6.3 が2月にβ、3月に正式版が出る予定なのですが、結局それまで待つ
しかなさそうです。
---
Tatsuo Ishii
t-ishii@sra.co.jp
</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<LI>Prev by Date:
<STRONG><A HREF="msg00038.html">[pgsql-jp 3251] self-introduction</A></STRONG>
</LI>
<LI>Next by Date:
<STRONG><A HREF="msg00040.html">[pgsql-jp 3253] FreeBSDにインストールしました</A></STRONG>
</LI>
<LI>Prev by thread:
<STRONG><A HREF="msg00057.html">[pgsql-jp 3270] Re: FreeBSDにインストールしました</A></STRONG>
</LI>
<LI>Next by thread:
<STRONG><A HREF="msg00038.html">[pgsql-jp 3251] self-introduction</A></STRONG>
</LI>
<LI>Index(es):
<UL>
<LI><A HREF="index.html#00039"><STRONG>Date</STRONG></A></LI>
<LI><A HREF="threads.html#00039"><STRONG>Thread</STRONG></A></LI>
</UL>
</LI>
</UL>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
