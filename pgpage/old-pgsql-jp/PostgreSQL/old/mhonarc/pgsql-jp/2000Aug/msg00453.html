<!-- MHonArc v2.1.0 -->
<!--X-Subject: [pgsql&#45;jp 16839] RE: 7.0.2¤ÎinsertÄ¾¸å¤Îpg_getlastoid()¤ÇÀµ¿ô¤Ë¤Ê¤Ã¤Æ¤·¤Þ¤¦Ææ -->
<!--X-From: "Eiji Tokuya" <tokuya@Mail.Sankyo&#45;Unyu.co.jp> -->
<!--X-Date: Tue, 22 Aug 2000 18:17:50 +0900 -->
<!--X-Message-Id: NEBBIPCKMDIGJJHFKAONEEFACAAA.tokuya@mail.sankyo&#45;unyu.co.jp -->
<!--X-ContentType: text/plain -->
<!--X-Reference-Id: 20000822164413.19622861@zaqcad091da.zaq.ne.jp -->
<!--X-Head-End-->
<HTML>
<HEAD>
<TITLE>[pgsql-jp 16839] RE: 7.0.2¤ÎinsertÄ¾¸å¤Îpg_getlastoid()¤ÇÀµ¿ô¤Ë¤Ê¤Ã¤Æ¤·¤ </TITLE>
<LINK REV="made" HREF="mailto:tokuya@Mail.Sankyo-Unyu.co.jp">
</HEAD>
<BODY BGCOLOR="#ffffff">
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
[<A HREF="msg00452.html">Date Prev</A>][<A HREF="msg00454.html">Date Next</A>][<A HREF="msg00477.html">Thread Prev</A>][<A HREF="msg00457.html">Thread Next</A>][<A HREF="index.html#00453">Date Index</A>][<A HREF="threads.html#00453">Thread Index</A>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>[pgsql-jp 16839] RE: 7.0.2¤ÎinsertÄ¾¸å¤Îpg_getlastoid()¤ÇÀµ¿ô¤Ë¤Ê¤Ã¤Æ¤·¤Þ¤¦Ææ</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><em>From</em>: "Eiji Tokuya" &lt;<A HREF="mailto:tokuya@Mail.Sankyo-Unyu.co.jp">tokuya@Mail.Sankyo-Unyu.co.jp</A>&gt;</LI>
<LI><em>Date</em>: Tue, 22 Aug 2000 18:17:50 +0900</LI>
<LI><em>Importance</em>: Normal</LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
¤³¤ó¤Ë¤Á¤ï¡£ÆÁ²È¤Ç¤¹¡£
OID¤Ë¤Ä¤¤¤Æ¤Ï¡¢¼«Ê¬¤Ê¤ê¤Ë¥Á¥§¥Ã¥¯¤·¤Þ¤·¤¿¡£
OID¤Ï³Æ¥¤¥ó¥¿¡¼¥Õ¥§¥¤¥¹¤Ç¤Þ¤Á¤Þ¤Á¤Î°·¤¤¤Ê¤Î¤Ç¡¢¶ËÎÏ¸Æ¤Ó½Ð¤·¤¿¤ê¤·¤Ê¤¤¤è¤¦¤Ë
¤¹¤ë¤Î¤¬ÎÉ¤¤¤È»×¤¤¤Þ¤¹¡£
PostgreSQLÆâ¤À¤±¤Ë¤È¤É¤á¤Æ¤â¡¢¥ª¥Ö¥¸¥§¥¯¥È¤ÎºîÀ®¤âÀ©¸Â¤µ¤ì¤ë¤Û¤È¤Ê¤Î¤Ç¡¢³°Éô
¤Î¥×¥í¥°¥é¥à¤«¤é¤ÎÍøÍÑ¤Ï¸·¤·¤¤¤â¤Î¤¬¤¢¤ê¤Þ¤¹¡£
OID¤Ë¤è¤ë¥ì¥³¡¼¥É´ÉÍý¤ÏÄü¤á¡¢¥·¥ê¥¢¥ë·¿¤Î¥«¥é¥à¤ò1¤ÄÄÉ²Ã¤µ¤»¤ë¤è¤¦¤Ë¤·ÂÐ±þ¤·
¤Þ¤·¤¿¡£

¤Þ¤¿Ê£¿ô¤Î¥Æ¡¼¥Ö¥ë¤Ç1¤Ä¤Î¥·¡¼¥±¥ó¥¹¤òÍøÍÑ¤·¤¿¼Â¸³¤·¤ÆÀ®¸ù¤·¤Æ¤¤¤Þ¤¹¡£(^^;)

CREATE SEQUENCE "seq";
CREATE TABLE a ( a INT4 DEFAULT NEXTVAL('seq'), ........);
CREATE TABLE b ( b INT4 DEFAULT NEXTVAL('seq'), ........);

ÃÍ¤ò¤È¤ë»þ¤Ï¡¢
SELECT CURRVAL('seq');
¤Ç¤¹¡£

¤³¤ÎÊýË¡¤À¤ÈÊ£¿ô¤Î¥Æ¡¼¥Ö¥ë¤Ç¤Î°ì°Õ¤ÎÃÍ¤¬¤È¤ì¤ë¤Î¤Ç¡¢OID¤È¥½¥Ã¥¯¥ê¤Ë¤Ê¤ê¤Þ¤¹
¤è¡£
°ì°Õ¤ÎÃÍ¤¬É¬Í×¤Ê¥Æ¡¼¥Ö¥ë¤À¤±¤Ç¤ÎÄÌ¤·ÈÖ¹æ¤Ê¤Î¤ÇOID¤è¤êÄ¹»ý¤Á¤·¤Þ¤¹¡£

¤É¤Î¤è¤¦¤Ë¹½À®¤·¤Æ¤¤¤ë¤«º£¤Ò¤È¤ÄÇÄ°®¤Ç¤­¤Æ¤¤¤Þ¤»¤ó¤¬¡¢¡Ö¤³¤ì¤Ç¤Ï¥Æ¡¼¥Ö¥ë¤ÎºÆ
¹½À®¤¬ÂçÊÑ¤À¡×¤È¤¤¤¦¾ì¹ç¤Ï
SELECT MIN(OID) FROM TABLE;
¤Ç¥Þ¥¤¥Ê¥¹¤ÎÃÍ¤Ç¤¢¤ì¤Ðpg_getlastoid()¤ÎÌá¤êÃÍ¤Ë-1¤ò¤«¤±¤Æ¤¢¤²¤ì¤Ð¤¤¤«¤«¤Ç
¤·¤ç¤¦¤«¡©

¤³¤Î¤è¤¦¤ÊÊýË¡¤Ç¤Ï¥À¥á¤Ç¤¹¤«¡©¡©¡©¡¡(^^;;;;

ÆÁ²È


&gt; ÆÁÅÄ¤È¸À¤¤¤Þ¤¹
&gt;
&gt; ¡Ú¸½¾Ý¡Û
&gt; INSERT Ä¾¸å¤Ë pg_getlastoid() ¤ò¼Â¹Ô¤¹¤ë¤È¡¢ËÜÍè¼«Æ°À¸À®¤·¤¿
&gt; OIDÈÖ¹æ¤È°Û¤Ê¤ë¿ôÃÍ¤òÊÖ¿ô¤¹¤ë¸½¾Ý¤Ç¤¹¡£¿®¤¸¤Æ¤¤¤¿¤À¤±¤Ê¤¤¤È
&gt; Â¸¤¸¤Þ¤¹¡£ÌÜ²¼¡¢PostgreSQL7.0.2¤ÏÉé(¥Þ¥¤¥Ê¥¹)¤ÎOID¤ò¼«Æ°
&gt; À¸À®¤·¤Æ¤¤¤Þ¤¹¡£Îã¤¨¤Ð¡¡-2147479072¡¡¤È¤«¤Ç¤¹¡£
&gt; ²¾¤Ëº£¡¢INSERT¤ò¼Â¹Ô¤·¼«Æ°Åª¤ËÀ¸À®¤µ¤ì¤¿OID¤¬ -2147479072
&gt; ¤À¤È¤·¤Þ¤·¤ç¤¦¡£¤½¤·¤Æ¡¢¤³¤ÎINSERT¤òPHP¤Çpg_exec¤·¤¿Ä¾¸å¤Ë
&gt; pg_getlastoid()¤ò¼Â¹Ô¤¹¤ë¤È¡¢²¿¤ÈÌá¤êÃÍ¤¬Àµ¿ô¤Ë¤Ê¤Ã¤Æ¤·¤Þ¤¤¤Þ¤¹¡£
&gt; ¤Ä¤Þ¤ê¡¢pg_getlastoid() ¤ÎÌá¤êÃÍ¤Ï ¡Ü2147479072 ¤È¤Ê¤ê¤Þ¤¹¡£
&gt; ¤ß¤Ê¤µ¤ó¤Î¤È¤³¤í¤Ç¤Ï¡¢°Û¾ï¤Ï¤Ê¤¤¤Ç¤¹¤«¡©
&gt; ¤­¤Ã¤È¤ß¤Ê¤µ¤ó¤Î¤È¤³¤í¤Ç¤Ï¡ÖOID¤ÏÀµ¿ô¤À¤è¡ª¡×¤Ã¤Æ¸À¤ï¤ì¤ë¤Î¤Ç
&gt; ¤·¤ç¤¦¤Í¡£
&gt;
&gt; PHP¤Ï³Î¤«¤ËPostgres7.0.2¤ò¥¤¥ó¥¹¥È¡¼¥ë¤·¤¿Ä¾¸å¤Ë¡¢PHP¤ò
&gt; ºÆÅÙ¥³¥ó¥Ñ¥¤¥ë¤·¡¢Apache¤Î¥â¥¸¥å¡¼¥ë¤ËÃÖ´¹¤µ¤»¤Þ¤·¤¿¤¬
&gt; PHP¤Î¥½¡¼¥¹¤ÏÊÑ¤ï¤Ã¤Æ¤ª¤ê¤Þ¤»¤ó¡£
&gt;
&gt; ¸½ºß¤Î´Ä¶­
&gt; PostgreSQL 7.0.2 (gcc 2.7.2.3)
&gt; (postgresql-7.0.2-patched-20000820.tar.gz)
&gt; php-3.0.15-i18n-ja
&gt; apache_1.3.12+openssl-0.9.5a+ssl_1.40
&gt; ¤ÇPostgreSQL¤òÍøÍÑÃæ¤Ç¤¹¡£
&gt; Linux 2.0.36
&gt;
&gt; ¿·µ¬ÍøÍÑ¤Ç¤Ï¤Ê¤¯¡¢°ÊÁ°¤Î¥Ð¡¼¥¸¥ç¥ó¤ÎPostgreSQL6.5.3¤Ç
&gt; ÍøÍÑÃæ¤Î´ÉÍý¥ß¥¹¤Ç°Û¾ï¤Ê¾õ¶·¤È¤Ê¤Ã¤¿¤¿¤á¤Ë
&gt; PostgreSQL¤Î¤ß¤òºÇ¿·ÈÇ¤Ë¥¢¥Ã¥×¥°¥ì¡¼¥É¤·¡¢
&gt; ¥Ç¡¼¥¿¡¼¥Ù¡¼¥¹¾ðÊó¤Ïpg_dump¤Ç¤Ï¤Ê¤¯
&gt; psql ¤Î copy ¤Î WITH OIDS ¥ª¥×¥·¥ç¥óÉÕ¤­¤Ç¥À¥ó¥×¤·¡¢
&gt; 7.0.2¤Ë¤·¤Æ¤«¤é¡¢OID ¹þ¤ß¤ÇÉü¸µ¤·¤Þ¤·¤¿¡£
&gt; (pg_dump -o ¤ÇOIDÉÕ¤­¤Ç½ÐÎÏ¤·¡¢psql -f ¤Ç
&gt; ÆÉ¤ß¹þ¤ó¤Ç¤â OID ¤òÉü¸µ¤·¤Ê¤«¤Ã¤¿ÍýÍ³¤â¤¢¤ê¤Þ¤¹¡¦¡¦¡¦¡Ë
&gt; ¡Ö¤Ê¤¼ OID ¤òÉü¸µ¤¹¤ë¤Î¤«¡©¡ª¡×¤Èµ¿Ìä¤Î¥á¡¼¥ë¤¬
&gt; Íè¤½¤¦¤Ç¤¹¤¬¡¢ÆÈ¼«¤ÎÈ½ÃÇ¤ÇOID¤òÄ¾ÀÜ»²¾È¤¹¤ë¥·¥¹¥Æ¥à¤È¤·¤Æ
&gt; PHP¤Ç³«È¯¤ò¿Ê¤á¤Æ¤ª¤ê¤Þ¤¹¡£ËÜÀ¤Âå¤Î¥·¥¹¥Æ¥à¤òOracle¤Ê¤É
&gt; Â¾¤ÎSQL¤Ë°Ü¿¢Í½Äê¤¬¤Ê¤¤¤¿¤á¤È¡¢ÃÏÍý¥Ç¡¼¥¿¡¼¤Î°·¤¤¤Î
&gt; ÍøÍÑ¤Ë¤è¤ê¤Þ¤¹¡£
&gt;
&gt; ³Î¤«¤Ë¡ÖOID¤ÎÉü¸µ¤Ç¡¢OID¼«Æ°È¯À¸¥ë¡¼¥Á¥ó¤È¶¥¹ç¤·¤Ê¤¤
&gt; ¤Î¤«¤Ê¡Á¡×¤Ê¤É¤È¹Í¤¨¤Ê¤¬¤éºî¶È¤ò¡ÖOID¤¬´°àú¤ËÉü¸µ¤Ç¤­¤¿¤«¡×
&gt; ¤ò¥Á¥§¥Ã¥¯¤·¤Ê¤¬¤é°Ü¿¢ºî¶È¤ò¹Ô¤¤¤Þ¤·¤¿¡£
&gt;
&gt; ¤½¤·¤Æ¡¢PostgreSQL 6.5.3 ¤Ç´°àú¤ËÆ°ºî¤·¤Æ¤¤¤¿PHP¥¹¥¯¥ê¥×¥È¤¬
&gt; ¤³¤È¤´¤È¤¯¥¨¥é¡¼¤òÅÇ¤­½Ð¤·¤Þ¤·¤¿¡£¡Ö¤¨¡Á¡ª¡¡¤¦¤½¤À¤í¡×¾õÂÖ¤Ç¤¹¡£
&gt;
&gt; ¤½¤³¤ÇÈ¯¸«¤Ç¤­¤¿¤Î¤¬¡¢¿·µ¬OID¤¬¤ä¤¿¤éÂç¤­¤ÊÉé¤Î¿ô»ú¤È¤Ê¤Ã¤Æ¤¤¤ë
&gt; ÅÀ¤Ç¤·¤¿¡£°ÊÁ°¤Î¥Ð¡¼¥¸¥ç¥ó¤Ç¤¢¤ë 6.5.3 »þÂå¤Ç¤ÏOID¤¬Á´¤Æ
&gt; Àµ¿ô¤Ç¤·¤¿¤Î¤Ç¡¢SELECT¹½Ê¸¤Ê¤É¤Î WHERE ¤Ç OID ¤òÆÃÄê¤¹¤ë¾ì¹ç¡¢
&gt; ¥·¥ó¥°¥ë¥¯¥ª¡¼¥Æ¡¼¥·¥ç¥ó¤Ïºß¤Ã¤Æ¤âÌµ¤¯¤Æ¤â¥¨¥é¡¼¤Ë¤Ï¤Ê¤ê¤Þ¤»¤ó
&gt; ¤Ç¤·¤¿¡£Îã¤¨¤Ð
&gt;
&gt; $OID_ = 12345678;
&gt; $query = "select * from junk where oid = $OID_";
&gt;
&gt; ¤Ç¤â°Û¾ï¤Ç¤Ï¤Ê¤«¤Ã¤¿¤Î¤Ç¤¹¤¬¡¦¡¦¡¦Éé¤Î¿ô»ú¤È¤Ê¤Ã¤¿º£¤Ç¤Ï
&gt; É¬¤º¡Ö¡Ç¡×¥·¥ó¥°¥ë¥¯¥ª¡¼¥Æ¥¤¥·¥ç¥ó¤Ç°Ï¤Þ¤Ê¤¤¤È¥¨¥é¡¼¤Ë¤Ê¤é¤Ê¤¤¤Ç
&gt; »²¾ÈÉÔÇ½¤È¤Ê¤ê¤Þ¤¹¡£¤½¤³¤ÇÁ´¤Æ¤ÎPHP¥½¡¼¥¹¤òÊÔ½¸¤·¤Þ¤·¤¿¡£
&gt;
&gt; ¤Þ¤À¥¨¥é¡¼¤¬¤¢¤ê¤Þ¤·¤¿¡¢SELECT ¤Î DISTINCT ON ¤ËÂ³¤¯
&gt; ¥Õ¥£¡¼¥ë¥É»ØÄê¤Ë¾®³ç¸Ì¤¬É¬¿Ü¤È¤Ê¤Ã¤¿¤³¤È¤Ç¤¹¡£6.5.3¤Ç¤Ï
&gt; ¾¯³ç¸Ì¤¬Ìµ¤¯¤Æ¤â¥¨¥é¡¼¤Ç¤Ï¤¢¤ê¤Þ¤»¤ó¤Ç¤·¤¿¡£
&gt;
&gt; ¾¯¡¹Ã¦Àþ¤·¤Þ¤·¤¿¤¬¡¢ÌÜ²¼¡¢pg_getlastoid()¤Î¿¶¤ëÉñ¤¤¤ò
&gt; PHP¤Ê¤É¤Î¥½¥Õ¥È¤Ç¤´¤Þ¤«¤¹¥ë¡¼¥Á¥ó¤ò»×¤¤¤Ä¤«¤Ê¤¤¤Î¤Ç
&gt; ML¤Ë¥¢¥Ã¥×Ã×¤·¤Þ¤·¤¿¡£¤ß¤Ê¤µ¤ó¤Î¤ªÃÎ·Ã¤òÇÒ¼Ú¤·¤¿¤¤¤È
&gt; Â¸¤¸¤Þ¤¹¡£
&gt;
&gt; ¢¨ PostgreSQL 6.5.3 ¤«¤é postgreSQL 7.0.2 ¤Ø¤Î°Ü¿¢ºî¶È¤Ë
&gt; ¡¡·¹Ãí¤·¤Æ¤ª¤ê¤Þ¤·¤¿¤Î¤Ç¡¢ML¤Î¥Á¥§¥Ã¥¯¤¬¤Ç¤­¤Æ¤ª¤ê¤Þ¤»¤ó¡£
&gt; ¡¡²áµî¤Î¾®À¸¤ÎMLÈ¯¸À¤Ø¤ÎResponse¤Ø¤ÎÊÖÅú¤¬ÂÚ¤Ã¤Æ¤¤¤ë¾ì¹ç¤Ï
&gt; ¡¡¶ÛµÞºî¶È¤À¤Ã¤¿¤¿¤á¤ÈÌÈ¤¸¤Æ¤¯¤À¤µ¤¤¤Þ¤»¡£
&gt;
&gt; _/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
&gt;      Yoshio Tokuda
&gt; _/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
&gt;
&gt;
&gt;
</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<UL><LI><STRONG>Follow-Ups</STRONG>:
<UL>
<LI><STRONG><A NAME="00457" HREF="msg00457.html">[pgsql-jp 16843] Re: [pgsql-jp 16839] RE: 7.0.2¤ÎinsertÄ¾¸å¤Îpg_getlastoid()¤ÇÀµ¿ô¤Ë¤Ê¤Ã¤Æ¤·¤Þ¤¦Ææ</A></STRONG>
<UL><LI><EM>From:</EM> "Yoshio Tokuda"&lt;actords@zaqcad091da.zaq.ne.jp&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-Follow-Ups-End-->
<!--X-References-->
<UL><LI><STRONG>References</STRONG>:
<UL>
<LI><STRONG><A NAME="00448" HREF="msg00448.html">[pgsql-jp 16834] 7.0.2¤ÎinsertÄ¾¸å¤Îpg_getlastoid()¤ÇÀµ¿ô¤Ë¤Ê¤Ã¤Æ¤·¤Þ¤¦Ææ</A></STRONG>
<UL><LI><EM>From:</EM> "Yoshio Tokuda"&lt;actords@zaqcad091da.zaq.ne.jp&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<LI>Prev by Date:
<STRONG><A HREF="msg00452.html">[pgsql-jp 16838] Re: PostgreSQL¤Î´ÉÍýÍÑ¥Ä¡¼¥ë</A></STRONG>
</LI>
<LI>Next by Date:
<STRONG><A HREF="msg00454.html">[pgsql-jp 16840] Re: [pgsql-jp 16835] Re: [pgsql-jp 16834] 7.0.2¤ÎinsertÄ¾¸å¤Îpg_getlastoid()¤ÇÀµ¿ô¤Ë¤Ê¤Ã¤Æ¤·¤Þ¤¦Ææ</A></STRONG>
</LI>
<LI>Prev by thread:
<STRONG><A HREF="msg00477.html">[pgsql-jp 16863] Re: [pgsql-jp 16862] Re:7.0.2¤ÎinsertÄ¾¸å¤Îpg_getlastoid()¤ÇÀµ¿ô¤Ë¤Ê¤Ã¤Æ¤·¤Þ¤¦Ææ</A></STRONG>
</LI>
<LI>Next by thread:
<STRONG><A HREF="msg00457.html">[pgsql-jp 16843] Re: [pgsql-jp 16839] RE: 7.0.2¤ÎinsertÄ¾¸å¤Îpg_getlastoid()¤ÇÀµ¿ô¤Ë¤Ê¤Ã¤Æ¤·¤Þ¤¦Ææ</A></STRONG>
</LI>
<LI>Index(es):
<UL>
<LI><A HREF="index.html#00453"><STRONG>Date</STRONG></A></LI>
<LI><A HREF="threads.html#00453"><STRONG>Thread</STRONG></A></LI>
</UL>
</LI>
</UL>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
