<!-- MHonArc v2.1.0 -->
<!--X-Subject: [pgsql&#45;jp 5265] please advice me -->
<!--X-From: Masaya Seki <jf2m&#45;sk@asahi&#45;net.or.jp> -->
<!--X-Date: Sun, 6 Sep 1998 03:05:26 +0900 (JST) -->
<!--X-Message-Id: 199809051805.DAA27367@leo.asahi&#45;net.or.jp -->
<!--X-ContentType: text/plain -->
<!--X-Head-End-->
<HTML>
<HEAD>
<TITLE>[pgsql-jp 5265] please advice me </TITLE>
<LINK REV="made" HREF="mailto:jf2m-sk@asahi-net.or.jp">
</HEAD>
<BODY BGCOLOR="#ffffff">
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
[<A HREF="msg00057.html">Date Prev</A>][<A HREF="msg00059.html">Date Next</A>][<A HREF="msg00080.html">Thread Prev</A>][<A HREF="msg00063.html">Thread Next</A>][<A HREF="index.html#00058">Date Index</A>][<A HREF="threads.html#00058">Thread Index</A>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>[pgsql-jp 5265] please advice me</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><em>From</em>: Masaya Seki &lt;<A HREF="mailto:jf2m-sk@asahi-net.or.jp">jf2m-sk@asahi-net.or.jp</A>&gt;</LI>
<LI><em>Date</em>: Sun, 6 Sep 1998 03:05:26 +0900 (JST)</LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
お世話になってます 関です。

postgresqlをUPDATEするPHP/FIハンドリングを見よう見まねで
作っています。また、突っ掛かってしまいました。

www.city.fujisawa.kanagawa.jp/~louis/apps/phpfi/doc-j.html
を拝見させて頂いたのですが、解決できません。

お手数をおかけしますが、アドバイスいただければ
ありがたいです。

直接SELECT、UPDATEは問題ありません。


1．問題点

UPDATEするレコードをSELECTし、ストアーするところで
エラーになってしまいました。

00022222meibowkrep.phtml: parse error, expecting `'('' on line 33
$shoz1st = shoz1;

2．作ったHTML、PHTML
+++++++++++++++++++++++++++++++++++++
+++            HTML               +++
++++++++++++++++++++++++++++++++++++
&lt;HTML&gt;
&lt;HEAD&gt;
        &lt;META HTTP-EQUIV=Content-Type CONTENT=text/html; charset=EUC_jp&gt;
        &lt;TITLE&gt;meibo-eteisei&lt;/TITLE&gt;
&lt;/HEAD&gt;

&lt;BODY BGCOLOR=WHITE&gt;

        &lt;CENTER&gt;&lt;H1&gt;&lt;B&gt;労働者名簿訂正画面&lt;/B&gt;&lt;/H1&gt;&lt;/CENTER&gt;

        &lt;FORM ACTION = "meibowkrep.phtml" METHOD = POST&gt;

        &lt;FONT SIZE = 4 COLOR = "RED"&gt;&lt;B&gt;個人番号必須&lt;/B&gt;&lt;BR&gt;&lt;/FONT&gt;
        &lt;INPUT TYPE = "text" NAME = kojintr MAXLENGTH = 8  SIZE = 8&gt; &lt;BR&gt;

        &lt;FONT SIZE = 4 COLOR = "RED"&gt;&lt;B&gt;所属（元）訂正 &lt;/B&gt;&lt;BR&gt;&lt;/FONT&gt;
                &lt;INPUT TYPE = "CHECKBOX" NAME ="shoz1-tei" VALUE=" "&gt;
&lt;INPUT TYPE = "text" NAME = shoz1tr MAXLENGTH = 7  SIZE = 7&gt; &lt;BR&gt;

        &lt;FONT SIZE = 4 COLOR = "RED"&gt;&lt;B&gt;所属（勤務地）訂正&lt;/B&gt;&lt;BR&gt;&lt;/FONT&gt;
         &lt;INPUT TYPE = "CHECKBOX" NAME ="shoz2-tei" VALUE=" "&gt;
         &lt;INPUT TYPE = "text" NAME = shoz2tr MAXLENGTH = 7  SIZE = 7&gt; &lt;BR&gt;

  &lt;FONT SIZE = 4 COLOR = "RED"&gt;&lt;B&gt;年齢訂正&lt;/B&gt;&lt;BR&gt;&lt;/FONT&gt;
        &lt;INPUT TYPE = "CHECKBOX" NAME ="age-tei" VALUE=" "&gt;
        &lt;INPUT TYPE = "text" NAME = agetr MAXLENGTH = 2 SIZE = 2&gt;&lt;BR&gt;&lt;BR&gt;

        &lt;FONT SIZE = 4 COLOR = "RED"&gt;&lt;B&gt;性別訂正&lt;/B&gt;&lt;BR&gt;&lt;/FONT&gt;
        &lt;INPUT TYPE = "CHECKBOX" NAME ="sex-tei" VALUE " "&gt;
        &lt;INPUT TYPE = "radio" NAME = sextr VALUE = 1&gt;男性
        &lt;INPUT TYPE = "radio" NAME = sextr VALUE = 2&gt;女性&lt;BR&gt;&lt;BR&gt;

        &lt;FONT SIZE = 4 COLOR = "RED"&gt;&lt;B&gt;氏名訂正&lt;/B&gt;&lt;BR&gt;&lt;/FONT&gt;
        &lt;INPUT TYPE = "CHECKBOX" NAME ="name-tei" VALUE " "&gt;
        &lt;INPUT TYPE = "text" NAME = nametr MAXLENGTH = 50  SIZE = 50&gt; &lt;BR&gt;

        &lt;FONT SIZE = 4 COLOR = "RED"&gt;&lt;B&gt;郵便番号訂正&lt;/B&gt;&lt;BR&gt;&lt;/FONT&gt;
        &lt;INPUT TYPE = "CHECKBOX" NAME ="post-tei" VALUE " "&gt;
        &lt;INPUT TYPE = "text" NAME = posttr MAXLENGTH = 7  SIZE = 7&gt; &lt;BR&gt;

        &lt;FONT SIZE = 4 COLOR = "RED"&gt;&lt;B&gt;住所コード訂正&lt;/B&gt;&lt;BR&gt;&lt;/FONT&gt;
        &lt;INPUT TYPE = "CHECKBOX" NAME ="adrcd-tei" VALUE " "&gt;
        &lt;INPUT TYPE = "text" NAME = adrcdtr MAXLENGTH = 10  SIZE =10&gt; &lt;BR&gt;

 &lt;FONT SIZE = 4 COLOR = "RED"&gt;&lt;B&gt;住所訂正&lt;/B&gt;&lt;BR&gt;&lt;/FONT&gt;
        &lt;INPUT TYPE = "CHECKBOX" NAME ="address-tei" VALUE " "&gt;
        &lt;INPUT TYPE = "text" NAME = address1tr MAXLENGTH = 50 SIZE = 50&gt;
       &lt;INPUT TYPE = "text" NAME = address2tr MAXLENGTH = 50 SIZE = 50&gt;&lt;BR&gt;

        &lt;FONT SIZE = 4 COLOR = "RED"&gt;&lt;B&gt;電話番号訂正&lt;/B&gt;&lt;BR&gt;&lt;/FONT&gt;
        &lt;INPUT TYPE = "CHECKBOX" NAME ="tel-tei" VALUE " "&gt;
        &lt;INPUT TYPE = "text" NAME = teltr MAXLENGTH =12   SIZE =12&gt; &lt;BR&gt;

        &lt;FONT SIZE = 4 COLOR = "RED"&gt;&lt;B&gt;会社使用欄訂正&lt;/B&gt;&lt;BR&gt;&lt;/FONT&gt;
        &lt;INPUT TYPE = "CHECKBOX" NAME ="kaisha-tei" VALUE " "&gt;
        &lt;INPUT TYPE = "text" NAME = kaishatr MAXLENGTH = 20  SIZE =20&gt; &lt;BR&gt;

        &lt;CENTER&gt;&lt;H3&gt;&lt;INPUT TYPE = "submit"  VALUE = データを訂正&gt;
        &lt;INPUT TYPE = "reset"  VALUE = リセットボタン&gt;&lt;/H3&gt;&lt;/CENTER&gt;
        &lt;/FORM&gt;
        &lt;BR&gt;&lt;BR&gt;

        &lt;H2 ALIGN = CENTER&gt; 更新です      &lt;/H2&gt;

&lt;/BODY&gt;&lt;/HTML&gt;



+++++++++++++++++++++++++++++++++++++++++
++   エラーのあった PHTML             +++
++++++++++++++++++++++++++++++++++++++++

&lt;HTML&gt;
&lt;HEAD&gt;&lt;TITLE&gt;訂正できました。&lt;/TITLE&gt;&lt;/HEAD&gt;
&lt;BODY BGCOLOR=WHITE&gt;

&lt;?

        SetShowInfo(0);
        if(!$kojintr){
                echo"個人番号が入力されてません。&lt;BR&gt;ブラウザの「戻る」ボタンを[10;1H，靴堂爾気n";
                exit;
        }

        $conn = pg_Connect("www.eijin.co.jp", "5432", "", "", "meibo");
        if (!$conn) {
      echo "エラーが発生しました：データベースに接続できません！\n";
      mail("masaya@eijin.co.jp","Error!","名簿登録で異常発生！対応してください。
");
      exit;
        }

        $ret = pg_Exec($conn,"BEGIN");
        $ret = pg_Exec($conn,"Lock meibo");

    echo $kojintr;

      $result = pg_Exec($conn,"SELECT * FROM meibo WHERE kojin = '$kojintr'");
        if (!$result) {
        echo "エラーが発生しました：データベースに異常があります！\n";
            mail("masaya@eijin.co.jp","Error!","読み取り異常です。");
                exit;
        }


        $shoz1st = shoz1;
        $shoz2st = shoz2;
        $agest = age;
        $sexst = sex;
        $namest = name;
        $postst = post;
        $adrcdst = adrcd;
        $adrmeist = adrmei;
        $telst = tel;
        $kaishas = kaisha;

        if($shoz1-tei &gt; " "){$shoz1st = $shoz1tr};
        if($shoz2-tei &gt; " "){$shoz2st = $shoz2tr};


 if($age-tei &gt; " "){$agest = $agetr};
        if($sex-tei &gt; " "){$sexst = $sextr};
        if($name-tei &gt; " "){$namest = $shoz1tr};
        if($post &gt; " "){$postst = $posttr};
        if($adrcd-tei &gt; " "){$adrcdst = $adrcdtr};
        if($adrmei-tei &gt; " "){$adrmeist = $adrmei1tr + $adrmei2tr};
        if($tel-tei &gt; " "){$telst = $teltr};
        if($kaisha-tei &gt; " "){$kaishast = $kaishatr};

        $sql = "UPDATE  meibo
        SET  shoz1 = $shoz1st, shoz2 = Sshoz2st, kojin = $kojinst,
        age =$agest, sex = $sexst, name = $namest, post = $postst,
        adrcd = $adrcdst, adrmei = $adrmeist, tel = &amp;telst,
        kaisha = $kaishast
        WHERE kojin  = '$kojintr'";

        echo $kojintr;

        $result = pg_Exec($conn,$sql);

        if (!$result) {
        pg_Exec($conn,"ROLLBACK");

   echo "エラーが発生しました：データベースに異常があります！\n";
            mail("masaya@eijin.co.jp","Error!","ROLLBACKします。");
                exit;
        }

        pg_Exec($conn,"COMMIT");

        pg_Exec($conn,"END");

        pg_FreeResult($result);

        pg_Close($conn);

&gt;

&lt;CENTER&gt;訂正できました。&lt;BR&gt;&lt;A HREF=meiboteisei.html&gt;戻る&lt;/A&gt;&lt;/CENTER&gt;


&lt;/BODY&gt;
&lt;/HTML&gt;

3．直接 の SELECT UPDATE ドキュメント
~
meibo=&gt; select * from meibo where kojin = '00022222';
  shoz1|  shoz2|   kojin|age|sex|name    |   post|  adrcd|adrmei
    |         tel|kaisha
-------+-------+--------+---+---+--------+-------+-------+----------------------
----+------------+-------
0600700|0600700|00022222| 20|  1|徳川家光|2580113|1100100|神奈川県足柄上郡松田町
松田|0465-84-0346|touroku
(1 row)


meibo=&gt; update meibo set name='toku',post='000' where kojin = '00022222';
UPDATE 1

meibo=&gt; select * from meibo where kojin = '00022222';
  shoz1|  shoz2|   kojin|age|sex|name|post|  adrcd|adrmei                    |
       tel|kaisha
-------+-------+--------+---+---+----+----+-------+--------------------------+--
----------+-------
0600700|0600700|00022222| 20|  1|toku| 000|1100100|神奈川県足柄上郡松田町松田|04
65-84-0346|touroku
(1 row)






Masaya Seki
</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<UL><LI><STRONG>Follow-Ups</STRONG>:
<UL>
<LI><STRONG><A NAME="00075" HREF="msg00075.html">[pgsql-jp 5283] Re: please advice me</A></STRONG>
<UL><LI><EM>From:</EM> Tomoji Suzuki &lt;suzuki@puffer.denso.co.jp&gt;</LI></UL></LI>
<LI><STRONG><A NAME="00063" HREF="msg00063.html">[pgsql-jp 5270] RE: please advice me</A></STRONG>
<UL><LI><EM>From:</EM> "Hiroshi Inoue" &lt;Inoue@tpf.co.jp&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<LI>Prev by Date:
<STRONG><A HREF="msg00057.html">[pgsql-jp 5264] Re: teach me about PHP/FI</A></STRONG>
</LI>
<LI>Next by Date:
<STRONG><A HREF="msg00059.html">[pgsql-jp 5266] Re: backslash with escape sequence.</A></STRONG>
</LI>
<LI>Prev by thread:
<STRONG><A HREF="msg00080.html">[pgsql-jp 5287] Re: 質問（画像データ）</A></STRONG>
</LI>
<LI>Next by thread:
<STRONG><A HREF="msg00063.html">[pgsql-jp 5270] RE: please advice me</A></STRONG>
</LI>
<LI>Index(es):
<UL>
<LI><A HREF="index.html#00058"><STRONG>Date</STRONG></A></LI>
<LI><A HREF="threads.html#00058"><STRONG>Thread</STRONG></A></LI>
</UL>
</LI>
</UL>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
