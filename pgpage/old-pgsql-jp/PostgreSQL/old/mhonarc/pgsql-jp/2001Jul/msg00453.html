<!-- MHonArc v2.1.0 -->
<!--X-Subject: [pgsql&#45;jp 22590] serial ¤Î¥·¡¼¥±¥ó¥¹ÃÍ¤Ïpostgres ¥¢¥«¥¦¥ó¥È¤Î¤ß¥¢¥¯¥»¥¹²ÄÇ½¤«¡© -->
<!--X-From: "Ricky" <ricky@ekuma.net> -->
<!--X-Date: Thu, 26 Jul 2001 20:13:49 +0900 -->
<!--X-Message-Id: 004001c115c4$0c38b1e0$de09713d@ekuma.net -->
<!--X-ContentType: text/plain -->
<!--X-Head-End-->
<HTML>
<HEAD>
<TITLE>[pgsql-jp 22590] serial ¤Î¥·¡¼¥±¥ó¥¹ÃÍ¤Ïpostgres ¥¢¥«¥¦¥ó¥È¤Î¤ß¥¢¥¯¥»¥¹² </TITLE>
<LINK REV="made" HREF="mailto:ricky@ekuma.net">
</HEAD>
<BODY BGCOLOR="#ffffff">
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
[<A HREF="msg00452.html">Date Prev</A>][<A HREF="msg00454.html">Date Next</A>][<A HREF="msg00474.html">Thread Prev</A>][<A HREF="msg00454.html">Thread Next</A>][<A HREF="index.html#00453">Date Index</A>][<A HREF="threads.html#00453">Thread Index</A>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>[pgsql-jp 22590] serial ¤Î¥·¡¼¥±¥ó¥¹ÃÍ¤Ïpostgres ¥¢¥«¥¦¥ó¥È¤Î¤ß¥¢¥¯¥»¥¹²ÄÇ½¤«¡©</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><em>From</em>: "Ricky" &lt;<A HREF="mailto:ricky@ekuma.net">ricky@ekuma.net</A>&gt;</LI>
<LI><em>Date</em>: Thu, 26 Jul 2001 20:13:49 +0900</LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
·§ÀÚ¤È¿½¤·¤Þ¤¹¡£

ÁáÂ®¤Ç¤¹¤¬¡¢serialÃÍ¤ò´Þ¤ó¤À¥Æ¡¼¥Ö¥ë¤òºîÀ®¤·¡¢¥Ç¡¼¥¿¤ò½ñ¤­¹þ¤ó¤Ç¤¤¤¯¤È¼«Æ°Åª¤Ë¥·¡¼
¥±¥ó¥¹¡Ê¥·¥ê¥¢¥ë¡ËÃÍ¤¬Áý¤¨¤Æ¹Ô¤­¤Þ¤¹¤¬¡¢¤½¤ÎÃÍ(tests_index_seq)¤ò£Ê£Ä£Â£Ã¤òÄÌ¤¸¤Æ
ÆÉ¤ß¼è¤í¤¦¤È¤·¤Æ¤¤¤Þ¤¹¡£¤È¤³¤í¤¬£Ä£ÂºîÀ®¼Ô¤Îpostgres¥¢¥«¥¦¥ó¥È¤Ç¤ÏÆÉ¤ß¹þ¤á¤ë¤Î¤Ë¡¢
¤½¤ì°Ê³°¤Î¥æ¡¼¥¶¡¼Ì¾¤Ç¤ÏÆÉ¤á¤ë¾ì¹ç¤ÈÆÉ¤á¤Ê¤¤¾ì¹ç¤¬¤¢¤ê¤Þ¤¹¡£¤É¤¦¤·¤¿¤é³Î¼Â¤ËÆÉ¤á¤ë
¤«¡¢ÊýË¡¤ò¤´Â¸ÃÎ¤ÎÊý¤¤¤é¤Ã¤·¤ã¤¤¤Þ¤»¤ó¤«¡£

¶ñÂÎÅª¤Ë¤Ï¡¢

Á°Äó¡Ë$PGDATA/pg_hba.conf ¤Ëcrypt authentication¤ÎÀßÄê¤ò¤¹¤ë¡£
host  all 192.168.1.0  255.255.255.0  crypt

£±¡Ëpostgres¥¢¥«¥¦¥ó¥È¤Ë¤Æ£Ä£Â¤òºîÀ®
$ createdb testdb

£²¡Ë¥Æ¡¼¥Ö¥ë¤òºîÀ®
$ psql testdb
testdb=# CREATE TABLE tests (index serial, status text);

£³¡ËÅ¬Åö¤Ê¥æ¡¼¥¶¡¼¤òcreate¤¹¤ë¡£
testdb=# create user totoro with password 'totoropassword';

£´¡Ë¥Æ¡¼¥Ö¥ë¤Ë¥¢¥¯¥»¥¹¸¢¤òÀßÄê¤¹¤ë¡£
testdb=# grant all on tests to public;

£µ¡Ë£ê£á£ö£á¤Ç¥Æ¥¹¥È¥×¥í¥°¥é¥à¤ò½ñ¤¯
    ¡ÊºÇ¸å¤ËºÜ¤»¤Þ¤¹¡Ë

£¶¡Ëpostgres¥¢¥«¥¦¥ó¥È¤ÇÁö¤é¤»¤ë¤ÈÀµ¾ï¤Ë½ªÎ»¤¹¤ë¡£
$ java test -a postgres -p postgrespassword

£·¡Ëtotoro¥¢¥«¥¦¥ó¥È¤À¤È java.sql.SQLException: ERROR: tests_index_seq.nextval:
you don't have permissions to set sequense tests_index_seq ¤¬È¯À¸¤·¤Æ¥¨¥é¡¼¤È¤Ê
¤ë¡£
$ java test

£¸¡Ëpg_hba.conf ¤Ëtrust¤ÎÀßÄê¤ò¤·¤Æ¤âÆ±ÍÍ¤Î¥¨¥é¡¼¤¬È¯À¸¤¹¤ë¡£

postgres¥¢¥«¥¦¥ó¥È¤Ç¤·¤«serial¤Î¥·¡¼¥±¥ó¥¹ÃÍ¤Ï¼è¤Ã¤Æ¤³¤ì¤Ê¤¤¤Î¤Ç¤·¤ç¤¦¤«¡©¡£
¿½¤·Á÷¤ì¤Þ¤·¤¿¤¬¡¢´Ä¶­¤Ïpostgresql-7.1.2¡¢ RedHat Linux 6.2J²þ¡¢jdk1.2.2¤Ç¤¹¡£

·§ÀÚ
¡Ê¥á¡¼¥ë¤Ïkanpi@ekuma.net¤Ç¤¹¡Ë

¥Æ¥¹¥È¥×¥í¥°¥é¥à

/*
 * test.java
 *
 */

  import java.util.*;
  import java.lang.*;
  import java.sql.*;

  class test {

    public static void main(String argv[]) {
      String testdb_url = "jdbc:postgresql:testdb";
      String testdb_account = "totoro";
      String testdb_password = "totoropassword";
      int num = 10;
      String query;

      for (int optind = 0; optind &lt; argv.length; optind++) {
        if (argv[optind].equals("-a")) {
   testdb_account = argv[++optind];
          }
          else if (argv[optind].equals("-p"))
     testdb_password = argv[++optind];
          else if (argv[optind].equals("-i"))
            num = Integer.parseInt(argv[++optind]);
          else if (argv[optind].equals("--")) {
     optind++;
     break;
            }
          else if (argv[optind].startsWith("?")) {
     System.out.println("Usage: test [-a account] [-p password] [-i num] [?]");
            System.out.println("  -a account, kanta totoro nekobus and others
[totoro]");
            System.out.println("  -p password.  set the password
[totoropassword]");
            System.out.println("  -i num  set data on testdb [10]");
     System.exit(0);
            }
          else break;
        }

    try {    // establish DB connections.
      Class.forName("org.postgresql.Driver");
    } catch(ClassNotFoundException cnf) {
        cnf.printStackTrace();
        System.out.println("Class.forName() error.");
        System.exit(1);
    }

    try {
      Connection connM = DriverManager.getConnection(testdb_url, testdb_account,
testdb_password);
      Statement st = connM.createStatement();
      System.out.print("now recording..");
      for(int i=0; i&lt;num; i++) {
        query = "INSERT INTO tests (status) VALUES ('" +Integer.toString(i)
+"');";
        int res = st.executeUpdate(query);
        System.out.print(" " +res +"(" +i +")");
    }
    System.out.println();

    query = "select last_value from tests_index_seq;";
    ResultSet rs = st.executeQuery(query);
    int ix = 0;
    while(rs.next()) ix = rs.getInt("last_value");
    System.out.println(" then, the last tests_index is " +Integer.toString(ix));

/*  As far as DB being written by one client, last_value really shows the last. */

    st.close();
    } catch (SQLException sql) {
        sql.printStackTrace();
    } finally {
      System.exit(0);
    }

    }
  }
</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<UL><LI><STRONG>Follow-Ups</STRONG>:
<UL>
<LI><STRONG><A NAME="00456" HREF="msg00456.html">[pgsql-jp 22593] Re: serial ¤Î¥·¡¼¥±¥ó¥¹ÃÍ¤Ïpostgres¥¢¥«¥¦¥ó¥È¤Î¤ß¥¢¥¯¥»¥¹²ÄÇ½¤«¡©</A></STRONG>
<UL><LI><EM>From:</EM> Yu Ooasa &lt;you@dearest.net&gt;</LI></UL></LI>
<LI><STRONG><A NAME="00454" HREF="msg00454.html">[pgsql-jp 22591] Re: serial ¤Î¥·¡¼¥±¥ó¥¹ÃÍ¤Ïpostgres¥¢¥«¥¦¥ó¥È¤Î¤ß¥¢¥¯¥»¥¹²ÄÇ½¤«¡©</A></STRONG>
<UL><LI><EM>From:</EM> Takahito Ito &lt;takahito@po.jah.ne.jp&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<LI>Prev by Date:
<STRONG><A HREF="msg00452.html">[pgsql-jp 22589] Re: £É£Î£Ó£Å£Ò£Ô¤Î¤º¤ì¤Ë¤Ä¤¤¤Æ</A></STRONG>
</LI>
<LI>Next by Date:
<STRONG><A HREF="msg00454.html">[pgsql-jp 22591] Re: serial ¤Î¥·¡¼¥±¥ó¥¹ÃÍ¤Ïpostgres¥¢¥«¥¦¥ó¥È¤Î¤ß¥¢¥¯¥»¥¹²ÄÇ½¤«¡©</A></STRONG>
</LI>
<LI>Prev by thread:
<STRONG><A HREF="msg00474.html">[pgsql-jp 22611] Re: Í¹ÊØÈÖ¹æ¤Ë¤è¤ë½»½êÈ½Äê</A></STRONG>
</LI>
<LI>Next by thread:
<STRONG><A HREF="msg00454.html">[pgsql-jp 22591] Re: serial ¤Î¥·¡¼¥±¥ó¥¹ÃÍ¤Ïpostgres¥¢¥«¥¦¥ó¥È¤Î¤ß¥¢¥¯¥»¥¹²ÄÇ½¤«¡©</A></STRONG>
</LI>
<LI>Index(es):
<UL>
<LI><A HREF="index.html#00453"><STRONG>Date</STRONG></A></LI>
<LI><A HREF="threads.html#00453"><STRONG>Thread</STRONG></A></LI>
</UL>
</LI>
</UL>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
