<!-- MHonArc v2.1.0 -->
<!--X-Subject: [pgsql&#45;jp 17811] Re: ·Ñ¾µ(INHERITS)¤ÎÍ­¸úÍøÍÑ¡©¡ÊÄ¹Ê¸Ãí°Õ¡§¤Ş¤¿¼¡¤ØÂ³¤¯¡Ë -->
<!--X-From: "Jun Kitamura" <jun&#45;n@ga2.so&#45;net.ne.jp> -->
<!--X-Date: Wed, 20 Sep 2000 16:31:51 +0900 -->
<!--X-Message-Id: 000d01c022d4$ea148b80$025011ac@nms -->
<!--X-ContentType: text/plain -->
<!--X-Reference-Id: 000701c022d4$28d2f920$025011ac@nms -->
<!--X-Head-End-->
<HTML>
<HEAD>
<TITLE>[pgsql-jp 17811] Re: ·Ñ¾µ(INHERITS)¤ÎÍ­¸úÍøÍÑ¡©¡ÊÄ¹Ê¸Ãí°Õ¡§¤Ş¤¿¼¡¤ØÂ³¤¯¡ </TITLE>
<LINK REV="made" HREF="mailto:jun-n@ga2.so-net.ne.jp">
</HEAD>
<BODY BGCOLOR="#ffffff">
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
[<A HREF="msg00479.html">Date Prev</A>][<A HREF="msg00481.html">Date Next</A>][<A HREF="msg00479.html">Thread Prev</A>][<A HREF="msg00481.html">Thread Next</A>][<A HREF="index.html#00480">Date Index</A>][<A HREF="threads.html#00480">Thread Index</A>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>[pgsql-jp 17811] Re: ·Ñ¾µ(INHERITS)¤ÎÍ­¸úÍøÍÑ¡©¡ÊÄ¹Ê¸Ãí°Õ¡§¤Ş¤¿¼¡¤ØÂ³¤¯¡Ë</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><em>From</em>: "Jun Kitamura" &lt;<A HREF="mailto:jun-n@ga2.so-net.ne.jp">jun-n@ga2.so-net.ne.jp</A>&gt;</LI>
<LI><em>Date</em>: Wed, 20 Sep 2000 16:31:51 +0900</LI>
<LI><em>References</em>: &lt;<A HREF="msg00479.html">000701c022d4$28d2f920$025011ac@nms</A>&gt;</LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
Â³¤­¤Ç¤¹¡£


Éô½ğ¥Ş¥¹¥¿¡¢Éô°÷¥Õ¥¡¥¤¥ë¤Ë¤ª¤±¤ë¥ì¥Ù¥ë¤Ï¡¢Ê¸»ú¤ò²£¤Ë¤º¤é¤¹ÄøÅÙ¤Î½ÅÍ×À­¤·¤«
¤¢¤ê¤Ş¤»¤ó¡£¿Æ»Ò´Ø·¸¤ÏÉô½ğ¥Ş¥¹¥¿Æâ¤Ë¤¢¤ê¤Ş¤¹¤Î¤Ç¡¢ÆÃ¤Ë¥Õ¥£¡¼¥ë¥É¤òÀß¤±¤Æ¤ª
¤¯É¬Í×¤âÌµ¤«¤Ã¤¿¤Î¤Ç¤·¤ç¤¦¤¬¡¢Æş¤ì¤Ş¤·¤¿¡£
²¼µ­¤Î SQL ¤Ï¥ì¥Ù¥ë¡¢¤½¤·¤Æ³¬ÁØÁ´ÂÎ¤ÎÊÂ¤Ó½ç(»ŞÈÖ:treenum)¤òÆÀ¤ë¤¿¤á¤Î¥Õ¥¡¥ó
¥¯¥·¥ç¥ó¤Ç¤¹¡£
(¤½¤ì¤¾¤ìÉô½ğ¥Ş¥¹¥¿ÍÑ¡¢Éô°÷¥Õ¥¡¥¤¥ëÍÑ)
groupm_gettreenum(°ú¿ô:¥°¥ë¡¼¥×¥³¡¼¥É) ¤Ï¡¢¥°¥ë¡¼¥×¥³¡¼¥É¤«¤é¿Æ¤Ë¾º¤Ã¤Æ¤¤¤­¡¢
¿Æ¤¬ NULL (¥È¥Ã¥×¥°¥ë¡¼¥×)¤Ë¤Ê¤ë¤Ş¤Ç¡¢dspnum (ÊÂ¤Ó½ç)¤òÊ¸»úÎó¤È¤·¤Æ·ë¹ç¤·¤Æ
¤¤¤­¤Ş¤¹¡£¥È¥Ã¥×¥°¥ë¡¼¥×¤Ï'0'¤Ç¤¹¤Î¤Ç¡¢¤½¤Î¥°¥ë¡¼¥×¤Î»Ò¤Ç 2ÈÖÌÜ¤Ë°ÌÃÖ¤¹¤ë¥°
¥ë¡¼¥×¤Ï¡¢'02'¤È¤¤¤¦¤Î¤¬ treenum ¤Ë¤Ê¤ê¤Ş¤¹¡£
treenum (text·¿)   ¾º½ç
0                  0
|-01               01
| |-011            011
| ^-012            012
|    |-0121        0121
|    ^-0122        0122
|-02               02
(°Ê²¼Î¬)

Æ±ÍÍ¤Ë¡¢Éô°÷¥Õ¥¡¥¤¥ë¤Î¤Û¤¦¤Ë¤â»ŞÈÖ(treenum)¤ò¤Ä¤±¤Ş¤¹¤¬¡¢¤³¤ì¤ÏÉô°÷(¼Ò°÷)¤¬
½êÂ°¤¹¤ë¥°¥ë¡¼¥×¤Î»ŞÈÖ¤Ë '-' ¤È dspnum ¡ÊÊÂ¤Ó½ç¡Ë¤òÊ¸»úÎó¤È¤·¤Æ·ë¹ç¤µ¤»¤Ş¤¹¡£
¾åµ­¤ÎÎã¤Ç¤Ï¡¢Á´ÂÎ¤Ç2ÈÖÌÜ¤Ë°ÌÃÖ¤¹¤ë¡Ö01¡×¤È¤¤¤¦»ŞÈÖ¤Ë¡Ö-1¡×¡Ö-2¡×¤¬ÉÕ¤¤¤¿¡¢¡Ö01-1¡×
¡Ö01-2¡×¤È¤Ê¤ê¤Ş¤¹¡£

¥ì¥Ù¥ë¤Ç¤¹¤¬¡¢Æ±¤¸¤¯¼«Ê¬¤Î¿Æ¡¢¤Ş¤¿¤½¤Î¿Æ¤È¾º¤Ã¤Æ¤¤¤­¡¢¤½¤Î²ó¿ô¤¬¥ì¥Ù¥ë¤È¤Ê
¤ê¤Ş¤¹¡£

groupm_gettreenum(°ú¿ô:groupcd int2) ÊÖ¤êÃÍ:text
groupm_getlevel(°ú¿ô:groupcd int2) ÊÖ¤êÃÍ:int2;
buinf_gettreenum(°ú¿ô:groupcd int2, buincd int2) ÊÖ¤êÃÍ:text
buinf_getlevel(°ú¿ô:groupcd int2) ÊÖ¤êÃÍ:int2
¤³¤ì¤é¤Î´Ø¿ô¤ò¡¢³Æ¥Æ¡¼¥Ö¥ë¤Î³Æ¹Ô¤ËÂĞ¤·¤Æ¹Ô¤Ê¤¤ treenum ¤È level ¤Ë UPDATE
¤¹¤ì¤Ğ OK ¤Ç¤¹¡£
ex.
update groupm set treenum = groupm_gettreenum(groupcd);
(Á´¤Æ¤Î¹Ô¤ËÂĞ¤·¤Æ»ŞÈÖ(treenum)¤òÀßÄê)


¤Ş¤À¡¡¼¡¤ØÂ³¤­¤Ş¤¹¡£


--»ŞÈÖÉÕ¤±(Éô½ğ¥Ş¥¹¥¿ÍÑ)
CREATE FUNCTION groupm_gettreenum(int2) RETURNS text AS '
 DECLARE
  tmptree text := '''';
  mygcd int2;
  pgcd int2;
 BEGIN
  mygcd := $1;
  pgcd := (SELECT pgroupcd FROM groupm WHERE groupcd = mygcd);
  IF (pgcd IS NULL) THEN
   tmptree := (SELECT dspnum::text FROM groupm
                WHERE groupcd = mygcd);
  ELSE
   WHILE (pgcd IS NOT NULL) LOOP
    tmptree := (SELECT dspnum::text FROM groupm
                 WHERE groupcd = mygcd) || tmptree;
    mygcd := pgcd;
    pgcd := (SELECT pgroupcd FROM groupm WHERE groupcd = mygcd);
   END LOOP;
   tmptree := (SELECT dspnum::text FROM groupm
                WHERE groupcd = mygcd) || tmptree;
  END IF;
  RETURN tmptree;
END;
' LANGUAGE 'plpgsql';

--¥ì¥Ù¥ëÉÕ¤±(Éô½ğ¥Ş¥¹¥¿ÍÑ)
CREATE FUNCTION groupm_getlevel(int2) RETURNS int2 AS '
 DECLARE
  lcnt int2 := 0;
  mygcd int2;
  pgcd int2;
 BEGIN
  mygcd := $1;
  pgcd := (SELECT pgroupcd FROM groupm WHERE groupcd = mygcd);
  WHILE (pgcd IS NOT NULL) LOOP
    lcnt := lcnt + 1;
    mygcd := pgcd;
    pgcd := (SELECT pgroupcd FROM groupm WHERE groupcd = mygcd);
  END LOOP;
  RETURN lcnt;
 END;
' LANGUAGE 'plpgsql';

--»ŞÈÖÉÕ¤±(Éô°÷¥Õ¥¡¥¤¥ëÍÑ)
CREATE FUNCTION buinf_gettreenum(int2,int2) returns text AS '
 DECLARE
  tmptree text;
 BEGIN
  tmptree := (SELECT treenum FROM groupm
               WHERE groupcd = $1) || ''-'' ||
             (SELECT dspnum::text FROM buinf
               WHERE groupcd = $1 and buincd = $2);
  RETURN tmptree;
 END;
' LANGUAGE 'plpgsql';

--¥ì¥Ù¥ëÉÕ¤±(Éô°÷¥Õ¥¡¥¤¥ëÍÑ)
CREATE FUNCTION buinf_getlevel(int2) returns int2 AS '
 BEGIN
  RETURN (SELECT level FROM groupm WHERE groupcd = $1);
 END;
' LANGUAGE 'plpgsql';
</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<UL><LI><STRONG>Follow-Ups</STRONG>:
<UL>
<LI><STRONG><A NAME="00481" HREF="msg00481.html">[pgsql-jp 17812] Re: ·Ñ¾µ(INHERITS)¤ÎÍ­¸úÍøÍÑ¡©¡ÊÄ¹Ê¸Ãí°Õ¡§¤Ş¤¿¤Ş¤¿¼¡¤ØÂ³¤¯¡Ë</A></STRONG>
<UL><LI><EM>From:</EM> "Jun Kitamura" &lt;jun-n@ga2.so-net.ne.jp&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-Follow-Ups-End-->
<!--X-References-->
<UL><LI><STRONG>References</STRONG>:
<UL>
<LI><STRONG><A NAME="00479" HREF="msg00479.html">[pgsql-jp 17810] ·Ñ¾µ(INHERITS)¤ÎÍ­¸úÍøÍÑ¡©¡ÊÄ¹Ê¸Ãí°Õ¡§¼¡¤ØÂ³¤¯¡Ë</A></STRONG>
<UL><LI><EM>From:</EM> "Jun Kitamura" &lt;jun-n@ga2.so-net.ne.jp&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<LI>Prev by Date:
<STRONG><A HREF="msg00479.html">[pgsql-jp 17810] ·Ñ¾µ(INHERITS)¤ÎÍ­¸úÍøÍÑ¡©¡ÊÄ¹Ê¸Ãí°Õ¡§¼¡¤ØÂ³¤¯¡Ë</A></STRONG>
</LI>
<LI>Next by Date:
<STRONG><A HREF="msg00481.html">[pgsql-jp 17812] Re: ·Ñ¾µ(INHERITS)¤ÎÍ­¸úÍøÍÑ¡©¡ÊÄ¹Ê¸Ãí°Õ¡§¤Ş¤¿¤Ş¤¿¼¡¤ØÂ³¤¯¡Ë</A></STRONG>
</LI>
<LI>Prev by thread:
<STRONG><A HREF="msg00479.html">[pgsql-jp 17810] ·Ñ¾µ(INHERITS)¤ÎÍ­¸úÍøÍÑ¡©¡ÊÄ¹Ê¸Ãí°Õ¡§¼¡¤ØÂ³¤¯¡Ë</A></STRONG>
</LI>
<LI>Next by thread:
<STRONG><A HREF="msg00481.html">[pgsql-jp 17812] Re: ·Ñ¾µ(INHERITS)¤ÎÍ­¸úÍøÍÑ¡©¡ÊÄ¹Ê¸Ãí°Õ¡§¤Ş¤¿¤Ş¤¿¼¡¤ØÂ³¤¯¡Ë</A></STRONG>
</LI>
<LI>Index(es):
<UL>
<LI><A HREF="index.html#00480"><STRONG>Date</STRONG></A></LI>
<LI><A HREF="threads.html#00480"><STRONG>Thread</STRONG></A></LI>
</UL>
</LI>
</UL>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
