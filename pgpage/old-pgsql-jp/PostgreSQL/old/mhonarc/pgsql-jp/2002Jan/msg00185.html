<!-- MHonArc v2.1.0 -->
<!--X-Subject: [pgsql&#45;jp 24516] Re: Â¾¤Î¥Æ¡¼¥Ö¥ë¤ò»²¾È¤¹¤ëupdate»þ¤Î¥¤¥ó¥Ç¥Ã¥¯¥¹¤ÎÍøÍÑ¤Ë¤Ä¤¤¤Æ -->
<!--X-From: Tatsuo Ishii <t&#45;ishii@sra.co.jp> -->
<!--X-Date: Fri, 18 Jan 2002 14:33:42 +0900 -->
<!--X-Message-Id: 20020118143342M.t&#45;ishii@sra.co.jp -->
<!--X-ContentType: text/plain -->
<!--X-Reference-Id: 3C46EE2C7C.D332KAKUMA@mail.mib21.co.jp -->
<!--X-Reference-Id: 20020118100311S.t&#45;ishii@sra.co.jp -->
<!--X-Reference-Id: 3C478EC424F.B93DKAKUMA@mail.mib21.co.jp -->
<!--X-Head-End-->
<HTML>
<HEAD>
<TITLE>[pgsql-jp 24516] Re: Â¾¤Î¥Æ¡¼¥Ö¥ë¤ò»²¾È¤¹¤ëupdate»þ¤Î¥¤¥ó¥Ç¥Ã¥¯¥¹¤ÎÍøÍÑ¤ </TITLE>
<LINK REV="made" HREF="mailto:t-ishii@sra.co.jp">
</HEAD>
<BODY BGCOLOR="#ffffff">
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<HR>
[<A HREF="msg00184.html">Date Prev</A>][<A HREF="msg00186.html">Date Next</A>][<A HREF="msg00182.html">Thread Prev</A>][<A HREF="msg00193.html">Thread Next</A>][<A HREF="index.html#00185">Date Index</A>][<A HREF="threads.html#00185">Thread Index</A>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<H1>[pgsql-jp 24516] Re: Â¾¤Î¥Æ¡¼¥Ö¥ë¤ò»²¾È¤¹¤ëupdate»þ¤Î¥¤¥ó¥Ç¥Ã¥¯¥¹¤ÎÍøÍÑ¤Ë¤Ä¤¤¤Æ</H1>
<HR>
<!--X-Subject-Header-End-->
<UL>
<LI><em>From</em>: Tatsuo Ishii &lt;<A HREF="mailto:t-ishii@sra.co.jp">t-ishii@sra.co.jp</A>&gt;</LI>
<LI><em>Date</em>: Fri, 18 Jan 2002 14:33:42 +0900</LI>
<LI><em>References</em>: &lt;<A HREF="msg00172.html">3C46EE2C7C.D332KAKUMA@mail.mib21.co.jp</A>&gt;&lt;<A HREF="msg00176.html">20020118100311S.t-ishii@sra.co.jp</A>&gt;&lt;<A HREF="msg00181.html">3C478EC424F.B93DKAKUMA@mail.mib21.co.jp</A>&gt;</LI>
</UL>
<!--X-Head-Body-Sep-Begin-->
<HR>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<PRE>
ÀÐ°æ¤Ç¤¹¡¥

&gt; ´ðËÜÅª¤Ë
&gt; create table M_PARENT(
&gt;   user_id  numeric(7)  primary key    ,  --0  ¥æ¡¼¥¶¡¼ID
&gt;   first_name  varchar(16)             ,  --  1  Ì¾Á°
&gt;   age  numeric(3)                     ,  --  2  Ç¯Îð
&gt;   age_id  numeric(3)                     --  3  Ç¯ÂåID
&gt; );
&gt; ¤Îage_id¤òºîÀ®¤¹¤ë¤¿¤á¤À¤±¤Ëm_parentage¤Ï¹Í¤¨¤Æ¤ª¤ê¤Þ¤·¤¿¡£
&gt; 
&gt; ÌÜÅª¤È¤·¤Þ¤·¤Æ¡Ö½¸·×¤Î»þ¤Ëage_id¤Ë¤è¤êGROUP BY¤¹¤ë¤³¤È¤Ë
&gt; ¤è¤êÇ¯ÂåÊÌ¤Î½¸·×¥Ç¡¼¥¿¤ò¼è¤ë¡×¤Ç¤·¤¿¡£
&gt; 
&gt; ·ë¶ÉËÌÂ¼¤µ¤ó¤Ë¶µ¤¨¤¿¤¤¤¿¤À¤¤¤¿¡¢Ç¯Îð¤ò¼ç¥­¡¼¤È¤¹¤ëÇ¯Âå¥ê¥¹¥È¤ò
&gt; ºî¤ë¤³¤È¤Ë¤è¤êage_id¼«ÂÎ¤ÎÉ¬Í×¤ÏÌµ¤¯¤Ê¤ê¡¢°ì±þ¤Î²ò·è¤ÏÆÀ¤¿¤Î¤Ç¤¹¤¬¡¢
&gt; ¡ÖÀß·×¡×¤ÎÏÃ¤Ç¤Ï¤Þ¤ÀÁ´¤¯²ò·è¤·¤Æ¤ª¤ê¤Þ¤»¤ó¡£
&gt; 
&gt; ¤¤¤Þ¤µ¤é¤Ê¤¬¤é¶ÈÌ³¤Î°Æ·ï¤ò½ñ¤­¤Þ¤¹¤È¡¢
&gt; ¡Ö¸½¹Ô¤Î¥·¥¹¥Æ¥à¤¬¤¢¤Þ¤ê¤Ë¤âÃÙ¤¤¤Î¤Ç²þÁ±¤·¤ÆÍß¤·¤¤¡×
&gt; ¤È¤Î¤³¤È¤Ç¡¢¹½Â¤¤òÄ´¤Ù¤Æ¤ß¤ë¤È¡¢M_PARENT¤Ë¤ÏÃÂÀ¸Æü¤·¤«ÊÝ»ý¤·¤Æ¤ª¤é¤º¡¢
&gt; ½¸·×¤Î¤Ä¤É¸½ºß¤ÎÆüÉÕ¤È¤Îº¹¤ò¤È¤êÇ¯Îð¤ËÀ°·Á¤·¤Æ¡¢¤½¤ì¤ò¸µ¤Ë½¸·×¤·¤Æ¤ª¤ê¡¢
&gt; Ç¯ÎðËè¤ËBETWEEN¤ÇSQL¤òÈ¯¹Ô¤·¥Ç¡¼¥¿¤òÆÀ¤ë¤È¤¤¤¦¡¢Ä´¤Ù¤Æ¤¤¤ë¤À¤±¤Ç
&gt; ½Å¤µ¤¬¼Â´¶½ÐÍè¤ë¹½Â¤¤Ë¤Ê¤Ã¤Æ¤ª¤ê¤Þ¤·¤¿¡£
&gt; 
&gt; ¤½¤³¤Ç¤Þ¤ºÇ¯Îð¥Õ¥£¡¼¥ë¥É¤òÄÉ²Ã¤·¡¢Ê£¿ôSQL¤À¤Ã¤¿¤Î¤ò°ìËÜ¤Ë¤Þ¤È¤á¤ë¤¿¤á¤Ë
&gt; GROUP BY¤ÎÍ×ÁÇ¤Ë¤Ê¤ê¤¨¤ëage_id¤ÎÄÉ²Ã¤ò¹Í¤¨¤Þ¤·¤¿¡£
&gt; ¤½¤Î¸åÌÚÂ¼¤µ¤ó¤Ë¶µ¤¨¤Æ¤¤¤¿¤À¤¤¤¿Àß·×¤Ë¤è¤ê¡¢
&gt; 
&gt; create table M_generation(
&gt;   age numeric(4)  primary key  ,  --  0  Ç¯ÎðID
&gt;   gen_type_id  numeric(3)    --  1  Ç¯ÂåID
&gt; );
&gt; 19,1
&gt; 20,1
&gt; 21,2
&gt; 22,2
&gt; 23,2
&gt; 24,3
&gt; ¤Î¤è¤¦¤Ë¥Æ¡¼¥Ö¥ë¤òºîÀ®¤·¡¢M_PARENT¤Îage¤ÈM_generation¤Îage¤òJOIN¤·¡¢
&gt; gen_type_id¤Ë¤è¤êGROUP BY¤¹¤ë¤³¤È¤Ë¤è¤ê¡¢¸½¹Ô¤Þ¤Ç¤ÎÀ®²Ì¤¬ÆÀ¤é¤ì¤Þ¤·¤¿¡£

¤Ê¤ë¤Û¤É¡¥Í×¤Ï¡¤group ¤Î¸µ¤Ë¤Ê¤ë±é»»¤¬ÃÙ¤¤¤È¸À¤¦¤ï¤±¤Ç¤¹¤Í¡¥¤¿¤Ö¤ó¤Þ¤È
¤â¤Ê(=·ï¿ô¤¬Áý¤¨¤Æ¤â¤µ¤Û¤ÉÃÙ¤¯¤Ê¤é¤Ê¤¤)ÊýË¡¤Ï¶áÆ£¤µ¤ó¤ÎÊýË¡¤À¤È»×¤¦¤Î
¤Ç¤¹¤¬¡¤¤½¤³¤Þ¤ÇÉ¬Í×¤Ê¤±¤ì¤Ð¡¤group by ¤Î¸µ¤Ë¤Ê¤ë¥Ç¡¼¥¿¤ò´Ø¿ô¤È¤·¤ÆÄê
µÁ¤¹¤ëÊýË¡¤¬¤¢¤ê¤Þ¤¹¡¥¤Ç¡¤¤½¤Î´Ø¿ô¤ò´Ø¿ô¥¤¥ó¥Ç¥Ã¥¯¥¹¤Ë¤·¤Æ¤·¤Þ¤¨¤Ð¡¤¥¤
¥ó¥Ç¥Ã¥¯¥¹¤ò»È¤Ã¤¿¹âÂ®¤Êgroup by¤¬¤Ç¤­¤Þ¤¹¡¥ÊÌ¤Ë¥«¥é¥à¤ä¥Æ¡¼¥Ö¥ë¤òÍÑ°Õ
¤¹¤ëÉ¬Í×¤â¤¢¤ê¤Þ¤»¤ó¡¥

Îã¤ò¼¨¤·¤Þ¤¹¡¥

¤Þ¤º¡¤ÃÂÀ¸Æü¤òÆþ¤ì¤¿¥Æ¡¼¥Ö¥ë¤òÍÑ°Õ¤·¤Þ¤¹(Ç¯Îð¤ò»ý¤Ä¤è¤ê¤âÎÉ¤¤¤Ç¤¹¤è¤Í)¡¥

create table t1 (t date);

¼¡¤Ë¡¤Ç¯Îð¤òÅÏ¤¹¤ÈÇ¯Âå¤òÊÖ¤¹´Ø¿ô¤òÄêµÁ¤·¤Þ¤¹¡¥¤³¤³¤Ç¤Ï¡¤¤ï¤¶¤ï¤¶CASEÊ¸
¤ò»È¤Ã¤Æ¤Þ¤¹¤¬¡¤µ¡³£Åª¤Ë·×»»¤¹¤ëÇ¯Âå¤ÇÎÉ¤±¤ì¤Ð¤â¤Ã¤È´ÊÃ±¤Ë¤Ê¤ê¤Þ¤¹¤Í¡¥

create function myage(date) returns int as '
select
  case
       :
       :
       when extract(year from age(current_date, $1)) between 20 and 29 then 20
       when extract(year from age(current_date, $1)) between 30 and 39 then 30
       :
       :
       else 0
  end
from t2
'
language 'sql' with (iscachable); 

¤³¤³¤Ç (iscachable) ¤Ë¤·¤Æ¤¤¤ë¤Î¤¬Ì£Á¹¤Ç¡¤¤³¤ì¤òÄêµÁ¤·¤Ê¤¤¤È´Ø¿ô¥¤¥ó¥Ç¥Ã
¥¯¥¹¤Ë¤Ê¤Ã¤Æ¤¯¤ì¤Þ¤»¤ó¡¥¤â¤Á¤í¤óÇ¯Îð¤ÏÆü¤¬ÊÑ¤ë¤ÈÊÑ¤ë²ÄÇ½À­¤¬¤¢¤ë¤Î¤Ç¡¤
É¬Í×¤Ê»þ¤Ë¥¤¥ó¥Ç¥Ã¥¯¥¹¤òºî¤êÄ¾¤µ¤Ê¤¤¤È¤¤¤±¤Þ¤»¤ó¡¥

drop index t1index;
create index t1index on t1(myage(t));

¤³¤¦¤·¤Æ¤ª¤¯¤È¡¤Ç¯Âå¤Ë¤è¤ëgroup by¤Ï¼¡¤Î¤è¤¦¤Ë¤Ç¤­¡¤¤·¤«¤â¥¤¥ó¥Ç¥Ã¥¯¥¹
¤¬»È¤ï¤ì¤Þ¤¹¡¥

test=# explain select myage(t),count(*) from t1 group by myage(t);
NOTICE:  QUERY PLAN:

Aggregate  (cost=0.00..48.00 rows=100 width=4)
  -&gt;  Group  (cost=0.00..45.50 rows=1000 width=4)
        -&gt;  Index Scan using t1index on t1  (cost=0.00..43.00 rows=1000 width=4)

20Ëü·ï¤Ç»î¤·¤¿¤ï¤±¤Ç¤Ï¤Ê¤¤¤Î¤Ç¡¤ËÌÂ¼¤µ¤ó¤ÎÊýË¡¤è¤ê¤â¼ÂºÝÂ®¤¤¤«¤É¤¦¤«¤Ï
Ê¬¤«¤ê¤Þ¤»¤ó¡¥

¥Ð¥ê¥¨¡¼¥·¥ç¥ó¤È¤·¤Æ¤Ï¡¤

(1)Ç¯Îð¤Ç¤Ï¤Ê¤¯¤ÆÇ¯Âå¤ò»ý¤Ä
(2)ËÌÂ¼¤µ¤ó¤Î¥Æ¡¼¥Ö¥ë¤ò¼Â¥Æ¡¼¥Ö¥ë¤Ë¤»¤º¤Ë´Ø¿ô¤ò¸Æ¤Ó½Ð¤¹view¤Ë¤¹¤ë

¤È¤«¤¤¤í¤¤¤í¤¢¤ê¤½¤¦¤Ç¤¹¡¥
--
Tatsuo Ishii
</PRE>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<HR>
<UL><LI><STRONG>Follow-Ups</STRONG>:
<UL>
<LI><STRONG><A NAME="00193" HREF="msg00193.html">[pgsql-jp 24524] Re: Â¾¤Î¥Æ¡¼¥Ö¥ë¤ò»²¾È¤¹¤ëupdate»þ¤Î¥¤¥ó¥Ç¥Ã¥¯¥¹¤ÎÍøÍÑ¤Ë¤Ä¤¤¤Æ</A></STRONG>
<UL><LI><EM>From:</EM> Jun Kitamura &lt;kitamura@assiette.net&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-Follow-Ups-End-->
<!--X-References-->
<UL><LI><STRONG>References</STRONG>:
<UL>
<LI><STRONG><A NAME="00172" HREF="msg00172.html">[pgsql-jp 24503] Â¾¤Î¥Æ¡¼¥Ö¥ë¤ò»²¾È¤¹¤ëupdate»þ¤Î¥¤¥ó¥Ç¥Ã¥¯¥¹¤ÎÍøÍÑ¤Ë¤Ä¤¤¤Æ</A></STRONG>
<UL><LI><EM>From:</EM> Minoru Kakuma &lt;kakuma@mib21.co.jp&gt;</LI></UL></LI>
<LI><STRONG><A NAME="00176" HREF="msg00176.html">[pgsql-jp 24507] Re: Â¾¤Î¥Æ¡¼¥Ö¥ë¤ò»²¾È¤¹¤ëupdate»þ¤Î¥¤¥ó¥Ç¥Ã¥¯¥¹¤ÎÍøÍÑ¤Ë¤Ä¤¤¤Æ</A></STRONG>
<UL><LI><EM>From:</EM> Tatsuo Ishii &lt;t-ishii@sra.co.jp&gt;</LI></UL></LI>
<LI><STRONG><A NAME="00181" HREF="msg00181.html">[pgsql-jp 24512] Re: Â¾¤Î¥Æ¡¼¥Ö¥ë¤ò»²¾È¤¹¤ëupdate»þ¤Î¥¤¥ó¥Ç¥Ã¥¯¥¹¤ÎÍøÍÑ¤Ë¤Ä¤¤¤Æ</A></STRONG>
<UL><LI><EM>From:</EM> Minoru Kakuma &lt;kakuma@mib21.co.jp&gt;</LI></UL></LI>
</UL></LI></UL>
<!--X-References-End-->
<!--X-BotPNI-->
<UL>
<LI>Prev by Date:
<STRONG><A HREF="msg00184.html">[pgsql-jp 24515] Re: DBD-Pg ¥¤¥ó¥¹¥È¡¼¥ë</A></STRONG>
</LI>
<LI>Next by Date:
<STRONG><A HREF="msg00186.html">[pgsql-jp 24517] Re: JDBC+PostgresSQL ¤Ç´ÝÉÕ¿ô»ú¤ÏÅÐÏ¿²ÄÇ½¡©</A></STRONG>
</LI>
<LI>Prev by thread:
<STRONG><A HREF="msg00182.html">[pgsql-jp 24513] Re: Â¾¤Î¥Æ¡¼¥Ö¥ë¤ò»²¾È¤¹¤ëupdate»þ¤Î¥¤¥ó¥Ç¥Ã¥¯¥¹¤ÎÍøÍÑ¤Ë¤Ä¤¤¤Æ</A></STRONG>
</LI>
<LI>Next by thread:
<STRONG><A HREF="msg00193.html">[pgsql-jp 24524] Re: Â¾¤Î¥Æ¡¼¥Ö¥ë¤ò»²¾È¤¹¤ëupdate»þ¤Î¥¤¥ó¥Ç¥Ã¥¯¥¹¤ÎÍøÍÑ¤Ë¤Ä¤¤¤Æ</A></STRONG>
</LI>
<LI>Index(es):
<UL>
<LI><A HREF="index.html#00185"><STRONG>Date</STRONG></A></LI>
<LI><A HREF="threads.html#00185"><STRONG>Thread</STRONG></A></LI>
</UL>
</LI>
</UL>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</BODY>
</HTML>
