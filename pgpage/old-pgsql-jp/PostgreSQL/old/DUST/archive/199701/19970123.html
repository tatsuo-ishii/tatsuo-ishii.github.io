<A NAME="8">
<PRE><B>
From: &quot;Takashi Mega&quot; &lt;mega@rodan.misc.hit-u.ac.jp&gt;
Date: Thu, 23 Jan 1997 20:10:10 +0900
Subject: [postgres95 1257] Re: pg95perl vs Postgresperl(Re: Q: FreeBSD gmake
Message-Id: &lt;199701231110.UAA18657@rodan.misc.hit-u.ac.jp&gt;
</A>
</B></PRE>
<PRE>

一橋の妻鹿です。


深谷さん&gt; 深谷＠川鉄情報システムです。

こんにちは。

はないさん&gt;
はないさん&gt; 
はないさん&gt; もし, pgperl95 というのが, pg95perl のことなら, 私はお勧めしません.
はないさん&gt; PostgresPerl のほうが使いやすいと思いますよ.
はないさん&gt; pg95perl だと, C でやってるのと大差ないですから.
はないさん&gt; ＃ あくまで, わたしの印象なのですが.

私も同じく PostgresPerl の方が好きです。特に私の場合は C は Perl 以上
に知らないというのも大きな理由なのですが… ^^;。

深谷さん&gt; PostgresPerl の所在を御存知でしたら教えて戴けませんか？
深谷さん&gt; 私も試してみたいと思います。

ftp://ftp.kciLink.com/pub/PostgresPerl-1.3.tar.gz ですね。

****************************************************************************
Hitotsubashi University(in Japan)                               Takashi Mega
Keywords                               Japanese Sake, International Exchange 
E-mail Address                                   mega@rodan.misc.hit-u.ac.jp
****************************************************************************
<HR>
</PRE>
<A NAME="7">
<PRE><B>
From: fukaya@chubu.ksd.co.jp (Fukaya/深谷)
Date: Thu, 23 Jan 1997 19:21:02 +0900
Subject: [postgres95 1256] Re: pg95perl vs Postgresperl(Re: Q: FreeBSD gmake         ld:
Message-Id: &lt;199701231021.TAA06019@chubu.ksd.co.jp&gt;
</A>
</B></PRE>
<PRE>

深谷＠川鉄情報システムです。

Jun TATEYAMA さんが 97.01.23ごろに
「[postgres95 1254] pg95perl vs Postgresperl(Re: Q: FreeBSD gmak」の件で：
&gt; こんにちは、たてやま＠JSTでございます。
・・・
&gt; You(Hanai Hiroyuki &lt;hanai@astec.co.jp&gt; さま) wrote
&gt; &gt; &gt; &gt;もし, pgperl95 というのが, pg95perl のことなら, 私はお勧めしません.
&gt; &gt; &gt; &gt;PostgresPerl のほうが使いやすいと思いますよ.
&gt; &gt; &gt; &gt;pg95perl だと, C でやってるのと大差ないですから.
&gt; &gt; &gt; &gt;＃ あくまで, わたしの印象なのですが.
・・・
&gt;  知らなかっただけなのですが、今回花井さんのmailを見まして早速PostgresPerlを
&gt;  installしてみました。

PostgresPerl の所在を御存知でしたら教えて戴けませんか？
私も試してみたいと思います。

--
深谷 直文             (Naofumi Fukaya)
川鉄情報システム(株)  (KAWASAKI STEEL Systems R&amp;D Corp.)
TEL/FAX : +81-569-24-2234  / +81-569-24-2026
E-Mail  : fukaya@ksd.co.jp / fukaya@cup.com (Private)
URL     : http://www.cup.com/fukaya/        (Private) 


<HR>
</PRE>
<A NAME="6">
<PRE><B>
From: fukaya@chubu.ksd.co.jp (Fukaya/深谷)
Date: Thu, 23 Jan 1997 19:18:34 +0900
Subject: [postgres95 1255] Re: Q: FreeBSD gmake ld: -lfl: no match ?
Message-Id: &lt;199701231018.TAA05969@chubu.ksd.co.jp&gt;
</A>
</B></PRE>
<PRE>

深谷＠川鉄情報システムです。

Masao Yakushijin さんが 97.01.22ごろに
「[postgres95 1247] Re: Q: FreeBSD gmake ld: -lfl: no match ?」の件で：
&gt; &lt;199701221050.TAA19715@chubu.ksd.co.jp&gt;において
&gt; 1月22日(水)，深谷＠川鉄情報システムさんは書きました。
&gt;
&gt;   | で、次に libpq.so.1 を作成すべく、以前石井さんに教えていただいた
&gt;   | 手順で作業を進めました。
&gt; (中略)
&gt;   | ところが、またまた下のようなエラーが出たのですが・・・

この後、妻鹿＠一橋大さん、薬師神 昌夫さん、花井さん、石井さんからフォローを
いただきました。どうもありがとうございます。

花井さん＞BSD44_derived だと, libpq.so.1 が作られませんからね.
花井さん＞ただ, 石井さんは SunOS 4.1.x か SunOS 5.x でやってらっしゃったんじゃ
花井さん＞なかったでしたっけ?

そのとおり、です。この時は SunOS 4.1.x について質問をしました。
FreeBSDとは違うのですね。知りませんでした。

花井さん＞この pgperl95 というのはどういうものなのでしょう?

すいません。これは私の記述間違いで、正しくは pg95perl でした m(_._)m

薬師神さん&gt; とありますから，
薬師神さん&gt;         gcc -fpic -DPIC ${CFLAGS} -c foo.c -o foo.so
薬師神さん&gt;         ld -x -r foo.so
薬師神さん&gt;         mv a.out foo.so
薬師神さん&gt; をライブラリを構成する全ての *.c に対して行い，
薬師神さん&gt;         rm -f libpq.so.1
薬師神さん&gt;         ld -Bshareable -o libpq.so.1 \
薬師神さん&gt;                 `lorder *.so | tsort`
薬師神さん&gt; を実行すれば，libpq.so.1 が作成されると思います．

上記手順で　FreeBSD 2.1.5R で libpq.so.1 を作成することができました。
皆さん、どうもありがとうございました。

--
深谷 直文             (Naofumi Fukaya)
川鉄情報システム(株)  (KAWASAKI STEEL Systems R&amp;D Corp.)
TEL/FAX : +81-569-24-2234  / +81-569-24-2026
E-Mail  : fukaya@ksd.co.jp / fukaya@cup.com (Private)
URL     : http://www.cup.com/fukaya/        (Private) 


<HR>
</PRE>
<A NAME="5">
<PRE><B>
From: Jun TATEYAMA &lt;tateyama@tokyo.jst-c.go.jp&gt;
Date: Thu, 23 Jan 1997 14:28:12 +0900
Subject: [postgres95 1254] pg95perl vs Postgresperl(Re: Q: FreeBSD gmake
Message-Id: &lt;199701230528.OAA07345@apollo.tokyo.jst-c.go.jp&gt;
</A>
</B></PRE>
<PRE>

こんにちは、たてやま＠JSTでございます。

 ＃久しぶりにmailさせていただきます。

You(Hanai Hiroyuki &lt;hanai@astec.co.jp&gt; さま) wrote 
&gt; &gt; &gt;もし, pgperl95 というのが, pg95perl のことなら, 私はお勧めしません.
&gt; &gt; &gt;PostgresPerl のほうが使いやすいと思いますよ.
&gt; &gt; &gt;pg95perl だと, C でやってるのと大差ないですから.
&gt; &gt; &gt;＃ あくまで, わたしの印象なのですが.
&gt; &gt; 
&gt; &gt; pg95perl の README によれば、
&gt; &gt; 
&gt; &gt; &gt;Pg95perl5 tries to implement the LIBPQ-interface as close, as possible.
&gt; &gt; 
&gt; &gt; ということなので、C (libpq) と同じ感じになってしまうのはやむを得ないの
&gt; &gt; では？もともとそれが狙いだったようですから。
&gt; 
&gt; そうなんですが, その狙いが私は好きじゃないというだけなのです.
&gt; 好み, と言ってしまえばそれまでですね :-)

 昨年の末におみつさんのお力を借りましてpg95perlをinstallして、暇をみて
 使っております。

 これは別にpg95perlが良い、というわけではなくて、単に他のperl I/Fを
 知らなかっただけなのですが、今回花井さんのmailを見まして早速PostgresPerlを
 installしてみました。

 今、両方のtest用のscriptをつらつらと眺めながらこのmailを書いているのですが、
 Cについてはほとんど知識のない私にとっては、どっちもそれなりに良く分かって
 おりません。

 ただ、PostgresPerlの方は
	@row = $result-&gt;fetchrow()
 のような記述ができるようで、これはperl使いには確かにしっくりくる感じが
 しますね。
 ＃'-&gt;'ってのはCみたいだけど。:-)

 もう少し、両方を比較しながら使ってみようかと思っておりますが、
 もし何かadviceのようなものがありましたら、是非とも御教示下さい。
---
舘山　純＠科学技術振興事業団(tateyama@tokyo.jst-c.go.jp)

<HR>
</PRE>
<A NAME="4">
<PRE><B>
From: maruno@alles.or.jp (Hideaki Maruno)
Date: Thu, 23 Jan 1997 14:14:12 +0900
Subject: [postgres95 1253] (No Subject in original)
Message-Id: &lt;199701230511.FAA06725@spou665.tqdomain.tdc.unisys.co.jp&gt;
</A>
</B></PRE>
<PRE>

subscribe postgres95


<HR>
</PRE>
<A NAME="3">
<PRE><B>
From: Hanai Hiroyuki &lt;hanai@astec.co.jp&gt;
Date: Thu, 23 Jan 1997 13:11:36 +0900
Subject: [postgres95 1252] Re: Q: FreeBSD gmake ld: -lfl: no match ? 
Message-Id: &lt;199701230411.NAA07980@pasar&gt;
</A>
</B></PRE>
<PRE>

花井です.

&gt; &gt;もし, pgperl95 というのが, pg95perl のことなら, 私はお勧めしません.
&gt; &gt;PostgresPerl のほうが使いやすいと思いますよ.
&gt; &gt;pg95perl だと, C でやってるのと大差ないですから.
&gt; &gt;＃ あくまで, わたしの印象なのですが.
&gt; 
&gt; pg95perl の README によれば、
&gt; 
&gt; &gt;Pg95perl5 tries to implement the LIBPQ-interface as close, as possible.
&gt; 
&gt; ということなので、C (libpq) と同じ感じになってしまうのはやむを得ないの
&gt; では？もともとそれが狙いだったようですから。

そうなんですが, その狙いが私は好きじゃないというだけなのです.
好み, と言ってしまえばそれまでですね :-)

&gt; ところで、PostgresPerl の方ですが、これは Apache の mod_perl（でしたっ
&gt; け？）でも使えるのですか？

使えると思います.
というか, 少なくとも一度は使ったことがあります.
自分で作ったサンプルプログラムなども間違って全て捨てたので,
例を挙げられなくて申し訳ないんですが…

-----花井
<HR>
</PRE>
<A NAME="2">
<PRE><B>
From: Tatsuo Ishii &lt;t-ishii@sra.co.jp&gt;
Date: Thu, 23 Jan 1997 12:45:15 +0900
Subject: [postgres95 1251] Re: Compile error on SPARC/Linux 
Message-Id: &lt;199701230345.MAA12855@srashd.sra.co.jp&gt;
</A>
</B></PRE>
<PRE>

石井＠SRAです。

&gt;いしかわ＠岐阜大です。
&gt;
&gt;自己紹介を除いて初めて書き込みます。
&gt;よろしくお願いします。

こちらこそよろしく。

&gt;fjでも尋ねているのですが、
&gt;＃たった今ですが(^^;
&gt;
&gt;SPARC/Linuxでpostgres95を PORTNAME=linux でコンパイルしたところ、
&gt;次のようなエラーが出て止まりました。
&gt;
&gt;gcc -c -DNAMEDATALEN=32 -DOIDNAMELEN=36 -O -DPORTNAME_linux \
&gt;＜略＞
&gt;-I/work/postgres95/src/backend/port/linux -DHBA \
&gt;/work/postgres95/src/backend/storage/ipc/s_lock.c -o obj/s_lock.o
&gt;/work/postgres95/src/backend/storage/ipc/s_lock.c: In function `tas':
&gt;/work/postgres95/src/backend/storage/ipc/s_lock.c:393: inconsistent operand constraints in an `asm'
&gt;make[1]: *** [obj/s_lock.o] Error 1
&gt;make[1]: Leaving directory `/work/postgres95/src/backend'
&gt;make: *** [all] Error 2
&gt;
&gt;そこで、/work/postgres95/src/backend/storage/ipc/s_lock.c:393 あたりをみてみると、
&gt;
&gt;int
&gt;tas(slock_t *m)
&gt;{
&gt;    slock_t res;
&gt;    __asm__(&quot;xchgb %0,%1&quot;:&quot;=q&quot; (res),&quot;=m&quot; (*m):&quot;0&quot; (0x1));
&gt;    return(res);
&gt;}
&gt;
&gt;void
&gt;S_LOCK(slock_t *lock)
&gt;{
&gt;    while (tas(lock))
&gt;        ;
&gt;}
&gt;
&gt;となっておりasmの記述がおかしいとのことですが、おそらくx86とSPARCの違
&gt;いではないかと思うのですが、さっぱりわかりません。
&gt;
&gt;この部分だけSolaris2 やSunOS4 用のコードに書き換えても、
&gt;tasがないよ〜。とかいわれてしまいます。
&gt;＃書き換え方が悪いのかも知れませんが。

tas という命令はありません。実際に sparc 用のアセンブラのコードが書か
れているのは、s_lock.c の323行目あたりにある tas_dummy() という関数で
す。

アセンブラをいじるのが面倒な場合は...

&gt;SPARC/Linuxでの動作実績はあるのでしょうか？

多分無いでしょう。でも御安心下さい。私が Mac用 Linux（つまり MkLinux) 
に移植した時の方法ですが、アセンブラのコードを使わず、system call で代
用することができます。やり方ですが、src/backend/storage/ipc.h の

#if defined(PORTNAME_aix) || \
    defined(PORTNAME_alpha) || \
    defined(PORTNAME_BSD44_derived) || \
    defined(PORTNAME_bsdi) || \
    defined(PORTNAME_bsdi_2_1) || \
    defined(PORTNAME_hpux) || \
    defined(PORTNAME_i386_solaris) || \
    defined(PORTNAME_irix5) || \
    defined(PORTNAME_linux) || \
    defined(PORTNAME_next) || \
    defined(PORTNAME_sparc) || \
    defined(PORTNAME_sparc_solaris)
#define HAS_TEST_AND_SET
#endif

から、

    defined(PORTNAME_linux) || \

を抜きます。これでコンパイルが通るはずです。
# 本来は、新しい port name を sparc_linux とでも定義してきちんと移植す
# べきですが...

また、system call で代用した場合、20-30% 程度パフォーマンスが悪くなり
ます。あらかじめ御承知下さい。
---
t-ishii@sra.co.jp	石井達夫
（株）ＳＲＡ
<HR>
</PRE>
<A NAME="1">
<PRE><B>
From: Satoshi Ishikawa &lt;power@sekine.densi.gifu-u.ac.jp&gt;
Date: Thu, 23 Jan 1997 10:49:16 +0900
Subject: [postgres95 1250] Compile error on SPARC/Linux
Message-Id: &lt;199701230149.KAA17451@sekine.densi.gifu-u.ac.jp&gt;
</A>
</B></PRE>
<PRE>

いしかわ＠岐阜大です。

自己紹介を除いて初めて書き込みます。
よろしくお願いします。

fjでも尋ねているのですが、
＃たった今ですが(^^;

SPARC/Linuxでpostgres95を PORTNAME=linux でコンパイルしたところ、
次のようなエラーが出て止まりました。

gcc -c -DNAMEDATALEN=32 -DOIDNAMELEN=36 -O -DPORTNAME_linux \
＜略＞
-I/work/postgres95/src/backend/port/linux -DHBA \
/work/postgres95/src/backend/storage/ipc/s_lock.c -o obj/s_lock.o
/work/postgres95/src/backend/storage/ipc/s_lock.c: In function `tas':
/work/postgres95/src/backend/storage/ipc/s_lock.c:393: inconsistent operand constraints in an `asm'
make[1]: *** [obj/s_lock.o] Error 1
make[1]: Leaving directory `/work/postgres95/src/backend'
make: *** [all] Error 2

そこで、/work/postgres95/src/backend/storage/ipc/s_lock.c:393 あたりをみてみると、

int
tas(slock_t *m)
{
    slock_t res;
    __asm__(&quot;xchgb %0,%1&quot;:&quot;=q&quot; (res),&quot;=m&quot; (*m):&quot;0&quot; (0x1));
    return(res);
}

void
S_LOCK(slock_t *lock)
{
    while (tas(lock))
        ;
}

となっておりasmの記述がおかしいとのことですが、おそらくx86とSPARCの違
いではないかと思うのですが、さっぱりわかりません。

この部分だけSolaris2 やSunOS4 用のコードに書き換えても、
tasがないよ〜。とかいわれてしまいます。
＃書き換え方が悪いのかも知れませんが。

SPARC/Linuxでの動作実績はあるのでしょうか？

また、SunOS4用のバイナリがあれば、エミュレーションで動作すると思われる
ので、バイナリ（tar.gz等）での配布をしていただくことはできないでしょうか？

それでは、今後ともよろしくお願いします。

End Of Message.  
----- ----- ----- ----- ----- ----- ----- ----- ----- ----- -----
石川 諭 （いしかわ さとし）power@densi.gifu-u.ac.jp
Key fingerprint = 53 12 86 DF BF 21 6D BE  DC A4 7B 31 C0 8D E2 F9






<HR>
</PRE>
<A NAME="0">
<PRE><B>
From: Tatsuo Ishii &lt;t-ishii@sra.co.jp&gt;
Date: Thu, 23 Jan 1997 10:22:18 +0900
Subject: [postgres95 1249] Re: Q: FreeBSD gmake ld: -lfl: no match ? 
Message-Id: &lt;199701230122.KAA11478@srashd.sra.co.jp&gt;
</A>
</B></PRE>
<PRE>

石井です。

&gt;花井です.
&gt;
&gt;深谷さん&gt;
&gt;&gt; で、次に libpq.so.1 を作成すべく、以前石井さんに教えていただいた
&gt;
&gt;BSD44_derived だと, libpq.so.1 が作られませんからね.
&gt;ただ, 石井さんは SunOS 4.1.x か SunOS 5.x でやってらっしゃったんじゃ
&gt;なかったでしたっけ?

Subject: [postgres95 989] Re: Q: How to make libpq.so.1 
ですね。その時には、

&gt;postgres95 のバージョンは 1.06 です。インストールは特に問題なくできました。
&gt;make する時に何か特別な指定をしないと libpq.so.1 が出来ないのでしょうか？
&gt;
&gt;マシン環境は、Sun-OS 4.1.3 です。

深谷さんの環境が SunOS ということなので、その前提でお答えしました。
というわけで、

&gt;多分, これだけじゃだめでしょうね.

ということですね。

&gt;もし, pgperl95 というのが, pg95perl のことなら, 私はお勧めしません.
&gt;PostgresPerl のほうが使いやすいと思いますよ.
&gt;pg95perl だと, C でやってるのと大差ないですから.
&gt;＃ あくまで, わたしの印象なのですが.

pg95perl の README によれば、

&gt;Pg95perl5 tries to implement the LIBPQ-interface as close, as possible.

ということなので、C (libpq) と同じ感じになってしまうのはやむを得ないの
では？もともとそれが狙いだったようですから。

ところで、PostgresPerl の方ですが、これは Apache の mod_perl（でしたっ
け？）でも使えるのですか？
---
t-ishii@sra.co.jp	石井達夫
（株）ＳＲＡ
<HR>
</PRE>
