<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>pg_archivecleanup</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.0文書"
HREF="index.html"><LINK
REL="UP"
TITLE="PostgreSQLサーバアプリケーション"
HREF="reference-server.html"><LINK
REL="PREVIOUS"
TITLE="initdb"
HREF="app-initdb.html"><LINK
REL="NEXT"
TITLE="pg_controldata"
HREF="app-pgcontroldata.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2016-10-20T00:12:21"></HEAD
><BODY
CLASS="REFENTRY"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.0文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="initdb"
HREF="app-initdb.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="reference-server.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="pg_controldata"
HREF="app-pgcontroldata.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="PGARCHIVECLEANUP"
></A
><SPAN
CLASS="APPLICATION"
>pg_archivecleanup</SPAN
></H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN101524"
></A
><H2
>名前</H2
>pg_archivecleanup&nbsp;--&nbsp;<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> WALアーカイブファイルを消去する</DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN101528"
></A
><H2
>概要</H2
><P
><TT
CLASS="COMMAND"
>pg_archivecleanup</TT
> [<TT
CLASS="REPLACEABLE"
><I
>option</I
></TT
>...]  <TT
CLASS="REPLACEABLE"
><I
>archivelocation</I
></TT
>   <TT
CLASS="REPLACEABLE"
><I
>oldestkeptwalfile</I
></TT
> </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN101537"
></A
><H2
>説明</H2
><P
><SPAN
CLASS="APPLICATION"
>pg_archivecleanup</SPAN
>は、スタンバイサーバとして動作している際のWALファイルのアーカイブを消去するための<TT
CLASS="LITERAL"
>archive_cleanup_command</TT
>として使用されるように設計されています（<A
HREF="warm-standby.html"
>項26.2</A
>参照）。
同時に、<SPAN
CLASS="APPLICATION"
>pg_archivecleanup</SPAN
>はWALファイルのアーカイブを消去するためのスタンドアローンのプログラムとしても利用することができます。
 </P
><P
><SPAN
CLASS="APPLICATION"
>pg_archivecleanup</SPAN
>を使うためにスタンバイサーバを設定するには、以下を<TT
CLASS="FILENAME"
>recovery.conf</TT
>設定ファイルに記述します。
</P><PRE
CLASS="PROGRAMLISTING"
>archive_cleanup_command = 'pg_archivecleanup <TT
CLASS="REPLACEABLE"
><I
>archivelocation</I
></TT
> %r'</PRE
><P>
<TT
CLASS="REPLACEABLE"
><I
>archivelocation</I
></TT
>は、WALセグメントファイルを削除するディレクトリです。
  </P
><P
><TT
CLASS="LITERAL"
>archive_cleanup_command</TT
>で使用される場合、論理的に<TT
CLASS="LITERAL"
>%r</TT
>より前のすべてのWALファイルは<TT
CLASS="REPLACEABLE"
><I
>archivelocation</I
></TT
>から削除されます。
これによって、クラッシュ—リスタートの機能を維持するための、保持しなければならないファイル数を最小限にします。
このパラメータの使用は、<TT
CLASS="REPLACEABLE"
><I
>archivelocation</I
></TT
>がスタンバイサーバにおいて短期的な保存場所となっている場合には適切ですが、<TT
CLASS="REPLACEABLE"
><I
>archivelocation</I
></TT
>を長期的なWALアーカイブ領域として使っている場合、または複数のスタンバイサーバが同一のアーカイブログの場所からリカバリしている場合には<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>適切ではありません</I
></SPAN
>。
  </P
><P
>スタンドアローンプログラムとして使用される場合、<TT
CLASS="REPLACEABLE"
><I
>oldestkeptwalfile</I
></TT
>より論理的に前のWALファイルは、すべて<TT
CLASS="REPLACEABLE"
><I
>archivelocation</I
></TT
>から削除されます。
このモードでは、<TT
CLASS="FILENAME"
>.partial</TT
>または<TT
CLASS="FILENAME"
>.backup</TT
>のファイル名が指定されると、そのプレフィックス部だけが<TT
CLASS="REPLACEABLE"
><I
>oldestkeptwalfile</I
></TT
>として使用されます。
この<TT
CLASS="FILENAME"
>.backup</TT
>のファイル名の処置により、エラーを起こすことなく特定のベースバックアップより前のすべてのWALファイルを削除することを可能にします。
以下の例は、<TT
CLASS="FILENAME"
>000000010000003700000010</TT
>より古いすべてのファイルを削除する実例です。
</P><PRE
CLASS="PROGRAMLISTING"
>pg_archivecleanup -d archive 000000010000003700000010.00000020.backup

pg_archivecleanup:  keep WAL file "archive/000000010000003700000010" and later
pg_archivecleanup:  removing file "archive/00000001000000370000000F"
pg_archivecleanup:  removing file "archive/00000001000000370000000E"</PRE
><P>
  </P
><P
><SPAN
CLASS="APPLICATION"
>pg_archivecleanup</SPAN
>は、<TT
CLASS="REPLACEABLE"
><I
>archivelocation</I
></TT
>がサーバを実行しているユーザによって読み書き可能なディレクトリであるものと仮定しています。
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN101569"
></A
><H2
>オプション</H2
><P
><SPAN
CLASS="APPLICATION"
>pg_archivecleanup</SPAN
>は、以下のコマンドライン引数を受け付けます。

    <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="OPTION"
>-d</TT
></DT
><DD
><P
><TT
CLASS="FILENAME"
>stderr</TT
>に大量のデバッグログを出力します。
       </P
></DD
><DT
><TT
CLASS="OPTION"
>-n</TT
></DT
><DD
><P
>削除されるファイルの名前を<TT
CLASS="FILENAME"
>stdout</TT
>に出力します(実際には削除しません).
       </P
></DD
><DT
><TT
CLASS="OPTION"
>-V</TT
><BR><TT
CLASS="OPTION"
>--version</TT
></DT
><DD
><P
><SPAN
CLASS="APPLICATION"
>pg_archivecleanup</SPAN
>のバージョンを表示して終了します。
       </P
></DD
><DT
><TT
CLASS="OPTION"
>-x</TT
> <TT
CLASS="REPLACEABLE"
><I
>extension</I
></TT
></DT
><DD
><P
>★原文変更あり
プログラムがスタンドアローンユーティリティとして使用される場合、削除するファイルを決定する前にファイル名から取り除かれる拡張子を指定します。
保存時に圧縮され、そのため圧縮プログラムにより拡張子を付けられたアーカイブを消去するのに特に役に立ちます。
例: <TT
CLASS="LITERAL"
>-x.gz</TT
>
       </P
></DD
><DT
><TT
CLASS="OPTION"
>-?</TT
><BR><TT
CLASS="OPTION"
>--help</TT
></DT
><DD
><P
><SPAN
CLASS="APPLICATION"
>pg_archivecleanup</SPAN
>のコマンドライン引数に関するヘルプを表示して終了します。
       </P
></DD
></DL
></DIV
><P>
   </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN101609"
></A
><H2
>注釈</H2
><P
><SPAN
CLASS="APPLICATION"
>pg_archivecleanup</SPAN
>は、<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> 8.0 とそれ以降において、スタンドアローンユーティリティとして動作するように設計されています。
また、<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> 9.0 とそれ以降においてはアーカイブのクリーンナップコマンドとして動作するように設計されています。
  </P
><P
><SPAN
CLASS="APPLICATION"
>pg_archivecleanup</SPAN
>はC言語で書かれており、必要に応じて修正すべき部分が明確に示されているので、修正の容易なソースコードとなっています。
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN101617"
></A
><H2
>例</H2
><P
>LinuxやUnixのシステムでは、以下のように使います。
</P><PRE
CLASS="PROGRAMLISTING"
>archive_cleanup_command = 'pg_archivecleanup -d /mnt/standby/archive %r 2&#62;&#62;cleanup.log'</PRE
><P>
アーカイブディレクトリは物理的にはスタンバイサーバ上に配置されていますので、<TT
CLASS="LITERAL"
>archive_command</TT
>はNFSを経由してアーカイブディレクトリにアクセスしますが、それらのファイルはスタンバイサーバにとってはローカルファイルです。
この設定では、
  </P
><P
></P
><UL
><LI
><P
>デバッグ出力を<TT
CLASS="FILENAME"
>cleanup.log</TT
>に生成します。
    </P
></LI
><LI
><P
>アーカイブディレクトリの中から、不要になったファイルを削除します。
    </P
></LI
></UL
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN101628"
></A
><H2
>関連項目</H2
><A
HREF="pgstandby.html"
><SPAN
CLASS="APPLICATION"
>pg_standby</SPAN
></A
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="app-initdb.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="app-pgcontroldata.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>initdb</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="reference-server.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><SPAN
CLASS="APPLICATION"
>pg_controldata</SPAN
></TD
></TR
></TABLE
></DIV
></BODY
></HTML
>