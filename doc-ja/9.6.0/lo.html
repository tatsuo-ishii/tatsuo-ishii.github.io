<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>lo</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.0文書"
HREF="index.html"><LINK
REL="UP"
TITLE="追加で提供されるモジュール"
HREF="contrib.html"><LINK
REL="PREVIOUS"
TITLE="isn"
HREF="isn.html"><LINK
REL="NEXT"
TITLE="ltree"
HREF="ltree.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2016-10-20T00:12:21"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.0文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="isn"
HREF="isn.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="contrib.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>付録 F. 追加で提供されるモジュール</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="ltree"
HREF="ltree.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="LO"
>F.20. lo</A
></H1
><P
><TT
CLASS="FILENAME"
>lo</TT
>モジュールはラージオブジェクト（LOやBLOBとも呼ばれます）保守作業のサポートを提供します。
<TT
CLASS="TYPE"
>lo</TT
>データ型と<CODE
CLASS="FUNCTION"
>lo_manage</CODE
>トリガが含まれます。
 </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN177775"
>F.20.1. 原理</A
></H2
><P
>JDBCドライバにおける問題の1つ（ODBCドライバでもこれは影響します）は、規定ではBLOB（バイナリラージオブジェクト）への参照はテーブル内に格納され、その項目が変更されると、関連するBLOBがデータベースから削除されると想定している点です。
  </P
><P
><SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>の立場では、これは起こりません。
ラージオブジェクトは独自の権限をもったオブジェクトとして扱われます。
テーブル項目はOIDによりラージオブジェクトを参照することはできますが、同じラージオブジェクトOIDを参照するテーブル項目を複数持つことも可能です。
このため、システムは、こうした項目を変更または削除したという理由だけでは、ラージオブジェクトを削除しません。
  </P
><P
>さて、これは<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>固有のアプリケーションでは問題ありませんが、JDBCやODBCを使用する標準的なコードでは、オブジェクトが削除されず、孤児、つまりどこからも参照されずディスクを消費するだけのオブジェクトになります。
  </P
><P
><TT
CLASS="FILENAME"
>lo</TT
>モジュールによりLO参照列を持つテーブルにトリガを付与して、これを解消することができます。
このトリガは基本的には、ラージオブジェクトを参照する値を削除または変更した時常に<CODE
CLASS="FUNCTION"
>lo_unlink</CODE
>を単に行います。
このトリガを使用する時は、単一のデータベースのみがトリガの対象列で参照されるラージオブジェクトを参照することを前提とします。
  </P
><P
>また、本モジュールは、単に<TT
CLASS="TYPE"
>oid</TT
>型のドメインに過ぎない<TT
CLASS="TYPE"
>lo</TT
>データ型を提供します。
ラージオブジェクトへの参照を持つデータベース列とこの他のOIDを持つデータベース列との間に違いを持たせるために有用です。
実際このトリガを使用するために<TT
CLASS="TYPE"
>lo</TT
>型を使用する必要はありません。
しかし、データベース内のどの列がトリガで管理されているラージオブジェクトを示しているかを保持するために、これを使用することは簡便かもしれません。
また、BLOB列で<TT
CLASS="TYPE"
>lo</TT
>を使用しない場合、ODBCドライバが混乱してしまうと取りざたされています。
  </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN177790"
>F.20.2. 使用方法</A
></H2
><P
>簡単な使用例を示します。
  </P
><PRE
CLASS="PROGRAMLISTING"
>CREATE TABLE image (title TEXT, raster lo);

CREATE TRIGGER t_raster BEFORE UPDATE OR DELETE ON image
    FOR EACH ROW EXECUTE PROCEDURE lo_manage(raster);</PRE
><P
>一意なラージオブジェクト参照を含む列それぞれに対し、<TT
CLASS="LITERAL"
>BEFORE UPDATE OR DELETE</TT
>トリガを作成してください。
そして、単一のトリガ引数として列名を指定してください。
<TT
CLASS="LITERAL"
>BEFORE UPDATE OF</TT
> <TT
CLASS="REPLACEABLE"
><I
>column_name</I
></TT
>を使って列が更新される時にのみ実行するようトリガを制限することもできます。
同一テーブル上に複数の<TT
CLASS="TYPE"
>lo</TT
>型の列を持たせる必要がある場合、それぞれに対して別のトリガを作成してください。
同一テーブル上の各トリガに別の名前を与えることは忘れないでください。
  </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN177799"
>F.20.3. 制限</A
></H2
><P
></P
><UL
><LI
><P
>トリガが実行されませんので、テーブル削除により含まれるオブジェクトは孤児化します。
<TT
CLASS="COMMAND"
>DROP TABLE</TT
>の前に<TT
CLASS="COMMAND"
>DELETE FROM <TT
CLASS="REPLACEABLE"
><I
>table</I
></TT
></TT
>を行うことで防止することができます。
    </P
><P
><TT
CLASS="COMMAND"
>TRUNCATE</TT
>も同様の危険があります。
    </P
><P
>ラージオブジェクトを孤児化させた、または孤児化させた疑いがある場合は、消去するための手助けとなる<A
HREF="vacuumlo.html"
><SPAN
CLASS="APPLICATION"
>vacuumlo</SPAN
></A
>モジュールを参照してください。
<CODE
CLASS="FUNCTION"
>lo_manage</CODE
>トリガのバックネットとして<SPAN
CLASS="APPLICATION"
>vacuumlo</SPAN
>を時々実行することを勧めます。
    </P
></LI
><LI
><P
>フロントエンドの中には独自のテーブルを作成するものがあり、その場合、関連するトリガは作成されません。
また、ユーザはトリガを作成することを忘れる（または知らない）かもしれません。
    </P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN177815"
>F.20.4. 作者</A
></H2
><P
>   Peter Mount <CODE
CLASS="EMAIL"
>&#60;<A
HREF="mailto:peter@retep.org.uk"
>peter@retep.org.uk</A
>&#62;</CODE
>
  </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="isn.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="ltree.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>isn</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="contrib.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>ltree</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>