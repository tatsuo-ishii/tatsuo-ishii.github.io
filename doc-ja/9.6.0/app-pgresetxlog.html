<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>pg_resetxlog</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.0文書"
HREF="index.html"><LINK
REL="UP"
TITLE="PostgreSQLサーバアプリケーション"
HREF="reference-server.html"><LINK
REL="PREVIOUS"
TITLE="pg_ctl"
HREF="app-pg-ctl.html"><LINK
REL="NEXT"
TITLE="pg_rewind"
HREF="app-pgrewind.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2016-10-20T00:12:21"></HEAD
><BODY
CLASS="REFENTRY"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.0文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="pg_ctl"
HREF="app-pg-ctl.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="reference-server.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="pg_rewind"
HREF="app-pgrewind.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="APP-PGRESETXLOG"
></A
><SPAN
CLASS="APPLICATION"
>pg_resetxlog</SPAN
></H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN102175"
></A
><H2
>名前</H2
>pg_resetxlog&nbsp;--&nbsp;<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>データベースクラスタの先行書き込みログやその他の制御情報を初期化する</DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN102179"
></A
><H2
>概要</H2
><P
><TT
CLASS="COMMAND"
>pg_resetxlog</TT
> [<TT
CLASS="OPTION"
>-f</TT
>] [<TT
CLASS="OPTION"
>-n</TT
>] [<TT
CLASS="REPLACEABLE"
><I
>option</I
></TT
>...] {[<TT
CLASS="OPTION"
>-D</TT
>] <TT
CLASS="REPLACEABLE"
><I
>datadir</I
></TT
>}</P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="R1-APP-PGRESETXLOG-1"
></A
><H2
>説明</H2
><P
><TT
CLASS="COMMAND"
>pg_resetxlog</TT
>は、先行書き込みログ（WAL）を消去し、さらにオプションで<TT
CLASS="FILENAME"
>pg_control</TT
>ファイル内に保存された制御情報の一部を初期化します。
この機能は、これらのファイルが破損した場合に必要になることがあります。
このような破損などが原因でサーバを起動できない場合の最後の手段としてのみ、この機能を使用してください。
  </P
><P
>このコマンドを実行すると、サーバが開始できるようになるはずです。
ただし、不完全にコミットされたトランザクションが原因でデータベースのデータに矛盾が起こる可能性があることに注意してください。
コマンドの実行後は、ただちにデータをダンプし、<TT
CLASS="COMMAND"
>initdb</TT
>を実行し、リロードすべきです。
リロード後、矛盾がないか検査し、必要に応じて修復を行ってください。
  </P
><P
>このユーティリティの実行にはデータディレクトリへの読み込み/書き込みアクセス権限が必要となるため、サーバをインストールしたユーザのみが実行できます。
安全のため、データディレクトリをコマンドラインで指定する必要があります。
<TT
CLASS="COMMAND"
>pg_resetxlog</TT
>は、環境変数<TT
CLASS="ENVAR"
>PGDATA</TT
>を使用しません。
  </P
><P
><TT
CLASS="COMMAND"
>pg_resetxlog</TT
>が<TT
CLASS="FILENAME"
>pg_control</TT
>に対する有効なデータを判別できない場合、<TT
CLASS="OPTION"
>-f</TT
>（force,強制）オプションを指定すれば強制的に処理を進めることができます。
その場合、欠落したデータは無難な値で代用されます。
ほとんどフィールドでは適切な値が使用されますが、次のOID、次のトランザクションIDとエポック時間、マルチトランザクションIDとそのオフセット、WAL開始アドレスの値については、手動の操作が必要な場合があります。
これらの値は下記で説明するオプションを使用して設定することができます。
すべてに対して正しい値を決定できない場合でも<TT
CLASS="OPTION"
>-f</TT
>を使用することができますが、この場合は回復したデータベースを通常よりさらに注意深く検査する必要があります。
必ず、ただちにダンプおよびリロードを行ってください。
決して、ダンプを行う前にデータ変更などの操作を行っては<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>なりません</I
></SPAN
>。
そのような操作は、破損状態をさらに悪化させます。
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN102208"
></A
><H2
>Options</H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="OPTION"
>-f</TT
></DT
><DD
><P
>★    Force <TT
CLASS="COMMAND"
>pg_resetxlog</TT
> to proceed even if it cannot determine
      valid data for <TT
CLASS="FILENAME"
>pg_control</TT
>, as explained above.
     </P
></DD
><DT
><TT
CLASS="OPTION"
>-n</TT
></DT
><DD
><P
><TT
CLASS="OPTION"
>-n</TT
>（no operation,操作なし）オプションを指定すると、<TT
CLASS="COMMAND"
>pg_resetxlog</TT
>は<TT
CLASS="FILENAME"
>pg_control</TT
>から再構築した値、および変更される値を出力して、何も変更せずに終了します。
これは主にデバッグと目的としたツールですが、<TT
CLASS="COMMAND"
>pg_resetxlog</TT
>を実際に進める前の検査としても有用な場合があります。
     </P
></DD
><DT
><TT
CLASS="OPTION"
>-V</TT
><BR><TT
CLASS="OPTION"
>--version</TT
></DT
><DD
><P
>★Display version information, then exit.</P
></DD
><DT
><TT
CLASS="OPTION"
>-?</TT
><BR><TT
CLASS="OPTION"
>--help</TT
></DT
><DD
><P
>★Show help, then exit.</P
></DD
></DL
></DIV
><P
>★ The following options are only needed when
   <TT
CLASS="COMMAND"
>pg_resetxlog</TT
> is unable to determine appropriate values
   by reading <TT
CLASS="FILENAME"
>pg_control</TT
>.  Safe values can be determined as
   described below.  For values that take numeric arguments, hexadecimal
   values can be specified by using the prefix <TT
CLASS="LITERAL"
>0x</TT
>.
  </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="OPTION"
>-c</TT
> <TT
CLASS="REPLACEABLE"
><I
>xid</I
></TT
>,<TT
CLASS="REPLACEABLE"
><I
>xid</I
></TT
></DT
><DD
><P
>★    Manually set the oldest and newest transaction IDs for which the commit
      time can be retrieved.
     </P
><P
>★コミット時刻が取り出せる最古のトランザクションIDとして安全な値（<TT
CLASS="OPTION"
>-c</TT
>の
1番目の部分）はデータディレクトリの下の<TT
CLASS="FILENAME"
>pg_commit_ts</TT
>ディレクトリの中
で、数値的に最小のファイル名を探すことで決定できます。
逆に、コミット時刻が取り出せる最新のトランザクションIDとして安全な値（<TT
CLASS="OPTION"
>-
c</TT
>の2番目の部分）は同じディレクトリの中で、数値的に最大のファイル名を探すこと
で決定できます。
上と同じく、ファイル名は16進数になっています。
★
     </P
></DD
><DT
><TT
CLASS="OPTION"
>-e</TT
> <TT
CLASS="REPLACEABLE"
><I
>xid_epoch</I
></TT
></DT
><DD
><P
>★    Manually set the next transaction ID's epoch.
     </P
><P
><TT
CLASS="COMMAND"
>pg_resetxlog</TT
>で設定されるフィールドを除き、トランザクションIDのエポック時間は実際にはデータベース内に格納されません。
そのため、データベース自身が問題としない限り、任意の値で動作するでしょう。
<SPAN
CLASS="APPLICATION"
>Slony-I</SPAN
>や<SPAN
CLASS="APPLICATION"
>Skytools</SPAN
>などのレプリケーションシステムが確実に正しく動作するように、この値を調整しなければならない可能性があります。
その場合、適切な値はレプリケーションシステムの下流で複製されたデータベースの状態から得られるはずです。
     </P
></DD
><DT
><TT
CLASS="OPTION"
>-l</TT
> <TT
CLASS="REPLACEABLE"
><I
>xlogfile</I
></TT
></DT
><DD
><P
>★    Manually set the WAL starting address.
     </P
><P
>WAL開始アドレス（<TT
CLASS="OPTION"
>-l</TT
>）は、データディレクトリ以下の<TT
CLASS="FILENAME"
>pg_xlog</TT
>に現在存在するWALセグメントファイル名のどの番号よりも大きくならなければなりません。
この名前も16進数で、3つの部分に分かれています。
最初の部分は<SPAN
CLASS="QUOTE"
>"時系列ID"</SPAN
>で、通常、この値は変更すべきではありません。
例えば、<TT
CLASS="FILENAME"
>pg_xlog</TT
>内で最大のエントリが<TT
CLASS="FILENAME"
>00000001000000320000004A</TT
>である場合は、<TT
CLASS="LITERAL"
>-l 00000001000000320000004B</TT
>以上を使用してください。
     </P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
><TT
CLASS="COMMAND"
>pg_resetxlog</TT
>自体は<TT
CLASS="FILENAME"
>pg_xlog</TT
>内のファイルを参照し、既存のファイル名の最後を超えた値をデフォルトの<TT
CLASS="OPTION"
>-l</TT
>設定として選択します。
したがって、手作業による<TT
CLASS="OPTION"
>-l</TT
>の調整は、オフラインアーカイブ内の項目など<TT
CLASS="FILENAME"
>pg_xlog</TT
>に現存しないWALセグメントファイルに注意する場合、または、<TT
CLASS="FILENAME"
>pg_xlog</TT
>の内容が完全に失われている場合にのみ必要とされます。
      </P
></BLOCKQUOTE
></DIV
></DD
><DT
><TT
CLASS="OPTION"
>-m</TT
> <TT
CLASS="REPLACEABLE"
><I
>mxid</I
></TT
>,<TT
CLASS="REPLACEABLE"
><I
>mxid</I
></TT
></DT
><DD
><P
>★    Manually set the next and oldest multitransaction ID.
     </P
><P
>★    A safe value for the next multitransaction ID (first part) can be
      determined by looking for the numerically largest file name in the
      directory <TT
CLASS="FILENAME"
>pg_multixact/offsets</TT
> under the data directory,
      adding one, and then multiplying by 65536 (0x10000).  Conversely, a safe
      value for the oldest multitransaction ID (second part of
      <TT
CLASS="OPTION"
>-m</TT
>) can be determined by looking for the numerically smallest
      file name in the same directory and multiplying by 65536.  The file
      names are in hexadecimal, so the easiest way to do this is to specify
      the option value in hexadecimal and append four zeroes.
     </P
></DD
><DT
><TT
CLASS="OPTION"
>-o</TT
> <TT
CLASS="REPLACEABLE"
><I
>oid</I
></TT
></DT
><DD
><P
>★    Manually set the next OID.
     </P
><P
>データベース内のOIDの最大値よりも大きな次のOIDを決定するには、上記のような簡単な方法はありません。
しかし、幸いにも、次のOIDの設定をが正しく取得することは、それほど重要ではありません。
     </P
></DD
><DT
><TT
CLASS="OPTION"
>-O</TT
> <TT
CLASS="REPLACEABLE"
><I
>mxoff</I
></TT
></DT
><DD
><P
>★    Manually set the next multitransaction offset.
     </P
><P
>★次のマルチトランザクションオフセット（<TT
CLASS="OPTION"
>-O</TT
>）用の安全な値は、データディレクトリ以下の<TT
CLASS="FILENAME"
>pg_multixact/members</TT
>ディレクトリ内で最も大きな数字を持つファイル名を探し、その値に1を加え、52352で乗算することで決定できます。
上と同様、ファイル名は16進数ですので、通常、オプションの値も16進数で指定した方が簡単ですが、上のような0をつけるだけの簡単な計算はありません。
     </P
></DD
><DT
><TT
CLASS="OPTION"
>-x</TT
> <TT
CLASS="REPLACEABLE"
><I
>xid</I
></TT
></DT
><DD
><P
>★    Manually set the next transaction ID.
     </P
><P
>★次のトランザクションID（<TT
CLASS="OPTION"
>-x</TT
>）用の安全な値は、データディレクトリ以下の
<TT
CLASS="FILENAME"
>pg_clog</TT
>ディレクトリ内で最も大きな数字を持つファイル名を探し、その値
に1を加え、1048576で乗算することで決定できます。
ファイル名は16進数ですので、通常、オプションの値も16進数で指定した方が簡単です
。
例えば、<TT
CLASS="FILENAME"
>0011</TT
>が<TT
CLASS="FILENAME"
>pg_clog</TT
>で最も大きなエントリであれば、<TT
CLASS="LITERAL"
>-x 0x1200000</TT
>となります（後ろにゼロを5つ付けると、正しく乗算したことに なります）。
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN102326"
></A
><H2
>注釈</H2
><P
>このコマンドは、サーバの稼動中に使用してはいけません。
<TT
CLASS="COMMAND"
>pg_resetxlog</TT
>は、データディレクトリにサーバのロックファイルがあると、実行されません。
サーバがクラッシュした場合、ロックファイルがそのまま残される場合があります。
その場合は、ロックファイルを削除すれば<TT
CLASS="COMMAND"
>pg_resetxlog</TT
>を実行することができます。
ただし、このコマンドを実行する時は、起動中のサーバプロセスが一切ないことを慎重に確認してください。
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN102331"
></A
><H2
>関連項目</H2
><A
HREF="app-pgcontroldata.html"
><SPAN
CLASS="APPLICATION"
>pg_controldata</SPAN
></A
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="app-pg-ctl.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="app-pgrewind.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><SPAN
CLASS="APPLICATION"
>pg_ctl</SPAN
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="reference-server.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><SPAN
CLASS="APPLICATION"
>pg_rewind</SPAN
></TD
></TR
></TABLE
></DIV
></BODY
></HTML
>