<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>構文解析過程</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.0文書"
HREF="index.html"><LINK
REL="UP"
TITLE="PostgreSQL内部の概要"
HREF="overview.html"><LINK
REL="PREVIOUS"
TITLE="接続の確立"
HREF="connect-estab.html"><LINK
REL="NEXT"
TITLE="PostgreSQLルールシステム"
HREF="rule-system.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2016-10-20T00:12:21"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.0文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="接続の確立"
HREF="connect-estab.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="overview.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>第 49章PostgreSQL内部の概要</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="PostgreSQLルールシステム"
HREF="rule-system.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PARSER-STAGE"
>49.3. 構文解析過程</A
></H1
><P
><I
CLASS="FIRSTTERM"
>構文解析過程</I
>は2つの部分から構成されています。

    <P
></P
></P><UL
><LI
><P
><TT
CLASS="FILENAME"
>gram.y</TT
>と<TT
CLASS="FILENAME"
>scan.l</TT
>で定義されている<I
CLASS="FIRSTTERM"
>パーサ</I
>は、Unixのツール<SPAN
CLASS="APPLICATION"
>bison</SPAN
>と<SPAN
CLASS="APPLICATION"
>flex</SPAN
>を使って構築されます。
      </P
></LI
><LI
><P
><I
CLASS="FIRSTTERM"
>変換プロセス</I
>は、パーサから返されたデータ構造の変更や追加を行います。
      </P
></LI
></UL
><P>
   </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN103816"
>49.3.1. パーサ</A
></H2
><P
>パーサは、（平文のテキストとして渡される）問い合わせ文字列が正しい構文になっているかチェックしなければいけません。
もし構文が正しい場合は<I
CLASS="FIRSTTERM"
>構文解析ツリー</I
>が作られて返されます。
正しくない場合はエラーが返されます。
パーサと字句解析はUnixでよく知られたツールの<SPAN
CLASS="APPLICATION"
>bison</SPAN
>と<SPAN
CLASS="APPLICATION"
>flex</SPAN
>を使用して実装されています。
    </P
><P
><I
CLASS="FIRSTTERM"
>字句解析</I
>はファイル<TT
CLASS="FILENAME"
>scan.l</TT
>で定義され、<I
CLASS="FIRSTTERM"
>識別子</I
>や<I
CLASS="FIRSTTERM"
>SQLキーワード</I
>などの確認を担当します。
検出された全てのキーワードや識別子に対し<I
CLASS="FIRSTTERM"
>トークン</I
>が生成されパーサに渡されます。
    </P
><P
>パーサはファイル<TT
CLASS="FILENAME"
>gram.y</TT
>の中で定義され、<I
CLASS="FIRSTTERM"
>文法ルール</I
>とルールが実行された時に実行される<I
CLASS="FIRSTTERM"
>アクション</I
>の組から構成されています。
アクションのコード（実際はC言語コードです）は構文解析ツリーを作るのに使われます。
    </P
><P
>ファイル<TT
CLASS="FILENAME"
>scan.l</TT
>はプログラム<SPAN
CLASS="APPLICATION"
>flex</SPAN
>を使ってCのソースファイル<TT
CLASS="FILENAME"
>scan.c</TT
>に変換されます。
そして<TT
CLASS="FILENAME"
>gram.y</TT
>は<SPAN
CLASS="APPLICATION"
>bison</SPAN
>を使って<TT
CLASS="FILENAME"
>gram.c</TT
>に書き換えられます。
これらの書き換えが終わると、パーサを作るために通常のCコンパイラが使えるようになります。
生成されたCのファイルには絶対に変更を加えないでください。
と言うのは次に<SPAN
CLASS="APPLICATION"
>flex</SPAN
>もしくは<SPAN
CLASS="APPLICATION"
>bison</SPAN
> が呼ばれた時に上書きされるからです。

     </P><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>注意: </B
>ここで言及した書き換えやコンパイルは通常<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>のソースと一緒に配布される<I
CLASS="FIRSTTERM"
>makefile</I
>を使って自動的に行われます。
      </P
></BLOCKQUOTE
></DIV
><P>
    </P
><P
><SPAN
CLASS="APPLICATION"
>bison</SPAN
>または<TT
CLASS="FILENAME"
>gram.y</TT
>で定義される文法ルールの詳細は本稿では説明しきれません。
<SPAN
CLASS="APPLICATION"
>flex</SPAN
>や<SPAN
CLASS="APPLICATION"
>bison</SPAN
>については本や資料がたくさん出ています。
<TT
CLASS="FILENAME"
>gram.y</TT
>の文法の勉強を始める前に<SPAN
CLASS="APPLICATION"
>bison</SPAN
>の知識が必須となります。
その知識なしではそこで何が起こっているのかを理解することは難しいでしょう。
    </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN103852"
>49.3.2. 書き換えプロセス</A
></H2
><P
>構文解析過程ではSQLの構文構造に関する固定ルールのみを使って構文解析ツリーを作成します。
システムカタログの参照を行わないので、要求されている操作の詳細な語義は理解しません。
構文解析が終わった後に入力としてパーサから戻されたツリーを<I
CLASS="FIRSTTERM"
>書き換えプロセス</I
>が引き受け、どのテーブル、関数、そして演算子が問い合わせによって参照されているのかの判断に必要な語義翻訳を行います。
この情報を表すために作成されるデータ構造を<I
CLASS="FIRSTTERM"
>問い合わせツリー</I
>と呼びます。
    </P
><P
>語義解釈と入力の構文解釈を切り分ける理由は、システムカタログの参照はトランザクション内でのみ行うことができますが、問い合わせ文字列を受け取ってすぐにトランザクションを開始することは好ましくないと考えられるからです。
入力に対する構文解析過程ではトランザクション管理コマンド（<TT
CLASS="COMMAND"
>BEGIN</TT
>、<TT
CLASS="COMMAND"
>ROLLBACK</TT
>など）を特定するだけで十分であるとともに、それ以上の分析を行わなくても正しい処理が実行されます。
実際の問い合わせ（例えば<TT
CLASS="COMMAND"
>SELECT</TT
>もしくは<TT
CLASS="COMMAND"
>UPDATE</TT
>）に関わっていると言うことがわかっていて既にあるトランザクション内にいなければ新規トランザクションを開始することは問題ありません。これ以降に限り書き換えプロセスを起動することができます。
    </P
><P
>書き換えプロセスで作成された問い合わせツリーはほとんどの箇所で加工されていない構文解析ツリーに構造的には似ていますが、細部では数多くの相違が存在します。
例えば、構文解析ツリーの<TT
CLASS="STRUCTNAME"
>FuncCall</TT
>ノードは構文的には関数呼び出しのように見える何かを表わしています。
これは参照された名前が通常の関数になるか集約関数となるかによって<TT
CLASS="STRUCTNAME"
>FuncExpr</TT
>もしくは<TT
CLASS="STRUCTNAME"
>Aggref</TT
>に書き換えられることがあります。
さらに、列の実際のデータ型と式の結果についての情報が問い合わせツリーに書き加えられます。
    </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="connect-estab.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="rule-system.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>接続の確立</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="overview.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>ルールシステム</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>