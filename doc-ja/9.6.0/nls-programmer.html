<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>プログラマへ</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.0文書"
HREF="index.html"><LINK
REL="UP"
TITLE="多言語サポート"
HREF="nls.html"><LINK
REL="PREVIOUS"
TITLE="翻訳者へ"
HREF="nls-translator.html"><LINK
REL="NEXT"
TITLE="手続き言語ハンドラの作成"
HREF="plhandler.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2016-10-20T00:12:21"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.0文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="翻訳者へ"
HREF="nls-translator.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="nls.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>第 53章多言語サポート</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="手続き言語ハンドラの作成"
HREF="plhandler.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="NLS-PROGRAMMER"
>53.2. プログラマへ</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="NLS-MECHANICS"
>53.2.1. 仕組み</A
></H2
><P
>本節では、<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>配布物の一部であるプログラムやライブラリにおける各国語サポートの実装方法を説明します。
現在はCプログラムにのみ適用できます。
  </P
><DIV
CLASS="PROCEDURE"
><P
><B
>プログラムにNLSサポートを追加する</B
></P
><OL
TYPE="1"
><LI
CLASS="STEP"
><P
>プログラムの起動処理に以下のコードを追加してください。
</P><PRE
CLASS="PROGRAMLISTING"
>#ifdef ENABLE_NLS
#include &lt;locale.h&gt;
#endif

...

#ifdef ENABLE_NLS
setlocale(LC_ALL, "");
bindtextdomain("<TT
CLASS="REPLACEABLE"
><I
>progname</I
></TT
>", LOCALEDIR);
textdomain("<TT
CLASS="REPLACEABLE"
><I
>progname</I
></TT
>");
#endif</PRE
><P>
（<TT
CLASS="REPLACEABLE"
><I
>progname</I
></TT
>は実際には自由に選択できます。）
    </P
></LI
><LI
CLASS="STEP"
><P
>どこであろうと翻訳の候補となるメッセージが見つかったら、<CODE
CLASS="FUNCTION"
>gettext()</CODE
>の呼び出しが追加される必要があります。
例えば、
</P><PRE
CLASS="PROGRAMLISTING"
>fprintf(stderr, "panic level %d\n", lvl);</PRE
><P>
は、次のように変更されます。
</P><PRE
CLASS="PROGRAMLISTING"
>fprintf(stderr, gettext("panic level %d\n"), lvl);</PRE
><P>
（NLSサポートが組み込まれていない場合、<TT
CLASS="SYMBOL"
>gettext</TT
>はノーオペレーション命令として定義されます。）
    </P
><P
>これは混乱しがちになります。一般的なショートカットは以下のものです。
</P><PRE
CLASS="PROGRAMLISTING"
>#define _(x) gettext(x)</PRE
><P>
他の解決方法は、バックエンドにおける<CODE
CLASS="FUNCTION"
>ereport()</CODE
>のように、そのプログラムが通信のほとんどを1つまたは数個の関数で行っている場合有効です。
その場合、この関数の内部で全ての入力文字列に対し<CODE
CLASS="FUNCTION"
>gettext</CODE
>を呼び出すようにすることになります。
    </P
></LI
><LI
CLASS="STEP"
><P
>プログラムのソースのあるディレクトリに<TT
CLASS="FILENAME"
>nls.mk</TT
>を追加してください。
これはmakefileとして読まれます。
以下の変数への代入をここで設定する必要があります。

     <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="VARNAME"
>CATALOG_NAME</TT
></DT
><DD
><P
><CODE
CLASS="FUNCTION"
>textdomain()</CODE
>の呼び出しに使用されるプログラム名です。
        </P
></DD
><DT
><TT
CLASS="VARNAME"
>AVAIL_LANGUAGES</TT
></DT
><DD
><P
>用意された翻訳のリストです。初めは空です。
        </P
></DD
><DT
><TT
CLASS="VARNAME"
>GETTEXT_FILES</TT
></DT
><DD
><P
>翻訳可能文字列を含むファイルの一覧です。
つまり、これらは<CODE
CLASS="FUNCTION"
>gettext</CODE
>もしくは他の解決法として印が付けられます。
結局、これはプログラムのほとんど全てのソースファイルを含むことになります。
この一覧があまりに長くなる場合、最初の<SPAN
CLASS="QUOTE"
>"file"</SPAN
>を<TT
CLASS="LITERAL"
>+</TT
>とし、2番目の単語を1行に対して1つのファイル名を持ったファイルとすることができます。
        </P
></DD
><DT
><TT
CLASS="VARNAME"
>GETTEXT_TRIGGERS</TT
></DT
><DD
><P
>翻訳者が作業を行う上で、どの関数呼び出しが翻訳可能文字列を含むかを知る必要に迫られた場合に、メッセージカタログを生成するツールです。
デフォルトでは、<CODE
CLASS="FUNCTION"
>gettext()</CODE
>呼び出しのみを認識します。
<CODE
CLASS="FUNCTION"
>_</CODE
>や他の識別子を使用した場合、ここに記載しなければなりません。
翻訳可能文字列がその最初の引数ではない場合、その項目は（例えば2番目の引数の場合）<TT
CLASS="LITERAL"
>func:2</TT
>という形式でなければなりません。
複数形メッセージをサポートする関数がある場合、その項目は（単一形および複数形メッセージ引数を特定する）<TT
CLASS="LITERAL"
>func:1,2</TT
>のようになります。
        </P
></DD
></DL
></DIV
><P>
    </P
></LI
></OL
></DIV
><P
>ビルドシステムは、自動的にメッセージカタログの構築およびインストールを行います。
  </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="NLS-GUIDELINES"
>53.2.2. メッセージ記述の指針</A
></H2
><P
>メッセージの翻訳を簡単にするために以下に指針をいくつか示します。

   <P
></P
></P><UL
><LI
><P
>以下のように実行時に文章を構築することはしないでください。
</P><PRE
CLASS="PROGRAMLISTING"
>printf("Files were %s.\n", flag ? "copied" : "removed");</PRE
><P>
文章内の単語の順番は言語によって異なる可能性があります。
さらに全ての断章に対して<CODE
CLASS="FUNCTION"
>gettext()</CODE
>を呼び出すことを覚えていたとしても、断章が個別に的確に翻訳されるわけではありません。
それぞれのメッセージが全て調和して翻訳されるかどうか、ちょっとしたコードの複製を用意するとよいかもしません。
番号、ファイル名、および実行時変数のみメッセージテキストに実行時に挿入するべきです。
     </P
></LI
><LI
><P
>同様の理由で、以下も上手くいきません。
</P><PRE
CLASS="PROGRAMLISTING"
>printf("copied %d file%s", n, n!=1 ? "s" : "");</PRE
><P>
これは複数形がどのように形成されるかを決めてかかっているからです。
もし、以下のようにして回避できたと考えると、
</P><PRE
CLASS="PROGRAMLISTING"
>if (n==1)
    printf("copied 1 file");
else
    printf("copied %d files", n):</PRE
><P>
失望することになります。
言語の中には、独特の規則によって2つ以上の形式になるものもあります。
問題全体を回避するためこのメッセージを設計することが最善です。たとえば以下のようにします。
</P><PRE
CLASS="PROGRAMLISTING"
>printf("number of copied files: %d", n);</PRE
><P>
     </P
><P
>適切に複数形を持つメッセージを構築したいと本当に思うのなら、これに対するサポートがありますが、多少厄介です。
<CODE
CLASS="FUNCTION"
>ereport()</CODE
>内の主たる、または詳細なエラーメッセージを生成する場合、以下のように書くことができます。
</P><PRE
CLASS="PROGRAMLISTING"
>errmsg_plural("copied %d file",
              "copied %d files",
              n,
              n)</PRE
><P>
最初の引数は英文の単数形に適切な書式文字列で、二番目は英文の複数形に適切な書式文字列、そして三番目はどの複数形を使用するのかを決定する整数制御値です。引き続く引数はいつものように書式文字列毎に書式化されます。（通常、複数化制御値は書式化されるべき値の内の１つです。）英語では<TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
>が１であるか、そうでないかのみ重要ですが、他の言語では数多くの複数書式が存在します。
翻訳者にはグループとして２つの英文書式を参照し、<TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
>の実行時の値に基づいて選択される適切な１つでもって、複数の代替文字列を供給する機会があります。
     </P
><P
><CODE
CLASS="FUNCTION"
>errmsg</CODE
>あるいは<CODE
CLASS="FUNCTION"
>errdetail</CODE
>報告に直接行かない複数形メッセージが必要であれば、基礎となっている関数、<CODE
CLASS="FUNCTION"
>ngettext</CODE
>を使用する必要があります。
gettextのドキュメントを参照してください。
     </P
></LI
><LI
><P
>メッセージをどのように他の出力と合わせる予定なのかなど翻訳者と何か連絡を取り合いたい場合、<TT
CLASS="LITERAL"
>translator</TT
>で始まるコメントを最初に付けてどうなるかを知らせてください。
以下のようにします。
</P><PRE
CLASS="PROGRAMLISTING"
>/* translator: This message is not what it seems to be. */</PRE
><P>
これらのコメントはメッセージカタログにコピーされますので翻訳者は参照できます。
     </P
></LI
></UL
><P>
  </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="nls-translator.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="plhandler.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>翻訳者へ</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="nls.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>手続き言語ハンドラの作成</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>