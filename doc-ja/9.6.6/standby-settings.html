<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>スタンバイサーバの設定</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.5文書"
HREF="index.html"><LINK
REL="UP"
TITLE="リカバリの設定"
HREF="recovery-config.html"><LINK
REL="PREVIOUS"
TITLE="リカバリ対象の設定"
HREF="recovery-target-settings.html"><LINK
REL="NEXT"
TITLE="データベース活動状況の監視"
HREF="monitoring.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2018-02-10T07:29:51"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.5文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="リカバリ対象の設定"
HREF="recovery-target-settings.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="recovery-config.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>第 27章リカバリの設定</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="データベース活動状況の監視"
HREF="monitoring.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="STANDBY-SETTINGS"
>27.3. スタンバイサーバの設定</A
></H1
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><A
NAME="STANDBY-MODE"
></A
><TT
CLASS="VARNAME"
>standby_mode</TT
> (<TT
CLASS="TYPE"
>boolean</TT
>)
        </DT
><DD
><P
><SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> サーバをスタンバイとして起動するかどうかを指定します。
このパラメータが <TT
CLASS="LITERAL"
>on</TT
> の場合、サーバはアーカイブWALファイルの最後に到達してもリカバリを終了せず、<TT
CLASS="VARNAME"
>restore_command</TT
> の実行、および/あるいは、 <TT
CLASS="VARNAME"
>primary_conninfo</TT
> で指定されたプライマリサーバへ接続することによって、新しいWALセグメントの取得を継続しようとします。
         </P
></DD
><DT
><A
NAME="PRIMARY-CONNINFO"
></A
><TT
CLASS="VARNAME"
>primary_conninfo</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
        </DT
><DD
><P
>スタンバイサーバがプライマリサーバに接続するための接続文字列を指定します。
この文字列は、<A
HREF="libpq-connect.html#LIBPQ-CONNSTRING"
>項32.1.1</A
>で説明されている書式で記述されます。
この文字列に何のオプションも指定されていない場合、これに対応する環境変数 (<A
HREF="libpq-envars.html"
>項32.14</A
> 参照) が確認されます。
もし、環境変数も設定されていない場合、デフォルトの値が使われます。
         </P
><P
>接続文字列では、プライマリサーバのホスト名（またはアドレス）、スタンバイサーバのデフォルトと異なるのであればポート番号も指定する必要があります。
また、プライマリサーバ上で適切な権限を保有するロールのユーザを指定しなければなりません (<A
HREF="warm-standby.html#STREAMING-REPLICATION-AUTHENTICATION"
>項26.2.5.1</A
> 参照)。
プライマリサーバが要求するのであれば、パスワードも記述される必要があります。
パスワードは <TT
CLASS="VARNAME"
>primary_conninfo</TT
> に記述することもできますし、スタンバイサーバ上の分離されたファイル <TT
CLASS="FILENAME"
>~/.pgpass</TT
> に記述することもできます (データベース名には <TT
CLASS="LITERAL"
>replication</TT
> を使います)。
<TT
CLASS="VARNAME"
>primary_conninfo</TT
> 文字列の中には、データベース名を指定しないでください。
         </P
><P
><TT
CLASS="VARNAME"
>standby_mode</TT
> が <TT
CLASS="LITERAL"
>off</TT
> になっている場合、この設定は無効です。
         </P
></DD
><DT
><A
NAME="PRIMARY-SLOT-NAME"
></A
><TT
CLASS="VARNAME"
>primary_slot_name</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
        </DT
><DD
><P
>上流ノードのリソース削除を制御するためにストリーミングレプリケーション経由でプライマリに接続した場合、既存のレプリケーションスロットを使うように、必要に応じて指定します（<A
HREF="warm-standby.html#STREAMING-REPLICATION-SLOTS"
>項26.2.6</A
>を参照）。
<TT
CLASS="VARNAME"
>primary_conninfo</TT
>が設定されていない場合、この設定は無効です。
         </P
></DD
><DT
><A
NAME="TRIGGER-FILE"
></A
><TT
CLASS="VARNAME"
>trigger_file</TT
> (<TT
CLASS="TYPE"
>string</TT
>)
        </DT
><DD
><P
>スタンバイサーバにおいて、リカバリの完了を示すトリガファイルを指定します。
もしこの値が設定されていない場合、<TT
CLASS="COMMAND"
>pg_ctl promote</TT
>を使ってスタンバイサーバを昇格させることができます。
<TT
CLASS="VARNAME"
>standby_mode</TT
> が <TT
CLASS="LITERAL"
>off</TT
> の時には、この設定は無効です。
         </P
></DD
><DT
><A
NAME="RECOVERY-MIN-APPLY-DELAY"
></A
><TT
CLASS="VARNAME"
>recovery_min_apply_delay</TT
> (<TT
CLASS="TYPE"
>integer</TT
>)
      </DT
><DD
><P
>デフォルトでは、スタンバイサーバは可能な限り早くプライマリからWALレコードをリストアします。
時間遅れのデータのコピーを持つことで、データ損失エラーを修正する機会を提供するのは有用かもしれません。
このパラメータを使う事で、一定時間リカバリを遅らせることができます。単位を指定しない場合、ミリ秒として扱われます。
例えば、パラメータに<TT
CLASS="LITERAL"
>5min</TT
>と指定した場合、各トランザクションについて、スタンバイのシステム時刻が、マスターから報告されたコミット時刻より5分以上経過している場合のみ、スタンバイサーバはコミットを再生します。
       </P
><P
>サーバ間のレプリケーション遅延はパラメータの値を上回る可能性があり、その場合には遅延は追加されません。
遅延は、マスタサーバで書かれたWALのタイムスタンプと、スタンバイサーバの現在時刻を使って計算されていることに注意してください。
ネットワークのラグやカスケーディングレプリケーション構成によるデータ転送の遅延は、実際の待ち時間を大幅に減らすかもしれません。
もし、マスタサーバとスタンバイサーバのシステムクロックが同期されていない場合、期待値よりも早くレコードのリカバリを始めるかもしれません。
しかし、このパラメータの有用な設定値は典型的なサーバ間の時間のずれよりもずっと大きいので、それらは大きな問題ではありません。
       </P
><P
>遅延はトランザクションコミットのWALレコードだけで発生します。
他のレコードは可能な限り早く再生されるでしょう。
対応する（トランザクション）コミットレコードが適用されるまではその効果が不可視であることがMVCCの可視ルールによって保証されているため、他のレコードが可能な限り早く再生されることは問題にはなりません。
       </P
><P
>ひとたびリカバリ中のデータベースが整合性のとれた状態になれば、スタンバイサーバが昇格またはトリガーになるまで、遅延が発生します。
その後、スタンバイサーバはそれ以上待たずにリカバリを終了します。
       </P
><P
>このパラメータはストリーミングレプリケーション配信で使われることを目的としていますが、パラメータが指定されていると、すべてのケースで使用されます。
この機能を使うことによって<TT
CLASS="VARNAME"
>hot_standby_feedback</TT
>が遅延され、マスタサーバの肥大化に繋がる可能性があります。両方同時に使う場合には注意して使ってください。

        <DIV
CLASS="WARNING"
><P
></P
><TABLE
CLASS="WARNING"
BORDER="1"
WIDTH="90%"
><TR
><TD
ALIGN="CENTER"
><B
>警告</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
><TT
CLASS="VARNAME"
>synchronous_commit</TT
>が<TT
CLASS="LITERAL"
>remote_apply</TT
>に設定されていれば、同期レプリケーションは、この設定に影響を受けます。各<TT
CLASS="LITERAL"
>COMMIT</TT
>は適用されるのを待つことが必要です。
         </P
></TD
></TR
></TABLE
></DIV
>
       </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="recovery-target-settings.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="monitoring.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>リカバリ対象の設定</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="recovery-config.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>データベース活動状況の監視</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>