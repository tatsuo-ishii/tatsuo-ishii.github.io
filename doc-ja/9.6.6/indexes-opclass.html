<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>演算子クラスと演算子族</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.5文書"
HREF="index.html"><LINK
REL="UP"
TITLE="インデックス"
HREF="indexes.html"><LINK
REL="PREVIOUS"
TITLE="部分インデックス"
HREF="indexes-partial.html"><LINK
REL="NEXT"
TITLE="インデックスと照合順序"
HREF="indexes-collations.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2018-02-10T07:29:51"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.5文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="部分インデックス"
HREF="indexes-partial.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="indexes.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>第 11章インデックス</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="インデックスと照合順序"
HREF="indexes-collations.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="INDEXES-OPCLASS"
>11.9. 演算子クラスと演算子族</A
></H1
><P
>インデックス定義では、インデックスの各列に<I
CLASS="FIRSTTERM"
>演算子クラス</I
>を指定することができます。
</P><PRE
CLASS="SYNOPSIS"
>CREATE INDEX <TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
> ON <TT
CLASS="REPLACEABLE"
><I
>table</I
></TT
> (<TT
CLASS="REPLACEABLE"
><I
>column</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>opclass</I
></TT
> [<SPAN
CLASS="OPTIONAL"
><TT
CLASS="REPLACEABLE"
><I
>sort options</I
></TT
></SPAN
>] [<SPAN
CLASS="OPTIONAL"
>, ...</SPAN
>]);</PRE
><P>
演算子クラスにより、その列のインデックスで使用される演算子が特定されます。
例えば、<TT
CLASS="TYPE"
>int4</TT
>型に対するB-treeインデックスには、<TT
CLASS="LITERAL"
>int4_ops</TT
>クラスを使用します。
この演算子クラスには、<TT
CLASS="TYPE"
>int4</TT
>型の値用の比較関数が含まれています。
実際には、通常、列のデータ型のデフォルト演算子クラスで十分です。
演算子クラスを持つ主な理由は、いくつかのデータ型では、複数の有意義なインデックスの振舞いがあり得るということです。
例えば、複素数データ型を、絶対値でソートしたいかもしれませんし、実数部でソートしたいかもしれません。
この処理は、そのデータ型の2つの演算子クラスを定義した上で、インデックスを作成する際に適切なクラスを選択することで、実行可能です。
演算子クラスは基本的なソート順を決定します。
（これはソートオプション<TT
CLASS="LITERAL"
>COLLATE</TT
>、<TT
CLASS="LITERAL"
>ASC</TT
>/<TT
CLASS="LITERAL"
>DESC</TT
>、<TT
CLASS="LITERAL"
>NULLS FIRST</TT
>/<TT
CLASS="LITERAL"
>NULLS LAST</TT
>を付けることで変更できます。）
  </P
><P
>以下のように、デフォルトの演算子クラスとは別に、組み込み演算子クラスがいくつかあります。

   <P
></P
></P><UL
><LI
><P
><TT
CLASS="LITERAL"
>text_pattern_ops</TT
>、<TT
CLASS="LITERAL"
>varchar_pattern_ops</TT
>、<TT
CLASS="LITERAL"
>bpchar_pattern_ops</TT
>、<TT
CLASS="LITERAL"
>name_pattern_ops</TT
>演算子クラスは、それぞれ、<TT
CLASS="TYPE"
>text</TT
>、<TT
CLASS="TYPE"
>varchar</TT
>、<TT
CLASS="TYPE"
>char</TT
>型上のB-treeインデックスをサポートします。
デフォルトの演算子クラスとの違いは、ロケール特有の照合規則に従わずに、文字同士を厳密に比較する点です。
これらの演算子クラスを、標準<SPAN
CLASS="QUOTE"
>"C"</SPAN
>ロケールを使用しないデータベースにおける、パターンマッチ式（<TT
CLASS="LITERAL"
>LIKE</TT
>やPOSIX正規表現）を含む問い合わせでの使用に適したものにします。
例えば、以下のように<TT
CLASS="TYPE"
>varchar</TT
>のインデックスを作成できます。
</P><PRE
CLASS="PROGRAMLISTING"
>CREATE INDEX test_index ON test_table (col varchar_pattern_ops);</PRE
><P>
また、通常の<TT
CLASS="LITERAL"
>&lt;</TT
>、<TT
CLASS="LITERAL"
>&lt;=</TT
>、<TT
CLASS="LITERAL"
>&gt;</TT
>、または<TT
CLASS="LITERAL"
>&gt;=</TT
>比較を含む問い合わせでインデックスを使いたい場合も、デフォルトの演算子クラスでインデックスを作成しなければならないことに注意してください。
こうした問い合わせでは<TT
CLASS="LITERAL"
><TT
CLASS="REPLACEABLE"
><I
>xxx</I
></TT
>_pattern_ops</TT
>演算子クラスを使用することができません。（しかし、通常の等価比較はこれらの演算子クラスを使用することができます。）
同じ列に対して異なる演算子クラスを使用して複数のインデックスを作成することができます。
Cロケールを使用する場合は、<TT
CLASS="LITERAL"
><TT
CLASS="REPLACEABLE"
><I
>xxx</I
></TT
>_pattern_ops</TT
>演算子クラスは必要ありません。
Cロケールでのパターンマッチ問い合わせでは、デフォルト演算子クラスを使用したインデックスが使用できるためです。
     </P
></LI
></UL
><P>
  </P
><P
>以下の問い合わせは、定義済みの演算子クラスを全て返します。

</P><PRE
CLASS="PROGRAMLISTING"
>SELECT am.amname AS index_method,
       opc.opcname AS opclass_name,
       opc.opcintype::regtype AS indexed_type,
       opc.opcdefault AS is_default
    FROM pg_am am, pg_opclass opc
    WHERE opc.opcmethod = am.oid
    ORDER BY index_method, opclass_name;</PRE
><P>
  </P
><P
>実際のところ演算子クラスは、<I
CLASS="FIRSTTERM"
>演算子族</I
>と呼ばれる、より大きな構造の一部でしかありません。
複数のデータ型が似たような動作を行う場合、データ型を跨る演算子を定義し、インデックスで使用可能とすることが有用な場合がよくあります。
このためには、各型に対する演算子クラスが同一の演算子族にまとめられている必要があります。
データ型を跨る演算子は演算子族の要素です。演算子族内の1つの演算子クラスに結びついているわけではありません。
  </P
><P
>以下は前述の問い合わせを拡張したバージョンで、各演算子クラスが属する演算子族を示します。
</P><PRE
CLASS="PROGRAMLISTING"
>SELECT am.amname AS index_method,
       opc.opcname AS opclass_name,
       opf.opfname AS opfamily_name,
       opc.opcintype::regtype AS indexed_type,
       opc.opcdefault AS is_default
    FROM pg_am am, pg_opclass opc, pg_opfamily opf
    WHERE opc.opcmethod = am.oid AND
          opc.opcfamily = opf.oid
    ORDER BY index_method, opclass_name;</PRE
><P>
  </P
><P
>以下の問い合わせは、定義済みの演算子族と各演算子族に含まれる演算子をすべて表示します。
</P><PRE
CLASS="PROGRAMLISTING"
>SELECT am.amname AS index_method,
       opf.opfname AS opfamily_name,
       amop.amopopr::regoperator AS opfamily_operator
    FROM pg_am am, pg_opfamily opf, pg_amop amop
    WHERE opf.opfmethod = am.oid AND
          amop.amopfamily = opf.oid
    ORDER BY index_method, opfamily_name, opfamily_operator;</PRE
><P>
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="indexes-partial.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="indexes-collations.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>部分インデックス</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="indexes.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>インデックスと照合順序</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>