<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>リリース9.6.1</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.5文書"
HREF="index.html"><LINK
REL="UP"
TITLE="リリースノート"
HREF="release.html"><LINK
REL="PREVIOUS"
TITLE="リリース9.6.2"
HREF="release-9-6-2.html"><LINK
REL="NEXT"
TITLE="リリース9.6"
HREF="release-9-6.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2018-02-10T07:29:51"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.5文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="リリース9.6.2"
HREF="release-9-6-2.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="release.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>付録 E. リリースノート</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="リリース9.6"
HREF="release-9-6.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="RELEASE-9-6-1"
>E.5. リリース9.6.1</A
></H1
><DIV
CLASS="FORMALPARA"
><P
><B
>Release date: </B
>2016-10-27</P
></DIV
><P
>このリリースは9.6.0に対し、各種不具合を修正したものです。
9.6メジャーリリースにおける新機能については、<A
HREF="release-9-6.html"
>項E.6</A
>
を参照してください。
  </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN131463"
>E.5.1. バージョン9.6.1への移行</A
></H2
><P
>9.6.Xからの移行ではダンプ/リストアは不要です。
   </P
><P
>しかしながら、インストレーションが下記変更点の最初の2項目に書かれたバグの影響を受けている場合には、アップデート後に壊れた空き領域マップおよび/または可視性マップを修復する作業が必要になるでしょう。
   </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN131467"
>E.5.2. 変更点</A
></H2
><P
></P
><UL
><LI
><P
>リレーションの空き領域マップと可視性マップの切り捨てに関するWAL記録を修正しました。
(Pavan Deolasee, Heikki Linnakangas)
     </P
><P
>クラッシュリカバリの際にこれらのファイルが正しくリストアされない、あるいは、スタンバイサーバで誤った書き込みがされる可能性がありました。
空き領域マップ内のでたらめな項目は、リレーション自体から切り捨てられて存在しないページへのアクセスを引き起こすおそれがあり、典型的には<SPAN
CLASS="QUOTE"
>"could not read block <TT
CLASS="REPLACEABLE"
><I
>XXX</I
></TT
>: read only 0 of 8192 bytes（ブロックXXXが読み取りできません: 8192バイトのうち0バイトのみ読み取りました）"</SPAN
>のようなエラーをもたらします。
チェックサム検査を有効にしているなら、可視性マップでのチェックサムエラーの可能性もあります。
     </P
><P
>問題があるかどうかの判断とそうであるときの修復の手順について、
<A
HREF="https://wiki.postgresql.org/wiki/Free_Space_Map_Problems"
TARGET="_top"
>https://wiki.postgresql.org/wiki/Free_Space_Map_Problems</A
>
で説明されています。
     </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_upgrade</SPAN
>がリレーションの可視性マップを9.6形式に書き換えたときに起こりうるデータ破損を修正しました。
(Tom Lane)
     </P
><P
>ビッグエンディアンのマシンで、新たな可視性マップのバイト列が誤った順で書かれ、完全に誤ったマップをもたらしました。
Windowsで、古いマップがテキストモードを使って読まれていて、偶然に復帰(CR)・改行(LF)と一致したバイト列を含んでいる場合に誤った結果をもたらしました。
後者のエラーは、マップファイルが誤った長さに見えるため、ほとんど常に<SPAN
CLASS="APPLICATION"
>pg_upgrade</SPAN
>のエラーになります。
     </P
><P
>ビッグエンディアンのマシン（多くの非インテルアーキテクチャはビッグエンディアンです）を使っていて、<SPAN
CLASS="APPLICATION"
>pg_upgrade</SPAN
>を9.6より前のリリースからのアップグレードに使っていた場合には、すべての可視性マップが不正で再生成を要すると考えるべきです。
そのためには<TT
CLASS="FILENAME"
>contrib/pg_visibility</TT
>の<CODE
CLASS="FUNCTION"
>pg_truncate_visibility_map()</CODE
>関数を用いて各リレーションの可視性マップを切り捨ればよいです。
詳細については
<A
HREF="https://wiki.postgresql.org/wiki/Visibility_Map_Problems"
TARGET="_top"
>https://wiki.postgresql.org/wiki/Visibility_Map_Problems</A
>
を参照してください。
     </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>INSERT ... ON CONFLICT</TT
>での自己競合する挿入には直列化のエラーを出さないようにしました。
(Thomas Munro, Peter Geoghegan)
     </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>DISTINCT</TT
>を使用する集約関数の実行で解放済みメモリ使用の危険があり、修正しました。
(Peter Geoghegan)
     </P
><P
>これはクラッシュまたは誤った問い合わせ結果をもたらすおそれがあります。
     </P
></LI
><LI
><P
>ウィンドウ関数として使用される多様型の集約の誤った扱いを修正しました。
(Tom Lane)
     </P
><P
>集約の遷移関数は、その第一引数と戻り値が状態の型でなく集約の出力の型であると知らされました。
このことは多様遷移関数のエラーまたはクラッシュを引き起こしました。
     </P
></LI
><LI
><P
>行単位セキュリティが有効なテーブルの列名リストを伴う<TT
CLASS="COMMAND"
>COPY</TT
>を修正しました。
(Adam Brightwell)
     </P
></LI
><LI
><P
>&#13;<A
HREF="runtime-config-statistics.html#GUC-TRACK-IO-TIMING"
>track_io_timing</A
>がonのとき、有効なXMLを出力するように<TT
CLASS="COMMAND"
>EXPLAIN</TT
>を修正しました。
(Markus Winand)
     </P
><P
>これまでXML出力形式オプションは<TT
CLASS="LITERAL"
>&lt;I/O-Read-Time&gt;</TT
>のような文法的に無効なタグを生成していました。
これは<TT
CLASS="LITERAL"
>&lt;I-O-Read-Time&gt;</TT
>となります。
     </P
></LI
><LI
><P
>準備されたトランザクションでの<TT
CLASS="COMMAND"
>TRUNCATE</TT
>に対する統計情報の更新が修正されました。
(Stas Kelvich)
     </P
></LI
><LI
><P
>テーブルの作成または定義変更における、継承した<TT
CLASS="LITERAL"
>CHECK</TT
>制約のマージでのバグを修正しました。
(Tom Lane, Amit Langote)
     </P
><P
>同一の<TT
CLASS="LITERAL"
>CHECK</TT
>制約を親テーブルと子テーブルにどの順でも加えることを可能にします。
親テーブルからの有効な制約と子テーブルの<TT
CLASS="LITERAL"
>NOT VALID</TT
>な制約とのマージを防止します。
そのうえ、<TT
CLASS="LITERAL"
>NO INHERIT</TT
>な子の制約と継承された制約とのマージを防止します。
     </P
></LI
><LI
><P
><TT
CLASS="STRUCTNAME"
>pg_settings</TT
>.<TT
CLASS="STRUCTFIELD"
>unit</TT
>で<TT
CLASS="VARNAME"
>min_wal_size</TT
>と<TT
CLASS="VARNAME"
>max_wal_size</TT
>に実用的な値を表示するようにしました。
(Tom Lane)
     </P
></LI
><LI
><P
><CODE
CLASS="FUNCTION"
>jsonb_set()</CODE
>で配列要素の置換を修正しました。
(Tom Lane)
     </P
><P
>対象が存在するJSON配列要素の場合、新たな値で置き換えられる代わりに削除されていました。
     </P
></LI
><LI
><P
>バッファロックの保持なしにタプル可視性をテストすることによる、とても低い確率のデータ破損を回避しました。
(Thomas Munro, Peter Geoghegan, Tom Lane)
     </P
></LI
><LI
><P
>サーバ再起動をまたいでコミットタイムスタンプを維持するようにしました。
(Julien Rouhaud, Craig Ringer)
     </P
><P
><A
HREF="runtime-config-replication.html#GUC-TRACK-COMMIT-TIMESTAMP"
>track_commit_timestamp</A
>がonのとき、クリーンなサーバ再起動の後に古いコミットタイムスタンプがアクセス不能になっていました。
     </P
></LI
><LI
><P
>サブトランザクションのWAL出力がディスクに溢れるほど大きいとき、適切に動作するようにロジカルWALデコーディングを修正しました。
(Andres Freund)
     </P
></LI
><LI
><P
>ロジカルWALでコーディングでダングリングポインタ問題を修正しました。
(Stas Kelvich)
     </P
></LI
><LI
><P
>Linuxでhuge pagesを使用しようとするとき、共有メモリ割り当て要求を実際のhuge pageサイズの倍数にまるめるようにしました。
(Tom Lane)
     </P
><P
>これにより、典型的ではないデフォルトhuge pageサイズを持つシステムで<CODE
CLASS="FUNCTION"
>munmap()</CODE
>中に起こりうる失敗を回避します。
クラッシュリカバリの場合を除いて、ログメッセージの他には悪影響はありませんでした。
     </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>libpq</SPAN
>で複数接続を横断してSSLコンテキストを共有をしようとしなくしました。
(Heikki Linnakangas)
     </P
><P
>特に異なる接続に異なるSSLパラメータを使おうとするとき、これは稀な場合で起きる様々なバグをもたらしました。
     </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>libpq</SPAN
>で稀な場合のメモリリークを回避しました。
(Tom Lane)
     </P
><P
>報告された問題は<CODE
CLASS="FUNCTION"
>PQreset()</CODE
>でエラー報告がメモリリークするものですが、関連したケースがいくつかあると思われます。
     </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_upgrade</SPAN
>でライブラリがロード可能かを名前順に検査するようにしました。
(Tom Lane)
     </P
><P
>これは言語の変換モジュールから、その基となる言語とデータ型のモジュールへの拡張間の依存を処理するための回避策です。
     </P
></LI
><LI
><P
>インデックスアクセスメソッドを含む拡張に対して正しく動作するように<SPAN
CLASS="APPLICATION"
>pg_upgrade</SPAN
>を修正しました。
(Tom Lane)
     </P
><P
>これを可能にするため、サーバが<TT
CLASS="COMMAND"
>ALTER EXTENSION ADD/DROP ACCESS METHOD</TT
>に対応するように拡張されました。
この機能はアクセスメソッドの動的作成に対応した当初のパッチに含まれているべきでしたが、見落とされていました。
     </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_upgrade</SPAN
>のファイルのコピー/リンク/リライト段階におけるエラー報告を改善しました。
(Tom Lane, &Aacute;lvaro Herrera)
     </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_dump</SPAN
>を7.4より前のサーバに対して動作するように修正しました。
(Amit Langote, Tom Lane)
     </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_rewind</SPAN
>で<TT
CLASS="OPTION"
>--source-server</TT
>と<TT
CLASS="OPTION"
>--source-target</TT
>のオプションを両方指定することを禁止しました。
(Michael Banck)
     </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_rewind</SPAN
>がソースサーバ上のセッションで<TT
CLASS="VARNAME"
>synchronous_commit</TT
>をoffにするようにしました。
(Michael Banck, Michael Paquier)
     </P
><P
>これによりソースサーバが同期レプリケーションを使用していて、何らかの理由でそれが機能していないときでも、<SPAN
CLASS="APPLICATION"
>pg_rewind</SPAN
>が動作するようになります。
     </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_xlogdump</SPAN
>で<TT
CLASS="OPTION"
>--follow</TT
>オプションを使っているとき、新たなWALセグメントのオープンを再試行するようにしました。
(Magnus Hagander)
     </P
><P
>これはサーバの次セグメント作成における起こりうる遅れを許容します。
     </P
></LI
><LI
><P
>ロールバックされた更新の対象となっていた破損したタプルに対して正しいTIDを報告するように<TT
CLASS="FILENAME"
>contrib/pg_visibility</TT
>を修正しました。
(Tom Lane)
     </P
></LI
><LI
><P
>単独での<SPAN
CLASS="APPLICATION"
>PL/Python</SPAN
>の並行makeが確実に成功するようにmakefileの依存を修正しました。
(Pavel Raiskup)
     </P
></LI
><LI
><P
>タイムゾーンデータファイルを<SPAN
CLASS="APPLICATION"
>tzdata</SPAN
> release 2016hに更新しました。
パレスチナとトルコの夏時間法の変更、トルコとロシアのいくつかの地域の歴史的修正が含まれます。
南極大陸、旧ソ連、スリランカのいくつかのタイムゾーンでは数値による省略形に切り替えました。
     </P
><P
>IANAタイムゾーンデータベースはこれまで全てのタイムゾーンについて文字による省略形を提供しましたが、地元の人々の間でほとんど、あるいは全く通用していない省略形をしばしば作成していました。
IANAは英語の省略形が現実に使われている形跡がないゾーンにおいてはUTCオフセット数値を使うことを選ぶという方針に転換しようとしてるところです。
少なくともしばらくの間、<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>はタイムスタンプの入力に、このような削除された省略形を引き続き受け入れます。
しかし、それらは<TT
CLASS="STRUCTNAME"
>pg_timezone_names</TT
>ビューには現れず、出力にも使用されなくなります。
     </P
><P
>本更新では<TT
CLASS="LITERAL"
>AMT</TT
>はもはやアルメニア時間の意味で使われるものとしては現れません。
それゆえに、これをアマゾン時間すなわちUTC+4ではなくUTC-4と解釈するように<TT
CLASS="LITERAL"
>Default</TT
>省略形セットを変更しました。
     </P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="release-9-6-2.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="release-9-6.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>リリース9.6.2</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="release.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>リリース9.6</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>