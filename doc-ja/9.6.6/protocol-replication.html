<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>ストリーミングレプリケーションプロトコル</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.5文書"
HREF="index.html"><LINK
REL="UP"
TITLE="フロントエンド/バックエンドプロトコル"
HREF="protocol.html"><LINK
REL="PREVIOUS"
TITLE="メッセージの流れ"
HREF="protocol-flow.html"><LINK
REL="NEXT"
TITLE="メッセージのデータ型"
HREF="protocol-message-types.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2018-02-10T07:29:51"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.5文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="メッセージの流れ"
HREF="protocol-flow.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="protocol.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>第 51章フロントエンド/バックエンドプロトコル</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="メッセージのデータ型"
HREF="protocol-message-types.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PROTOCOL-REPLICATION"
>51.3. ストリーミングレプリケーションプロトコル</A
></H1
><P
>ストリーミングレプリケーションを初期化するために、フロントエンドは開始メッセージにて<TT
CLASS="LITERAL"
>replication</TT
>パラメータを送信します。
ブール値の<TT
CLASS="LITERAL"
>true</TT
>がバックエンドに対して、SQL文ではなく小規模なレプリケーションコマンド群を発行できるようになる、walsenderモードに入るように伝えます。
walsenderモードでは簡易問い合わせプロトコルのみを使用することができます。
<A
HREF="runtime-config-logging.html#GUC-LOG-REPLICATION-COMMANDS"
>log_replication_commands</A
>が有効であれば、レプリケーションコマンドはサーバログにログが残ります。
<TT
CLASS="LITERAL"
>database</TT
>を値として渡すことにより、
<TT
CLASS="LITERAL"
>dbname</TT
>パラメータに指定したデータベースに接続することをwalsenderに教えます。
それにより、そのデータベースからの論理的レプリケーションとして使用する接続が可能となります。</P
><P
>レプリケーションコマンドをテストするために、<TT
CLASS="LITERAL"
>replication</TT
>オプションを含む接続文字列を使用して、<SPAN
CLASS="APPLICATION"
>psql</SPAN
>または他の<TT
CLASS="LITERAL"
>libpq</TT
>によるレプリケーション接続を作成できます。
例を示します。
</P><PRE
CLASS="PROGRAMLISTING"
>psql "dbname=postgres replication=database" -c "IDENTIFY_SYSTEM;"</PRE
><P>
しかし、物理的レプリケーションのために<A
HREF="app-pgreceivexlog.html"
>pg_receivexlog</A
>を使用し、論理的レプリケーションのため<A
HREF="app-pgrecvlogical.html"
><SPAN
CLASS="APPLICATION"
>pg_recvlogical</SPAN
></A
>を使用すれば、もっと有用なことが多いです。</P
><P
>walsenderモードで受け付けられるコマンドは以下の通りです。
<P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>IDENTIFY_SYSTEM</TT
>
     </DT
><DD
><P
>サーバに自身を識別することを要求します。
サーバは以下の４つのフィールドを持つ単一行の結果セットをもって応答します。
     </P
><P
>      <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>systemid</TT
> (<TT
CLASS="TYPE"
>text</TT
>)</DT
><DD
><P
>クラスタを識別する一意なシステム識別子です。
これを使用してスタンバイを初期化するために使用するベースバックアップが同じクラスタに由来していることを検査することができます。
      </P
></DD
><DT
><TT
CLASS="LITERAL"
>timeline</TT
> (<TT
CLASS="TYPE"
>int4</TT
>)</DT
><DD
><P
>現在のタイムラインIDです。
同様にスタンバイがマスタと一貫性を持つことを検査するために使用されます。
      </P
></DD
><DT
><TT
CLASS="LITERAL"
>xlogpos</TT
> (<TT
CLASS="TYPE"
>text</TT
>)</DT
><DD
><P
>現在のxlogの吐き出し位置です。
ストリーミングを開始できるトランザクションログの既知の位置を得る際に有用です。
      </P
></DD
><DT
><TT
CLASS="LITERAL"
>dbname</TT
> (<TT
CLASS="TYPE"
>text</TT
>)</DT
><DD
><P
>接続したデータベース名またはNULLです。
      </P
></DD
></DL
></DIV
><P>
     </P
></DD
><DT
><TT
CLASS="LITERAL"
>TIMELINE_HISTORY</TT
> <TT
CLASS="REPLACEABLE"
><I
>tli</I
></TT
>
     </DT
><DD
><P
><TT
CLASS="REPLACEABLE"
><I
>tli</I
></TT
>のタイムラインのため、サーバにタイムライン履歴ファイルの送付を要求します。
サーバは2列単一行の結果セットを返します。
     </P
><P
>      <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>filename</TT
> (<TT
CLASS="TYPE"
>text</TT
>)</DT
><DD
><P
>タイムライン履歴ファイル名、例えば<TT
CLASS="FILENAME"
>00000002.history</TT
>
      </P
></DD
><DT
><TT
CLASS="LITERAL"
>content</TT
> (<TT
CLASS="TYPE"
>bytea</TT
>)</DT
><DD
><P
>ライムライン履歴ファイルの内容
      </P
></DD
></DL
></DIV
><P>
     </P
></DD
><DT
><TT
CLASS="LITERAL"
>CREATE_REPLICATION_SLOT</TT
> <TT
CLASS="REPLACEABLE"
><I
>slot_name</I
></TT
> { <TT
CLASS="LITERAL"
>PHYSICAL</TT
> [ <TT
CLASS="LITERAL"
>RESERVE_WAL</TT
> ] | <TT
CLASS="LITERAL"
>LOGICAL</TT
> <TT
CLASS="REPLACEABLE"
><I
>output_plugin</I
></TT
> }
     </DT
><DD
><P
>物理的または論理的レプリケーションスロットを作成します。
レプリケーションスロットの詳細は<A
HREF="warm-standby.html#STREAMING-REPLICATION-SLOTS"
>項26.2.6</A
>を参照。
     </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>slot_name</I
></TT
></DT
><DD
><P
>作成するスロット名。
有効なレプリケーションスロット名でなければならない。
（<A
HREF="warm-standby.html#STREAMING-REPLICATION-SLOTS-MANIPULATION"
>項26.2.6.1</A
>を参照）。
         </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>output_plugin</I
></TT
></DT
><DD
><P
>ロジカルデコーディングに使用される出力プラグイン名。
（<A
HREF="logicaldecoding-output-plugin.html"
>項47.6</A
>を参照）。
         </P
></DD
><DT
><TT
CLASS="LITERAL"
>RESERVE_WAL</TT
></DT
><DD
><P
>この物理的レプリケーションスロットが直ちに<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>を予約することを指定します。
そうでなければ、<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>はストリーミングレプリケーションクライアントからの接続に応じてだけ予約されます。
        </P
></DD
></DL
></DIV
></DD
><DT
><TT
CLASS="LITERAL"
>START_REPLICATION</TT
> [ <TT
CLASS="LITERAL"
>SLOT</TT
> <TT
CLASS="REPLACEABLE"
><I
>slot_name</I
></TT
> ] [ <TT
CLASS="LITERAL"
>PHYSICAL</TT
> ] <TT
CLASS="REPLACEABLE"
><I
>XXX/XXX</I
></TT
> [ <TT
CLASS="LITERAL"
>TIMELINE</TT
> <TT
CLASS="REPLACEABLE"
><I
>tli</I
></TT
> ]
     </DT
><DD
><P
>サーバに対して、WALのストリーミングを<TT
CLASS="REPLACEABLE"
><I
>XXX/XXX</I
></TT
> WAL時点から開始するよう指示します。
<TT
CLASS="LITERAL"
>TIMELINE</TT
>オプションが指定された場合、ストリーミングは<TT
CLASS="REPLACEABLE"
><I
>tli</I
></TT
>のタイムラインから開始されます。
そうでなければ、サーバの現在のタイムラインが選択されます。
サーバが、例えば、要求されたWALの断片がすでに回収されているなど、エラーを返すことがありえます。
成功時サーバはCopyBothResponseメッセージで応答し、フロントエンドに対するWALストリームを開始します。
     </P
><P
><TT
CLASS="REPLACEABLE"
><I
>slot_name</I
></TT
>を経由してスロット名が提供された場合、それはレプリケーションの進行として更新されます。
それによってサーバは、どのWALセグメントがまだスタンバイに必要か、<TT
CLASS="VARNAME"
>hot_standby_feedback</TT
>のトランザクションはどれか、を感知します。
     </P
><P
>最新ではなくて、サーバの過去のタイムラインをクライアントが要求した場合、サーバは要求された開始時点から他のタイムラインに切り替えるまでの、全てのWALストリームを送付します。
クライアントが旧タイムラインの終点のストリームを要求した場合、サーバはCOPYモードに入らずにCommandCompleteをすぐに応答します。
     </P
><P
>最新でないタイムラインの全てのWALストリームを送付した後、サーバはCOPYモードを出ることによりストリームを終了します。
クライアントもCOPYモードを出ることにより承認した場合、サーバは2列単一行の結果セットを送付し、サーバにある次のタイムラインを示します。
最初の列は次のタイムラインID(<TT
CLASS="TYPE"
>int8</TT
>型)であり、次の列は切り替えたXLOGの位置(<TT
CLASS="TYPE"
>text</TT
>型)です。
通常切り替えた位置はWALストリームの終点ですが、昇格する前に再実行されなかった旧タイムラインからWALを送付するというまれな場合もあります。
最後に、サーバはCommandCompleteメッセージを送付し、新規のコマンドを受理できるようになります。
     </P
><P
>WALデータはCopyDataメッセージ群として送信されます。
（これにより他の情報を混在させることができます。
具体的にはサーバはストリーム開始後に失敗が起きた場合にErrorResponseメッセージを送信することができます。）
サーバからクライアントへの各CopyDataメッセージのペイロード、は以下の書式のどれかを含みます。
     </P
><P
>      <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>XLogData (B)</DT
><DD
><P
>      <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('w')</DT
><DD
><P
>メッセージをWALデータとして識別します。
      </P
></DD
><DT
>Int64</DT
><DD
><P
>このメッセージ内のWALの開始点。
      </P
></DD
><DT
>Int64</DT
><DD
><P
>サーバ上の現在のWAL終了点。
      </P
></DD
><DT
>Int64</DT
><DD
><P
>転送時点でのサーバのシステム時刻。
2000年1月1日午前0時からのマイクロ秒。
      </P
></DD
><DT
>Byte<TT
CLASS="REPLACEABLE"
><I
>n</I
></TT
></DT
><DD
><P
>WALデータストリームの断片。
      </P
><P
>単一のWALレコードが2つのXLogDataメッセージに分かれることはありません。
しかしWALレコードがWALページ境界を跨る場合、継続レコードを用いてすでに分割されていますので、ページ境界で分割することができます。
言い換えると、先頭の主WALレコードとその継続レコードは、別のXLogDataメッセージとして分かれることがありえます。
      </P
></DD
></DL
></DIV
><P>
      </P
></DD
><DT
>プライマリキープアライブメッセージ(B)</DT
><DD
><P
>      <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('k')</DT
><DD
><P
>このメッセージを送信元キープアライブとして識別します。
      </P
></DD
><DT
>Int64</DT
><DD
><P
>サーバ上の現在のWAL終端。
      </P
></DD
><DT
>Int64</DT
><DD
><P
>転送時点でのサーバのシステム時刻。
2000年1月1日午前0時からのマイクロ秒。
      </P
></DD
><DT
>Byte1</DT
><DD
><P
>タイムアウトによる切断を避けるため、クライアントがこのメッセージに即時に応答するべき方法の1つ。
0またはその他
      </P
></DD
></DL
></DIV
><P>
      </P
></DD
></DL
></DIV
><P>
     </P
><P
>以下のメッセージ書式の1つ（およびCopyDataメッセージのペイロード中のもの）を使用して、受理プロセスは送信者にいつでも応答できます。
     </P
><P
>      <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>スタンバイ状態の更新(F)</DT
><DD
><P
>      <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('r')</DT
><DD
><P
>メッセージを受信側の状態更新として識別します。
      </P
></DD
><DT
>Int64</DT
><DD
><P
>スタンバイにおいて受信しディスクに書き込まれた最終WALバイト+1の場所。
      </P
></DD
><DT
>Int64</DT
><DD
><P
>スタンバイにおいてディスクに吐き出された最終WALバイト+1の場所。
      </P
></DD
><DT
>Int64</DT
><DD
><P
>スタンバイにおいて適用された最終WALバイト+1の場所。
      </P
></DD
><DT
>Int64</DT
><DD
><P
>転送時点でのクライアントのシステム時刻。
2000年1月1日午前0時からのマイクロ秒。
      </P
></DD
><DT
>Byte1</DT
><DD
><P
>値が1の場合、このメッセージにすぐ応答するように、クライアントはサーバへ要求します。
この方法は、接続がまだ保持されているか検査するために、サーバへのピング送信として使用できます。
      </P
></DD
></DL
></DIV
><P>
      </P
></DD
></DL
></DIV
><P>
     </P
><P
>      <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>ホットスタンバイフィードバックメッセージ(F)</DT
><DD
><P
>      <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>Byte1('h')</DT
><DD
><P
>メッセージをホットスタンバイのフィードバックメッセージとして識別します。
      </P
></DD
><DT
>Int64</DT
><DD
><P
>転送時点でのクライアントのシステム時刻。
2000年1月1日午前0時からのマイクロ秒
      </P
></DD
><DT
>Int32</DT
><DD
><P
>スタンバイの現在のxminです。
もはやホットスタンバイフィードバックがこの接続では送信されないという通知を、スタンバイが送信している場合、この値は0でしょう。
後ほど、0でないメッセージがフィードバック機構を再び開始します。
      </P
></DD
><DT
>Int32</DT
><DD
><P
>スタンバイの現在のエポックです。
      </P
></DD
></DL
></DIV
><P>
      </P
></DD
></DL
></DIV
><P>
     </P
></DD
><DT
><TT
CLASS="LITERAL"
>START_REPLICATION</TT
> <TT
CLASS="LITERAL"
>SLOT</TT
> <TT
CLASS="REPLACEABLE"
><I
>slot_name</I
></TT
> <TT
CLASS="LITERAL"
>LOGICAL</TT
> <TT
CLASS="REPLACEABLE"
><I
>XXX/XXX</I
></TT
> [ ( <TT
CLASS="REPLACEABLE"
><I
>option_name</I
></TT
> [ <TT
CLASS="REPLACEABLE"
><I
>option_value</I
></TT
> ] [, ...] ) ]</DT
><DD
><P
>サーバに対して、<TT
CLASS="REPLACEABLE"
><I
>XXX/XXX</I
></TT
>WAL時点から、論理的レプリケーションのWALストリームを開始するよう指示します。
例えば、要求されたWALがすでに回収された場合、サーバはエラーを返します。
サーバが、例えば、要求されたWALセクションがすでに回収されている場合、エラーを返すことがありえます。
成功時サーバはCopyBothResponseメッセージで応答し、フロントエンドに対するWALストリームを開始します。
     </P
><P
>CopyBothResponse内部のメッセージは、<TT
CLASS="LITERAL"
>START_REPLICATION ... PHYSICAL</TT
>の記述と同じ書式です。
     </P
><P
>選択されたスロットに関連した出力プラグインは、出力ストリームの処理に使用されます。
     </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>SLOT</TT
> <TT
CLASS="REPLACEABLE"
><I
>slot_name</I
></TT
></DT
><DD
><P
>ストリームを変更したスロット名。
このパラメータは必須であり、<TT
CLASS="LITERAL"
>LOGICAL</TT
>モードにおいて<TT
CLASS="LITERAL"
>CREATE_REPLICATION_SLOT</TT
>によって作成された、実在する論理的レプリケーションスロットに対応しなければなりません。
         </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>XXX/XXX</I
></TT
></DT
><DD
><P
>ストリームを開始するWAL時点。
        </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>option_name</I
></TT
></DT
><DD
><P
>レプリケーションスロットのロジカルデコーディング出力プラグインに渡すオプション名。
        </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>option_value</I
></TT
></DT
><DD
><P
>オプションの値。
文字列定数の形式。
        </P
></DD
></DL
></DIV
></DD
><DT
><TT
CLASS="LITERAL"
>DROP_REPLICATION_SLOT</TT
> <TT
CLASS="REPLACEABLE"
><I
>slot_name</I
></TT
>
     </DT
><DD
><P
>レプリケーションスロットを削除し、サーバ側で準備した資源を解放します。
実行中の接続に現在スロットが使用中の場合、このコマンドは失敗します。
     </P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>slot_name</I
></TT
></DT
><DD
><P
>削除するスロット名。
         </P
></DD
></DL
></DIV
></DD
><DT
><TT
CLASS="LITERAL"
>BASE_BACKUP</TT
> [ <TT
CLASS="LITERAL"
>LABEL</TT
> <TT
CLASS="REPLACEABLE"
><I
>'label'</I
></TT
> ] [ <TT
CLASS="LITERAL"
>PROGRESS</TT
> ] [ <TT
CLASS="LITERAL"
>FAST</TT
> ] [ <TT
CLASS="LITERAL"
>WAL</TT
> ] [ <TT
CLASS="LITERAL"
>NOWAIT</TT
> ] [ <TT
CLASS="LITERAL"
>MAX_RATE</TT
> <TT
CLASS="REPLACEABLE"
><I
>rate</I
></TT
> ] [ <TT
CLASS="LITERAL"
>TABLESPACE_MAP</TT
> ]
     </DT
><DD
><P
>サーバにベースバックアップのストリーミングを始めるよう指示します。
システムはバックアップが開始される前に自動的にバックアップモードになり、バックアップが完了した時に取り出されます。
以下のオプションを受け付けることができます。
      <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>LABEL</TT
> <TT
CLASS="REPLACEABLE"
><I
>'label'</I
></TT
></DT
><DD
><P
>バックアップのラベルを設定します。
指定がない場合、<TT
CLASS="LITERAL"
>base backup</TT
>というバックアップラベルが使用されます。
ラベルについての引用符付け規則は、<A
HREF="runtime-config-compatible.html#GUC-STANDARD-CONFORMING-STRINGS"
>standard_conforming_strings</A
>を有効にした場合の標準SQLの文字列の規則と同じです。
         </P
></DD
><DT
><TT
CLASS="LITERAL"
>PROGRESS</TT
></DT
><DD
><P
>進行状況の報告を生成するために必要な情報を要求します。
これは、ストリームが完了するまでにどのくらいかかるかを計算するために使用することができる、各テーブル空間のヘッダ内の概算容量を返送します。
これは、転送を始める前のすべてのファイルサイズを１度数え上げることで計算されます。
これ自体が性能に与える悪影響があるかもしれません。
特に最初のデータがストリームされるまでにより多くの時間がかかる可能性があります。
データベースファイルはバックアップの間変更される可能性がありますので、容量は概算に過ぎず、概算時と実ファイルを送信するまでの間に増減される可能性があります。
         </P
></DD
><DT
><TT
CLASS="LITERAL"
>FAST</TT
></DT
><DD
><P
>高速チェックポイントを要求します。
         </P
></DD
><DT
><TT
CLASS="LITERAL"
>WAL</TT
></DT
><DD
><P
>バックアップ内に必要なWALセグメントを含めます。
ベースディレクトリtarファイルの<TT
CLASS="FILENAME"
>pg_xlog</TT
>ディレクトリにある、バックアップの開始から終了までのすべてのファイルが含まれます。
         </P
></DD
><DT
><TT
CLASS="LITERAL"
>NOWAIT</TT
></DT
><DD
><P
>デフォルトでは、バックアップは必要な最終WALセグメントがアーカイブされるまで待機します。
ログアーカイブが有効でない場合は警告が発せられます。
<TT
CLASS="LITERAL"
>NOWAIT</TT
>により、必要なログが利用できるようになったことを確認することをクライアント側の責任として、この待機や警告が無効になります。
         </P
></DD
><DT
><TT
CLASS="LITERAL"
>MAX_RATE</TT
> <TT
CLASS="REPLACEABLE"
><I
>rate</I
></TT
></DT
><DD
><P
>サーバからクライアントへ転送する単位時間当たりの最大データ容量を制限します（絞ります）。
予期される単位はkB/s（キロバイト/秒）です。
このオプションが指定された場合、値はゼロまたは32 kB以上1 GB以下でなければなりません。
ゼロが渡されるかオプションが指定されない場合、転送の制約は課されません。
         </P
></DD
><DT
><TT
CLASS="LITERAL"
>TABLESPACE_MAP</TT
></DT
><DD
><P
>ディレクトリ<TT
CLASS="FILENAME"
>pg_tblspc</TT
>にあるシンボリックリンクに関する情報を<TT
CLASS="FILENAME"
>tablespace_map</TT
>という名前のファイルに含めます。
テーブル空間マップファイルには、ディレクトリ<TT
CLASS="FILENAME"
>pg_tblspc/</TT
>に存在する各シンボリックリンクの名前とそのシンボリックリンクのフルパスが含まれています。
         </P
></DD
></DL
></DIV
><P>
     </P
><P
>バックアップを開始する時、サーバはまず２つの通常の結果セットを送信し、続けて１つ以上のCopyResponse結果を送信します。
     </P
><P
>最初の通常の結果セットには、1行2列という形でバックアップの開始位置が含まれます。
最初の列にはXLogRecPtr書式の開始位置が、2番目の列には対応するタイムラインIDが含まれます。
     </P
><P
>２番目の通常の結果セットには各テーブル空間に付き１行を持ちます。
この行のフィールドは以下の通りです。
      <P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>spcoid</TT
> (<TT
CLASS="TYPE"
>oid</TT
>)</DT
><DD
><P
>テーブル空間のOIDです。
ベースディレクトリの場合はNULLです。
         </P
></DD
><DT
><TT
CLASS="LITERAL"
>spclocation</TT
> (<TT
CLASS="TYPE"
>text</TT
>)</DT
><DD
><P
>テーブル空間ディレクトリのフルパスです。
ベースディレクトリの場合はNULLです。
         </P
></DD
><DT
><TT
CLASS="LITERAL"
>size</TT
> (<TT
CLASS="TYPE"
>int8</TT
>)</DT
><DD
><P
>進行状況報告が要求された場合は、テーブル空間の概算容量です。
要求されていない場合はNULLです。
         </P
></DD
></DL
></DIV
><P>
     </P
><P
>２番目の通常の結果セットの後、１つ以上のCopyResponse結果が送信されます。
主データディレクトリ用に1つ、<TT
CLASS="LITERAL"
>pg_default</TT
>、<TT
CLASS="LITERAL"
>pg_global</TT
>以外の追加のテーブル空間ごとに1つ送信されます。
CopyResponse結果内のデータは、テーブル空間の内容のtar形式（POSIX 1003.1-2008標準で規定された<SPAN
CLASS="QUOTE"
>"ustar交換形式"</SPAN
>に従う）ダンプです。
ただし標準で規定された最後の２つのゼロブロックは省略されています。
このtarデータが終わった後、最終の通常結果セットが送信されます。
結果セットには、開始位置と同じ書式のバックアップのWAL終了位置が含まれます。
     </P
><P
>データディレクトリと各テーブル空間のtarアーカイブには、そのディレクトリ内のファイルが<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>ファイルかそのディレクトリに追加された他のファイルかに関係なく、すべて含まれます。
以下に除かれるファイルを示します。
      <P
></P
></P><UL
COMPACT="COMPACT"
><LI
STYLE="list-style-type: disc"
><P
>         <TT
CLASS="FILENAME"
>postmaster.pid</TT
>
        </P
></LI
><LI
STYLE="list-style-type: disc"
><P
>         <TT
CLASS="FILENAME"
>postmaster.opts</TT
>
        </P
></LI
><LI
STYLE="list-style-type: disc"
><P
>PostgreSQLサーバの操作中に、種々の一時ファイルが作成されます。
        </P
></LI
><LI
STYLE="list-style-type: disc"
><P
>サブディレクトリを含む<TT
CLASS="FILENAME"
>pg_xlog</TT
>。
バックアップがwalファイルを含めて実行される場合、合成された版の<TT
CLASS="FILENAME"
>pg_xlog</TT
>が含まれます。
これにはバックアップが動作するために必要なファイルのみが含まれ、残りの内容は含まれません。
        </P
></LI
><LI
STYLE="list-style-type: disc"
><P
><TT
CLASS="FILENAME"
>pg_replslot</TT
>が空ディレクトリとしてコピーされます。
        </P
></LI
><LI
STYLE="list-style-type: disc"
><P
>通常のファイルとディレクトリ以外のもの、シンボリックリンクや特殊なデバイスファイルは省略されます。
（<TT
CLASS="FILENAME"
>pg_tblspc</TT
>中のシンボリックリンクは保持されます。）
        </P
></LI
></UL
><P>
サーバ上の基盤となるファイルシステムがサポートする場合、所有者、グループ、ファイルのモードが設定されます。
     </P
></DD
></DL
></DIV
><P>&#13;</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="protocol-flow.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="protocol-message-types.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>メッセージの流れ</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="protocol.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>メッセージのデータ型</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>