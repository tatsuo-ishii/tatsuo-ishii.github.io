<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>CREATE SEQUENCE</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.5文書"
HREF="index.html"><LINK
REL="UP"
TITLE="SQLコマンド"
HREF="sql-commands.html"><LINK
REL="PREVIOUS"
TITLE="CREATE SCHEMA"
HREF="sql-createschema.html"><LINK
REL="NEXT"
TITLE="CREATE SERVER"
HREF="sql-createserver.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2018-02-10T07:29:51"></HEAD
><BODY
CLASS="REFENTRY"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.5文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="CREATE SCHEMA"
HREF="sql-createschema.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="sql-commands.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="CREATE SERVER"
HREF="sql-createserver.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="SQL-CREATESEQUENCE"
></A
>CREATE SEQUENCE</H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN81796"
></A
><H2
>名前</H2
>CREATE SEQUENCE&nbsp;--&nbsp;新しいシーケンスジェネレータを定義する</DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN81799"
></A
><H2
>概要</H2
><PRE
CLASS="SYNOPSIS"
>CREATE [ TEMPORARY | TEMP ] SEQUENCE [ IF NOT EXISTS ] <TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
> [ INCREMENT [ BY ] <TT
CLASS="REPLACEABLE"
><I
>increment</I
></TT
> ]
    [ MINVALUE <TT
CLASS="REPLACEABLE"
><I
>minvalue</I
></TT
> | NO MINVALUE ] [ MAXVALUE <TT
CLASS="REPLACEABLE"
><I
>maxvalue</I
></TT
> | NO MAXVALUE ]
    [ START [ WITH ] <TT
CLASS="REPLACEABLE"
><I
>start</I
></TT
> ] [ CACHE <TT
CLASS="REPLACEABLE"
><I
>cache</I
></TT
> ] [ [ NO ] CYCLE ]
    [ OWNED BY { <TT
CLASS="REPLACEABLE"
><I
>table_name</I
></TT
>.<TT
CLASS="REPLACEABLE"
><I
>column_name</I
></TT
> | NONE } ]</PRE
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN81809"
></A
><H2
>説明</H2
><P
><TT
CLASS="COMMAND"
>CREATE SEQUENCE</TT
>は、新しいシーケンス番号ジェネレータを作成します。
これには、新しく<TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
>という名前を持つ、1行だけの特殊なテーブルの作成と初期化が含まれます。
シーケンスジェネレータは、このコマンドを実行したユーザによって所有されます。
  </P
><P
>スキーマ名が与えられている場合、そのシーケンスは指定されたスキーマに作成されます。
スキーマ名がなければ、シーケンスは現在のスキーマに作成されます。
また、一時シーケンスは特別なスキーマに存在するため、一時シーケンスの作成時にスキーマ名を与えることはできません。
シーケンス名は、同じスキーマ内の他のシーケンス、テーブル、インデックス、ビュー、外部テーブルとは異なる名前にする必要があります。
  </P
><P
>シーケンスを作成した後、<CODE
CLASS="FUNCTION"
>nextval</CODE
>、<CODE
CLASS="FUNCTION"
>currval</CODE
>、<CODE
CLASS="FUNCTION"
>setval</CODE
>関数を使用してシーケンスを操作します。
これらの関数については<A
HREF="functions-sequence.html"
>項9.16</A
>を参照してください。
  </P
><P
>シーケンスを直接更新することはできませんが、以下のような問い合わせは可能です。

</P><PRE
CLASS="PROGRAMLISTING"
>SELECT * FROM <TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
>;</PRE
><P>

これを使用すると、シーケンスのパラメータと現在の状態を確認することができます。
中でも、シーケンスの<TT
CLASS="LITERAL"
>last_value</TT
>フィールドは全てのセッションで割り当てられた最後の値を示します
（もちろんこの値は、他のセッションの<CODE
CLASS="FUNCTION"
>nextval</CODE
>の実行により、表示された時点で既に最新ではない可能性があります）。
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN81825"
></A
><H2
>パラメータ</H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>TEMPORARY</TT
>もしくは<TT
CLASS="LITERAL"
>TEMP</TT
></DT
><DD
><P
>このパラメータが指定された場合、作成するシーケンスオブジェクトがそのセッション専用となり、セッション終了時に自動的に削除されます。
一時シーケンスが存在する場合、同じ名前を持つ既存の永続シーケンスは、スキーマ修飾された名前で参照されない限り、（そのセッションでは）不可視になります。
     </P
></DD
><DT
><TT
CLASS="LITERAL"
>IF NOT EXISTS</TT
></DT
><DD
><P
>同じ名前のリレーションが既に存在する場合にエラーとしません。
この場合、注意が発行されます。
既存のリレーションが、作成されようとしていたシーケンスと類似のものであることは全く保証されないことに注意してください。
それはシーケンスでさえ、ないかもしれません。
     </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
></DT
><DD
><P
>作成するシーケンスの名前です（スキーマ修飾名も可）。
     </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>increment</I
></TT
></DT
><DD
><P
><TT
CLASS="LITERAL"
>INCREMENT BY <TT
CLASS="REPLACEABLE"
><I
>increment</I
></TT
></TT
>句は、現在のシーケンスの値から新しいシーケンス値を作成する際の値の増加量を設定します。この句は省略可能です。
正の値が指定された時は昇順のシーケンス、負の値が指定された時は降順のシーケンスを作成します。
指定がない場合のデフォルト値は1です。
     </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>minvalue</I
></TT
><BR><TT
CLASS="LITERAL"
>NO MINVALUE</TT
></DT
><DD
><P
><TT
CLASS="LITERAL"
>MINVALUE <TT
CLASS="REPLACEABLE"
><I
>minvalue</I
></TT
></TT
>句は、シーケンスとして作成する最小値を指定します。この句は省略可能です。
この句の指定されなかった場合、もしくは、<TT
CLASS="OPTION"
>NO MINVALUE</TT
>が指定された場合、デフォルトが使用されます。
シーケンスのデフォルトの最小値は、昇順の時は1、降順の時は-(2<SUP
>63</SUP
>-1)です。
     </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>maxvalue</I
></TT
><BR><TT
CLASS="LITERAL"
>NO MAXVALUE</TT
></DT
><DD
><P
><TT
CLASS="LITERAL"
>MAXVALUE <TT
CLASS="REPLACEABLE"
><I
>maxvalue</I
></TT
></TT
>句は、シーケンスの最大値を決定します。この句は省略可能です。
この句が指定されなかった場合、もしくは<TT
CLASS="OPTION"
>NO MAXVALUE</TT
>が指定された場合、デフォルトが使用されます。
シーケンスのデフォルトの最大値は、昇順の時は2<SUP
>63</SUP
>-1、降順の時は-1です。
     </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>start</I
></TT
></DT
><DD
><P
><TT
CLASS="LITERAL"
>START WITH <TT
CLASS="REPLACEABLE"
><I
>start</I
></TT
></TT
>句を使用すると、任意の数からシーケンス番号を開始することができます。この句は省略可能です。
デフォルトでは、シーケンス番号が始まる値は、昇順の場合<TT
CLASS="REPLACEABLE"
><I
>minvalue</I
></TT
>、降順の場合<TT
CLASS="REPLACEABLE"
><I
>maxvalue</I
></TT
>になります。
     </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>cache</I
></TT
></DT
><DD
><P
><TT
CLASS="LITERAL"
>CACHE <TT
CLASS="REPLACEABLE"
><I
>cache</I
></TT
></TT
>オプションは、あらかじめ番号を割り当て、メモリに格納しておくシーケンス番号の量を指定します。これによりアクセスを高速にすることができます。
最小値は1です（一度に生成する値が1つだけなので、キャッシュがない状態になります）。これがデフォルトになっています。
     </P
></DD
><DT
><TT
CLASS="LITERAL"
>CYCLE</TT
><BR><TT
CLASS="LITERAL"
>NO CYCLE</TT
></DT
><DD
><P
><TT
CLASS="LITERAL"
>CYCLE</TT
>オプションを使用すると、シーケンスが限界値（昇順の場合は<TT
CLASS="REPLACEABLE"
><I
>maxvalue</I
></TT
>、降順の場合は<TT
CLASS="REPLACEABLE"
><I
>minvalue</I
></TT
>）に達した時、そのシーケンスを周回させることができます。
限界値まで達した時、次に生成される番号は、昇順の場合は<TT
CLASS="REPLACEABLE"
><I
>minvalue</I
></TT
>、降順の場合は<TT
CLASS="REPLACEABLE"
><I
>maxvalue</I
></TT
>になります。
     </P
><P
><TT
CLASS="LITERAL"
>NO CYCLE</TT
>が指定された場合、シーケンスの限界値に達した後の<CODE
CLASS="FUNCTION"
>nextval</CODE
>呼び出しは全てエラーになります。
<TT
CLASS="LITERAL"
>CYCLE</TT
>も<TT
CLASS="LITERAL"
>NO CYCLE</TT
>も指定されていない場合は、<TT
CLASS="LITERAL"
>NO CYCLE</TT
>がデフォルトとなります。
     </P
></DD
><DT
><TT
CLASS="LITERAL"
>OWNED BY</TT
> <TT
CLASS="REPLACEABLE"
><I
>table_name</I
></TT
>.<TT
CLASS="REPLACEABLE"
><I
>column_name</I
></TT
><BR><TT
CLASS="LITERAL"
>OWNED BY NONE</TT
></DT
><DD
><P
><TT
CLASS="LITERAL"
>OWNED BY</TT
>オプションにより、シーケンスは指定されたテーブル列に関連付けられ、その列（やテーブル全体）が削除されると、自動的にシーケンスも一緒に削除されるようになります。
指定するテーブルは、シーケンスと同一所有者でなければならず、また、同一のスキーマ内に存在しなければなりません。
デフォルトは<TT
CLASS="LITERAL"
>OWNED BY NONE</TT
>であり、こうした関連付けがないことを示します。
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN81918"
></A
><H2
>注釈</H2
><P
>シーケンスを削除するには<TT
CLASS="COMMAND"
>DROP SEQUENCE</TT
>を使用してください。
  </P
><P
>シーケンスは<TT
CLASS="TYPE"
>bigint</TT
>演算に基づいています。
そのため、8バイト整数の範囲（-9223372036854775808から9223372036854775807まで）を越えることはできません。
  </P
><P
><CODE
CLASS="FUNCTION"
>nextval</CODE
>と<CODE
CLASS="FUNCTION"
>setval</CODE
>の呼び出しは決してロールバックされないので、シーケンスの番号について<SPAN
CLASS="QUOTE"
>"欠番のない"</SPAN
>割り当てが必要な場合には、シーケンスオブジェクトを使うことはできません。
カウンターを含むテーブルに対して排他ロックを使うことで、欠番のない割り当てを構築することは可能ですが、この解決策はシーケンスオブジェクトに比べてずっと高価で、特に多くのトランザクションが同時にシーケンスの番号を必要とする場合は高価になります。
  </P
><P
>シーケンスオブジェクトの<TT
CLASS="REPLACEABLE"
><I
>cache</I
></TT
>として1より大きな値を設定した場合、そのシーケンスを複数のセッションで同時に使用すると、予想外の結果になる可能性があります。
各セッションは、シーケンスオブジェクトへの1回のアクセスの間に、連続するシーケンス値を取得し、キャッシュします。
そして、キャッシュした数に応じて、シーケンスオブジェクトの<TT
CLASS="LITERAL"
>last_value</TT
>を増加させます。
この場合、そのセッションは、その後の<TT
CLASS="REPLACEABLE"
><I
>cache</I
></TT
>-1回に対しては、あらかじめ取得済みのシーケンス値を返し、シーケンスオブジェクトを変更しません。
セッションに割り当てられたが使用されなかったシーケンス番号は、セッションの終了時に全て失われるため、結果としてシーケンスに<SPAN
CLASS="QUOTE"
>"穴"</SPAN
>ができます。
  </P
><P
>さらに、複数のセッションには異なるシーケンス値が割り当てられることが保証されていますが、全てのセッションが尊重されると、シーケンス値が順番通りにならないことがあります。
例えば、<TT
CLASS="REPLACEABLE"
><I
>cache</I
></TT
>が10の場合を考えます。
セッションAでは1から10までを確保し、<CODE
CLASS="FUNCTION"
>nextval</CODE
>=1を返します。
セッションBでは、セッションAが<CODE
CLASS="FUNCTION"
>nextval</CODE
>=2を返す前に、11から20を確保し、<CODE
CLASS="FUNCTION"
>nextval</CODE
>=11を返します。
したがって、<TT
CLASS="REPLACEABLE"
><I
>cache</I
></TT
>を1に設定した場合は<CODE
CLASS="FUNCTION"
>nextval</CODE
>が順番に生成される値であると考えても問題ありませんが、<TT
CLASS="REPLACEABLE"
><I
>cache</I
></TT
>を1より大きな値に設定した場合は、<CODE
CLASS="FUNCTION"
>nextval</CODE
>の値が全て異なることのみが保証され、順番に生成される値であることは保証されません。
また、<TT
CLASS="LITERAL"
>last_value</TT
>は、値が<CODE
CLASS="FUNCTION"
>nextval</CODE
>によって返されたかどうかに関係なく、いずれかのセッションによって確保された最後の値となります。
  </P
><P
>この他、このようなシーケンスに対して<CODE
CLASS="FUNCTION"
>setval</CODE
>が実行されても、他のセッションは、それぞれがキャッシュした取得済みの値を全て使い果たすまで、それがわからないことも考慮すべき問題です。
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN81946"
></A
><H2
>例</H2
><P
>101から始まる<TT
CLASS="LITERAL"
>serial</TT
>という名前の昇順シーケンスを作成します。
</P><PRE
CLASS="PROGRAMLISTING"
>CREATE SEQUENCE serial START 101;</PRE
><P>
  </P
><P
>このシーケンスから次の番号を選択します。
</P><PRE
CLASS="PROGRAMLISTING"
>SELECT nextval('serial');

 nextval
---------
     101</PRE
><P>
  </P
><P
>このシーケンスから次の番号を選択します。
</P><PRE
CLASS="PROGRAMLISTING"
>SELECT nextval('serial');

 nextval
---------
     102</PRE
><P>
  </P
><P
>このシーケンスを<TT
CLASS="COMMAND"
>INSERT</TT
>コマンドで使用します。
</P><PRE
CLASS="PROGRAMLISTING"
>INSERT INTO distributors VALUES (nextval('serial'), 'nothing');</PRE
><P>
  </P
><P
><TT
CLASS="COMMAND"
>COPY FROM</TT
>の後でシーケンス値を更新します。
</P><PRE
CLASS="PROGRAMLISTING"
>BEGIN;
COPY distributors FROM 'input_file';
SELECT setval('serial', max(id)) FROM distributors;
END;</PRE
><P></P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN81961"
></A
><H2
>互換性</H2
><P
>以下の例外を除き、<TT
CLASS="COMMAND"
>CREATE SEQUENCE</TT
>は標準<ACRONYM
CLASS="ACRONYM"
>SQL</ACRONYM
>に従います。
   <P
></P
></P><UL
><LI
><P
>標準における<TT
CLASS="LITERAL"
>AS <TT
CLASS="REPLACEABLE"
><I
>data_type</I
></TT
></TT
>式はサポートされていません。
     </P
></LI
><LI
><P
>次の値を取り出すには、標準の<TT
CLASS="COMMAND"
>NEXT VALUE FOR</TT
>式ではなく<CODE
CLASS="FUNCTION"
>nextval()</CODE
>関数を使用します。
     </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>OWNED BY</TT
>句は<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>の拡張です。
     </P
></LI
></UL
><P></P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN81979"
></A
><H2
>関連項目</H2
><A
HREF="sql-altersequence.html"
>ALTER SEQUENCE</A
>, <A
HREF="sql-dropsequence.html"
>DROP SEQUENCE</A
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sql-createschema.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sql-createserver.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>CREATE SCHEMA</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sql-commands.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>CREATE SERVER</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>