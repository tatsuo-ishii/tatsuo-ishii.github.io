<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>プロトコル2.0からの変更点の要約</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.5文書"
HREF="index.html"><LINK
REL="UP"
TITLE="フロントエンド/バックエンドプロトコル"
HREF="protocol.html"><LINK
REL="PREVIOUS"
TITLE="エラーおよび警報メッセージフィールド"
HREF="protocol-error-fields.html"><LINK
REL="NEXT"
TITLE="PostgreSQLコーディング規約"
HREF="source.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2018-02-10T07:29:51"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.5文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="エラーおよび警報メッセージフィールド"
HREF="protocol-error-fields.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="protocol.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>第 51章フロントエンド/バックエンドプロトコル</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="PostgreSQLコーディング規約"
HREF="source.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PROTOCOL-CHANGES"
>51.7. プロトコル2.0からの変更点の要約</A
></H1
><P
>本節では、既存のクライアントライブラリをプロトコル3.0に更新しようとする開発者向けに、変更点の簡易チェックリストを示します。</P
><P
>最初の開始パケットは、固定書式ではなく、柔軟な文字列のリスト書式を使用します。
実行時パラメータのセッションのデフォルト値が直接開始パケット内に指定できるようになった点に注意してください。
（実際、以前でも<TT
CLASS="LITERAL"
>options</TT
>フィールドを使用してこれを行うことができましたが、<TT
CLASS="LITERAL"
>options</TT
>には長さに制限があること、および値内の空白文字を引用符でくくる方法がないことから、あまり安全な技法ではありませんでした。）</P
><P
>すべてのメッセージが、メッセージ種類バイトの直後にバイト数を持つようになりました
（種類バイトがない開始パケットは例外です）。
また、PasswordMessageが種類バイトを持つようになったことにも注意してください。</P
><P
>ErrorResponseおよびNoticeResponse（'<TT
CLASS="LITERAL"
>E</TT
>'および'<TT
CLASS="LITERAL"
>N</TT
>'）メッセージが複数のフィールドを持つようになりました。
これを使用して、クライアントコードは、必要な冗長度に合わせて、エラーメッセージを組み立てることができます。
個々のフィールドが通常改行で終わらないことに注意してください。
単一の文字列を送信する古いプロトコルでは、常に改行で終わっていました。</P
><P
>ReadyForQuery（'<TT
CLASS="LITERAL"
>Z</TT
>'）メッセージに、トランザクション状態指示子が含まれます。</P
><P
>BinaryRowとDataRowメッセージ種類間の区別がなくなりました。
1つのDataRowメッセージ種類で、すべての書式で記述されたデータを返すことができます。
DataRowのレイアウトが解析しやすいように変更されたことに注意してください。
またバイナリ値の表現も変更されました。
もはやサーバの内部表現に直接束縛されません。</P
><P
>新しい<SPAN
CLASS="QUOTE"
>"拡張問い合わせ"</SPAN
>サブプロトコルがあります。
これにより、フロントエンドメッセージ種類にParse、Execute、Describe、Close、Flush、およびSyncが、バックエンドメッセージ種類にParseComplete、BindComplete、PortalSuspended、ParameterDescription、NoData、およびCloseCompleteが追加されました。
既存のクライアントは、このサブプロトコルを意識する必要はありませんが、これを使用することで、性能や機能を向上させることができます。</P
><P
><TT
CLASS="COMMAND"
>COPY</TT
>データがCopyDataとCopyDoneメッセージにカプセル化されるようになりました。
<TT
CLASS="COMMAND"
>COPY</TT
>中のエラーから復旧するための十分に定義された方法があります。
特別な<SPAN
CLASS="QUOTE"
>"<TT
CLASS="LITERAL"
>\.</TT
>"</SPAN
>という最後の行はもはや不要で、<TT
CLASS="COMMAND"
>COPY OUT</TT
>で送信されません。
（<TT
CLASS="COMMAND"
>COPY IN</TT
>ではまだ終端として認識されます。しかし、この使用は廃止予定で、最終的には削除されます。）
バイナリ<TT
CLASS="COMMAND"
>COPY</TT
>がサポートされます。
CopyInResponseとCopyOutResponseメッセージは、列数と各列の書式を示すフィールドが含まれます。</P
><P
>FunctionCallとFunctionCallResponseメッセージのレイアウトが変更されました。
FunctionCallは関数へのNULL引数を渡すことができるようになりました。
また、テキストとバイナリ書式のどちらでもパラメータの引き渡しと結果の取り出しを扱うことができます。
サーバの内部データ表現への直接アクセスを提供しなくなりましたので、FunctionCallを潜在的なセキュリティホールとみなす理由はもはやありません。</P
><P
>バックエンドは、接続開始時にクライアントライブラリが興味を持つとみなされるすべてのパラメータのためにParameterStatus（'<TT
CLASS="LITERAL"
>S</TT
>'）メッセージを送信します。
その後、これらのパラメータのいずれかの実際の値が変更された時は常に、ParameterStatusメッセージが送信されます。</P
><P
>RowDescription（'<TT
CLASS="LITERAL"
>T</TT
>'）メッセージは、新規に、記述する各列に対してテーブルのOIDと列番号フィールドを伝えます。
また各列の書式コードも示します。</P
><P
>CursorResponse（'<TT
CLASS="LITERAL"
>P</TT
>'）メッセージはもはやバックエンドで生成されません。</P
><P
>NotificationResponse（'<TT
CLASS="LITERAL"
>A</TT
>'）メッセージは、<TT
CLASS="COMMAND"
>NOTIFY</TT
>イベントの送信者から渡される<SPAN
CLASS="QUOTE"
>"ペイロード"</SPAN
>文字列を伝えることができる追加文字列フィールドを持ちます。</P
><P
>EmptyQueryResponse（'<TT
CLASS="LITERAL"
>I</TT
>'）メッセージは、空の文字列パラメータを含めるために使用されていました。
これは削除されました。</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="protocol-error-fields.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="source.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>エラーおよび警報メッセージフィールド</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="protocol.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>PostgreSQLコーディング規約</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>