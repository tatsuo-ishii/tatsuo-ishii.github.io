<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>エクゼキュータ</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.5文書"
HREF="index.html"><LINK
REL="UP"
TITLE="PostgreSQL内部の概要"
HREF="overview.html"><LINK
REL="PREVIOUS"
TITLE="プランナ/オプティマイザ"
HREF="planner-optimizer.html"><LINK
REL="NEXT"
TITLE="システムカタログ"
HREF="catalogs.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2018-02-10T07:29:51"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.5文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="プランナ/オプティマイザ"
HREF="planner-optimizer.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="overview.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>第 49章PostgreSQL内部の概要</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="システムカタログ"
HREF="catalogs.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="EXECUTOR"
>49.6. エクゼキュータ</A
></H1
><P
><I
CLASS="FIRSTTERM"
>エクゼキュータ</I
>は、プランナ/オプティマイザで作成された計画を受け取り、必要な行の集合を抽出するために再帰的に処理します。
これは本質的に要求引き寄せ型（demand-pull）パイプライン機能です。
計画ノードが呼ばれる度にもう1つの行を引き渡すか、行を引き渡したことの報告を行わなければなりません。
   </P
><P
>具体的な例を提供する目的で頂点のノードが<TT
CLASS="LITERAL"
>MergeJoin</TT
>ノードである場合を想定しましょう。
いかなるマージも実行される前に（それぞれの副計画から1つずつ）2つの行を取ってこなくてはいけません。
ですからエクゼキュータは副計画を処理するために自分自身を再帰的に呼び出します（<TT
CLASS="LITERAL"
>lefttree</TT
>に付随する副計画から開始します）。
新しい頂点のノード（左の副計画の頂点のノード）は<TT
CLASS="LITERAL"
>Sort</TT
>ノードであるとしましょう。ここでもノード自体が処理される前に入力行を取ってこなくてはいけません。
<TT
CLASS="LITERAL"
>Sort</TT
>の子ノードは実際のテーブルの読み取りを表現している<TT
CLASS="LITERAL"
>SeqScan</TT
>ノードのこともあり得ます。
このノードの処理はエクゼキュータにテーブルから行を抽出させ、呼び出しているノードに渡し戻させます。
<TT
CLASS="LITERAL"
>Sort</TT
>ノードはソート対象の全てのノードを取得するために子ノードを繰り返し呼び出します。
入力がなくなった時（子ノードが行ではなくNULLを返してきた時）<TT
CLASS="LITERAL"
>Sort</TT
>コードがソートを実行して最終的に最初の出力行を返すことができるようになります。
つまりソート順における最初の結果です。
後での要求に答えるためソート順に引き渡すことができるように残っている行は保存されます。
   </P
><P
><TT
CLASS="LITERAL"
>MergeJoin</TT
>ノードは同じようにしてその右副計画から最初の行を要求します。
そこで2つの行が結合できるかどうか比較されます。もし結合できる場合には呼び出し側に結合された行が返されます。
次の呼び出しの時に、もしくは入力された現在の組み合わせが結合できない場合はすぐに、あるテーブルあるいはそれ以外のテーブル（比較の結果に依存して）の次の行に進んで、さらに一致があるかどうか検証されます。
最終的にはある副計画もしくは他の計画が使いきられ、<TT
CLASS="LITERAL"
>MergeJoin</TT
>ノードがこれ以上の結合行を生成できないという意味のNULLを返すことになります。
   </P
><P
>複雑な問い合わせは多くの階層となった計画ノードに関わるかもしれませんが、概略的な取り扱い方は同じです。
それぞれのノードは呼び出される度に次の出力行を計算して返します。
それぞれのノードは同時にプランナによって割り当てられたいかなる選択式や射影式でも適用する責任があります。
   </P
><P
>エクゼキュータ機構は全ての4つの基本的なSQL型を検証するために用いられます。
4つのSQL型とは<TT
CLASS="COMMAND"
>SELECT</TT
>、<TT
CLASS="COMMAND"
>INSERT</TT
>、<TT
CLASS="COMMAND"
>UPDATE</TT
>、そして<TT
CLASS="COMMAND"
>DELETE</TT
>です。
<TT
CLASS="COMMAND"
>SELECT</TT
>では、最上位階層のエクゼキュータコードは問い合わせ計画によって返されるそれぞれの行をクライアントへ送り返すだけでよいことになっています。
<TT
CLASS="COMMAND"
>INSERT</TT
>では、<TT
CLASS="COMMAND"
>INSERT</TT
>で指定された対象となるテーブルに返された行が挿入されます。
これは<TT
CLASS="LITERAL"
>ModifyTable</TT
>と呼ばれる特別な最上位階層の計画ノードの中で行われます。
（ある単純な<TT
CLASS="COMMAND"
>INSERT ... VALUES</TT
>コマンドは1つの<TT
CLASS="LITERAL"
>Result</TT
>ノード（これは、結果としての行を1つだけ計算するに留まります）とその上の挿入を実行するための<TT
CLASS="LITERAL"
>ModifyTable</TT
>からなる単純な計画ツリーを生成します。
しかし、<TT
CLASS="COMMAND"
>INSERT ... SELECT</TT
>はエクゼキュータ機構ができ得る限りの能力を発揮することを要求する場合があります）。
<TT
CLASS="COMMAND"
>UPDATE</TT
>ではプランナはすべての更新された列の値を含んだ行の演算結果と<I
CLASS="FIRSTTERM"
>TID</I
>（タプルID、または行ID）を準備します。
このデータは<TT
CLASS="LITERAL"
>ModifyTable</TT
>ノードに入力され、ノードでは新しく更新された行の作成と削除された古い行に印を付けるためこの情報を利用します。
<TT
CLASS="COMMAND"
>DELETE</TT
>では計画から実際に返されるただ1つの列はTIDで、<TT
CLASS="LITERAL"
>ModifyTable</TT
>ノードは単に各対象行を尋ね当てて削除の印を付けるためにこのTIDを使用します。
   </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="planner-optimizer.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="catalogs.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>プランナ/オプティマイザ</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="overview.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>システムカタログ</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>