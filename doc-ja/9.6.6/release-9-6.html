<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>リリース9.6</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.5文書"
HREF="index.html"><LINK
REL="UP"
TITLE="リリースノート"
HREF="release.html"><LINK
REL="PREVIOUS"
TITLE="リリース9.6.1"
HREF="release-9-6-1.html"><LINK
REL="NEXT"
TITLE="リリース9.5.9"
HREF="release-9-5-9.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2018-02-10T07:29:51"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.5文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="リリース9.6.1"
HREF="release-9-6-1.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="release.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>付録 E. リリースノート</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="リリース9.5.9"
HREF="release-9-5-9.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="RELEASE-9-6"
>E.6. リリース9.6</A
></H1
><DIV
CLASS="FORMALPARA"
><P
><B
>Release date: </B
>2016-09-29</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN131601"
>E.6.1. 概要</A
></H2
><P
>    <SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>9.6の主な強化点には以下のものがあります。
   </P
><P
></P
><UL
><LI
><P
>シーケンシャルスキャン、結合、集約の並列実行
     </P
></LI
><LI
><P
>バキューム凍結処理で不要なページスキャンを回避しました
     </P
></LI
><LI
><P
>同期レプリケーションで信頼性向上のための複数スタンバイサーバが可能になりました
     </P
></LI
><LI
><P
>全文検索でフレーズ（隣接した複数単語）を検索できるようになりました
     </P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>postgres_fdw</TT
>がリモートでの結合、ソート、<TT
CLASS="COMMAND"
>UPDATE</TT
>、<TT
CLASS="COMMAND"
>DELETE</TT
>に対応しました
     </P
></LI
><LI
><P
>特にマルチ<TT
CLASS="LITERAL"
>CPU</TT
>ソケットサーバでのスケーラビリティの領域における、相当な性能改善をしました
     </P
></LI
></UL
><P
>上記の項目について以下でより詳細に説明します。
   </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN131623"
>E.6.2. バージョン9.6への移行</A
></H2
><P
>以前のリリースからデータを移行したい時は、どのリリースについても、
<A
HREF="app-pg-dumpall.html"
><SPAN
CLASS="APPLICATION"
>pg_dumpall</SPAN
></A
>を利用したダンプとリストア、
あるいは<A
HREF="pgupgrade.html"
><SPAN
CLASS="APPLICATION"
>pg_upgrade</SPAN
></A
>の利用が必要です。
   </P
><P
>バージョン9.6には、以前のバージョンとの互換性に影響する多数の変更点が含まれています。
以下の非互換性に注意してください。
   </P
><P
></P
><UL
><LI
><P
><A
HREF="monitoring-stats.html#PG-STAT-ACTIVITY-VIEW"
><TT
CLASS="STRUCTNAME"
>pg_stat_activity</TT
></A
>ビューの、プロセスが何を待機しているかの情報を改善しました。
(Amit Kapila, Ildus Kurbangaliev)
       </P
><P
>歴史的には重量ロックを待機している場合だけプロセスは待機中と示されていました。
これからは軽量ロックとバッファピンの待機も<TT
CLASS="STRUCTNAME"
>pg_stat_activity</TT
>で示されます。
また、待機しているロックのタイプも見えるようになります。
これらの変更は<TT
CLASS="STRUCTFIELD"
>waiting</TT
>列を<TT
CLASS="STRUCTFIELD"
>wait_event_type</TT
>と<TT
CLASS="STRUCTFIELD"
>wait_event</TT
>で置き換えます。
       </P
></LI
><LI
><P
><A
HREF="functions-formatting.html#FUNCTIONS-FORMATTING-TABLE"
><CODE
CLASS="FUNCTION"
>to_char()</CODE
></A
>で時間関連のフィールドにおいて（必要ならば）マイナス符号をフィールド幅の一部としてカウントしません。
(Bruce Momjian)
       </P
><P
>例えば<TT
CLASS="LITERAL"
>to_char('-4 years'::interval, 'YY')</TT
>は<TT
CLASS="LITERAL"
>-4</TT
>でなく<TT
CLASS="LITERAL"
>-04</TT
>を返すようになります。
       </P
></LI
><LI
><P
>無限値の入力に対して<A
HREF="functions-datetime.html#FUNCTIONS-DATETIME-TABLE"
><CODE
CLASS="FUNCTION"
>extract()</CODE
></A
>が、より合理的に動作するようにしました。
(Vitaly Burovoy)
       </P
><P
>歴史的には<CODE
CLASS="FUNCTION"
>extract()</CODE
>関数は与えられたフィールド名が何であっても、無限大のタイムスタンプが与えられたなら単に0を返していました。
これを、要求フィールドが単調増加するもの（例：<TT
CLASS="LITERAL"
>year</TT
>、<TT
CLASS="LITERAL"
>epoch</TT
>）なら適切に<TT
CLASS="LITERAL"
>infinity</TT
>または<TT
CLASS="LITERAL"
>-infinity</TT
>を返し、そうでないもの（例：<TT
CLASS="LITERAL"
>day</TT
>、<TT
CLASS="LITERAL"
>hour</TT
>）なら<TT
CLASS="LITERAL"
>NULL</TT
>を返すようにしました。
また、誤ったフィールド名には期待されるエラーを投げます。
       </P
></LI
><LI
><P
>PL/pgSQLの<TT
CLASS="COMMAND"
>RAISE</TT
>コマンドで出力されるメッセージにて<TT
CLASS="LITERAL"
>CONTEXT</TT
>の最も内側の行を抑制する<SPAN
CLASS="QUOTE"
>"機能"</SPAN
>を取り除きました。
(Pavel Stehule)
       </P
><P
>この古くからの後方互換性のための作り込みは、もはや役に立たなくなっていると認められました。
       </P
></LI
><LI
><P
>デフォルトのテキスト検索パーサを<TT
CLASS="LITERAL"
>email</TT
>および<TT
CLASS="LITERAL"
>host</TT
>トークンが数字から始まるのを許すように修正しました。
(Artur Zakirov)
       </P
><P
>ほとんどの場合、これはテキスト解析に僅かな違いしかもたらしません。
しかし、このようなアドレスが頻繁に生じるデータを持っているなら、テキスト検索でこの形のアドレスを適切に見つけられるようにするために、従属する<TT
CLASS="TYPE"
>tsvector</TT
>列とインデックスを再構築するだけの価値があるでしょう。
       </P
></LI
><LI
><P
><A
HREF="unaccent.html"
><TT
CLASS="FILENAME"
>contrib/unaccent</TT
></A
>の標準<TT
CLASS="FILENAME"
>unaccent.rules</TT
>ファイルをユニコードむけに知られている全ての発音区別符号を扱うように、また、合字を正しく展開するように拡張しました。
(Thomas Munro, L&eacute;onard Benedetti)
       </P
><P
>従来バージョンでは一部の一般的でない発音区別符号を伴う文字を変換するのを怠っていました。
また、これからは合字は別々の文字に展開されます。
このルールファイルを使うインストレーションは<TT
CLASS="TYPE"
>tsvector</TT
>列とその結果に依存するインデックスを再構築するのがよいでしょう。
       </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>CREATE ROLE</TT
>および同種のコマンド群から、長く非推奨とされてきた<TT
CLASS="LITERAL"
>CREATEUSER</TT
>/<TT
CLASS="LITERAL"
>NOCREATEUSER</TT
>オプションを取り除きました。
(Tom Lane)
       </P
><P
>古い後方互換性を理由として、<TT
CLASS="LITERAL"
>CREATEUSER</TT
>は実際のところ<TT
CLASS="LITERAL"
>SUPERUSER</TT
>を意味しました。
このことは常にこれは<TT
CLASS="LITERAL"
>CREATEROLE</TT
>の意味だろうと（合理的に）予想するユーザの混乱の元となっていました。
現時点で10年にわたって非推奨でしたので、除去することでこの問題を解決します。
       </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>pg_</TT
>で始まるロール名を予約済みとして扱うようにしました。
(Stephen Frost)
       </P
><P
>これからはこのようなロール名のユーザ作成は禁止されます。
これにより<SPAN
CLASS="APPLICATION"
>initdb</SPAN
>で作られた組み込みロールとの競合を防ぎます。
       </P
></LI
><LI
><P
><TT
CLASS="STRUCTNAME"
>information_schema</TT
>.<TT
CLASS="STRUCTNAME"
>routines</TT
>ビュー内の列名を<TT
CLASS="STRUCTFIELD"
>result_cast_character_set_name</TT
>から<TT
CLASS="STRUCTFIELD"
>result_cast_char_set_name</TT
>に変更しました。
(Cl&eacute;ment Pr&eacute;vost)
       </P
><P
>SQL:2011標準には長い方の名前が記載されていますが、隣の列名では他の<TT
CLASS="STRUCTNAME"
>information_schema</TT
>ビューと同様に短い方の書き方を使っていることから、これは誤りと見られます。
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>psql</SPAN
>の<TT
CLASS="OPTION"
>-c</TT
>オプションはもはや<TT
CLASS="OPTION"
>--no-psqlrc</TT
>の意味を含まなくなりました。
(Pavel Stehule, Catalin Iacob)
       </P
><P
>古い動作を得るには<TT
CLASS="OPTION"
>--no-psqlrc</TT
>（または短縮形の<TT
CLASS="OPTION"
>-X</TT
>）を明示的に書いてください。
このように修正されたスクリプトは古いバージョンの<SPAN
CLASS="APPLICATION"
>psql</SPAN
>でも引き続き動作するでしょう。
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_restore</SPAN
>の<TT
CLASS="OPTION"
>-t</TT
>オプションを普通のテーブルだけでなく全てのタイプのリレーションに対応するように改善しました。
(Craig Ringer)
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_controldata</SPAN
>および関連する箇所で<TT
CLASS="LITERAL"
>NextXID</TT
>の表示形式を変更しました。
(Joe Conway, Bruce Momjian)
       </P
><P
><TT
CLASS="REPLACEABLE"
><I
>number</I
></TT
><TT
CLASS="LITERAL"
>:</TT
><TT
CLASS="REPLACEABLE"
><I
>number</I
></TT
>形式でエポックとトランザクションIDの値を表示します。
これまでの<TT
CLASS="REPLACEABLE"
><I
>number</I
></TT
><TT
CLASS="LITERAL"
>/</TT
><TT
CLASS="REPLACEABLE"
><I
>number</I
></TT
>形式は、<ACRONYM
CLASS="ACRONYM"
>LSN</ACRONYM
>に使われる形式と紛らわしく似ていました。
       </P
></LI
><LI
><P
>拡張の関数を適切なものについてパラレルセーフと印付けされるように改定しました。
(Andreas Karlsson)
       </P
><P
>多くの標準拡張はそれらの関数がパラレルクエリーのワーカプロセスで実行できるように改定されました。
これらの変更は、（クラスタの各データベースの）各拡張に<TT
CLASS="COMMAND"
>ALTER EXTENSION UPDATE</TT
>を適用しない限り、前バージョンから<SPAN
CLASS="APPLICATION"
>pg_upgrade</SPAN
>されたデータベースには効力がありません。
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN131731"
>E.6.3. 変更点</A
></H2
><P
>以下に<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> 9.6と前のメジャーリリースとの詳細な変更点を記載します。
   </P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN131735"
>E.6.3.1. サーバ</A
></H3
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN131737"
>E.6.3.1.1. 並列問い合わせ</A
></H4
><P
></P
><UL
><LI
><P
>並列問い合わせ。
(Robert Haas, Amit Kapila, David Rowley, many others)
       </P
><P
>9.6で<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>は大きな問い合わせに対する並列実行の最初のサポートを導入しました。
厳密に駆動テーブルをシーケンシャルスキャンで処理する参照問い合わせの場合だけ、並列化できます。
ハッシュ結合とネステッドループも、また（サポートされている集約について）集約処理も同様に並列実行できます。
やるべきことは沢山残っていますが、これはすでに役立つ機能セットです。
       </P
><P
>並列問い合わせの実行は（未だ）デフォルトでは有効ではありません。
有効にするには、新たな設定パラメータ<A
HREF="runtime-config-resource.html#GUC-MAX-PARALLEL-WORKERS-PER-GATHER"
>max_parallel_workers_per_gather</A
>を0より大きい値に設定します。
その他の新たな設定パラメータ<A
HREF="runtime-config-query.html#GUC-FORCE-PARALLEL-MODE"
>force_parallel_mode</A
>、<A
HREF="runtime-config-query.html#GUC-PARALLEL-SETUP-COST"
>parallel_setup_cost</A
>、<A
HREF="runtime-config-query.html#GUC-PARALLEL-TUPLE-COST"
>parallel_tuple_cost</A
>、<A
HREF="runtime-config-query.html#GUC-MIN-PARALLEL-RELATION-SIZE"
>min_parallel_relation_size</A
>を通してさらなる並列処理の制御を行うことができます。
       </P
></LI
><LI
><P
>関数のパラレル安全状態を印付けするための基盤を用意しました。
(Robert Haas, Amit Kapila)
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN131752"
>E.6.3.1.2. インデックス</A
></H4
><P
></P
><UL
><LI
><P
><A
HREF="gin.html"
><ACRONYM
CLASS="ACRONYM"
>GIN</ACRONYM
></A
>インデックス作成で、1GBより大きい<A
HREF="runtime-config-resource.html#GUC-MAINTENANCE-WORK-MEM"
>maintenance_work_mem</A
>設定の効果的な活用ができるようにしました。
(Robert Abraham, Teodor Sigaev)
       </P
></LI
><LI
><P
>GINインデックスのペンディングリストから削除されたページを空き領域マップに即座に追加するようにしました。
(Jeff Janes, Teodor Sigaev)
       </P
><P
>これはテーブルのバキューム頻度が低いときの膨張を減らします。
       </P
></LI
><LI
><P
>GINインデックスのペンディングリストのクリーンアップを手動で実行できるように<A
HREF="functions-admin.html#FUNCTIONS-ADMIN-INDEX"
><CODE
CLASS="FUNCTION"
>gin_clean_pending_list()</CODE
></A
>関数を追加しました。
(Jeff Janes)
       </P
><P
>以前は、このクリーンアップは親テーブルのバキュームやアナライズの副次効果としてのみ生じました。
       </P
></LI
><LI
><P
><A
HREF="gist.html"
>GiST</A
>インデックスにおける dead(削除済み)インデックスタプルの扱いを改善しました。
(Anastasia Lubennikova)
       </P
><P
>deadインデックスタプルは、あるインデックスキャンが対応するヒープタプルがdeadであると気づくとき、そのように印付けされるようになります。
タプルを挿入するとき、ページ上に空間を作るために必要ならdeadとマークされたタプルは削除されます。
       </P
></LI
><LI
><P
><TT
CLASS="TYPE"
>box</TT
>型むけの<A
HREF="spgist.html"
>SP-GiST</A
>演算子クラスを追加しました。
(Alexander Lebedev)
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN131776"
>E.6.3.1.3. ソート</A
></H4
><P
></P
><UL
><LI
><P
>外部ソート方式を行うときに置換選択ソートでなくクイックソートを使うことでソートの性能を改善しました。
(Peter Geoghegan)
       </P
><P
>この新しい方法では典型的なキャッシュサイズとデータ量に対して<ACRONYM
CLASS="ACRONYM"
>CPU</ACRONYM
>キャッシュをより良く使用します。
必要に応じて、この動作は新たな設定パラメータ<A
HREF="runtime-config-resource.html#GUC-REPLACEMENT-SORT-TUPLES"
>replacement_sort_tuples</A
>を通して調整されます。
       </P
></LI
><LI
><P
>同じ文字列が複数回現れる場合のテキストソートを高速化しました。
(Peter Geoghegan)
       </P
></LI
><LI
><P
><SPAN
CLASS="QUOTE"
>"短縮"</SPAN
>キーを使うことで、<TT
CLASS="TYPE"
>uuid</TT
>、<TT
CLASS="TYPE"
>bytea</TT
>、<TT
CLASS="TYPE"
>char(n)</TT
>のソートを高速化しました。
(Peter Geoghegan)
       </P
><P
>短縮キーのサポートでは非デフォルト演算子クラス<A
HREF="indexes-opclass.html"
><TT
CLASS="LITERAL"
>text_pattern_ops</TT
></A
>、<TT
CLASS="LITERAL"
>varchar_pattern_ops</TT
>、<TT
CLASS="LITERAL"
>bpchar_pattern_ops</TT
>も追加されました。
順序集合集約を処理して短縮キーをうまく利用できるようになりました。
       </P
></LI
><LI
><P
>ソートのときに<ACRONYM
CLASS="ACRONYM"
>TID</ACRONYM
>を64bit整数として扱うことで<TT
CLASS="COMMAND"
>CREATE INDEX CONCURRENTLY</TT
>を高速化しました。
(Peter Geoghegan)
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN131801"
>E.6.3.1.4. ロック</A
></H4
><P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>ProcArrayLock</TT
>の競合を減らしました。
(Amit Kapila, Robert Haas)
       </P
></LI
><LI
><P
>バッファ内容のロックをバッファデスクリプタに移すことで性能を改善しました。
(Andres Freund, Simon Riggs)
       </P
></LI
><LI
><P
>スケーラビリティ改善のため、共有バッファヘッダのスピンロックを原子的操作に置き換えました。
       </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>LWLock</TT
>の待ちキューを保護するため、スピンロックでなく原子的操作を使います。
(Andres Freund)
       </P
></LI
><LI
><P
>マルチ<ACRONYM
CLASS="ACRONYM"
>CPU</ACRONYM
>ソケットのサーバ上で競合を減らすため共有ハッシュテーブルのフリーリストを分割しました。
(Aleksander Alekseev)
       </P
></LI
><LI
><P
>Btreeインデックスのバキューム操作の再生中のスタンバイサーバ上のインターロックを減らしました。
(Simon Riggs)
       </P
><P
>この変更はこのような操作の再生で時々発生するかなりのレプリケーション遅延を回避します。
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN131820"
>E.6.3.1.5. オプティマイザ統計</A
></H4
><P
></P
><UL
><LI
><P
><TT
CLASS="COMMAND"
>ANALYZE</TT
>の多数のNULLを持つ列の推定を改善しました。
(Tomas Vondra, Alex Shulgin)
       </P
><P
>これまで<TT
CLASS="COMMAND"
>ANALYZE</TT
>は多数<TT
CLASS="LITERAL"
>NULL</TT
>を持つ列では、非<TT
CLASS="LITERAL"
>NULL</TT
>の個別値数を過小評価する傾向があり、また、頻出値の計算でも不正確でした。
       </P
></LI
><LI
><P
>プランナの問い合わせ結果での個別値数の推定を改善しました。
(Tomas Vondra)
       </P
></LI
><LI
><P
>結合述語における選択度の推測に外部キー関係を使用するようにしました。
(Tomas Vondra, David Rowley)
       </P
><P
>もしテーブル<TT
CLASS="LITERAL"
>t</TT
>が、<TT
CLASS="LITERAL"
>(a,b) REFERENCES r (x,y)</TT
> という外部キー制約を持つなら、<TT
CLASS="LITERAL"
>t.a = r.x AND t.b = r.y</TT
>などの<TT
CLASS="LITERAL"
>WHERE</TT
>条件は<TT
CLASS="LITERAL"
>t</TT
>の各行に対して1行より多い<TT
CLASS="LITERAL"
>r</TT
>の行を選択することはありえません。
プランナは以前はこれら<TT
CLASS="LITERAL"
>AND</TT
>条件を独立しているとみなし、結果として、しばしば選択度を大幅に誤って推定していました。
これからは、<TT
CLASS="LITERAL"
>WHERE</TT
>条件を当てはまる外部キー制約と比較し、より良い推定を出します。
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN131843"
>E.6.3.1.6. <TT
CLASS="COMMAND"
>VACUUM</TT
></A
></H4
><P
></P
><UL
><LI
><P
>凍結済みタプルだけを含むページの再バキュームを回避しました。
(Masahiko Sawada, Robert Haas, Andres Freund)
       </P
><P
>以前は、周回防止用のバキュームは、たとえ何もすることがないページであっても、テーブルのすべてのページを巡回しなければなりませんでした。
これからは、凍結済みタプルのみを含むページはテーブルの可視性マップで識別され、たとえトランザクション周回予防を行っているときでもスキップすることができます。
これは大部分のデータが変化しない大きいテーブルを保守するコストを大幅に削減するでしょう。
       </P
><P
>必要であれば、新たな<TT
CLASS="LITERAL"
>DISABLE_PAGE_SKIPPING</TT
>オプションを使ってバキュームで全ての凍結済みページを処理することを強制できます。
通常これは全く必要ありませんが、可視性マップの破損を復旧するのに役立つかもしれません。
       </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>VACUUM</TT
>中の無駄なヒープ切り捨ての試行を回避しました。
(Jeff Janes, Tom Lane)
       </P
><P
>本変更は有効な切り捨てが不可能である場合の排他テーブルロックの取得を回避します。
主な利点はスタンバイサーバ上での不要な問い合わせキャンセルを回避できることです。
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN131856"
>E.6.3.1.7. 性能全般</A
></H4
><P
></P
><UL
><LI
><P
>古い<ACRONYM
CLASS="ACRONYM"
>MVCC</ACRONYM
>スナップショットを設定可能なタイムアウトの後に無効にできるようにしました。
(Kevin Grittner)
       </P
><P
>通常、削除されたタプルは、それを<SPAN
CLASS="QUOTE"
>"見る"</SPAN
>かもしれない最後のトランザクションがいなくなるまでは、バキュームによる物理的な除去がされません。
長時間オープンしたままのトランザクションは、このため、空間が再利用できないので相当なテーブル膨張を引き起こす可能性があります。
この機能は、<ACRONYM
CLASS="ACRONYM"
>MVCC</ACRONYM
>スナップショットをどれだけの間、有効と保証するかを指定する新たな設定パラメータ<A
HREF="runtime-config-resource.html#GUC-OLD-SNAPSHOT-THRESHOLD"
>old_snapshot_threshold</A
>を通して、時間に基づく制限を設定可能にします。
上限時間後、デッドタプルは除去候補になります。
古いスナップショットを使うトランザクションは潜在的にこのようなデータが含まれているかもしれないページを読もうとしたならエラーを受け取るはずです。
       </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>GROUP BY</TT
>の他の列に機能的に従属している列を無視するようにしました。
(David Rowley)
       </P
><P
><TT
CLASS="LITERAL"
>GROUP BY</TT
>句が、同テーブルの他の列と共に遅延されていない主キーのすべての列を含むなら、主キー以外の列は冗長でグルーピングから外すことができます。
これは多くのよくある場合に計算を節約します。
       </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>WHERE</TT
>句がインデックスされていない列を参照している部分インデックスで、<A
HREF="indexes-index-only-scans.html"
>インデックスオンリースキャン</A
>を利用可能にしました。
(Tomas Vondra, Kyotaro Horiguchi)
       </P
><P
>例えば、<TT
CLASS="COMMAND"
>CREATE INDEX tidx_partial ON t(b) WHERE a &gt; 0</TT
>で定義されたインデックスを、<TT
CLASS="LITERAL"
>WHERE a &gt; 0</TT
>と指定する問い合わせで、インデックスオンリースキャンに使うことができるようになりました。
これまでは、<TT
CLASS="LITERAL"
>a</TT
>がインデックス列にあらわれないために、これは許されませんでした。
       </P
></LI
><LI
><P
>チェックポイント書き込みをソートされた順で行うようにしました。
(Fabien Coelho, Andres Freund)
       </P
><P
>これまでチェックポイントは、通常ランダムに近い、とにかく共有バッファにたまたま出てきた順にダーティページを書き出していました。
これは特に回転メディアで性能がよくありません。
本変更はチェックポイント駆動の書き込みがファイルとブロック番号の順で行われるように、また、テーブルスペース間で偏りが無いようにします。
       </P
></LI
><LI
><P
>可能なところでは、カーネルディスクバッファにダーティデータが蓄積されるのを防ぐため、設定可能な書き込み数の後にカーネルライトバックを起動するようにしました。
(Fabien Coelho, Andres Freund)
       </P
><P
><SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>はデータをカーネルのディスクキャッシュに書き、それはやがて物理ストレージにフラッシュされます。
多くのOSはこれを賢く管理せず、大量のダーティデータを一度にフラッシュすると判断するまで蓄積させておきます。これはフラッシュが終わるまでの間、新たなI/O要求に大きな遅延を引き起こします。
本変更は設定可能な間隔の後に明示的にデータフラッシュを要求することで、この問題を緩和しようとします。
       </P
><P
>Linuxにおいては、この用途に<CODE
CLASS="FUNCTION"
>sync_file_range()</CODE
>が使われ、この関数にほとんどマイナス面が無いため本機能はデフォルトで有効です。
このフラッシュする機能は、<CODE
CLASS="FUNCTION"
>msync()</CODE
>または<CODE
CLASS="FUNCTION"
>posix_fadvise()</CODE
>があるなら他のプラットフォームでも使用可能ですが、これらのインタフェースには若干の望ましくない副作用がありるため、Linux以外のプラットフォームでは本機能はデフォルトでは無効です。
       </P
><P
>新たな設定パラメータ<A
HREF="runtime-config-resource.html#GUC-BACKEND-FLUSH-AFTER"
>backend_flush_after</A
>, <A
HREF="runtime-config-resource.html#GUC-BGWRITER-FLUSH-AFTER"
>bgwriter_flush_after</A
>, <A
HREF="runtime-config-wal.html#GUC-CHECKPOINT-FLUSH-AFTER"
>checkpoint_flush_after</A
>, and <A
HREF="runtime-config-wal.html#GUC-WAL-WRITER-FLUSH-AFTER"
>wal_writer_flush_after</A
>が本動作を制御します。
       </P
></LI
><LI
><P
>複数の集約が同じ引数と遷移関数を持っているなら、それらの間で計算を共有することで集約関数の性能を改善しました。
(David Rowley)
       </P
><P
>例えば、<TT
CLASS="COMMAND"
>SELECT AVG(x), VARIANCE(x) FROM tab</TT
>は行ごとに二つの集約に対して対して単一の計算を用いることができます。
       </P
></LI
><LI
><P
>元トランザクションがコミット済みかを判断するのに<TT
CLASS="STRUCTNAME"
>pg_clog</TT
>ではなく現在トランザクションのスナップショットを調べることにより、最近に作られたタプルに対する可視性の検査を高速化しました。
(Jeff Janes, Tom Lane)
       </P
></LI
><LI
><P
>タプルのヒントビットが以前より早くセットされるようにしました。
(Andres Freund)
       </P
></LI
><LI
><P
>短命な準備されたトランザクションの性能を改善しました。
(Stas Kelvich, Simon Riggs, Pavan Deolasee)
       </P
><P
>二相コミットの情報は<TT
CLASS="COMMAND"
>PREPARE TRANSACTION</TT
>の際に<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>のみに書かれ、<TT
CLASS="COMMAND"
>COMMIT PREPARED</TT
>の際には、それがすぐ後に生じたなら、<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>から読み戻されるようになりました。
分離状態ファイルは、保留しているトランザクションが次のチェックポイントの時までコミットにもアボートにもならなかった場合のみ作られます。
       </P
></LI
><LI
><P
>メモリコンテキストの廃棄の性能を改善しました。
(Jan Wieck)
       </P
></LI
><LI
><P
>多数のオブジェクトを追跡するリソースオーナーの性能を改善しました。
(Aleksander Alekseev)
       </P
></LI
><LI
><P
><TT
CLASS="TYPE"
>timestamp</TT
>、<TT
CLASS="TYPE"
>time</TT
>、および<TT
CLASS="TYPE"
>date</TT
>データ型の出力関数の速度を改善しました。
(David Rowley, Andres Freund)
       </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>AccessExclusive</TT
>ロックを取得する操作のリプレイ中の、ホットスタンバイ問い合わせの不要なキャンセルを回避しました。
(Jeff Janes)
       </P
></LI
><LI
><P
>リレーション拡張のロックに競合があるとき、リレーションを複数ブロック一度に拡張するようにしました。
(Dilip Kumar)
       </P
><P
>これは競合を減らすことでスケーラビリティを改善します。
       </P
></LI
><LI
><P
>よりよいスケーラビリティのためにclogバッファの数を増やしました。
(Amit Kapila, Andres Freund)
       </P
></LI
><LI
><P
>常に単純な変数むけの<TT
CLASS="LITERAL"
>ParamListInfo</TT
>エントリを有効な状態に留めておくことで、<SPAN
CLASS="APPLICATION"
>PL/pgSQL</SPAN
>で式の評価を高速化しました。
(Tom Lane)
       </P
></LI
><LI
><P
>最近のWindowsバージョンで、<TT
CLASS="LITERAL"
>SO_SNDBUF</TT
>設定をそのデフォルトよりも減らすことを回避しました。
(Chen Huajun)
       </P
></LI
><LI
><P
>Windowsにおいて<A
HREF="runtime-config-logging.html#GUC-UPDATE-PROCESS-TITLE"
>update_process_title</A
>をデフォルトで無効にしました。
(Takayuki Tsunakawa)
       </P
><P
>Windowsでは大部分の他プラットフォームよりもプロセスタイトルを更新するオーバーヘッドが大きく、また、大部分のWindowsユーザはプロセスタイトルを表示できるツールを持っていないことから、更新してもあまり役に立ちません。
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN131939"
>E.6.3.1.8. モニタリング</A
></H4
><P
></P
><UL
><LI
><P
><TT
CLASS="COMMAND"
>VACUUM</TT
>操作の進捗報告を提供する<A
HREF="progress-reporting.html#PG-STAT-PROGRESS-VACUUM-VIEW"
><TT
CLASS="STRUCTNAME"
>pg_stat_progress_vacuum</TT
></A
>システムビューを追加しました。
(Amit Langote, Robert Haas, Vinayak Pokale, Rahila Syed)
       </P
></LI
><LI
><P
><ACRONYM
CLASS="ACRONYM"
>SQL</ACRONYM
>に<TT
CLASS="FILENAME"
>pg_control</TT
>のフィールドを見せる<A
HREF="functions-info.html#FUNCTIONS-CONTROLDATA"
><CODE
CLASS="FUNCTION"
>pg_control_system()</CODE
></A
>、<CODE
CLASS="FUNCTION"
>pg_control_checkpoint()</CODE
>、<CODE
CLASS="FUNCTION"
>pg_control_recovery()</CODE
>、および、<CODE
CLASS="FUNCTION"
>pg_control_init()</CODE
>関数を追加しました。
(Joe Conway, Michael Paquier)
       </P
></LI
><LI
><P
><A
HREF="view-pg-config.html"
><TT
CLASS="STRUCTNAME"
>pg_config</TT
></A
>システムビューを追加しました。
(Joe Conway)
       </P
><P
>このビューは<SPAN
CLASS="APPLICATION"
>pg_config</SPAN
>コマンドラインユーティリティから参照できるものと同様の情報、すなわち様々な<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>のコンパイル時の設定情報を見せます。
       </P
></LI
><LI
><P
><A
HREF="view-pg-replication-slots.html"
><TT
CLASS="STRUCTNAME"
>pg_replication_slots</TT
></A
>システムビューに<TT
CLASS="STRUCTFIELD"
>confirmed_flush_lsn</TT
>列を追加しました。
(Marko Tiikkaja)
       </P
></LI
><LI
><P
>ホットスタンバイサーバの<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>レシーバプロセスに関する情報を提供する<A
HREF="monitoring-stats.html#PG-STAT-WAL-RECEIVER-VIEW"
><TT
CLASS="STRUCTNAME"
>pg_stat_wal_receiver</TT
></A
>システムビューを追加しました。
(Michael Paquier)
       </P
></LI
><LI
><P
>どのセッションがどの他セッションをブロックしているかを確実に識別する<A
HREF="functions-info.html#FUNCTIONS-INFO-SESSION-TABLE"
><CODE
CLASS="FUNCTION"
>pg_blocking_pids()</CODE
></A
>関数を追加しました。
(Tom Lane)
       </P
><P
>この関数は与えられたプロセスIDのセッションをブロックしている全てのセッションのプロセスIDの配列を返します。
歴史的にはユーザは<TT
CLASS="STRUCTNAME"
>pg_locks</TT
>ビューの自己結合を使ってこのような情報を取得していました。
しかしながら、いくらかの僅かな正確さに対してこのように実施するのことは不合理に面倒です。また、並列問い合わせの追加は、セッションの主プロセスでなくワーカ子プロセスによってロックが取得・待機されるかもしれないことから、この古い方法を完全に非実用的にしました。
       </P
></LI
><LI
><P
>現在のトランザクションログのフラッシュ位置を見せる関数<A
HREF="functions-admin.html#FUNCTIONS-ADMIN-BACKUP-TABLE"
><CODE
CLASS="FUNCTION"
>pg_current_xlog_flush_location()</CODE
></A
>を追加しました。
(Tomas Vondra)
       </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>NOTIFY</TT
>がどのくらいいっぱいであるかを報告する関数<A
HREF="functions-info.html#FUNCTIONS-INFO-SESSION-TABLE"
><CODE
CLASS="FUNCTION"
>pg_notification_queue_usage()</CODE
></A
>を追加しました。
(Brendan Jurd)
       </P
></LI
><LI
><P
>メモリコンテキスト統計のダンプの冗長さを制限しました。
(Tom Lane)
       </P
><P
>メモリ不足エラーの際にポストマスタのログに出力されるメモリ使用のダンプは、多数のメモリコンテキストがあるとき、ことによると巨大なレポートを生成するのでなく、統計を要約するようになります。
<SPAN
CLASS="QUOTE"
>"grand total(総計)"</SPAN
>要約行も追加されます。
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN131992"
>E.6.3.1.9. <ACRONYM
CLASS="ACRONYM"
>認証</ACRONYM
></A
></H4
><P
></P
><UL
><LI
><P
><SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>クライアント認証に<SPAN
CLASS="SYSTEMITEM"
>BSD</SPAN
>認証サービスを使用できる<A
HREF="auth-methods.html#AUTH-BSD"
><ACRONYM
CLASS="ACRONYM"
>BSD</ACRONYM
>認証方式</A
>を追加しました。
(Marisa Emerson)
       </P
><P
>BSD認証は今のところ<SPAN
CLASS="SYSTEMITEM"
>OpenBSD</SPAN
>でのみ使用できます。
       </P
></LI
><LI
><P
><A
HREF="auth-methods.html#AUTH-PAM"
><ACRONYM
CLASS="ACRONYM"
>PAM</ACRONYM
>認証</A
>を使うとき、クライアントIPアドレスやホスト名を<TT
CLASS="LITERAL"
>PAM_RHOST</TT
>要素を通して<ACRONYM
CLASS="ACRONYM"
>PAM</ACRONYM
>モジュールに供給するようにしました。
(Grzegorz Sampolski)
       </P
></LI
><LI
><P
>ポストマスタのログでパスワード認証失敗のより多くの類型について詳細を出力するようにしました。
(Tom Lane)
       </P
><P
>全ての普通に起きうるパスワード認証失敗の場合に、ログに詳細な<TT
CLASS="LITERAL"
>DETAIL</TT
>フィールドが提供されます。
       </P
></LI
><LI
><P
><A
HREF="auth-methods.html#AUTH-RADIUS"
><ACRONYM
CLASS="ACRONYM"
>RADIUS</ACRONYM
>パスワード</A
>を128文字の長さまでサポートしました。
(Marko Tiikkaja)
       </P
></LI
><LI
><P
><A
HREF="auth-methods.html#SSPI-AUTH"
><ACRONYM
CLASS="ACRONYM"
>SSPI</ACRONYM
>認証</A
>のときに<SPAN
CLASS="PRODUCTNAME"
>NetBIOS</SPAN
>か<SPAN
CLASS="PRODUCTNAME"
>Kerberos</SPAN
>のレルム名とユーザ名を制御する<A
HREF="auth-methods.html#SSPI-AUTH"
><ACRONYM
CLASS="ACRONYM"
>SSPI</ACRONYM
>認証</A
>の新たなパラメータ<TT
CLASS="VARNAME"
>compat_realm</TT
>と<TT
CLASS="VARNAME"
>upn_username</TT
>が追加されました。
(Christian Ullrich)
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN132028"
>E.6.3.1.10. Server Configuration</A
></H4
><P
></P
><UL
><LI
><P
>長すぎるアイドルイントランザクション状態のとき、セッションを自動的に終了できるようにしました。
(Vik Fearing)
       </P
><P
>この動作は新たな設定パラメータ<A
HREF="runtime-config-client.html#GUC-IDLE-IN-TRANSACTION-SESSION-TIMEOUT"
>idle_in_transaction_session_timeout</A
>で制御されます。
これは忘れられたトランザクションが長期にロックを保持したり、バキュームクリーンアップを阻害したりするのを防止するのに役立ちます。
       </P
></LI
><LI
><P
><A
HREF="runtime-config-wal.html#GUC-CHECKPOINT-TIMEOUT"
>checkpoint_timeout</A
>の許容される最大値を24時間に引き上げました。
(Simon Riggs)
       </P
></LI
><LI
><P
>異なるテーブルスペースが各々異なるI/O特性を持つ場合に対応するため、<TT
CLASS="VARNAME"
>effective_io_concurrency</TT
>をテーブルスペースごとに設定できるようにしました。
(Julien Rouhaud)
       </P
></LI
><LI
><P
>現在時刻をミリ秒付きのUnixエポック形式で出力する<A
HREF="runtime-config-logging.html#GUC-LOG-LINE-PREFIX"
>log_line_prefix</A
>のオプション<TT
CLASS="LITERAL"
>%n</TT
>を追加しました。
(Tomas Vondra, Jeff Davis)
       </P
></LI
><LI
><P
><SPAN
CLASS="SYSTEMITEM"
>syslog</SPAN
>へログ出力するとき、メッセージ形式により多くの制御を提供する<A
HREF="runtime-config-logging.html#GUC-SYSLOG-SEQUENCE-NUMBERS"
>syslog_sequence_numbers</A
>および<A
HREF="runtime-config-logging.html#GUC-SYSLOG-SPLIT-MESSAGES"
>syslog_split_messages</A
>設定パラメータを追加しました。
(Peter Eisentraut)
       </P
></LI
><LI
><P
><A
HREF="runtime-config-wal.html#GUC-WAL-LEVEL"
>wal_level</A
>設定パラメータの値である<TT
CLASS="LITERAL"
>archive</TT
>と<TT
CLASS="LITERAL"
>hot_standby</TT
>を一つの新たな値<TT
CLASS="LITERAL"
>replica</TT
>に合併しました。
(Peter Eisentraut)
       </P
><P
>これら設定値を区別することはもはや役に立たず、また、これらを合併することはレプリケーションのセットアップの計画された将来の平易化への一歩です。
古い名前はまだ受け付けられますが、内部的に<TT
CLASS="LITERAL"
>replica</TT
>に変換されます。
       </P
></LI
><LI
><P
>サーバの起動、停止で<CODE
CLASS="FUNCTION"
>sd_notify()</CODE
>の呼び出しを可能にする設定オプション<TT
CLASS="OPTION"
>--with-systemd</TT
>を追加しました。
(Peter Eisentraut)
       </P
><P
>これは、<SPAN
CLASS="APPLICATION"
>systemd</SPAN
>下の<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>の管理を大幅に簡単にする<TT
CLASS="LITERAL"
>notify</TT
>タイプの<SPAN
CLASS="APPLICATION"
>systemd</SPAN
>サービスユニットを利用できるようにします。
       </P
></LI
><LI
><P
>&#13;サーバの<ACRONYM
CLASS="ACRONYM"
>SSL</ACRONYM
>キーファイルが<TT
CLASS="LITERAL"
>root</TT
>に所有されている場合には、グループ読み込みアクセスを持てるようにしました。
(Christoph Berg)
       </P
><P
>以前は、キーファイルは<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>サーバを実行するユーザに所有されるべきと主張していましたが、これは証明書を集中管理するように構成されている一部システム（<SPAN
CLASS="SYSTEMITEM"
>Debian</SPAN
>など）で不便です。
それゆえ、キーファイルが<TT
CLASS="LITERAL"
>root</TT
>に所有されていてグループ参照アクセスを持っている場合を許容しました。
そのグループに信頼できないユーザが決して含まれないようにするのは、OS管理者の責任です。
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN132075"
>E.6.3.1.11. 信頼性</A
></H4
><P
></P
><UL
><LI
><P
>ポストマスタがダウンしたならバックエンドを強制的に終了させるようにしました。
(Rajeev Rastogi, Robert Haas)
       </P
><P
>通常の状況下ではポストマスタは常に子プロセスより長く生き残るはずです。
もし何らか理由でポストマスタがダウンしたなら、バックエンドセッションをエラーと共に強制的に終了させます。
以前は、現存するバックエンドはクライアントの切断まで実行し続けましたが、危険で非効率的です。
これはまた、前の古いバックエンドが終了するまでは新たなポストマスタが起動しないようにします。
バックエンドはクライアントI/Oを待つときにポストマスタのダウンを検知するでしょうから、終了は即時ではありませんが、クライアント問い合わせの終了よりも遅くなることはないはずです。
       </P
></LI
><LI
><P
>直列化可能かを、制約違反エラーを報告する前に検査するようにしました。
(Thomas Munro)
       </P
><P
>シリアライザブルトランザクション隔離を使っているとき、同時トランザクションを原因とするいかなるエラーも直列化の失敗として表明するのが望ましく、それによりアプリケーションにリトライが成功するかもしれないという手がかりを与えます。
残念ながら、キー重複の失敗が同時挿入で引き起こされた場合には、これは確実には生じません。
本変更は、アプリケーションがトランザクションのより早くに明示的に競合するキーの存在をチェックした（そして見つからなかった）なら、このようなエラーが直列化のエラーとして報告されることを保証します。
       </P
></LI
><LI
><P
>たとえ<ACRONYM
CLASS="ACRONYM"
>XID</ACRONYM
>をもたないトランザクションから発行されたときでも、無効化メッセージが<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>記録されることを保証しました。
(Andres Freund)
       </P
><P
>これはスタンバイサーバのトランザクションが新たなインデックスのような変化に気づくのに失敗するという一部の稀な場合について修正します。
       </P
></LI
><LI
><P
>複数プロセスが<ACRONYM
CLASS="ACRONYM"
>GIN</ACRONYM
>インデックスのペンディングリストを同時にクリーンアップしようとするのを防ぎます。
       </P
><P
>意図的に許容されていいましたが、これは結果としてバキュームが削除を要するインデックスエントリの見落しに帰着する可能性のある競合状態を引き起こします。
       </P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN132093"
>E.6.3.2. レプリケーションとリカバリ</A
></H3
><P
></P
><UL
><LI
><P
>同期レプリケーションで1つだけでなく複数同時の同期スタンバイサーバに対応しました。
(Masahiko Sawada, Beena Emerson, Michael Paquier, Fujii Masao, Kyotaro Horiguchi)
       </P
><P
>完了したとみなす前にコミットを確認しなければいけないスタンバイサーバの数は、<A
HREF="runtime-config-replication.html#GUC-SYNCHRONOUS-STANDBY-NAMES"
>synchronous_standby_names</A
>パラメータの一部で設定します。
       </P
></LI
><LI
><P
>設定パラメータ<A
HREF="runtime-config-wal.html#GUC-SYNCHRONOUS-COMMIT"
>synchronous_commit</A
>に新たな設定<TT
CLASS="LITERAL"
>remote_apply</TT
>を加えました。
(Thomas Munro)
       </P
><P
>このモードでは、マスタはスタンバイサーバでトランザクションがディスクに書かれるだけでなく<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>適用済み</I
></SPAN
>になるまで待ちます。
このことは、それより前にマスタで認識されたすべてのコミットが、スタンバイサーバで開始したトランザクションから見えると期待できることを意味します。
       </P
></LI
><LI
><P
>レプリケーションスロットを作ったときに<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>の確保を直ちに行うため、レプリケーションプロトコルに機能を追加し、対応するオプションを<A
HREF="functions-admin.html#FUNCTIONS-REPLICATION-TABLE"
><CODE
CLASS="FUNCTION"
>pg_create_physical_replication_slot()</CODE
></A
>に追加しました。 
(Gurjeet Singh, Michael Paquier)
       </P
><P
>これはレプリケーションスロット作成でベースバックアップで必要とされる全ての<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>を保証できるようにします。
       </P
></LI
><LI
><P
><A
HREF="app-pgbasebackup.html"
><SPAN
CLASS="APPLICATION"
>pg_basebackup</SPAN
></A
>に<TT
CLASS="OPTION"
>--slot</TT
>オプションを追加しました。
(Peter Eisentraut)
       </P
><P
>これは<SPAN
CLASS="APPLICATION"
>pg_basebackup</SPAN
>に<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>ストリーミング向けに定義されたレプリケーションスロットを使わせます。
ベースバックアップ完了後、同じスロットを通常のストリーミングレプリケーションに選ぶことでシームレスに新たなスタンバイサーバの起動が可能です。
       </P
></LI
><LI
><P
>非排他のバックアップのために<A
HREF="functions-admin.html#FUNCTIONS-ADMIN-BACKUP-TABLE"
><CODE
CLASS="FUNCTION"
>pg_start_backup()</CODE
></A
>と<CODE
CLASS="FUNCTION"
>pg_stop_backup()</CODE
>を拡張しました。
(Magnus Hagander)
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN132126"
>E.6.3.3. 問い合わせ</A
></H3
><P
></P
><UL
><LI
><P
>タプルの集合を返す関数が単なる<TT
CLASS="LITERAL"
>NULL</TT
>を返せるようにしました。
(Andrew Gierth, Tom Lane)
       </P
><P
><TT
CLASS="LITERAL"
>SELECT FROM function(...)</TT
>の文脈において、以前は複合値の集合を返す関数は単なる<TT
CLASS="LITERAL"
>NULL</TT
>値を集合の一部として返すことを許していませんでした。
これからはこれが可能になり、要素が皆<TT
CLASS="LITERAL"
>NULL</TT
>の行として解釈されます。
これは例えば複合値の配列をunnestするなどのまれなケースでのエラーを回避します。
       </P
></LI
><LI
><P
>複数の<TT
CLASS="LITERAL"
>VALUES</TT
>行を伴う<TT
CLASS="COMMAND"
>INSERT</TT
>のターゲット列リストにおける配列添え字とフィールド選択に完全に対応しました。
(Tom Lane)
       </P
><P
>これまで、このような場合は同じターゲット列が2回以上でてくるとき、例えば<TT
CLASS="LITERAL"
>INSERT INTO tab (x[1], x[2]) VALUES (...)</TT
>などで、失敗していました。
       </P
></LI
><LI
><P
>適切なとき、<TT
CLASS="COMMAND"
>SELECT</TT
>出力式の評価を<TT
CLASS="LITERAL"
>ORDER BY</TT
>ソート後まで後回しにするようにしました。
(Konstantin Knizhnik)
       </P
><P
>この変更は出力リスト内の揮発性あるいは高コストの関数が<TT
CLASS="LITERAL"
>ORDER BY</TT
>で示される順序で実行されること、また、<TT
CLASS="LITERAL"
>LIMIT</TT
>句があるとき必要とされる回数以上に評価されないことを保証します。
これまで、並び替えがインデックススキャンやマージ結合前のソートで実行されるときには、これらの特性を持っていましたが、トップレベルのソートで実行されるときにはそうなっていませんでした。
       </P
></LI
><LI
><P
>処理したタプル数を記録するカウンタを64bitに拡張しました。
(Andreas Scherbaum)
       </P
><P
>この変更は<TT
CLASS="COMMAND"
>SELECT</TT
>などのコマンドタグで40億件以上のタプルカウントを正しく報告できるようにします。
これはPL/pgSQLの<TT
CLASS="COMMAND"
>GET DIAGNOSTICS ... ROW_COUNT</TT
>コマンドにも適用されます。
       </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>MULE_INTERNAL</TT
>エンコーディングを通した変換でエンコーディング変換をするのを回避しました。
(Tom Lane)
       </P
><P
>これまではキリル文字と中央ヨーロッパのシングルバイトのエンコーディングに対する多くの変換は、関連する<TT
CLASS="LITERAL"
>MULE_INTERNAL</TT
>コーディング方式に変換して、それから目的のエンコーディングに変換することで実行されていました。
非効率であることと別にこれは、変換できない文字に遭遇したときにエラーメッセージが、ユーザに見えるエンコーディングではなく<TT
CLASS="LITERAL"
>MULE_INTERNAL</TT
>との間で変換できないと混乱を招きやすい苦情を言うことを意味します。
       </P
></LI
><LI
><P
>テーブルが同じロールIDのもとでアクセスされる場合のみ、外部テーブルの結合をリモートで行うことを検討するようにしました。
(Shigeru Hanada, Ashutosh Bapat, Etsuro Fujita)
       </P
><P
>これまで外部結合プッシュダウン基盤はセキュリティの課題を完全に各外部データラッパに任せていました、これは<ACRONYM
CLASS="ACRONYM"
>FDW</ACRONYM
>に意図せぬ微妙なセキュリティホールをあまりに容易に作らせてしまいます。
そこで、どのロールIDが各テーブルにアクセスするか決定することを本体コードの役割としました。
また、関わるすべてのリレーションについてロールが同じでない限り、結合プッシュダウンを試みないようにしました。
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN132164"
>E.6.3.4. ユーティリティコマンド</A
></H3
><P
></P
><UL
><LI
><P
><TT
CLASS="COMMAND"
>COPY</TT
>が<TT
CLASS="LITERAL"
>INSERT</TT
>/<TT
CLASS="LITERAL"
>UPDATE</TT
>/<TT
CLASS="LITERAL"
>DELETE</TT
> ... <TT
CLASS="LITERAL"
>RETURNING</TT
>問い合わせの出力をコピーできるようにしました。
(Marko Tiikkaja)
       </P
><P
>これまでは、実現するのに中継する<ACRONYM
CLASS="ACRONYM"
>CTE</ACRONYM
>を書く必要がありました。
       </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>ALTER <TT
CLASS="REPLACEABLE"
><I
>object</I
></TT
> DEPENDS ON EXTENSION</TT
>を導入しました。
(Abhijit Menon-Sen)
       </P
><P
>本コマンドはデータベースオブジェクトに拡張に依存していると印付けできるようにします。
これにより、拡張が削除されたならオブジェクトは（<TT
CLASS="LITERAL"
>CASCADE</TT
>は必要なしに）自動的に削除されます。
しかしながら、このオブジェクトは拡張の一部ではないので、<SPAN
CLASS="APPLICATION"
>pg_dump</SPAN
>では別にダンプされます。
       </P
></LI
><LI
><P
>オブジェクトがすでに要求されたスキーマにあるときには<TT
CLASS="COMMAND"
>ALTER <TT
CLASS="REPLACEABLE"
><I
>object</I
></TT
> SET SCHEMA</TT
>が、歴史的に大部分のオブジェクトタイプに対してそうであったようにエラーを投げるのではなく、何もしないようにしました。
(Marti Raudsepp)
       </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>ALTER OPERATOR</TT
>に既存の演算子に関連付けられた選択度の関数を変更できるオプションを追加しました。
(Yury Zhuravlev)
       </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>ALTER TABLE ADD COLUMN</TT
>に<TT
CLASS="OPTION"
>IF NOT EXISTS</TT
>オプションを追加しました。
(Fabr&iacute;zio de Royes Mello)
       </P
></LI
><LI
><P
>フィルファクタと自動バキューム関連のリレーションオプションを設定するとき、<TT
CLASS="COMMAND"
>ALTER TABLE</TT
>が必要とするロック強度を減らしました。
(Fabr&iacute;zio de Royes Mello, Simon Riggs)
       </P
></LI
><LI
><P
>拡張でインデックスアクセスメソッドを作ることを可能にする、<A
HREF="sql-create-access-method.html"
><TT
CLASS="COMMAND"
>CREATE ACCESS METHOD</TT
></A
>を導入しました。
(Alexander Korotkov, Petr Jel&iacute;nek)
       </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>CREATE EXTENSION</TT
>に、要求された拡張が依存するすべての拡張を自動的に作成する<TT
CLASS="LITERAL"
>CASCADE</TT
>オプションを追加しました。
(Petr Jel&iacute;nek)
       </P
></LI
><LI
><P
>元テーブルが<TT
CLASS="TYPE"
>OID</TT
>列を持つとき、<TT
CLASS="COMMAND"
>CREATE TABLE ... LIKE</TT
>でそれを含めるようにしました。
(Bruce Momjian)
       </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>CHECK</TT
>制約がテーブル作成コマンドで<TT
CLASS="LITERAL"
>NOT VALID</TT
>と宣言されている場合、自動的に有効と印付けするようにしました。
(Amit Langote, Amul Sul)
       </P
><P
>テーブルには行が存在しないので安全です。
これは以前からの<TT
CLASS="LITERAL"
>FOREIGN KEY</TT
>制約の動作と一致します。
       </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>DROP OPERATOR</TT
>を削除された演算子とリンクしている<TT
CLASS="STRUCTNAME"
>pg_operator</TT
>.<TT
CLASS="STRUCTFIELD"
>oprcom</TT
>と<TT
CLASS="STRUCTNAME"
>pg_operator</TT
>.<TT
CLASS="STRUCTFIELD"
>oprnegate</TT
>をクリアするように修正しました。
(Roma Sokolov)
       </P
><P
>これまではこのようなリンクはそのまま残されて、削除した演算子の<TT
CLASS="TYPE"
>OID</TT
>が他の演算子に再利用されるという、あまりなさそうな事象で問題がでるかもしれません。
       </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>EXPLAIN</TT
>出力で同じサブプランを二度見せないようにしました。
(Tom Lane)
       </P
><P
>ある種の、典型的にはインデックス条件でSubPlanノードを伴う場合、<TT
CLASS="COMMAND"
>EXPLAIN</TT
>は同じサブプランのデータを二回出力していました。
       </P
></LI
><LI
><P
><TT
CLASS="TYPE"
>OID</TT
>列を除くシステム列へのインデックス作成を禁止しました。
(David Rowley)
       </P
><P
>このようなインデックスはサポートされているとみなされませんし、システムがタプルのシステム列フィールドをインデックス更新無しに変えるかもしれないため、高い可能性で誤動作するでしょう。
しかしながら、これまではこれが作られないように防ぐエラーチェックがありませんでした。
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN132233"
>E.6.3.5. 権限管理</A
></H3
><P
></P
><UL
><LI
><P
>注意を要する関数へのアクセス管理に権限システムを使うようにしました。
(Stephen Frost)
       </P
><P
>これまでは、多くの安全に注意を要する関数は非スーパーユーザから呼び出されるとエラーを投げる固定実装のチェックを含んでいました。
これはやや退屈な仕事としてスーパーユーザロールを使うことを強制していました。
これからは固定実装のエラーチェックは無くなり、<SPAN
CLASS="APPLICATION"
>initdb</SPAN
>にデフォルトのpublicの<TT
CLASS="LITERAL"
>EXECUTE</TT
>権限を取り上げさせるようにしました。
このことで、必ずしも全てのスーパーユーザ権限を必要としない信頼されたロールに、これらの関数の使用を認めることをインストレーションは選択できます。
       </P
></LI
><LI
><P
>従来スーパーユーザ専用だった関数へのアクセスを与えるのに使える<A
HREF="default-roles.html"
>組み込みロール</A
>を作成しました。
(Stephen Frost)
       </P
><P
>いまのところそのようなロールは<TT
CLASS="LITERAL"
>pg_signal_backend</TT
>だけですが、より多くが将来に追加される見通しです。
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN132246"
>E.6.3.6. データ型</A
></H3
><P
></P
><UL
><LI
><P
><A
HREF="textsearch.html"
>全文検索</A
>をフレーズ、すなわち特定順序あるいは指定された間隔で互いに隣接して現れる複数の語彙素、の検索に対応するように改善しました。
(Teodor Sigaev, Oleg Bartunov, Dmitry Ivanov)
       </P
><P
><TT
CLASS="TYPE"
>tsquery</TT
>入力で新たな演算子<TT
CLASS="LITERAL"
>&lt;-&gt;</TT
>と<TT
CLASS="LITERAL"
>&lt;<TT
CLASS="REPLACEABLE"
><I
>N</I
></TT
>&gt;</TT
>を使ってフレーズ検索問い合わせを指定できます。
前者は前後の語彙素が互いに隣接してその順に現れなければいけないことを意味します。後者は前後の語彙素がちょうどN<TT
CLASS="REPLACEABLE"
><I
>N</I
></TT
>だけ離れていなければいけないことを意味します。
       </P
></LI
><LI
><P
>配列スライス指定子で範囲の片方あるいは両方を（例えば<TT
CLASS="LITERAL"
>array_col[3:]</TT
>と）省略できるようにしました。
(Yury Zhuravlev)
       </P
><P
>省略された範囲は対応する配列の添え字の上限または下限と受け取られます。
これは多くの一般的なユースケースでよりシンプルな指定を可能にします。
       </P
></LI
><LI
><P
>範囲外の日付やタイムスタンプについてより注意深くしました。
(Vitaly Burovoy)
       </P
><P
>この変更は<TT
CLASS="TYPE"
>timestamp with time zone</TT
>の実装の限界に極めて近い値に対する予期せぬ範囲外エラーを防ぎます。
これまでは、<SPAN
CLASS="QUOTE"
>"同じ"</SPAN
>値が<TT
CLASS="VARNAME"
>timezone</TT
>設定によって、受け入れられたり、受け入れられなかったりしました。これは現在受け付けられている値のダンプ、リストアが失敗するかもしれないことを意味します。
これからは、値の限界はローカルタイムでなく、<TT
CLASS="VARNAME"
>timezone</TT
>とは無関係にするため、同等の<ACRONYM
CLASS="ACRONYM"
>UTC</ACRONYM
>時間に従って制限されます。
       </P
><P
>また、<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>は、<TT
CLASS="TYPE"
>date</TT
> <TT
CLASS="LITERAL"
>+</TT
> <TT
CLASS="TYPE"
>integer</TT
>などの新たな日付やタイムスタンプ値を計算する処理でも、より注意深くオーバーフローを検出するようになりました。
       </P
></LI
><LI
><P
>幾何データ型について、<TT
CLASS="LITERAL"
>infinity</TT
>と<TT
CLASS="LITERAL"
>NaN</TT
>の複合値が入出力の際に確実に一貫した扱いをされるようにしました。
(Tom Lane)
       </P
><P
>これからはこのような値は常にシンプルな<TT
CLASS="TYPE"
>float8</TT
>列と同様に出力し、入力で同様に受け入れられます。
これまではプラットフォームに依存した動作をしていました。
       </P
></LI
><LI
><P
>現代的な<SPAN
CLASS="PRODUCTNAME"
>Hunspell</SPAN
>ファイルを扱うように、また、より多くの言語に対応するように<A
HREF="textsearch-dictionaries.html#TEXTSEARCH-ISPELL-DICTIONARY"
><TT
CLASS="LITERAL"
>ispell</TT
></A
>辞書タイプを更新しました。
(Artur Zakirov)
       </P
></LI
><LI
><P
><A
HREF="functions-matching.html#FUNCTIONS-POSIX-REGEXP"
>正規表現</A
>で後方検索制約を実装しました。
(Tom Lane)
       </P
><P
>後方検索制約はテキストを消費せず既存の先行検索制約と似ていますが、
文字列の現在位置から始まるのでなく、現在位置で終わるマッチが在ること（あるいは無いこと）をチェックします。
同様の機能は既存の他の多くの正規表現エンジンに存在します。
       </P
></LI
><LI
><P
>正規表現で、見たところ3桁8進数のエスケープ<TT
CLASS="LITERAL"
>\</TT
><TT
CLASS="REPLACEABLE"
><I
>nnn</I
></TT
>が
377（10進数で255)を超えた場合、代わりに2桁8進数のエスケープとみなすようにしました。
(Tom Lane)
       </P
><P
>これにより現在の<SPAN
CLASS="APPLICATION"
>Tcl</SPAN
>リリースと振る舞いが一致します。
       </P
></LI
><LI
><P
>対応する等価演算子との一貫性のため、トランザクションID演算子<TT
CLASS="TYPE"
>xid</TT
> <TT
CLASS="LITERAL"
>&lt;&gt;</TT
> <TT
CLASS="TYPE"
>xid</TT
>と<TT
CLASS="TYPE"
>xid</TT
> <TT
CLASS="LITERAL"
>&lt;&gt;</TT
> <TT
CLASS="TYPE"
>int4</TT
>を追加しました。
(Michael Paquier)
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN132304"
>E.6.3.7. 関数</A
></H3
><P
></P
><UL
><LI
><P
><TT
CLASS="TYPE"
>jsonb</TT
>配列に新たな要素を挿入したり、未だ無いキーを<TT
CLASS="TYPE"
>jsonb</TT
>オブジェクト挿入したりする<A
HREF="functions-json.html#FUNCTIONS-JSON-PROCESSING-TABLE"
><CODE
CLASS="FUNCTION"
>jsonb_insert()</CODE
></A
>関数を追加しました。
(Dmitry Dolgov)
       </P
></LI
><LI
><P
><TT
CLASS="TYPE"
>numeric</TT
>型むけの<CODE
CLASS="FUNCTION"
>ln()</CODE
>、<CODE
CLASS="FUNCTION"
>log()</CODE
>、<CODE
CLASS="FUNCTION"
>exp()</CODE
>、および、<CODE
CLASS="FUNCTION"
>pow()</CODE
>関数の精度を改善しました。
(Dean Rasheed)
       </P
></LI
><LI
><P
><TT
CLASS="TYPE"
>numeric</TT
>値の表示スケールを取り出す<A
HREF="functions-math.html#FUNCTIONS-MATH-FUNC-TABLE"
><CODE
CLASS="FUNCTION"
>scale(numeric)</CODE
></A
>関数を追加しました。
(Marko Tiikkaja)
       </P
></LI
><LI
><P
>度で動作する三角関数が追加されました。
(Dean Rasheed)
       </P
><P
>例えば、<CODE
CLASS="FUNCTION"
>sin()</CODE
>は引数をラジアンで評価しますが、<A
HREF="functions-math.html#FUNCTIONS-MATH-TRIG-TABLE"
><CODE
CLASS="FUNCTION"
>sind()</CODE
></A
>では度で評価します。
これらの関数は、例えば<TT
CLASS="LITERAL"
>sind(30) = 0.5</TT
>のように、いくつか予測可能な値でちょうどの結果値をもたらすように動作します。
       </P
></LI
><LI
><P
>三角関数が<TT
CLASS="LITERAL"
>infinity</TT
>および<TT
CLASS="LITERAL"
>NaN</TT
>の入力を<ACRONYM
CLASS="ACRONYM"
>POSIX</ACRONYM
>標準によって扱うことを保証しました。
(Dean Rasheed)
       </P
><P
><ACRONYM
CLASS="ACRONYM"
>POSIX</ACRONYM
>標準にはこれら関数は<TT
CLASS="LITERAL"
>NaN</TT
>入力には<TT
CLASS="LITERAL"
>NaN</TT
>を返し、<TT
CLASS="LITERAL"
>infinity</TT
>を含む範囲外の入力にはエラーを投げるべきと書かれています。
これまでの振る舞いはプラットフォームによって様々でした。
       </P
></LI
><LI
><P
><A
HREF="functions-datetime.html#FUNCTIONS-DATETIME-TABLE"
><CODE
CLASS="FUNCTION"
>to_timestamp(float8)</CODE
></A
>が浮動小数点の<TT
CLASS="LITERAL"
>infinity</TT
>をタイムスタンプの<TT
CLASS="LITERAL"
>infinity</TT
>に変換するようにしました。
(Vitaly Burovoy)
       </P
><P
>以前は無限大の入力では単に失敗していました。
       </P
></LI
><LI
><P
><TT
CLASS="TYPE"
>tsvector</TT
>データむけの関数を追加しました。
(Stas Kelvich)
       </P
><P
>新たな関数<A
HREF="functions-textsearch.html#TEXTSEARCH-FUNCTIONS-TABLE"
><CODE
CLASS="FUNCTION"
>ts_delete()</CODE
></A
>、<CODE
CLASS="FUNCTION"
>ts_filter()</CODE
>、<CODE
CLASS="FUNCTION"
>unnest()</CODE
>、<CODE
CLASS="FUNCTION"
>tsvector_to_array()</CODE
>、<CODE
CLASS="FUNCTION"
>array_to_tsvector()</CODE
>、および、特定語彙素にだけ重みを付ける<CODE
CLASS="FUNCTION"
>setweight()</CODE
>の別形を追加しました。
       </P
></LI
><LI
><P
><A
HREF="textsearch-features.html#TEXTSEARCH-STATISTICS"
><CODE
CLASS="FUNCTION"
>ts_stat()</CODE
></A
>と<A
HREF="textsearch-features.html#TEXTSEARCH-UPDATE-TRIGGERS"
><CODE
CLASS="FUNCTION"
>tsvector_update_trigger()</CODE
></A
>を期待される引数型そのものでなく、そのバイナリ互換の型の値でも動作するようにしました。
例えば<TT
CLASS="TYPE"
>text</TT
>が期待されているところに<TT
CLASS="TYPE"
>citext</TT
>を可能にします。
(Teodor Sigaev)
       </P
></LI
><LI
><P
>引数の中のNULLまたは非NULLを数える可変引数関数<A
HREF="functions-comparison.html#FUNCTIONS-COMPARISON-FUNC-TABLE"
><CODE
CLASS="FUNCTION"
>num_nulls()</CODE
></A
>と<CODE
CLASS="FUNCTION"
>num_nonnulls()</CODE
>を追加しました。
(Marko Tiikkaja)
       </P
><P
>a、b、c の内ちょうど一つだけ非<TT
CLASS="LITERAL"
>NULL</TT
>であることを主張する<TT
CLASS="LITERAL"
>CHECK(num_nonnulls(a,b,c) = 1)</TT
>は、一つの使用例です。
これら関数は配列の中のNULLや非NULLを数えるのにも使用できます。
       </P
></LI
><LI
><P
>修飾され、クオートされているかもしれないSQL識別子を部品に分解する関数<A
HREF="functions-string.html#FUNCTIONS-STRING-OTHER"
><CODE
CLASS="FUNCTION"
>parse_ident()</CODE
></A
>を追加しました。
(Pavel Stehule)
       </P
></LI
><LI
><P
><A
HREF="functions-formatting.html#FUNCTIONS-FORMATTING-TABLE"
><CODE
CLASS="FUNCTION"
>to_number()</CODE
></A
>で、<TT
CLASS="LITERAL"
>V</TT
>フォーマットコードを10の<TT
CLASS="LITERAL"
>V</TT
>に続く数字の数のべき乗で割るものと解釈するようにしました。
(Bruce Momjian)
       </P
><P
>このことで<CODE
CLASS="FUNCTION"
>to_char()</CODE
>の逆関数として動作させます。

       </P
></LI
><LI
><P
><A
HREF="functions-info.html#FUNCTIONS-INFO-CATALOG-TABLE"
><CODE
CLASS="FUNCTION"
>to_reg*()</CODE
></A
>関数群が
<TT
CLASS="TYPE"
>cstring</TT
>でなく<TT
CLASS="TYPE"
>text</TT
>型を受け付けるようにしました。
(Petr Korobeinikov)
       </P
><P
>これは引数がシンプルなリテラル定数でない箇所のほとんどの場合で明示的なキャストの必要をなくします。
       </P
></LI
><LI
><P
>サイズを示す人間に読みやすい文字列を数値に変換する<A
HREF="functions-admin.html#FUNCTIONS-ADMIN-DBSIZE"
><CODE
CLASS="FUNCTION"
>pg_size_bytes()</CODE
></A
>関数を追加しました。
(Pavel Stehule, Vitaly Burovoy, Dean Rasheed)
       </P
><P
>本関数は文字列を<CODE
CLASS="FUNCTION"
>pg_size_pretty()</CODE
>で生成されたような文字列をバイトに変換します。
<TT
CLASS="LITERAL"
>SELECT oid::regclass FROM pg_class WHERE pg_total_relation_size(oid) &gt; pg_size_bytes('10 GB')</TT
>が使用例です。
       </P
></LI
><LI
><P
><A
HREF="functions-admin.html#FUNCTIONS-ADMIN-DBSIZE"
><CODE
CLASS="FUNCTION"
>pg_size_pretty()</CODE
></A
>で、負の値を正の値と同様に整形するようにしました。
(Adrian Vondendriesch)
       </P
><P
>これまでは負の値は短縮されず、バイトで出力されていました。
       </P
></LI
><LI
><P
><A
HREF="functions-admin.html#FUNCTIONS-ADMIN-SET-TABLE"
><CODE
CLASS="FUNCTION"
>current_setting()</CODE
></A
>関数にオプションの<TT
CLASS="REPLACEABLE"
><I
>missing_ok</I
></TT
>引数を追加しました。
(David Christensen)
       </P
><P
>これは認識できないパラメータ名に対してエラーを回避できるようにします。代わりに<TT
CLASS="LITERAL"
>NULL</TT
>が返ります。
       </P
></LI
><LI
><P
>様々なシステムカタログ情報関数が不正な入力に対して<TT
CLASS="LITERAL"
>NULL</TT
>を返すように変更しました。
(Michael Paquier)
       </P
><P
>これからは<A
HREF="functions-info.html#FUNCTIONS-INFO-CATALOG-TABLE"
><CODE
CLASS="FUNCTION"
>pg_get_viewdef()</CODE
></A
>関数は無効なビューの<TT
CLASS="TYPE"
>OID</TT
>が与えられたなら<TT
CLASS="LITERAL"
>NULL</TT
>を返します。また、いくつかの同種の関数も不正な入力に対して同様に<TT
CLASS="LITERAL"
>NULL</TT
>を返します。
以前は、このような場合にたいてい、ユーザ側の問題で起きたことを意味しない<SPAN
CLASS="QUOTE"
>"cache lookup failed"</SPAN
>エラーになっていました。
       </P
></LI
><LI
><P
><A
HREF="functions-admin.html#PG-REPLICATION-ORIGIN-XACT-RESET"
><CODE
CLASS="FUNCTION"
>pg_replication_origin_xact_reset()</CODE
></A
>を引数を一切持たないように修正しました。
(Fujii Masao)
       </P
><P
>ドキュメントには引数を持たないと書かれていて、Cコードも引数を想定していませんが、<TT
CLASS="STRUCTNAME"
>pg_proc</TT
>のエントリでは誤って2つの引数が指定されていました。
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN132430"
>E.6.3.8. サーバサイド言語</A
></H3
><P
></P
><UL
><LI
><P
><A
HREF="plpgsql.html"
>PL/pgSQL</A
>で実行時でなく関数をコンパイルするときに、<TT
CLASS="COMMAND"
>CONTINUE</TT
>文と<TT
CLASS="COMMAND"
>EXIT</TT
>文の不一致を検出するようにしました。
(Jim Nasby)
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>PL/Python</SPAN
>のエラー報告とメッセージ報告の関数を、主エラーメッセージの他に追加メッセージフィールドも指定できるように拡張しました。
(Pavel Stehule)
       </P
></LI
><LI
><P
>PL/Python関数が<SPAN
CLASS="APPLICATION"
>SPI</SPAN
>を通して自身を再帰的に呼び出しできるようにしました。
また、複数の集合を返すPL/Python関数が一つの問い合わせから呼び出されたときの動作を修正しました。
(Alexey Grishchenko, Tom Lane)
       </P
></LI
><LI
><P
>PL/Pythonでのセッション有効期間のメモリリークを修正しました。
(Heikki Linnakangas, Haribabu Kommi, Tom Lane)
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>PL/Tcl</SPAN
>をシンプル文字列ではなく、Tclの<SPAN
CLASS="QUOTE"
>"object"</SPAN
> <ACRONYM
CLASS="ACRONYM"
>API</ACRONYM
>を使うように現代化しました。
(Jim Nasby, Karl Lehenbauer)
       </P
><P
>これは一部のケースで性能をかなり改善できます。
今後は<SPAN
CLASS="APPLICATION"
>PL/Tcl</SPAN
>はTcl 8.4以上を必要とすることに注意してください。
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>PL/Tcl</SPAN
>でデータベースの報告するエラーが、Tclの<TT
CLASS="VARNAME"
>errorCode</TT
>グローバル変数で追加情報を返すようにしました。
(Jim Nasby, Tom Lane)
       </P
><P
>この機能はエラーについての補助データを返すときのTclの習慣に従っています。
       </P
></LI
><LI
><P
>データベースエンコーディングとTclが期待する<TT
CLASS="LITERAL"
>UTF-8</TT
>との間でエンコーディング変換をするように<SPAN
CLASS="APPLICATION"
>PL/Tcl</SPAN
>を修正しました。
(Tom Lane)
       </P
><P
>これまでは、文字列が変換無しに素通しで渡されていて、データベースエンコーディングが<TT
CLASS="LITERAL"
>UTF-8</TT
>でないとき、非<TT
CLASS="LITERAL"
>ASCII</TT
>文字で誤動作の原因となりました。
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN132465"
>E.6.3.9. クライアントインターフェイス</A
></H3
><P
></P
><UL
><LI
><P
>エラーおよび通知メッセージに<A
HREF="protocol-error-fields.html"
>深刻度フィールド</A
>の非ローカライズ版を加えました。
(Tom Lane)
       </P
><P
>この変更はクライアントコードが深刻度をあらわす文字列のローカライズ変形を懸念することなくエラーまたは通知の深刻度を判断できるようにします。
       </P
></LI
><LI
><P
>常に、あるいは非エラーメッセージ限定、のいずれかでメッセージの<TT
CLASS="LITERAL"
>CONTEXT</TT
>フィールドを抑止できる機能を<SPAN
CLASS="APPLICATION"
>libpq</SPAN
>に導入しました。
(Pavel Stehule)
       </P
><P
><A
HREF="libpq-status.html#LIBPQ-PQERRORMESSAGE"
><CODE
CLASS="FUNCTION"
>PQerrorMessage()</CODE
></A
>の現在のデフォルト動作では、エラーについてのみ<TT
CLASS="LITERAL"
>CONTEXT</TT
>を出力します。
新たな関数<A
HREF="libpq-control.html#LIBPQ-PQSETERRORCONTEXTVISIBILITY"
><CODE
CLASS="FUNCTION"
>PQsetErrorContextVisibility()</CODE
></A
>でこれを調節できます。
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>libpq</SPAN
>で異なる冗長度でのエラーメッセージ再生成に対応しました。
(Alex Shulgin)
       </P
><P
>これは新たな関数<A
HREF="libpq-exec.html#LIBPQ-PQRESULTVERBOSEERRORMESSAGE"
><CODE
CLASS="FUNCTION"
>PQresultVerboseErrorMessage()</CODE
></A
>で行われます。
これは<SPAN
CLASS="APPLICATION"
>psql</SPAN
>の新たな<TT
CLASS="LITERAL"
>\errverbose</TT
>機能を下支えします。また、他のクライアントにとってもおそらく有益でしょう。
       </P
></LI
><LI
><P
>デフォルトのUnixソケット接続において有益なデータを返すように、<SPAN
CLASS="APPLICATION"
>libpq</SPAN
>の<A
HREF="libpq-status.html#LIBPQ-PQHOST"
><CODE
CLASS="FUNCTION"
>PQhost()</CODE
></A
>関数を改善しました。
(Tom Lane)
       </P
><P
>明示的なホスト指定が与えられていない場合、これまでは<TT
CLASS="LITERAL"
>NULL</TT
>を返していましたが、これからはデフォルトのソケットディレクトリのパスを返します。
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>ecpg</SPAN
>の字句解析が、プリプロセッサディレクティブの行のコメント文字列内の改行を扱えるように修正しました。
(Michael Meskes)
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN132500"
>E.6.3.10. クライアントアプリケーション</A
></H3
><P
></P
><UL
><LI
><P
><A
HREF="app-pgdump.html"
><SPAN
CLASS="APPLICATION"
>pg_dump</SPAN
></A
>と<A
HREF="app-pgrestore.html"
><SPAN
CLASS="APPLICATION"
>pg_restore</SPAN
></A
>に<TT
CLASS="OPTION"
>--strict-names</TT
>オプションを加えました。
(Pavel Stehule)
       </P
><P
>このオプションはプログラムに<TT
CLASS="OPTION"
>-t</TT
>または<TT
CLASS="OPTION"
>-n</TT
>にマッチするものが無いなら、静かに何もしないのではなく苦情を言うようにさせます。
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_dump</SPAN
>で、システムオブジェクトへの権限割り当てのローカルな変更をダンプするようにしました。
(Stephen Frost)
       </P
><P
>組み込みの、あるいは、拡張で作られたオブジェクトの権限割り当てを変更することはスーパーユーザで常に可能でしたが、そのような変更は以前はダンプとリストアで失われました。
これからは、<SPAN
CLASS="APPLICATION"
>pg_dump</SPAN
>がそのような変更を認識してダンプします。
（しかしながら、これは9.6以降のサーバからダンプするときだけ動作します。）
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_dump</SPAN
>で、拡張が所有するスキーマに含まれる、拡張が所有していないオブジェクトをダンプできるようにしました。
(Mart&iacute;n Marqu&eacute;s)
       </P
><P
>これまでは誤ってスキーマを所有している拡張に属しているとみなされて、このようなオブジェクトは無視されました。
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_dump</SPAN
>の出力で、テーブル毎においてだけ一意の名前がつくオブジェクトタイプ（例えばトリガー）のオブジェクトタグにテーブル名を含めるようにしました。
(Peter Eisentraut)
       </P
></LI
></UL
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN132525"
>E.6.3.10.1. <A
HREF="app-psql.html"
><SPAN
CLASS="APPLICATION"
>psql</SPAN
></A
></A
></H4
><P
></P
><UL
><LI
><P
>複数の<TT
CLASS="OPTION"
>-c</TT
>と<TT
CLASS="OPTION"
>-f</TT
>コマンドラインオプションに対応しました。
(Pavel Stehule, Catalin Iacob)
       </P
><P
>指定した操作は与えられたオプションの順に実行され、その後<SPAN
CLASS="APPLICATION"
>psql</SPAN
>が終了します。
       </P
></LI
><LI
><P
>問い合わせ結果をクロス表表示で出力する<TT
CLASS="COMMAND"
>\crosstabview</TT
>コマンドを追加しました。
       </P
><P
>クロス表表示では、ひとつの問い合わせの結果列のデータ値が出力表に配置されます。出力表の行、列のヘッダは問い合わせの別の結果列からきています。
       </P
></LI
><LI
><P
>最大の冗長度で最後のサーバエラーを表示する<TT
CLASS="LITERAL"
>\errverbose</TT
>コマンドを追加しました。
(Alex Shulgin)
       </P
><P
>予期せぬエラーを受け取った後、これは便利です。
もはや、<TT
CLASS="VARNAME"
>VERBOSITY</TT
>変数を調整してデフォルトでは見られないエラーフィールドを見るために失敗を再現する必要はありません。
       </P
></LI
><LI
><P
>ビュー定義の編集と表示をする<TT
CLASS="LITERAL"
>\ev</TT
>および<TT
CLASS="LITERAL"
>\sv</TT
>コマンドを追加しました。
(Petr Korobeinikov)
       </P
><P
>これらは関数に対する既存の<TT
CLASS="LITERAL"
>\ef</TT
>および<TT
CLASS="LITERAL"
>\sf</TT
>コマンドに対応するものです。
       </P
></LI
><LI
><P
>問い合わせを実行して、その結果を新たな問い合わせとして再実行する<TT
CLASS="COMMAND"
>\gexec</TT
>コマンドを追加しました。
(Corey Huinker)
       </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>\C <TT
CLASS="REPLACEABLE"
><I
>string</I
></TT
></TT
>との一貫性のため、<TT
CLASS="LITERAL"
>\pset C <TT
CLASS="REPLACEABLE"
><I
>string</I
></TT
></TT
>でテーブルタイトルを設定できるようにしました。
(Bruce Momjian)
       </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>\pset expanded auto</TT
>モードで、一つだけの列からなる問い合わせ結果については拡張書式を使わないようにしました。
(Andreas Karlsson, Robert Haas)
       </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>\watch</TT
>コマンドによるヘッダ出力を改善しました。
(Michael Paquier, Tom Lane)
       </P
><P
><TT
CLASS="COMMAND"
>\pset title</TT
>の文字列がセットされていたならをそれをヘッダ出力に含めます。また、ヘッダの規格通りの部分を<TT
CLASS="LITERAL"
><TT
CLASS="REPLACEABLE"
><I
>timestamp</I
></TT
> (every <TT
CLASS="REPLACEABLE"
><I
>N</I
></TT
>s)</TT
>と、短くしました。
また、タイムスタンプ書式は<SPAN
CLASS="APPLICATION"
>psql</SPAN
>のロケール環境に従うようになります。
       </P
></LI
><LI
><P
>現在行だけでなく入力の問い合わせ全体を考慮するようにタブ補完ロジックを改善しました。
(Tom Lane)
       </P
><P
>これまではコマンドが複数行に分かれることで、手前の行の語を見る必要のある全てのタブ補完ルールが無効になっていました。
       </P
></LI
><LI
><P
>タブ補完動作の多数の細かな改善。
(Peter Eisentraut, Vik Fearing, Kevin Grittner, Kyotaro Horiguchi, Jeff Janes, Andreas Karlsson, Fujii Masao, Thomas Munro, Masahiko Sawada, Pavel Stehule)
       </P
></LI
><LI
><P
>接続されたバックエンドのプロセスIDを挿入する<TT
CLASS="LITERAL"
>PROMPT</TT
>オプション<TT
CLASS="LITERAL"
>%p</TT
>を追加しました。
(Julien Rouhaud)
       </P
></LI
><LI
><P
>常に、あるいは非エラーメッセージ限定、のいずれかでメッセージの<TT
CLASS="LITERAL"
>CONTEXT</TT
>フィールドを抑止できる機能を導入しました。
(Pavel Stehule)
       </P
><P
>現在のデフォルト動作ではエラーの場合のみ<TT
CLASS="LITERAL"
>CONTEXT</TT
>を出力します。
特別変数<TT
CLASS="VARNAME"
>SHOW_CONTEXT</TT
>を設定することでこれを変更できます。
       </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>\df+</TT
>が関数のアクセス権限とパラレルセーフ属性を表示するようにしました。
(Michael Paquier)
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN132590"
>E.6.3.10.2. <A
HREF="pgbench.html"
><SPAN
CLASS="APPLICATION"
>pgbench</SPAN
></A
></A
></H4
><P
></P
><UL
><LI
><P
><SPAN
CLASS="APPLICATION"
>pgbench</SPAN
>スクリプト内のSQLコマンドは改行ではなく、セミコロンで終了するものとしました。
(Kyotaro Horiguchi, Tom Lane)
       </P
><P
>この変更はスクリプト内の複数行にわたるSQLコマンドを可能にします。
現存のカスタムスクリプトは、各行末にセミコロンが未だ無ければ加える修正が必要でしょう。
（そのようにすることは、旧バージョン<SPAN
CLASS="APPLICATION"
>pgbench</SPAN
>むけのスクリプトを壊しません）
       </P
></LI
><LI
><P
>バックスラッシュコマンドの式で<A
HREF="pgbench.html#PGBENCH-BUILTIN-FUNCTIONS"
>組み込み関数</A
>、および、浮動小数点演算に対応しました。
(Fabien Coelho)
       </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>\setrandom</TT
>を組み込み関数で置き換えました。
(Fabien Coelho)
       </P
><P
>新たに組み込み関数<A
HREF="pgbench.html#PGBENCH-FUNCTIONS"
><CODE
CLASS="FUNCTION"
>random()</CODE
></A
>、<CODE
CLASS="FUNCTION"
>random_exponential()</CODE
>、<CODE
CLASS="FUNCTION"
>random_gaussian()</CODE
>を追加しました。
これらは<TT
CLASS="COMMAND"
>\setrandom</TT
>と同じ働きをしますが、大きい式に組み入れることができるのでより使いやすいです。
これら関数の追加で不要になったため、<TT
CLASS="COMMAND"
>\setrandom</TT
>を除去しました。
       </P
></LI
><LI
><P
>カスタムスクリプトだけでなく、組み込みのスクリプトの複数の複製を起動できるようにしました。
(Fabien Coelho)
       </P
><P
>これは<TT
CLASS="OPTION"
>-f</TT
>と似たように働く、カスタムスクリプトむけの新たな<TT
CLASS="OPTION"
>-b</TT
>スイッチにより実行されます。
       </P
></LI
><LI
><P
>スクリプトの選択率（重み）を変更できるようにしました。
(Fabien Coelho)
       </P
><P
>複数スクリプトが指定されたとき、各<SPAN
CLASS="APPLICATION"
>pgbench</SPAN
>トランザクションは実行するものをランダムに選びます。
これまでこれは常に均等な確率で行われていましたが、これからは異なるスクリプトに異なる選択率を指定することができます。
       </P
></LI
><LI
><P
>複数スクリプトの実行において、各スクリプトむけに統計情報を収集するようにしました。
(Fabien Coelho)
       </P
><P
>この機能は既にある全体統計とコマンド毎統計に対して、中間の詳細度を追加します。
       </P
></LI
><LI
><P
>実行開始からの時間の代わりにUnixエポックタイムスタンプで進行を報告する<TT
CLASS="OPTION"
>--progress-timestamp</TT
>オプションを追加しました。
(Fabien Coelho)
       </P
></LI
><LI
><P
>クライアント接続数(<TT
CLASS="OPTION"
>-c</TT
>)がスレッド数(<TT
CLASS="OPTION"
>-j</TT
>)の倍数でなくてもよくしました。
(Fabien Coelho)
       </P
></LI
><LI
><P
><TT
CLASS="OPTION"
>-T</TT
>オプションが使われているとき、指定時間の終わりで直ちに終了するようにしました。
(Fabien Coelho)
       </P
><P
>これまでは、低いトランザクションレートが指定されていると<SPAN
CLASS="APPLICATION"
>pgbench</SPAN
>が指定よりもかなり長く待つ可能性がありました。
       </P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN132636"
>E.6.3.11. サーバアプリケーション</A
></H3
><P
></P
><UL
><LI
><P
><SPAN
CLASS="APPLICATION"
>initdb</SPAN
>のブートストラップ後フェーズにおけるエラー報告を改善しました。
(Tom Lane)
       </P
><P
>これまでは、ここでのエラーは入力ファイル全体を<SPAN
CLASS="QUOTE"
>"失敗している問い合わせ"</SPAN
>として報告するものになっていました。
これからは、現在の問い合わせだけが報告されます。
この望まれる動作を得るため、<SPAN
CLASS="APPLICATION"
>initdb</SPAN
>の入力ファイルの問い合わせは空行で区切られなければなりません。
       </P
></LI
><LI
><P
>ブートストラップ後の処理の全てに単一のスタンドアローンバックエンドセッションを使うことで<SPAN
CLASS="APPLICATION"
>initdb</SPAN
>を高速化しました。
       </P
></LI
><LI
><P
>ターゲットタイムラインが変化するときでも動作するように<A
HREF="app-pgrewind.html"
><SPAN
CLASS="APPLICATION"
>pg_rewind</SPAN
></A
>を改善しました。
(Alexander Korotkov)
       </P
><P
>例えば、昇格したスタンバイを旧マスタのタイムラインのどこかの状態に巻き戻すことができます。
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN132653"
>E.6.3.12. ソースコード</A
></H3
><P
></P
><UL
><LI
><P
>廃れた<CODE
CLASS="FUNCTION"
>heap_formtuple</CODE
>/<CODE
CLASS="FUNCTION"
>heap_modifytuple</CODE
>/<CODE
CLASS="FUNCTION"
>heap_deformtuple</CODE
>関数を除去しました。
(Peter Geoghegan)
       </P
></LI
><LI
><P
><CODE
CLASS="FUNCTION"
>AllocSetContextCreate()</CODE
>呼び出しをシンプルで安全にするマクロを追加しました。
(Tom Lane)
       </P
><P
>新たなマクロ<TT
CLASS="SYMBOL"
>ALLOCSET_DEFAULT_SIZES</TT
>、<TT
CLASS="SYMBOL"
>ALLOCSET_SMALL_SIZES</TT
>、<TT
CLASS="SYMBOL"
>ALLOCSET_START_SMALL_SIZES</TT
>の一つを使うことが推奨され、メモリコンテキストむけに個別のサイズパラメータを書き出すことは非推奨となりました。
しかしながら、既存のコードは引き続き動作します。
       </P
></LI
><LI
><P
>ヘッダファイルに無条件で<TT
CLASS="LITERAL"
>static inline</TT
>関数を使うようにしました。
(Andres Freund)
       </P
><P
>これはとても古いコンパイラでは警告および/または無駄なコードスペースをもたらすかもしれませんが、表記法の改善はそうするだけの価値があると思われます。
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>TAP</SPAN
>テスト基盤を改善しました。
(Michael Paquier, Craig Ringer, &Aacute;lvaro Herrera, Stephen Frost)
       </P
><P
>特に、この基盤を使ってリカバリシナリオをテストできるようになりました。
       </P
></LI
><LI
><P
><TT
CLASS="VARNAME"
>trace_lwlocks</TT
>が各ロックを名前で識別するようにしました。
(Robert Haas)
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>psql</SPAN
>のタブ補完のコード基盤を改善しました。
(Thomas Munro, Michael Paquier)
       </P
><P
>タブ補完規則がかなり容易に書けるようになり、また、よりコンパクトになりました。
       </P
></LI
><LI
><P
>接続認証の間のアクセスで利用可能になるように、<TT
CLASS="STRUCTNAME"
>pg_shseclabel</TT
>システムカタログをキャッシュに釘づけにしました。
(Adam Brightwell)
       </P
><P
>コアコードはこのカタログを認証に使いませんが、拡張が参照したいかもしれません。
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>C</SPAN
>レベルの大部分を隠すように<A
HREF="indexam.html"
>インデックスアクセスメソッド<ACRONYM
CLASS="ACRONYM"
>API</ACRONYM
></A
>再構築しました。
(Alexander Korotkov, Andrew Gierth)
       </P
><P
>本変更はインデックス<ACRONYM
CLASS="ACRONYM"
>AM API</ACRONYM
>を外部データラッパーやテーブルサンプルハンドラに適用したデザインと同様に現代化します。
これは<SPAN
CLASS="APPLICATION"
>C</SPAN
>コードをシンプルにし、組み込み可能な拡張でインデックスアクセスメソッドを定義することをより実用的にします。
結果として、大部分の<TT
CLASS="STRUCTNAME"
>pg_am</TT
>システムカタログの列はなくなりました。
インデックスAMのこれまで<TT
CLASS="STRUCTNAME"
>pg_am</TT
>にあった属性情報をSQL問い合わせで調べることができる新たな<A
HREF="functions-info.html#FUNCTIONS-INFO-CATALOG-TABLE"
>検査関数</A
>が追加されました。
       </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>initdb</SPAN
>や拡張で作られたオブジェクトの元の権限を保持する<A
HREF="catalog-pg-init-privs.html"
><TT
CLASS="STRUCTNAME"
>pg_init_privs</TT
></A
>システムカタログを追加しました。
(Stephen Frost)
       </P
><P
>この基盤は<SPAN
CLASS="APPLICATION"
>pg_dump</SPAN
>がインストレーションでシステムオブジェクトに加えられた権限の変更をダンプできるようにします。
以前はこのような変更はダンプとリロードで失われていましたが、これからは保存されます。
       </P
></LI
><LI
><P
>拡張がカスタム<TT
CLASS="LITERAL"
>LWLocks</TT
>を割り当てる方法を変更しました。
(Amit Kapila, Robert Haas)
       </P
><P
><CODE
CLASS="FUNCTION"
>RequestAddinLWLocks()</CODE
>関数は削除され、<CODE
CLASS="FUNCTION"
>RequestNamedLWLockTranche()</CODE
>に置き換えられました。
これによりカスタム<TT
CLASS="LITERAL"
>LWLocks</TT
>の識別を改善し、間違いやすさを軽減します。
       </P
></LI
><LI
><P
>複数セッションが同時に待機できるように隔離テスタを改善して、デッドロックシナリオのテストが可能になります。
(Robert Haas)
       </P
></LI
><LI
><P
>拡張可能なノードタイプを導入しました。
(KaiGai Kohei)
       </P
><P
>本変更は<SPAN
CLASS="APPLICATION"
>FDW</SPAN
>あるいはカスタムスキャンプロバイダがプランツリーに従来可能なものよりも便利な形式でデータを置けるようにします。
       </P
></LI
><LI
><P
>プランナがスキャン/結合後の問い合わせ処理段階で<TT
CLASS="LITERAL"
>Paths</TT
>を生成比較することで処理するようにし、多数のアドホックなロジックと置き換えました。
(Tom Lane)
       </P
><P
>この変更は現時点ではユーザに見える改善は僅かしかもたらしませんが、古いコード構造を用いた取り組みでは現実的でなかった、将来の多数の上位プランナ改良を可能にします。
       </P
></LI
><LI
><P
>部分的な集約に対応しました。
(David Rowley, Simon Riggs)
       </P
><P
>本変更は、集約関数の計算を分割された部分に分けることを可能にし、それにより例えばパラレルワーカープロセスが一つの集約の計算を協力して実行できるようにします。
将来的には、ローカルとリモートのデータを横断した集約を部分的にリモート先で行うことが可能になるかもしれません。
       </P
></LI
><LI
><P
>汎用のコマンド進捗報告基盤を追加しました。
(Vinayak Pokale, Rahila Syed, Amit Langote, Robert Haas)
       </P
></LI
><LI
><P
>他のクライアントプログラムから使えるようにするため、<SPAN
CLASS="APPLICATION"
>psql</SPAN
>の<SPAN
CLASS="APPLICATION"
>flex</SPAN
>字句解析を分離しました。
(Tom Lane, Kyotaro Horiguchi)
       </P
><P
>これはコマンド境界を識別するSQLコマンド解析を要するプログラムからコード重複を排除します。
完全な普遍性をもってこれを行うことは望まれているものと比べ困難で、実際いまのところはサポートされるクライアントプログラムの中で<SPAN
CLASS="APPLICATION"
>psql</SPAN
>だけがうまく対応しました。
       </P
><P
>これと他のクライアントプログラム間で共有されるコードを置くため新たなソースコードのサブディレクトリ<TT
CLASS="FILENAME"
>src/fe_utils/</TT
>が作られました。
以前はこのような共有は、見苦しく重複したコンパイルを要する、シンボリックリンクやビルド時のソースファイルのコピーで実現されていました。
       </P
></LI
><LI
><P
>ある待機から次にたいてい変化しないイベントセットの効果的な待機を可能とする<TT
CLASS="LITERAL"
>WaitEventSet</TT
> <ACRONYM
CLASS="ACRONYM"
>API</ACRONYM
>を導入しました。
(Andres Freund, Amit Kapila)
       </P
></LI
><LI
><P
><ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>レコード書き込みの一般インターフェイスを追加しました。
(Alexander Korotkov, Petr Jel&iacute;nek, Markus Nullmeier)
       </P
><P
>本変更は拡張が標準レイアウトでページ変更の<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>レコードを書くことを可能にします。
拡張にアクセスすることなく<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>のリプレイを要する問題は、一般リプレイコードを持つことで解決されました。
これは例えばインデックスアクセスメソッドとその<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>対応など、拡張での実装を可能にします。
       </P
></LI
><LI
><P
>ロジカルデコーディングの一般<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>メッセージに対応しました。
(Petr Jel&iacute;nek, Andres Freund)
       </P
><P
>この機能は拡張がロジカルデコーディングプラグインで読み取り可能なデータを<ACRONYM
CLASS="ACRONYM"
>WAL</ACRONYM
>ストリームに挿入できるようにしますが、物理データ再構築には関係しません。
       </P
></LI
><LI
><P
>SP-GiST演算子クラスがインデックスをたどるときに任意の<SPAN
CLASS="QUOTE"
>"横断値"</SPAN
>を置けるようにしました。
(Alexander Lebedev, Teodor Sigaev)
       </P
><P
>これは<SPAN
CLASS="QUOTE"
>"再構築された値"</SPAN
>に似たものですが、任意のデータチャンクにできて、インデックス列と同じデータ型の必要がありません。
       </P
></LI
><LI
><P
><CODE
CLASS="FUNCTION"
>ereport()</CODE
>に<TT
CLASS="LITERAL"
>LOG_SERVER_ONLY</TT
>メッセージレベルを導入しました。
(David Steele)
       </P
><P
>本レベルはメッセージが決してクライアントに送られない点を除き、<TT
CLASS="LITERAL"
>LOG</TT
>のように動作します。
これは監査等の用途で使う想定です。
       </P
></LI
><LI
><P
>全ての生成されるヘッダファイルをビルドする<TT
CLASS="FILENAME"
>Makefile</TT
>ターゲットを提供しました。
(Michael Paquier, Tom Lane)
       </P
><P
><TT
CLASS="LITERAL"
>submake-generated-headers</TT
>を実行して、バックエンドヘッダファイルを確実に最新状態にすることができます。
これは<SPAN
CLASS="QUOTE"
>"スタンドアローン"</SPAN
>でビルドされるサブディレクトリにおいて便利です。
       </P
></LI
><LI
><P
>OpenSSL 1.1.0に対応しました。
(Andreas Karlsson, Heikki Linnakangas)
       </P
></LI
></UL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN132770"
>E.6.3.13. 追加モジュール</A
></H3
><P
></P
><UL
><LI
><P
><A
HREF="auto-explain.html"
><TT
CLASS="FILENAME"
>contrib/auto_explain</TT
></A
>で全問い合わせのうち設定可能な少量だけを採取できるようにする設定パラメータ<TT
CLASS="LITERAL"
>auto_explain.sample_rate</TT
>を追加しました。
(Craig Ringer, Julien Rouhaud)
       </P
><P
>これにより重い問い合わせ流量のオーバーヘッドが軽減できる一方、概してなお有用な情報を取得できます。
       </P
></LI
><LI
><P
>ブルームフィルタリングに基づくインデックスアクセスメソッドを実装した<A
HREF="bloom.html"
><TT
CLASS="FILENAME"
>contrib/bloom</TT
></A
>モジュールを追加しました。
(Teodor Sigaev, Alexander Korotkov)
       </P
><P
>これは主として本体以外のインデックスアクセスメソッドの概念実証ですが、多数の列を検索する問い合わせに対するこのモジュール本来の能力が有用であるかもしれません。
       </P
></LI
><LI
><P
><A
HREF="cube.html"
><TT
CLASS="FILENAME"
>contrib/cube</TT
></A
>で立体の距離演算子を導入し、また、立体列のGiSTインデックスでkNN方式の検索に対応しました。
(Stas Kelvich)
       </P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>contrib/hstore</TT
>の<A
HREF="hstore.html#HSTORE-FUNC-TABLE"
><CODE
CLASS="FUNCTION"
>hstore_to_jsonb_loose()</CODE
></A
>および<CODE
CLASS="FUNCTION"
>hstore_to_json_loose()</CODE
>関数で何が数値であるかの認識を一致させました。
(Tom Lane)
       </P
><P
>これまで、<CODE
CLASS="FUNCTION"
>hstore_to_jsonb_loose()</CODE
>は、<ACRONYM
CLASS="ACRONYM"
>JSON</ACRONYM
>構文の数値の仕様に厳密に一致していなくとも、数値に見える文字列を文字列でなく<ACRONYM
CLASS="ACRONYM"
>JSON</ACRONYM
>数値に変換していました。
この動作は<CODE
CLASS="FUNCTION"
>hstore_to_json_loose()</CODE
>と一致せず、それで<ACRONYM
CLASS="ACRONYM"
>JSON</ACRONYM
>構文に合わせるように厳格化しました。
       </P
></LI
><LI
><P
><A
HREF="intarray.html"
><TT
CLASS="FILENAME"
>contrib/intarray</TT
></A
>の演算子に、これら演算子を使ったプランを改善するため、選択度推定関数を追加しました。
(Yury Zhuravlev, Alexander Korotkov)
       </P
></LI
><LI
><P
><A
HREF="pageinspect.html"
><TT
CLASS="FILENAME"
>contrib/pageinspect</TT
></A
>の<CODE
CLASS="FUNCTION"
>heap_page_items()</CODE
>関数が各タプルの生データを表示するようにしました。
また、各タプルフィールドを調べる新たな関数<CODE
CLASS="FUNCTION"
>tuple_data_split()</CODE
>および<CODE
CLASS="FUNCTION"
>heap_page_item_attrs()</CODE
>を追加しました。 
(Nikolay Shaplov)
       </P
></LI
><LI
><P
><A
HREF="pgcrypto.html"
><TT
CLASS="FILENAME"
>contrib/pgcrypto</TT
></A
>の<CODE
CLASS="FUNCTION"
>pgp_sym_encrypt()</CODE
>関数にオプションとして<TT
CLASS="LITERAL"
>S2K</TT
>イテレーションカウントパラメータを追加しました。
(Jeff Janes)
       </P
></LI
><LI
><P
><A
HREF="pgtrgm.html"
><TT
CLASS="FILENAME"
>contrib/pg_trgm</TT
></A
>に<SPAN
CLASS="QUOTE"
>"単語類似度"</SPAN
>のサポートを加えました。
(Alexander Korotkov, Artur Zakirov)
       </P
><P
>これらの関数と演算子はある文字列と別の文字列の中のもっとも類似した一つの単語との類似度を測ります。
       </P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>contrib/pg_trgm</TT
>の類似度の閾値を指定する設定パラメータ<TT
CLASS="VARNAME"
>pg_trgm.similarity_threshold</TT
>を追加しました。
(Artur Zakirov)
       </P
><P
>この閾値は以前から設定可能でしたが、これまでは専用の関数<CODE
CLASS="FUNCTION"
>set_limit()</CODE
>、<CODE
CLASS="FUNCTION"
>show_limit()</CODE
>で制御されていました。
これらは非推奨となります。
       </P
></LI
><LI
><P
>よくあるキーと稀なキーが両方現れる場合のインデックス検索の速度を上げるように<TT
CLASS="FILENAME"
>contrib/pg_trgm</TT
>のGIN演算子クラスを改善しました。
(Jeff Janes)
       </P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>contrib/pg_trgm</TT
>のGINインデックスで類似度検索の性能を改善しました。
(Christophe Fornaroli)
       </P
></LI
><LI
><P
>テーブルの可視性マップを検査できる<A
HREF="pgvisibility.html"
><TT
CLASS="FILENAME"
>contrib/pg_visibility</TT
></A
>モジュールを追加しました。
(Robert Haas)
       </P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>contrib/sslinfo</TT
>に<A
HREF="sslinfo.html"
><CODE
CLASS="FUNCTION"
>ssl_extension_info()</CODE
></A
>関数を追加しました。
現在の接続に使われている<TT
CLASS="LITERAL"
>X509</TT
>証明書に含まれる<ACRONYM
CLASS="ACRONYM"
>SSL</ACRONYM
>拡張情報を出力します。
(Dmitry Voronin)
       </P
></LI
></UL
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN132847"
>E.6.3.13.1. <A
HREF="postgres-fdw.html"
><TT
CLASS="FILENAME"
>postgres_fdw</TT
></A
></A
></H4
><P
></P
><UL
><LI
><P
>外部サーバのオプションでホワイトリストに含まれている拡張であれば、拡張で提供される演算子と関数をリモート実行に送れるようにしました。
(Paul Ramsey)
       </P
><P
>互換性のあるバージョンの拡張がリモートサーバに在るとき、ユーザはこの機能を有効にできます。
これは拡張の演算子を伴う問い合わせのより効果的な実行を可能にします。
       </P
></LI
><LI
><P
>リモートサーバ上でのソートを検討するようにしました。
(Ashutosh Bapat)
       </P
></LI
><LI
><P
>リモートサーバ上での結合を検討するようにしました。
(Shigeru Hanada, Ashutosh Bapat)
       </P
></LI
><LI
><P
>可能であれば<TT
CLASS="COMMAND"
>UPDATE</TT
>や<TT
CLASS="COMMAND"
>DELETE</TT
>を全面的にリモートサーバ上で実行するようにしました。
(Etsuro Fujita)
       </P
><P
>これまではリモート更新は<TT
CLASS="COMMAND"
>SELECT FOR UPDATE</TT
>コマンドの送信とその後の選択された行の一行ずつの更新や削除を伴いました。
問い合わせのすべての要素がリモートサーバに送って差し支えないならリモートで実行できるようになりますが、一方で演算が何等かローカル処理を必要とするならこの動作はなお必要です。
       </P
></LI
><LI
><P
>取り出しサイズをサーバやテーブルのオプションとして設定可能にしました。
(Corey Huinker)
       </P
><P
>これまでは<TT
CLASS="FILENAME"
>postgres_fdw</TT
>は常にリモート問い合わせから一度に100行を取り出ししていました。この動作が調整可能になりました。
       </P
></LI
><LI
><P
>全て同じリモートユーザにマップしている複数ローカルユーザIDが単一の外部サーバ接続を使うようにしました。
(Ashutosh Bapat)
       </P
></LI
><LI
><P
>リモートサーバに問い合わせキャンセル要求を伝播するようにしました。
(Michael Paquier, Etsuro Fujita)
       </P
><P
>これまでは、ローカル問い合わせのキャンセル要求は送信済みのリモート問い合わせを早く終了させませんでした。
       </P
></LI
></UL
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="release-9-6-1.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="release-9-5-9.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>リリース9.6.1</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="release.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>リリース9.5.9</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>