<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>バイナリ列データ型</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.5.2文書"
HREF="index.html"><LINK
REL="UP"
TITLE="データ型"
HREF="datatype.html"><LINK
REL="PREVIOUS"
TITLE="文字型"
HREF="datatype-character.html"><LINK
REL="NEXT"
TITLE="日付/時刻データ型"
HREF="datatype-datetime.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2016-05-13T05:09:04"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.5.2文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="文字型"
HREF="datatype-character.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="datatype.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>第 8章データ型</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="日付/時刻データ型"
HREF="datatype-datetime.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DATATYPE-BINARY"
>8.4. バイナリ列データ型</A
></H1
><P
><TT
CLASS="TYPE"
>bytea</TT
>データ型はバイナリ列の保存を可能にします。
<A
HREF="datatype-binary.html#DATATYPE-BINARY-TABLE"
>表8-6</A
>を参照してください。
   </P
><DIV
CLASS="TABLE"
><A
NAME="DATATYPE-BINARY-TABLE"
></A
><P
><B
>表 8-6. バイナリ列データ型</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>型名</TH
><TH
>格納サイズ</TH
><TH
>説明</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="TYPE"
>bytea</TT
></TD
><TD
>1または4バイトと実際のバイナリ列の長さ</TD
><TD
>可変長のバイナリ列</TD
></TR
></TBODY
></TABLE
></DIV
><P
>バイナリ列はオクテット（またはバイト）の連続です。
バイナリ列は２つの点で文字列と区別されます。
1点目は、バイナリ列はゼロの値のオクテットと他の<SPAN
CLASS="QUOTE"
>"表示できない"</SPAN
>オクテット（通常32から126の範囲外のオクテット）を保存できるということです。
文字列ではゼロというオクテットは使用できません。
また、データベースで選択している文字セット符号化方式で無効なオクテット値やオクテット値の並びも使用できません。
2点目は、バイナリ列を演算すると実際のバイトが処理されるのに対して、文字列の処理はロケール設定に従うということです。
まとめると、バイナリ列はプログラマが<SPAN
CLASS="QUOTE"
>"バイト列そのもの"</SPAN
>と考えるものを格納するのに適し、文字列はテキストを格納するのに適しています。
   </P
><P
><TT
CLASS="TYPE"
>bytea</TT
>型は入出力用に2つの外部書式をサポートします。
<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>の歴史的な<SPAN
CLASS="QUOTE"
>"エスケープ"</SPAN
>書式と<SPAN
CLASS="QUOTE"
>"hex"</SPAN
>です。
入力ではこれらの両方とも常に受け入れられます。
出力書式は<A
HREF="runtime-config-client.html#GUC-BYTEA-OUTPUT"
>bytea_output</A
>設定パラメータに依存し、デフォルトではhexです。
（hex書式は<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> 9.0から導入されたものであることに注意してください。
以前のバージョンや一部のツールではこれを理解しません。）
   </P
><P
>標準<ACRONYM
CLASS="ACRONYM"
>SQL</ACRONYM
>は、<TT
CLASS="TYPE"
>BLOB</TT
>または<TT
CLASS="TYPE"
>BINARY LARGE OBJECT</TT
>という、異なるバイナリ列型を定義します。
入力書式は<TT
CLASS="TYPE"
>bytea</TT
>と異なりますが、提供される関数および演算子はほぼ同じです。
   </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN5671"
>8.4.1. <TT
CLASS="TYPE"
>bytea</TT
>のhex書式</A
></H2
><P
><SPAN
CLASS="QUOTE"
>"hex"</SPAN
>書式ではバイナリデータの各バイトを上位4ビット、下位4ビットの順で2桁の16進数に符号化します。
（エスケープ書式と区別するために）文字列全体は<TT
CLASS="LITERAL"
>\x</TT
>という並びの後に付けられます。
一部の文脈では、先頭のバックスラッシュを二重にしてエスケープさせる必要があるかもしれません。
これはエスケープ書式でバックスラッシュを二重にしなければならない場合と同じで、詳細は以下に示します。
16進数の桁は大文字でも小文字でも構いません。
桁の組み合わせと次の組み合わせの間に空白文字を入れることができます。
（しかし桁の組み合わせの間や先頭の<TT
CLASS="LITERAL"
>\x</TT
>の間には入れることはできません。）
hex書式は外部のアプリケーションおよびプロトコルの間で広く互換性を持ち、また、エスケープ書式と比べ変換が高速になる傾向があります。
このため使用が好まれます。
   </P
><P
>例
</P><PRE
CLASS="PROGRAMLISTING"
>SELECT E'\\xDEADBEEF';</PRE
><P>
   </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN5680"
>8.4.2. <TT
CLASS="TYPE"
>bytea</TT
>のエスケープ書式</A
></H2
><P
><SPAN
CLASS="QUOTE"
>"エスケープ"</SPAN
>書式は<TT
CLASS="TYPE"
>bytea</TT
>型用の伝統的な<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>の書式です。
これは、バイナリ列をASCII文字の並びとして表現しASCII文字として表現できないバイトは特殊なエスケープシーケンスとして表現するという方式を取ります。
アプリケーションの見地から文字として表現されたバイトが有意であれば、この表現は簡便です。
しかし現実にはバイナリ列と文字列の間の区別があいまいになりますので、通常は混乱します。
また選択されたこのエスケープ機構自体が多少非効率的です。
このためこの書式はおそらくほとんどの新しいアプリケーションでは避けるべきでしょう。
   </P
><P
>エスケープ書式で<TT
CLASS="TYPE"
>bytea</TT
>値を入力する際に、特定の値のオクテットをエスケープする<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>必要</I
></SPAN
>があります。
なお、すべてのオクテットの値をエスケープすることが<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>できます</I
></SPAN
>。
一般的にあるオクテットをエスケープするには、それをその3桁の8進数に変換し、バックスラッシュ(エスケープ文字列構文を使用してリテラルとして値を記述する場合は2つのバックスラッシュ)を前に付けます。
他にもバックスラッシュ自体(オクテット値92)を二重のバックスラッシュとして表現することができます。
<A
HREF="datatype-binary.html#DATATYPE-BINARY-SQLESC"
>表8-7</A
>には、エスケープする必要がある文字と、その適用可能な代替エスケープシーケンスを示しています。
   </P
><DIV
CLASS="TABLE"
><A
NAME="DATATYPE-BINARY-SQLESC"
></A
><P
><B
>表 8-7. オクテットをエスケープした<TT
CLASS="TYPE"
>bytea</TT
>リテラル</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><COL><COL><COL><THEAD
><TR
><TH
>10進オクテット値</TH
><TH
>説明</TH
><TH
>エスケープされた入力表現</TH
><TH
>例</TH
><TH
>出力表現</TH
></TR
></THEAD
><TBODY
><TR
><TD
>0</TD
><TD
>ゼロオクテット</TD
><TD
><TT
CLASS="LITERAL"
>E'\\000'</TT
></TD
><TD
><TT
CLASS="LITERAL"
>SELECT E'\\000'::bytea;</TT
></TD
><TD
><TT
CLASS="LITERAL"
>\000</TT
></TD
></TR
><TR
><TD
>39</TD
><TD
>単一引用符</TD
><TD
><TT
CLASS="LITERAL"
>''''</TT
>もしくは<TT
CLASS="LITERAL"
>E'\\047'</TT
></TD
><TD
><TT
CLASS="LITERAL"
>SELECT E'\''::bytea;</TT
></TD
><TD
><TT
CLASS="LITERAL"
>'</TT
></TD
></TR
><TR
><TD
>92</TD
><TD
>バックスラッシュ</TD
><TD
><TT
CLASS="LITERAL"
>E'\\\\'</TT
>もしくは<TT
CLASS="LITERAL"
>E'\\134'</TT
></TD
><TD
><TT
CLASS="LITERAL"
>SELECT E'\\\\'::bytea;</TT
></TD
><TD
><TT
CLASS="LITERAL"
>\\</TT
></TD
></TR
><TR
><TD
>0から31まで、および127から255まで</TD
><TD
><SPAN
CLASS="QUOTE"
>"表示できない"</SPAN
>オクテット</TD
><TD
><TT
CLASS="LITERAL"
>E'\\<TT
CLASS="REPLACEABLE"
><I
>xxx'</I
></TT
></TT
> (8進数)</TD
><TD
><TT
CLASS="LITERAL"
>SELECT E'\\001'::bytea;</TT
></TD
><TD
><TT
CLASS="LITERAL"
>\001</TT
></TD
></TR
></TBODY
></TABLE
></DIV
><P
>実際には、<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>表示できない</I
></SPAN
>オクテットに対するエスケープ要求はロケールの設定に依存して異なります。
ロケールの設定によっては、エスケープをしないで済むこともあります。
<A
HREF="datatype-binary.html#DATATYPE-BINARY-SQLESC"
>表8-7</A
>の例の各結果は、出力表現が時として2文字以上であっても、長さは正確に1オクテットであることに注意してください。
   </P
><P
><A
HREF="datatype-binary.html#DATATYPE-BINARY-SQLESC"
>表8-7</A
>で示したように、複数バックスラッシュが必要な理由は、文字列リテラルとして記述された入力文字列は、<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>サーバ上で2つの解析段階を通過する必要があることです。
各組み合わせの最初のバックスラッシュは文字列リテラル用パーサでエスケープ文字と解釈（エスケープ文字列構文の使用を前提）され、2番目のバックスラッシュを残して、そこで消費されます。
（この段階のエスケープを避けるためにドル引用符による文字列を使用することができます。）
残りのバックスラッシュは、<TT
CLASS="TYPE"
>bytea</TT
>入力関数が3桁のオクテット値の先頭に付く記号、もしくは、他のバックスラッシュをエスケープする記号として認識します。
例えば、<TT
CLASS="LITERAL"
>E'\\001'</TT
>としてサーバに渡された文字列リテラルは、エスケープ文字列パーサを通過した後<TT
CLASS="LITERAL"
>\001</TT
>のようになります。
<TT
CLASS="LITERAL"
>\001</TT
>はその後<TT
CLASS="TYPE"
>bytea</TT
>入力関数に送られ、10進数値1の1つのオクテットに変換されます。
単一引用符文字は<TT
CLASS="TYPE"
>bytea</TT
>では特別に扱われず、通常の文字列リテラルの規則に従うことに注意してください。
（<A
HREF="sql-syntax-lexical.html#SQL-SYNTAX-STRINGS"
>項4.1.2.1</A
>も参照してください。）
   </P
><P
>また、<TT
CLASS="TYPE"
>Bytea</TT
>オクテットは出力時も時々エスケープされます。
一般的には、各<SPAN
CLASS="QUOTE"
>"表示できない"</SPAN
>オクテットは、1つのバックスラッシュの後に等価な3桁8進数という形に変換されます。
ほとんどの<SPAN
CLASS="QUOTE"
>"表示できる"</SPAN
>オクテットは、クライアント文字セットにおける標準表現で表されます。
10進数で92となるオクテット（バックスラッシュ）は出力では二重になります。
詳細は<A
HREF="datatype-binary.html#DATATYPE-BINARY-RESESC"
>表8-8</A
>に示します。
   </P
><DIV
CLASS="TABLE"
><A
NAME="DATATYPE-BINARY-RESESC"
></A
><P
><B
>表 8-8. <TT
CLASS="TYPE"
>bytea</TT
>出力のエスケープされたオクテット</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><COL><COL><COL><THEAD
><TR
><TH
>10進オクテット値</TH
><TH
>説明</TH
><TH
>エスケープされた出力表現</TH
><TH
>例</TH
><TH
>出力結果</TH
></TR
></THEAD
><TBODY
><TR
><TD
>92</TD
><TD
>バックスラッシュ</TD
><TD
><TT
CLASS="LITERAL"
>\\</TT
></TD
><TD
><TT
CLASS="LITERAL"
>SELECT E'\\134'::bytea;</TT
></TD
><TD
><TT
CLASS="LITERAL"
>\\</TT
></TD
></TR
><TR
><TD
>0から31および127から255</TD
><TD
><SPAN
CLASS="QUOTE"
>"表示できない"</SPAN
>オクテット</TD
><TD
><TT
CLASS="LITERAL"
>\<TT
CLASS="REPLACEABLE"
><I
>xxx</I
></TT
></TT
>（8進数）</TD
><TD
><TT
CLASS="LITERAL"
>SELECT E'\\001'::bytea;</TT
></TD
><TD
><TT
CLASS="LITERAL"
>\001</TT
></TD
></TR
><TR
><TD
>32から126</TD
><TD
><SPAN
CLASS="QUOTE"
>"表示できる"</SPAN
>オクテット</TD
><TD
>クライアント文字セットにおける表現</TD
><TD
><TT
CLASS="LITERAL"
>SELECT E'\\176'::bytea;</TT
></TD
><TD
><TT
CLASS="LITERAL"
>~</TT
></TD
></TR
></TBODY
></TABLE
></DIV
><P
>使用する<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>のフロントエンドによっては、<TT
CLASS="TYPE"
>bytea</TT
>文字列をエスケープまたはアンエスケープする際に、追加的な作業が必要になることがあります。
例えば、使用するインタフェースが改行文字や復帰文字を自動的に翻訳してしまう場合、これらの文字もエスケープしなければならないかもしれません。
   </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="datatype-character.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="datatype-datetime.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>文字型</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="datatype.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>日付/時刻データ型</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>