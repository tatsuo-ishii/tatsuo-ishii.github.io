<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>REINDEX</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.5.2文書"
HREF="index.html"><LINK
REL="UP"
TITLE="SQLコマンド"
HREF="sql-commands.html"><LINK
REL="PREVIOUS"
TITLE="REFRESH MATERIALIZED VIEW"
HREF="sql-refreshmaterializedview.html"><LINK
REL="NEXT"
TITLE="RELEASE SAVEPOINT"
HREF="sql-release-savepoint.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2016-05-13T05:09:04"></HEAD
><BODY
CLASS="REFENTRY"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.5.2文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="REFRESH MATERIALIZED VIEW"
HREF="sql-refreshmaterializedview.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="sql-commands.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="RELEASE SAVEPOINT"
HREF="sql-release-savepoint.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="SQL-REINDEX"
></A
>REINDEX</H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN85769"
></A
><H2
>名前</H2
>REINDEX&nbsp;--&nbsp;インデックスを再構築する</DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN85772"
></A
><H2
>概要</H2
><PRE
CLASS="SYNOPSIS"
>REINDEX [ ( VERBOSE ) ] { INDEX | TABLE | SCHEMA | DATABASE | SYSTEM } <TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
></PRE
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN85775"
></A
><H2
>説明</H2
><P
><TT
CLASS="COMMAND"
>REINDEX</TT
>は、インデックスのテーブルに保存されたデータを使用してインデックスを再構築し、古いインデックスのコピーと置き換えます。
以下に<TT
CLASS="COMMAND"
>REINDEX</TT
>が使用される状況を示します。

   <P
></P
></P><UL
><LI
><P
>インデックスが破損してしまい、有効なデータがなくなった場合です。
理論的には決して起こらないはずですが、実際には、ソフトウェアのバグやハードウェアの障害によりインデックスが破損することがあります。
<TT
CLASS="COMMAND"
>REINDEX</TT
>はこの修復手段を提供します。
     </P
></LI
><LI
><P
>インデックスが<SPAN
CLASS="QUOTE"
>"膨張状態"</SPAN
>、つまり、多くの空、もしくは、ほとんど空のページを持つ状態になっている場合です。
この状況は、<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>のB-treeインデックスが特定の普通でないパターンでアクセスされた場合に起こり得ます。
<TT
CLASS="COMMAND"
>REINDEX</TT
>を使って、使用されないページを取り除いた新しいインデックス作成すると、インデックスの領域消費量を減少することができます。
詳細は<A
HREF="routine-reindex.html"
>項23.2</A
>を参照してください。
     </P
></LI
><LI
><P
>インデックスの格納パラメータ（フィルファクタなど）を変更し、この変更を確実に有効にしたい場合です。
     </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>CONCURRENTLY</TT
>オプションをつけたインデックス作成が失敗し、<SPAN
CLASS="QUOTE"
>"無効な"</SPAN
>インデックスが残った場合です。
こうしたインデックスは使用されませんが、<TT
CLASS="COMMAND"
>REINDEX</TT
>を使用して再作成するのが便利かもしれません。
<TT
CLASS="COMMAND"
>REINDEX</TT
>では同時構築ができないことに注意してください。
運用に影響を与えずにインデックスを作成するためには、インデックスを削除してから<TT
CLASS="COMMAND"
>CREATE INDEX CONCURRENTLY</TT
>コマンドを再発行しなければなりません。
     </P
></LI
></UL
><P></P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN85799"
></A
><H2
>パラメータ</H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>INDEX</TT
></DT
><DD
><P
>指定したインデックスを再作成します。
     </P
></DD
><DT
><TT
CLASS="LITERAL"
>TABLE</TT
></DT
><DD
><P
>指定したテーブルの全インデックスを再作成します。
テーブルに2次的な<SPAN
CLASS="QUOTE"
>"TOAST"</SPAN
>テーブルがある場合、それについてもインデックスを再作成します。
     </P
></DD
><DT
><TT
CLASS="LITERAL"
>SCHEMA</TT
></DT
><DD
><P
>指定したスキーマのすべてのインデックスを再作成します。
このスキーマのテーブルが二次的な<SPAN
CLASS="QUOTE"
>"TOAST"</SPAN
>テーブルを持っている場合は、そのインデックスも再作成されます。
共有システムカタログのインデックスも処理されます。
この構文の<TT
CLASS="COMMAND"
>REINDEX</TT
>はトランザクションブロックの内側で実行することはできません。
     </P
></DD
><DT
><TT
CLASS="LITERAL"
>DATABASE</TT
></DT
><DD
><P
>現在のデータベースのすべてのインデックスを再作成します。
共有システムカタログのインデックスも処理されます。
この構文の<TT
CLASS="COMMAND"
>REINDEX</TT
>をトランザクションブロック内で実行することはできません。
     </P
></DD
><DT
><TT
CLASS="LITERAL"
>SYSTEM</TT
></DT
><DD
><P
>現在のデータベースのシステムカタログに対するすべてのインデックスを再作成します。
共有システムカタログのインデックスも含みます。
ユーザテーブルのインデックスは処理されません。
この構文の<TT
CLASS="COMMAND"
>REINDEX</TT
>をトランザクションブロック内で実行することはできません。
     </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
></DT
><DD
><P
>インデックスを再作成するインデックス、テーブル、データベースの名前です。
インデックスとテーブルはスキーマ修飾可能です。
現状では、<TT
CLASS="COMMAND"
>REINDEX DATABASE</TT
>と<TT
CLASS="COMMAND"
>REINDEX SYSTEM</TT
>は現在のデータベースのインデックスのみを再作成することができます。
そのため、このパラメータは現在のデータベース名と一致する必要があります。
     </P
></DD
><DT
><TT
CLASS="LITERAL"
>VERBOSE</TT
></DT
><DD
><P
>各インデックスが再作成されるときに、進捗レポートを表示します。
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN85844"
></A
><H2
>注釈</H2
><P
>ユーザテーブル上の特定のインデックスに破損の疑いがある場合、<TT
CLASS="COMMAND"
>REINDEX INDEX</TT
>を使ってそのインデックスを再構築することもできますし、<TT
CLASS="COMMAND"
>REINDEX TABLE</TT
>を使ってそのテーブルのすべてのインデックスを再構築することもできます。
  </P
><P
>システムテーブルのインデックスの破損を復旧する場合の手順はより複雑になります。
この場合、システムによって破損の可能性があるインデックス自体が使用されないようにすることが重要です
（実際は、このようなケースでは、破損したインデックスに依存していたため、サーバプロセスが起動時に強制終了してしまう可能性があります）。
安全に復旧させるには、システムカタログ検索時のインデックスの使用を禁止する<TT
CLASS="OPTION"
>-P</TT
>オプションを使用してサーバを起動しなければなりません。
  </P
><P
>考えられる方法の1つは次の方法です。まず、サーバを停止して、コマンドラインから<TT
CLASS="OPTION"
>-P</TT
>オプションを指定してシングルユーザ状態の<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>サーバを起動します。
そして、再構成する範囲に応じて、<TT
CLASS="COMMAND"
>REINDEX DATABASE</TT
>、<TT
CLASS="COMMAND"
>REINDEX SYSTEM</TT
>、<TT
CLASS="COMMAND"
>REINDEX TABLE</TT
>、または、<TT
CLASS="COMMAND"
>REINDEX INDEX</TT
>コマンドを発行します。
範囲が不明な場合は、<TT
CLASS="COMMAND"
>REINDEX SYSTEM</TT
>を使用して、そのデータベースの全てのシステムインデックスを再構成してください。
その後、シングルユーザ状態のサーバセッションを停止して、通常のサーバを再起動します。
シングルユーザ状態のサーバインタフェースの操作方法についての詳細は、<A
HREF="app-postgres.html"
><SPAN
CLASS="APPLICATION"
>postgres</SPAN
></A
>マニュアルページを参照してください。
  </P
><P
>その他、コマンドラインで<TT
CLASS="OPTION"
>-P</TT
>を指定して通常のサーバセッションを起動することもできます。
具体的な方法は、クライアントによって異なります。
しかし、<SPAN
CLASS="APPLICATION"
>libpq</SPAN
>ベースのクライアントであれば、クライアントを起動する前に環境変数<TT
CLASS="ENVAR"
>PGOPTIONS</TT
>を<TT
CLASS="LITERAL"
>-P</TT
>に設定すれば実現できます。
この方法では他のクライアントを締め出す必要はありませんが、修復が終わるまで破損したデータベースへの他のユーザの接続を防止する方が良いことに注意してください。
  </P
><P
><TT
CLASS="COMMAND"
>REINDEX</TT
>は、インデックスの中身を1から作り直すという点では、インデックスを削除してから再作成する処理と似ています。
しかし、ロックに関しては異なります。
<TT
CLASS="COMMAND"
>REINDEX</TT
>はインデックスの元となるテーブルの書き込みをロックしますが、読み込みはロックしません。
また、処理中のインデックスに対する排他ロックを取得するので、そのインデックスを使用する読み込みはブロックされます。
一方、<TT
CLASS="COMMAND"
>DROP INDEX</TT
>は瞬間的に元となるテーブルの排他ロックを取得するので、書き込みも読み込みもブロックされます。
その後に行う<TT
CLASS="COMMAND"
>CREATE INDEX</TT
>では書き込みのみをロックし、読み込みはロックしません。
インデックスは存在しないので、インデックスを使用する読み込みは発生しません。
したがって、読み込みがブロックされることはありませんが、コストが高いシーケンシャルスキャンの使用を強制されることになります。
  </P
><P
>単一インデックスまたは単一テーブルのインデックス再作成を行うには、そのインデックスまたはテーブルの所有者でなければなりません。
データベースに対するインデックス再作成を行うには、データベースの所有者でなければなりません（したがって、この所有者は他のユーザが所有するテーブルのインデックスを再作成することができます）。
もちろん、スーパーユーザは常にすべてのインデックス再作成を行うことができます。
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN85871"
></A
><H2
>例</H2
><P
>単一のインデックスを再構築します。

</P><PRE
CLASS="PROGRAMLISTING"
>REINDEX INDEX my_index;</PRE
><P>
  </P
><P
>テーブル<TT
CLASS="LITERAL"
>my_table</TT
>上のすべてのインデックスを再構築します。

</P><PRE
CLASS="PROGRAMLISTING"
>REINDEX TABLE my_table;</PRE
><P>
  </P
><P
>システムインデックスが有効かどうかを確認することなく、あるデータベース内の全てのインデックスを再構築します。

</P><PRE
CLASS="PROGRAMLISTING"
>$ <KBD
CLASS="USERINPUT"
>export PGOPTIONS="-P"</KBD
>
$ <KBD
CLASS="USERINPUT"
>psql broken_db</KBD
>
...
broken_db=&gt; REINDEX DATABASE broken_db;
broken_db=&gt; \q</PRE
><P></P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN85882"
></A
><H2
>互換性</H2
><P
>標準SQLには<TT
CLASS="COMMAND"
>REINDEX</TT
>はありません。
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sql-refreshmaterializedview.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sql-release-savepoint.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>REFRESH MATERIALIZED VIEW</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sql-commands.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>RELEASE SAVEPOINT</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>