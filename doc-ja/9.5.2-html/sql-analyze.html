<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>ANALYZE</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.5.2文書"
HREF="index.html"><LINK
REL="UP"
TITLE="SQLコマンド"
HREF="sql-commands.html"><LINK
REL="PREVIOUS"
TITLE="ALTER VIEW"
HREF="sql-alterview.html"><LINK
REL="NEXT"
TITLE="BEGIN"
HREF="sql-begin.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2016-05-13T05:09:04"></HEAD
><BODY
CLASS="REFENTRY"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.5.2文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="ALTER VIEW"
HREF="sql-alterview.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="sql-commands.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="BEGIN"
HREF="sql-begin.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="SQL-ANALYZE"
></A
>ANALYZE</H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN73361"
></A
><H2
>名前</H2
>ANALYZE&nbsp;--&nbsp;データベースに関する統計を収集する</DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN73364"
></A
><H2
>概要</H2
><PRE
CLASS="SYNOPSIS"
>ANALYZE [ VERBOSE ] [ <TT
CLASS="REPLACEABLE"
><I
>table_name</I
></TT
> [ ( <TT
CLASS="REPLACEABLE"
><I
>column_name</I
></TT
> [, ...] ) ] ]</PRE
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN73368"
></A
><H2
>説明</H2
><P
><TT
CLASS="COMMAND"
>ANALYZE</TT
>はデータベース内のテーブルの内容に関する統計情報を収集し、その結果を<A
HREF="catalog-pg-statistic.html"
><TT
CLASS="STRUCTNAME"
>pg_statistic</TT
></A
>システムカタログに保存します。
問い合わせプランナが最も効率の良い問い合わせの実行計画を決定する際、この統計情報が使用されます。
  </P
><P
>パラメータがない場合、<TT
CLASS="COMMAND"
>ANALYZE</TT
>は現在のデータベース内の全てのテーブルを検査します。
パラメータがある場合、<TT
CLASS="COMMAND"
>ANALYZE</TT
>は指定されたテーブルのみを検査します。
さらに列名のリストを与え、その列の統計情報のみを更新することも可能です。
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN73377"
></A
><H2
>パラメータ</H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>VERBOSE</TT
></DT
><DD
><P
>進行状況の表示を有効にします。
     </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>table_name</I
></TT
></DT
><DD
><P
>解析の対象とするテーブルの名前です（スキーマ修飾名も可）。
省略された場合、現在のデータベースの中のすべての通常のテーブル（外部テーブルは除く）が解析されます。
     </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>column_name</I
></TT
></DT
><DD
><P
>解析の対象とする列名です。
デフォルトは全ての列です。
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN73395"
></A
><H2
>出力</H2
><P
><TT
CLASS="LITERAL"
>VERBOSE</TT
>が指定された場合、<TT
CLASS="COMMAND"
>ANALYZE</TT
>は進捗メッセージとして処理中のテーブルを表示します。
さらに、テーブルについての各種統計情報も表示されます。
   </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN73400"
></A
><H2
>注釈</H2
><P
>外部テーブルは明示的に選択された場合にのみ解析されます。
すべての外部データラッパが<TT
CLASS="COMMAND"
>ANALYZE</TT
>をサポートしているとは限りません。
テーブルのラッパが<TT
CLASS="COMMAND"
>ANALYZE</TT
>をサポートしない場合、コマンドは警告を出力し、何も行いません。
  </P
><P
>デフォルトの<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>の設定では、自動バキュームデーモン（<A
HREF="routine-vacuuming.html#AUTOVACUUM"
>項23.1.6</A
>参照）が、データが最初にロードされた時や通常の操作を通して変更された時にテーブルの自動解析まで面倒をみます。
もし自動バキュームが無効にしているならば<TT
CLASS="COMMAND"
>ANALYZE</TT
>は定期的に、もしくは、テーブルの内容に大きな変更がある度に行うことを推奨します。
統計情報が正確であれば、プランナが最も適切な問い合わせ計画を選択できるようになります。
これによって、問い合わせ処理の速度が向上します。
読み取りの多いデータベースでは、<A
HREF="sql-vacuum.html"
>VACUUM</A
>と<TT
CLASS="COMMAND"
>ANALYZE</TT
>は、1日1回、データベースがあまり使用されていない時間帯に実行することが一般的です。
（非常に更新が激しい場合、これでは十分ではありません。）
  </P
><P
><TT
CLASS="COMMAND"
>ANALYZE</TT
>は、対象とするテーブルの読み取りロックのみを必要とします。
したがって、そのテーブルに対する他の操作と並行して実行することができます。
  </P
><P
>通常、<TT
CLASS="COMMAND"
>ANALYZE</TT
>によって収集される統計情報には、各列の典型的な値と各列のデータ分布の概要を示す度数分布が含まれます。
<TT
CLASS="COMMAND"
>ANALYZE</TT
>によってあまり意味がないとみなされた場合（例えば、一意性制約が付加された列では、典型的な値というものは存在しません）や、列のデータ型が適切な演算子をサポートしていない場合は、片方もしくは両方の情報を省略することがあります。
<A
HREF="maintenance.html"
>第23章</A
>に、統計情報についての詳細が記載されています。
  </P
><P
>巨大なテーブルでは、<TT
CLASS="COMMAND"
>ANALYZE</TT
>は、全ての行を検査するのではなく、テーブルの中からランダムにサンプルを取り出して使用します。
これによって、非常に巨大なテーブルであっても短時間で解析することが可能です。
しかし、このようにして得られた統計情報はおおよそのものでしかなく、テーブルの内容に変更がなくても<TT
CLASS="COMMAND"
>ANALYZE</TT
>を実行する度に変化することに注意してください。
これにより、<A
HREF="sql-explain.html"
>EXPLAIN</A
>が表示する、プランナの推定コストも多少変化する可能性があります。
稀に、このような不確定要素のせいで、プランナが<TT
CLASS="COMMAND"
>ANALYZE</TT
>を実行した後に異なる問い合わせ計画を選択してしまうことがあります。
これを防止するには、以下に示すように<TT
CLASS="COMMAND"
>ANALYZE</TT
>で収集される統計情報の量を増やしてください。
  </P
><P
>設定パラメータ変数<A
HREF="runtime-config-query.html#GUC-DEFAULT-STATISTICS-TARGET"
>default_statistics_target</A
>を調整するか、もしくは<TT
CLASS="COMMAND"
>ALTER TABLE ... ALTER COLUMN ... SET STATISTICS</TT
>(<A
HREF="sql-altertable.html"
>ALTER TABLE</A
>参照)を使用して列単位の統計目標を列毎に設定することで、解析の範囲を制御することができます
目標値として設定するのは、典型的な値のリストにおけるエントリ数の最大値と度数分布のビンの最大数です。
デフォルトの目標値は100です。
しかし、この値は、プランナの推定精度と<TT
CLASS="COMMAND"
>ANALYZE</TT
>の処理時間、<TT
CLASS="LITERAL"
>pg_statistic</TT
>の占める容量とのトレードオフによって大きくも小さくも調整されることがあります。
目標値を0に設定すると、その列に関する統計情報の収集は無効になります。
決して<TT
CLASS="LITERAL"
>WHERE</TT
>句、<TT
CLASS="LITERAL"
>GROUP BY</TT
>句、<TT
CLASS="LITERAL"
>ORDER BY</TT
>句に使用されない列に対しては、このような設定が有用です。
プランナにとってそのような列の統計情報は不要だからです。
  </P
><P
>解析対象列の統計情報目標値の最大値によって、統計情報を作成するためにテーブルから抽出する行数が決定します。
目標値を大きくすると、比例して、<TT
CLASS="COMMAND"
>ANALYZE</TT
>に要する時間とディスク容量が増加します。
  </P
><P
><TT
CLASS="COMMAND"
>ANALYZE</TT
>で推定される値の1つに各列に出現する個別値の個数があります。
行の部分集合のみしか検査されませんので、統計情報の対象をできる限り大きくしたとしても、この推定値はかなり不正確になることが時々あり得ます。
この不正確性のために悪い問い合わせ計画となる場合、より正確な値を手作業で求めて、<TT
CLASS="COMMAND"
>ALTER TABLE ... ALTER COLUMN ... SET (n_distinct = ...)</TT
>(<A
HREF="sql-altertable.html"
>ALTER TABLE</A
>参照)で設定することができます。
  </P
><P
>解析中のテーブルが1つ以上の子テーブルを持つ場合、<TT
CLASS="COMMAND"
>ANALYZE</TT
>は2回統計情報を収集します。
1回目は親テーブルのみのテーブル行を対象とし、2回目では親テーブルの行とそのすべての子テーブルの行を対象とします。
継承ツリー全体をたどる問い合わせの計画作成では、この２回目の統計情報群が必要とされます。
しかし自動バキュームデーモンでは、自動的に解析を行うかどうかを決定する際に親テーブル上の挿入や更新のみを考慮します。
このテーブルへの挿入や更新がほとんどなければ、継承関係に対する統計情報は手作業で<TT
CLASS="COMMAND"
>ANALYZE</TT
>を実行しない限り最新状態にはなりません。
  </P
><P
>子テーブルに外部テーブルがあり、その外部データラッパが<TT
CLASS="COMMAND"
>ANALYZE</TT
>をサポートしない場合、その子テーブルは継承の統計を取得する際に無視されます。
  </P
><P
>解析しようとするテーブルが完全に空である場合、<TT
CLASS="COMMAND"
>ANALYZE</TT
>はそのテーブルに対する新しい解析情報を記録しません。
これまでの統計情報はすべて保持されます。
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN73445"
></A
><H2
>互換性</H2
><P
>標準SQLには<TT
CLASS="COMMAND"
>ANALYZE</TT
>文はありません。
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN73449"
></A
><H2
>関連項目</H2
><A
HREF="sql-vacuum.html"
>VACUUM</A
>, <A
HREF="app-vacuumdb.html"
><SPAN
CLASS="APPLICATION"
>vacuumdb</SPAN
></A
>, <A
HREF="runtime-config-resource.html#RUNTIME-CONFIG-RESOURCE-VACUUM-COST"
>項18.4.4</A
>, <A
HREF="routine-vacuuming.html#AUTOVACUUM"
>項23.1.6</A
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sql-alterview.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sql-begin.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>ALTER VIEW</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sql-commands.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>BEGIN</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>