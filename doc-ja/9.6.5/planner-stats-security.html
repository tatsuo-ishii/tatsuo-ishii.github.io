<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>プランナの統計情報とセキュリティ</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.5文書"
HREF="index.html"><LINK
REL="UP"
TITLE="プランナは統計情報をどのように使用するか"
HREF="planner-stats-details.html"><LINK
REL="PREVIOUS"
TITLE="行数推定の例"
HREF="row-estimation-examples.html"><LINK
REL="NEXT"
TITLE="付録"
HREF="appendixes.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2017-10-17T11:51:21"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.5文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="行数推定の例"
HREF="row-estimation-examples.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="planner-stats-details.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>第 67章プランナは統計情報をどのように使用するか</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="付録"
HREF="appendixes.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PLANNER-STATS-SECURITY"
>67.2. プランナの統計情報とセキュリティ</A
></H1
><P
>テーブル<TT
CLASS="STRUCTNAME"
>pg_statistic</TT
>へのアクセスはスーパーユーザのみに制限されているため、一般ユーザはこのテーブルを使って他のユーザのテーブル内容について調べることはできません。
選択性推定関数には保存されている統計情報を解析するためにユーザ定義の演算子（問い合わせに現れる演算子あるいは関連する演算子）を使うものがあります。
例えば、保存されている最頻値を適用できるかどうかを調べるためには、選択性推定関数は適切な<TT
CLASS="LITERAL"
>=</TT
>演算子を実行して問い合わせ内の定数を保存されている値と比較する必要があるでしょう。
従って、<TT
CLASS="STRUCTNAME"
>pg_statistic</TT
>内のデータは、潜在的に、ユーザ定義演算子に渡される可能性があります。
巧妙に作られた演算子を使うと、渡された引数を意図的に漏らす（例えば、それをログに出力する、他のテーブルに書き出すなど）、あるいはその値をエラーメッセージに出力することで偶然に漏らすことが可能で、いずれにせよ<TT
CLASS="STRUCTNAME"
>pg_statistic</TT
>のデータを、それを見ることができないはずのユーザに対して露出する可能性があります。
  </P
><P
>このことを防ぐため、すべての組み込みの選択性推定関数には以下のことが適用されます。
問い合わせの計画を作成するとき、保存されている統計情報を使用できるためには、現在のユーザはテーブルあるいは対象の列に<TT
CLASS="LITERAL"
>SELECT</TT
>権限を持っている必要がある、あるいは使用する演算子（正確には、演算子の元となる関数）が<TT
CLASS="LITERAL"
>LEAKPROOF</TT
>である必要があります。
そうでないときは、選択性推定はあたかも利用可能な統計情報がないかのような動作をし、プランナはデフォルトあるいは代替の推定に従って処理をします。
  </P
><P
>ユーザがテーブルや列について必要な権限を持っていない場合、最終的には権限不足のエラーを受け取ることが多いでしょう。
この場合、上記の仕組みは実際にはユーザからはわかりません。
しかし、ユーザがセキュリティバリアビューから読み取ろうとしている場合、プランナはそのビューの元となっているテーブルの統計情報を検査したいと思うかもしれず、またユーザはそのテーブルにはアクセス権がないかもしれません。
その場合は、演算子がリークプルーフ(leak-proof)でなければ、統計情報は使用されません。
そのことについての直接的なフィードバックは何もなく、プランが理想的ではないかもしれないというだけです。
このことが起きているかもしれないと思った場合は、より権限のあるユーザで問い合わせを実行して、異なる計画が得られるかどうか調べることができます。
  </P
><P
>この制限は、プランナが<TT
CLASS="STRUCTNAME"
>pg_statistic</TT
>の1つ以上の値についてユーザ定義演算子を実行する必要がある場合にのみ適用されます。
従って、列内でのNULL値の割合や異なる値の個数といった一般的な統計情報については、プランナはアクセス権限に関わらず使用することが許されています。
  </P
><P
>サードパーティの拡張に含まれる選択性推定関数で、ユーザ定義演算子で統計情報の演算をする可能性のあるものは、同じセキュリティ規則に従うべきです。
そのための手引については、PostgreSQLのソースコードを参照してください。
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="row-estimation-examples.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="appendixes.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>行数推定の例</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="planner-stats-details.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>付録</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>