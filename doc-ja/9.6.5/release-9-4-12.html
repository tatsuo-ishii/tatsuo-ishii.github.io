<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>リリース9.4.12</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.5文書"
HREF="index.html"><LINK
REL="UP"
TITLE="リリースノート"
HREF="release.html"><LINK
REL="PREVIOUS"
TITLE="リリース9.4.13"
HREF="release-9-4-13.html"><LINK
REL="NEXT"
TITLE="リリース9.4.11"
HREF="release-9-4-11.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2017-10-17T11:51:21"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.5文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="リリース9.4.13"
HREF="release-9-4-13.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="release.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>付録 E. リリースノート</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="リリース9.4.11"
HREF="release-9-4-11.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="RELEASE-9-4-12"
>E.19. リリース9.4.12</A
></H1
><DIV
CLASS="FORMALPARA"
><P
><B
>リリース日: </B
>2017-05-11</P
></DIV
><P
>このリリースは9.4.11に対し、各種不具合を修正したものです。
9.4メジャーリリースにおける新機能については、<A
HREF="release-9-4.html"
>項E.31</A
>を参照してください。
  </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN136058"
>E.19.1. バージョン9.4.12への移行</A
></H2
><P
>9.4.Xからの移行ではダンプ/リストアは不要です。
   </P
><P
>しかしながら、認証にユーザパスワードを利用する外部データサーバを使っている場合には、以下の変更点の1番目の項目を参照してください。
   </P
><P
>また、<SPAN
CLASS="QUOTE"
>"ロジカルデコーディング"</SPAN
>に依存したサードパーティレプリケーションツールを使っている場合には、以下の変更点の4番目の項目を参照してください。
   </P
><P
>また、9.4.11よりも前のリリースからアップグレードする場合は、<A
HREF="release-9-4-11.html"
>項E.20</A
>を参照して下さい。
   </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN136066"
>E.19.2. 変更点</A
></H2
><P
></P
><UL
><LI
><P
>ユーザマッピングオプションとして格納されたパスワードを保護するため、<TT
CLASS="STRUCTNAME"
>pg_user_mappings</TT
>.<TT
CLASS="STRUCTFIELD"
>umoptions</TT
>の可視性を厳格化しました。
(Michael Paquier, Feike Steenbergen)
     </P
><P
>これまでのコードは、外部サーバオブジェクトの所有者やサーバの<TT
CLASS="LITERAL"
>USAGE</TT
>権限を付与されているユーザに、そのサーバに関連した全てのユーザマッピングのオプションを参照することを許していました。
これには他のユーザのパスワードがしっかり含まれているかもしれません。
<TT
CLASS="STRUCTNAME"
>information_schema.user_mapping_options</TT
>の振る舞いと一致するように、すなわち、これらオプションがマップされているユーザに、またはマッピングが<TT
CLASS="LITERAL"
>PUBLIC</TT
>で現在ユーザがサーバ所有者の場合に、あるいは現在ユーザがスーパーユーザである場合に、可視であるようにビュー定義を修正しました。
(CVE-2017-7486)
     </P
><P
>このパッチのみでは新たにinitdbされたデータベースでの動作しか修正しません。
この変更を既存のデータベースに適用するには、<A
HREF="release-9-4-13.html"
>項E.18</A
>にあるCVE-2017-7547に対する変更点に示した正しい手順に従ってください。
     </P
></LI
><LI
><P
>漏洩のある演算子を通した統計情報の露出を防止しました。
(Peter Eisentraut)
     </P
><P
>プランナの一部の選択率見積関数は、ユーザ定義演算子を頻出値やヒストグラム項目のような<TT
CLASS="STRUCTNAME"
>pg_statistic</TT
>から取得された値に適用します。
これはテーブル権限がチェックされる前に行われるので、悪意のユーザがこの振る舞いを読み取り権限を持たないテーブル列の値を取得するために悪用するおそれがありました。
修正するため、演算子の実装関数が漏洩防止を保証されておらず、呼び出しているユーザが統計情報を要するテーブル列の読み取り権限を持っていない場合には、デフォルトの見積で代用するようにしました。
実際はたいていのケースでこれら基準のうち少なくとも一つを満たします。
(CVE-2017-7484)
     </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>libpq</SPAN
>の<TT
CLASS="ENVAR"
>PGREQUIRESSL</TT
>環境変数の認識が復旧されました。
(Daniel Gustafsson)
     </P
><P
>環境変数の処理が<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
> 9.3で意図せず外されていましたが、
ドキュメントはそのままでした。
ユーザがSSL暗号化接続を強制するために、もはや保証されないであろうこの環境変数に依存しているかもしれず、これはセキュリティ上の危険を生じさせます。
この環境変数の処理を復旧しましたが、9.3以降のコードで正しく動作している設定を壊さないように、<TT
CLASS="ENVAR"
>PGSSLMODE</TT
>よりも低い優先順位を与えました。
(CVE-2017-7485)
     </P
></LI
><LI
><P
>ロジカルデコーディング中の初期スナップショットが無効になる可能性があり、これを修正しました。
(Petr Jelinek, Andres Freund)
     </P
><P
>ロジカルデコーディングのレプリケーションスロットむけに作られた初期スナップショットが潜在的に不正となりえました。
これによりロジカルデコーディングを使うサードパーティツールが不完全あるいは不正な初期データのコピーをする可能性があります。
ソースサーバがスロットを作るときに高負荷特の場合、または、他のロジカルスロットが既に存在している場合に特に発生しやすい現象です。
     </P
><P
>ロジカルデコーディングに依存したレプリケーションツールを使っていて、レプリケーション開始時に空でないデータセットをコピーしたであろう場合には、アップグレードを導入した後にレプリカを再作成するか、ソースサーバと比較してその内容を検証することが推奨されます。
     </P
></LI
><LI
><P
>ログをとらないインデックスの<SPAN
CLASS="QUOTE"
>"初期フォーク"</SPAN
>の破損を修正しました。
(Robert Haas, Michael Paquier)
     </P
><P
>これによりクラッシュと再起動の後に、ログをとらないインデックスが不正な状態になるおそれがありました。
この問題はインデックスが削除、再構築されるまで持続するでしょう。
     </P
></LI
><LI
><P
>スタンバイサーバが、準備されているけれどコミットされていない2相トランザクションを再生するときの<TT
CLASS="STRUCTNAME"
>pg_subtrans</TT
>の項目の誤った再構築を修正しました。
(Tom Lane)
     </P
><P
>大抵の場合は目に見える悪影響には至りませんが、稀な場合に<TT
CLASS="STRUCTNAME"
>pg_subtrans</TT
>で循環参照になり、2相トランザクションで修正された行を検査する問い合わせで潜在的に無限ループをひき起こす可能性がありました。
     </P
></LI
><LI
><P
>文字列バッファ初期化の失敗による<SPAN
CLASS="APPLICATION"
>walsender</SPAN
>でのクラッシュの可能性を回避しました。
(Stas Kelvich, Fujii Masao)
     </P
></LI
><LI
><P
>バックグラウンドワーカプロセスについての<CODE
CLASS="FUNCTION"
>fork()</CODE
>失敗に対するpostmasterの処理が修正されました。
(Tom Lane)
     </P
><P
>これまでは、postmasterはプロセスが正常に起動されたかのようにワーカ状態の一部を更新していて、結果としてその後に混乱が生じていました。 
     </P
></LI
><LI
><P
>拡張のスクリプトで問い合わせの構文解析に直前のDDLの結果が見えることを保証しました。
(Julien Rouhaud, Tom Lane)
     </P
><P
>拡張のスクリプトファイル内のコマンド間でキャッシュをフラッシュする手順が欠けていたため、ユーティリティ以外の問い合わせには直前の<TT
CLASS="COMMAND"
>ALTER TABLE ... RENAME</TT
>のようなカタログ変更の結果が見えないかもしれませんでした。
     </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>ALTER TABLE ... ALTER COLUMN TYPE</TT
>が既存インデックスを再構築するときのテーブルスペースの権限検査を省略しました。
(Noah Misch)
     </P
><P
>呼び出すユーザがインデックスを含むテーブルスペースに対する<TT
CLASS="LITERAL"
>CREATE</TT
>権限をそのとき持っていなかった場合、コマンドは失敗していました。
この振る舞いは役に立たないと考えられるので、検査を省略し、ここではインデックスを再構築できるようにしました。
     </P
></LI
><LI
><P
>制約が<TT
CLASS="LITERAL"
>NO INHERIT</TT
>と印付けされているときには、<TT
CLASS="COMMAND"
>ALTER TABLE ... VALIDATE CONSTRAINT</TT
>が子テーブルに再帰処理をしないように修正しました。
(Amit Langote)
     </P
><P
>この修正は一致する制約が子テーブルに無いときに望まれない<SPAN
CLASS="QUOTE"
>"constraint does not exist（制約がありません）"</SPAN
>エラーになるのを防ぎます。
     </P
></LI
><LI
><P
>ページピンの競合によりスキャンできなかったページを適切に計算するように<TT
CLASS="COMMAND"
>VACUUM</TT
>を修正しました。
(Andrew Gierth)
     </P
><P
>これはテーブルのタプル数の過小見積をもたらす傾向がありました。
小さくて競合が激しいテーブルという最悪の場合には、<TT
CLASS="COMMAND"
>VACUUM</TT
>がテーブルにはタプルが一切含まれないという不正な報告をして、非常に悪いプラン選択をもたらす可能性がありました。
     </P
></LI
><LI
><P
>ハッシュ結合の中での大量タプル転送ループを問い合わせキャンセル要求により確実に割り込みできるようにしました。
(Tom Lane, Thomas Munro)
     </P
></LI
><LI
><P
><TT
CLASS="TYPE"
>interval</TT
>の比較で整数オーバーフロー問題を修正しました。
(Kyotaro Horiguchi, Tom Lane)
     </P
><P
>約296000年より大きい期間に対して<TT
CLASS="TYPE"
>interval</TT
>型の比較演算子が誤った答えを生み出す可能性がありました。
このような大きい値を含む列のインデックスは壊れているかもしれないので、インデックス再構築をしたほうがよいです。
     </P
></LI
><LI
><P
><TT
CLASS="REPLACEABLE"
><I
>tableforest</I
></TT
> = falseのとき、<CODE
CLASS="FUNCTION"
>cursor_to_xml()</CODE
>が正しいな出力をするように修正しました。
(Thomas Munro, Peter Eisentraut)
     </P
><P
>これまでは<TT
CLASS="LITERAL"
>&lt;table&gt;</TT
>要素の囲みを生成していませんでした。
     </P
></LI
><LI
><P
><CODE
CLASS="FUNCTION"
>float8_timestamptz()</CODE
>と<CODE
CLASS="FUNCTION"
>make_interval()</CODE
>で端数丸めの問題を修正しました。
(Tom Lane)
     </P
><P
>これら関数は浮動小数点の値から整数のマイクロ秒に変換するときに丸めでなく、切り捨てをしていました。これにより予期せずひとつ少ない結果がもたらされる可能性がありました。 
     </P
></LI
><LI
><P
><TT
CLASS="STRUCTNAME"
>pg_timezone_names</TT
>ビューの性能を改善しました。
(Tom Lane, David Rowley)
     </P
></LI
><LI
><P
>多数の大きいブロックを含むコンテキストについてメモリ管理オーバーヘッドを軽減しました。
(Tom Lane)
     </P
></LI
><LI
><P
><CODE
CLASS="FUNCTION"
>lseek()</CODE
>と<CODE
CLASS="FUNCTION"
>close()</CODE
>の稀な場合のエラーに対するいいかげんな処理を修正しました。
(Tom Lane)
     </P
><P
>どちらも通常ではあまり失敗しないシステムコールですが、失敗した場合には<TT
CLASS="FILENAME"
>fd.c</TT
>がかなり混乱する可能性がありました。 
     </P
></LI
><LI
><P
>postmasterがWindowsサービスとして実行しているかどうかの誤った検査を修正しました。
(Michael Paquier)
     </P
><P
>これは、アクセス不能であるときにイベントログに書き出しを試みて、そのため全くログが書かれない結果をもたらしました。 
     </P
></LI
><LI
><P
><TT
CLASS="COMMAND"
>COMMIT PREPARED</TT
>と<TT
CLASS="COMMAND"
>ROLLBACK PREPARED</TT
>に対応するように<SPAN
CLASS="APPLICATION"
>ecpg</SPAN
>を修正しました。
(Masahiko Sawada)
     </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>ecpg</SPAN
>で、$でクォートされた文字列リテラルを処理する際の二重解放エラーを修正しました。
(Michael Meskes)
     </P
></LI
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_dump</SPAN
>で、コメントとデータベースオブジェクトのいくつかのタイプのセキュリティラベルに対する、誤ったスキーマと所有者の印付けを修正しました。
(Giuseppe Broccolo, Tom Lane)
     </P
><P
>単純な使い方の場合には悪影響はありませんが、例えばスキーマを指定したリストアでは含まれるべきコメントが無視される可能性がありました。これはダンプ時にそれらが関連するオブジェクトのスキーマに属するという印付けがされなかったためです。
     </P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>pg_restore -l</TT
>で、SQLオブジェクト名に改行が含まれるときに無効なリストファイルが出力されるのを回避しました。
(Tom Lane)
     </P
><P
>改行を空白で置き換えました。出力を<TT
CLASS="LITERAL"
>pg_restore -L</TT
>の用途に使えるようにするにはこれで十分です。
     </P
></LI
><LI
><P
><SPAN
CLASS="QUOTE"
>"ラージオブジェクト"</SPAN
>(BLOB)に付けられたコメントとセキュリティラベルを移行するように<SPAN
CLASS="APPLICATION"
>pg_upgrade</SPAN
>を修正しました。
(Stephen Frost)
     </P
><P
>これまで、ラージオブジェクトは新データベースに正しく移行されていましたが、それに付加されたコメントとセキュリティラベルが失われていました。 
     </P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>contrib/adminpack</TT
>の<CODE
CLASS="FUNCTION"
>pg_file_write()</CODE
>関数でエラー処理を改善しました。
(Noah Misch)
     </P
><P
>特に<CODE
CLASS="FUNCTION"
>fclose()</CODE
>から報告されたエラーを検知していませんでした。
     </P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>contrib/dblink</TT
>で新たな無名接続を確立するときに、前の無名接続がリークするのを回避しました。
(Joe Conway)
     </P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>contrib/pg_trgm</TT
>の正規表現からのトライグラム抽出を修正しました。
(Tom Lane)
     </P
><P
>場合によっては、何にも決してマッチしない壊れたデータ構造を生み出し、トライグラムインデックスを使うGINまたはGiSTのインデックススキャンが正規表現へのマッチを何も見つけられない結果になります。 
     </P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>contrib/postgres_fdw</TT
>にて、リモートサーバに問い合わせキャンセル要求を伝播するようにしました。
(Michael Paquier, Etsuro Fujita)
     </P
><P
>これまでは、ローカル問い合わせのキャンセル要求は送信済みのリモート問い合わせを早く終了させませんでした。
これは元々9.6で行われた作業のバックパッチです。
     </P
></LI
><LI
><P
>OpenSSL 1.1.0に対応しました。
(Heikki Linnakangas, Andreas Karlsson, Tom Lane)
     </P
><P
>これはより新しいブランチで以前行なわれた作業のバックパッチです。多くのプラットフォームがOpenSSLの新しいバージョンを採用しているため、必要です。
     </P
></LI
><LI
><P
>MSVCビルドでTcl 8.6に対応しました。
(&Aacute;lvaro Herrera)
     </P
></LI
><LI
><P
>私たちのタイムゾーンライブラリのコピーをIANA release tzcode2017bに同期しました。
(Tom Lane)
     </P
><P
>これは、2038年1月の一部の夏時間遷移に影響するバグを修正します。
     </P
></LI
><LI
><P
>タイムゾーンデータファイルを<SPAN
CLASS="APPLICATION"
>tzdata</SPAN
> release 2017bに更新しました。チリ、ハイチ、モンゴルの夏時間法の変更、エクアドル、カザフスタン、リベリア、スペインの歴史的修正が含まれます。
南米、太平洋、インド洋、および、一部アジア・中東の国々における多数のタイムゾーンを、数字による省略形に切り替えました。 
     </P
><P
>IANAタイムゾーンデータベースはこれまで全てのタイムゾーンについて文字による省略形を提供しましたが、地元の人々の間でほとんど、あるいは全く通用していない省略形をしばしば作成していました。
IANAは英語の省略形が現実に使われている形跡がないゾーンにおいてはUTCオフセット数値を使うことを選ぶという方針に転換しようとしてるところです。
少なくともしばらくの間、<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>はタイムスタンプの入力に、このような削除された省略形を引き続き受け入れます。
しかし、それらは<TT
CLASS="STRUCTNAME"
>pg_timezone_names</TT
>ビューには現れず、出力にも使用されなくなります。
     </P
></LI
><LI
><P
>MSVC ビルドにおいて、POSIX形式のタイムゾーン名に対して正しい夏時間規則を使用するようにしました。
(David Rowley)
     </P
><P
>MicrosoftのMSVCビルドスクリプトは<TT
CLASS="FILENAME"
>posixrules</TT
>ファイルをタイムゾーンディレクトリツリーにインストールするのを怠っていました。
この結果、POSIX形式のタイムゾーン名に対し想定される夏時間の振る舞いについて、タイムゾーンコードがビルトインの規則に退行してしまっていました。
歴史的な理由により、その組み込み規則は、米国が2007年より前に使っていた夏時間規則（すなわち、4月最初の日曜日と 10月最終の日曜日の変更）に引き続き対応しています。
この修正にともない、POSIX形式のゾーン名は<TT
CLASS="LITERAL"
>US/Eastern</TT
>ゾーンの現在および歴史的な夏時間遷移日を使います。
そのようにしたくない場合には、<TT
CLASS="FILENAME"
>posixrules</TT
>ファイルを削除するか、他のゾーンファイルのコピーで置き換えてください（<A
HREF="datatype-datetime.html#DATATYPE-TIMEZONES"
>項8.5.3</A
>参照）。
キャッシュ利用のため、このような変更を反映させるにはサーバの再起動が必要であることに注意してください。
     </P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="release-9-4-13.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="release-9-4-11.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>リリース9.4.13</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="release.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>リリース9.4.11</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>