<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>リリース9.4.4</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.5文書"
HREF="index.html"><LINK
REL="UP"
TITLE="リリースノート"
HREF="release.html"><LINK
REL="PREVIOUS"
TITLE="リリース9.4.5"
HREF="release-9-4-5.html"><LINK
REL="NEXT"
TITLE="リリース9.4.3"
HREF="release-9-4-3.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2017-10-17T11:51:21"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.5文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="リリース9.4.5"
HREF="release-9-4-5.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="release.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>付録 E. リリースノート</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="リリース9.4.3"
HREF="release-9-4-3.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="RELEASE-9-4-4"
>E.27. リリース9.4.4</A
></H1
><DIV
CLASS="FORMALPARA"
><P
><B
>リリース日: </B
>2015-06-12</P
></DIV
><P
>このリリースは9.4.3に対し、少数の不具合を修正したものです。
9.4メジャーリリースにおける新機能については、<A
HREF="release-9-4.html"
>項E.31</A
>を参照してください。
  </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN137568"
>E.27.1. バージョン9.4.4への移行</A
></H2
><P
>9.4.Xからの移行ではダンプ/リストアは不要です。
   </P
><P
>しかしながら、以前に9.3.0から9.3.4の<SPAN
CLASS="APPLICATION"
>pg_upgrade</SPAN
>を使ってアップグレードしている場合には、以下の変更点の最初の項目を確認してください。
   </P
><P
>また、9.4.2よりも前のリリースからアップグレードする場合は、<A
HREF="release-9-4-2.html"
>項E.29</A
>を参照して下さい。
   </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN137575"
>E.27.2. 変更点</A
></H2
><P
></P
><UL
><LI
><P
>一貫性のないデータベース状態からのリカバリに失敗する可能性があり、修正しました。
(Robert Haas)
     </P
><P
>最近の<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>リリースでマルチトランザクション周回を防ぐ仕組みが導入されましたが、そのコードの一部はデータベースがまだ一貫した状態になっていないときのクラッシュリカバリ中に実行が必要となる可能性について責任を果たしていませんでした。
これはクラッシュ後の再起動失敗やスタンバイサーバの開始失敗を引き起こすおそれがあります。
バージョン9.3.0から9.3.4の<SPAN
CLASS="APPLICATION"
>pg_upgrade</SPAN
>を使って構築されたデータベースでは、以前に修正された<SPAN
CLASS="APPLICATION"
>pg_upgrade</SPAN
>のバグの長引く影響が同様の障害を引き起こします。
     </P
><P
>問題の<SPAN
CLASS="APPLICATION"
>pg_upgrade</SPAN
>のバグは、本来はより大きい値であるべきときでも<TT
CLASS="FILENAME"
>pg_control</TT
>の<TT
CLASS="LITERAL"
>oldestMultiXid</TT
>に1を設定します。
本リリースで導入された修正では、このような状態では直ちに緊急自動バキュームが生じ、適正な<TT
CLASS="LITERAL"
>oldestMultiXid</TT
>値を確定できるまで実行されます。
このことが困難を引き起こすのであれば、本リリースにアップグレードする<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>前に</I
></SPAN
>手動バキュームを行うことで回避できます。
詳細手順は以下の通りです。

      <P
></P
></P><OL
TYPE="1"
><LI
><P
><SPAN
CLASS="APPLICATION"
>pg_controldata</SPAN
>が<SPAN
CLASS="QUOTE"
>"Latest checkpoint's oldestMultiXid"</SPAN
>を1と報告するかを確認します。そうでなければ、やるべきことはありません。
        </P
></LI
><LI
><P
><TT
CLASS="FILENAME"
>PGDATA/pg_multixact/offsets</TT
>で<TT
CLASS="FILENAME"
>0000</TT
>ファイルが在るかを見ます。
ファイルが在るなら、やるべきことはありません。
        </P
></LI
><LI
><P
>さもなくば、<TT
CLASS="STRUCTNAME"
>pg_class</TT
>.<TT
CLASS="STRUCTFIELD"
>relminmxid</TT
>が1である各テーブルに対して、
<A
HREF="runtime-config-client.html#GUC-VACUUM-MULTIXACT-FREEZE-MIN-AGE"
>vacuum_multixact_freeze_min_age</A
>と<A
HREF="runtime-config-client.html#GUC-VACUUM-MULTIXACT-FREEZE-TABLE-AGE"
>vacuum_multixact_freeze_table_age</A
>を0に設定したうえで、<TT
CLASS="COMMAND"
>VACUUM</TT
>を行います。
（同時実行セッションの性能影響を減らすため、<A
HREF="runtime-config-resource.html#RUNTIME-CONFIG-RESOURCE-VACUUM-COST"
>項19.4.4</A
>に記載されているバキュームコスト遅延設定を使うことができます）
        </P
></LI
></OL
><P>
     </P
></LI
><LI
><P
>稀にリレーションキャッシュ初期化ファイル無効化に失敗するのを修正しました。
(Tom Lane)
     </P
><P
>ちょうど悪いタイミングの同時動作で、システムカタログの<TT
CLASS="COMMAND"
>VACUUM FULL</TT
>が、新たなセッションのためにキャッシュ読み込み動作を避けるのに使われる<SPAN
CLASS="QUOTE"
>"initファイル"</SPAN
>の更新に失敗することがありました。
この結果、後のセッションがそのシステムカタログに全くアクセスできなくなってしまいます。
これはとても古くからのバグですが、起こすのが難しく、最近まで再現できるケースが見つかりませんでした。
     </P
></LI
><LI
><P
>新たなセッション開始と<TT
CLASS="LITERAL"
>CREATE/DROP DATABASE</TT
>との間のデッドロックを回避しました。
(Tom Lane)
     </P
><P
><TT
CLASS="COMMAND"
>DROP DATABASE</TT
>コマンドの対象であるか、または、<TT
CLASS="COMMAND"
>CREATE DATABASE</TT
>コマンドでのテンプレートであるデータベースに対する新たなセッション開始が、5秒待った後、たとえ新たなセッションがその前に終了していたとしても、失敗する可能性がありました。
     </P
></LI
><LI
><P
>内部インデックススキャンでセミ結合とアンチ結合についてプランナのコスト見積りを改善しました。
(Tom Lane, Tomas Vondra)
     </P
><P
>全ての結合節がインデックススキャン条件として使われている場合、たとえ内部スキャンが見かけ上は多数の行を読みだすとしても、エグゼキュータは一行を取得した後止まるので、この種の実行計画は全く低コストです。
プランナはこの効果をごく一部しか考慮しておらず、他の能率が大きく劣る他の計画タイプを選んでしまう可能性をもたらしていました。
     </P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="release-9-4-5.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="release-9-4-3.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>リリース9.4.5</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="release.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>リリース9.4.3</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>