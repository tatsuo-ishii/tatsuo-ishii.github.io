<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>pg_visibility</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.6.5文書"
HREF="index.html"><LINK
REL="UP"
TITLE="追加で提供されるモジュール"
HREF="contrib.html"><LINK
REL="PREVIOUS"
TITLE="pg_trgm"
HREF="pgtrgm.html"><LINK
REL="NEXT"
TITLE="postgres_fdw"
HREF="postgres-fdw.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=utf-8"><META
NAME="creation"
CONTENT="2017-10-17T11:51:21"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="4"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.6.5文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="pg_trgm"
HREF="pgtrgm.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
HREF="contrib.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>付録 F. 追加で提供されるモジュール</TD
><TD
WIDTH="20%"
ALIGN="right"
VALIGN="top"
><A
TITLE="postgres_fdw"
HREF="postgres-fdw.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PGVISIBILITY"
>F.32. pg_visibility</A
></H1
><P
><TT
CLASS="FILENAME"
>pg_visibility</TT
>モジュールは可視性マップ(Visibility Map, VM)およびテーブルのページレベルでの可視性情報を検査する手段を提供します。
このモジュールはまた、可視性マップの整合性を検査し、強制的に再構築する機能も提供します。
 </P
><P
>ページレベルの可視性についての情報を格納するために、3つの異なるビットが使用されます。
可視性マップの全可視ビットは、対応するリレーションのページの全タプルがすべての現在および将来のトランザクションに対して可視であることを示します。
可視性マップの全凍結ビットは、そのページのすべてのタプルが凍結されていることを示します。
これはすなわち、そのページに対してタプルの挿入、更新、削除、ロックなどが発生しない限り、将来もバキュームによる修正が必要ないことを意味します。
ページヘッダの<TT
CLASS="LITERAL"
>PD_ALL_VISIBLE</TT
>ビットは、可視性マップの全可視ビットと同じ意味ですが、別のデータ構造ではなく、データページ自体の中に格納されています。
これら2つのビットは通常は同じ値になりますが、クラッシュリカバリの後は、ページの全可視ビットがセットされているのに、可視性マップの全可視ビットはクリアされているということもあります。
また、<TT
CLASS="LITERAL"
>pg_visibility</TT
>が可視性マップを検査した後、データページを検査する前に更新が行われたために、これらについて報告される値が一致しないということもあり得ます。
データ破壊を起こすような何らかのイベントの後も、これらのビットが異なることがあり得ます。
 </P
><P
><TT
CLASS="LITERAL"
>PD_ALL_VISIBLE</TT
>ビットに関する情報を表示する関数は、可視性マップのみを参照する関数に比べるとずっと高価です。
これは、可視性マップだけではなく、（それよりずっと大きな）リレーションのデータブロックを読む必要があるからです。
リレーションのデータブロックを検査する関数は、同様に高価です。
 </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN185271"
>F.32.1. 関数</A
></H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><CODE
CLASS="FUNCTION"
>pg_visibility_map(relation regclass, blkno bigint, all_visible OUT boolean, all_frozen OUT boolean) returns record</CODE
></DT
><DD
><P
>指定のリレーションの指定のブロックについて、可視性マップ内の全可視ビットと全凍結ビットを返します。
     </P
></DD
><DT
><CODE
CLASS="FUNCTION"
>pg_visibility(relation regclass, blkno bigint, all_visible OUT boolean, all_frozen OUT boolean, pd_all_visible OUT boolean) returns record</CODE
></DT
><DD
><P
>指定のリレーションの指定のブロックについて、可視性マップ内の全可視ビットと全凍結ビット、およびそのブロックの<TT
CLASS="LITERAL"
>PD_ALL_VISIBLE</TT
>を返します。
     </P
></DD
><DT
><CODE
CLASS="FUNCTION"
>pg_visibility_map(relation regclass, blkno OUT bigint, all_visible OUT boolean, all_frozen OUT boolean) returns setof record</CODE
></DT
><DD
><P
>指定のリレーションの各ブロックについて、全可視ビットと全凍結ビットを返します。
     </P
></DD
><DT
><CODE
CLASS="FUNCTION"
>pg_visibility(relation regclass, blkno OUT bigint, all_visible OUT boolean, all_frozen OUT boolean, pd_all_visible OUT boolean) returns setof record</CODE
></DT
><DD
><P
>指定のリレーションの各ブロックについて、全可視ビットと全凍結ビット、および各ブロックの<TT
CLASS="LITERAL"
>PD_ALL_VISIBLE</TT
>ビットを返します。
     </P
></DD
><DT
><CODE
CLASS="FUNCTION"
>pg_visibility_map_summary(relation regclass, all_visible OUT bigint, all_frozen OUT bigint) returns record</CODE
></DT
><DD
><P
>可視性マップに従って、リレーション内の全可視ページの数と全凍結ページの数を返します。
     </P
></DD
><DT
><CODE
CLASS="FUNCTION"
>pg_check_frozen(relation regclass, t_ctid OUT tid) returns setof tid</CODE
></DT
><DD
><P
>可視性マップ内で全凍結と印を付けられたページ内に格納されている非凍結タプルのTIDを返します。
この関数が返すTIDの集合が空でないなら、可視性マップは壊れています。
     </P
></DD
><DT
><CODE
CLASS="FUNCTION"
>pg_check_visible(relation regclass, t_ctid OUT tid) returns setof tid</CODE
></DT
><DD
><P
>可視性マップ内で全可視と印を付けられたページ内に格納されている全可視でないタプルのTIDを返します。
この関数が返すTIDの集合が空でないなら、可視性マップは壊れています。
     </P
></DD
><DT
><CODE
CLASS="FUNCTION"
>pg_truncate_visibility_map(relation regclass) returns void</CODE
></DT
><DD
><P
>指定のリレーションの可視性マップを切り詰めます。
そのリレーションの可視性マップが壊れていると思われ、強制的に再構築したい場合にこの関数は有効です。
この関数を実行した後に、指定のリレーション上で実行される最初の<TT
CLASS="COMMAND"
>VACUUM</TT
>において、リレーション内の全ページがスキャンされ、可視性マップが再構築されます。
（それが終わるまでは、可視性マップの中がすべてゼロになっているものとして問い合わせは動作します。）
     </P
></DD
></DL
></DIV
><P
>デフォルトでは、これらの関数はスーパーユーザのみが実行可能です。
  </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN185318"
>F.32.2. 作者</A
></H2
><P
>   Robert Haas <CODE
CLASS="EMAIL"
>&#60;<A
HREF="mailto:rhaas@postgresql.org"
>rhaas@postgresql.org</A
>&#62;</CODE
>
  </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="pgtrgm.html"
ACCESSKEY="P"
>前のページ</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>ホーム</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="postgres-fdw.html"
ACCESSKEY="N"
>次のページ</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>pg_trgm</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="contrib.html"
ACCESSKEY="U"
>上に戻る</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>postgres_fdw</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>